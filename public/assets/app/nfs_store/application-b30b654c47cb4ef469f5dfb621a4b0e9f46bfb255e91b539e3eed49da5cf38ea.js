!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}(function(u){u.ui=u.ui||{};u.ui.version="1.12.1";var o,n=0,s=Array.prototype.slice;u.cleanData=(o=u.cleanData,function(e){var t,n,i;for(i=0;null!=(n=e[i]);i++)try{(t=u._data(n,"events"))&&t.remove&&u(n).triggerHandler("remove")}catch(r){}o(e)}),u.widget=function(e,n,t){var i,r,o,a={},s=e.split(".")[0],l=s+"-"+(e=e.split(".")[1]);return t||(t=n,n=u.Widget),u.isArray(t)&&(t=u.extend.apply(null,[{}].concat(t))),u.expr[":"][l.toLowerCase()]=function(e){return!!u.data(e,l)},u[s]=u[s]||{},i=u[s][e],r=u[s][e]=function(e,t){if(!this._createWidget)return new r(e,t);arguments.length&&this._createWidget(e,t)},u.extend(r,i,{version:t.version,_proto:u.extend({},t),_childConstructors:[]}),(o=new n).options=u.widget.extend({},o.options),u.each(t,function(t,o){u.isFunction(o)?a[t]=function(){function i(){return n.prototype[t].apply(this,arguments)}function r(e){return n.prototype[t].apply(this,e)}return function(){var e,t=this._super,n=this._superApply;return this._super=i,this._superApply=r,e=o.apply(this,arguments),this._super=t,this._superApply=n,e}}():a[t]=o}),r.prototype=u.widget.extend(o,{widgetEventPrefix:i&&o.widgetEventPrefix||e},a,{constructor:r,namespace:s,widgetName:e,widgetFullName:l}),i?(u.each(i._childConstructors,function(e,t){var n=t.prototype;u.widget(n.namespace+"."+n.widgetName,r,t._proto)}),delete i._childConstructors):n._childConstructors.push(r),u.widget.bridge(e,r),r},u.widget.extend=function(e){for(var t,n,i=s.call(arguments,1),r=0,o=i.length;r<o;r++)for(t in i[r])n=i[r][t],i[r].hasOwnProperty(t)&&n!==undefined&&(u.isPlainObject(n)?e[t]=u.isPlainObject(e[t])?u.widget.extend({},e[t],n):u.widget.extend({},n):e[t]=n);return e},u.widget.bridge=function(o,t){var a=t.prototype.widgetFullName||o;u.fn[o]=function(n){var e="string"==typeof n,i=s.call(arguments,1),r=this;return e?this.length||"instance"!==n?this.each(function(){var e,t=u.data(this,a);return"instance"===n?(r=t,!1):t?u.isFunction(t[n])&&"_"!==n.charAt(0)?(e=t[n].apply(t,i))!==t&&e!==undefined?(r=e&&e.jquery?r.pushStack(e.get()):e,!1):void 0:u.error("no such method '"+n+"' for "+o+" widget instance"):u.error("cannot call methods on "+o+" prior to initialization; attempted to call method '"+n+"'")}):r=undefined:(i.length&&(n=u.widget.extend.apply(null,[n].concat(i))),this.each(function(){var e=u.data(this,a);e?(e.option(n||{}),e._init&&e._init()):u.data(this,a,new t(n,this))})),r}},u.Widget=function(){},u.Widget._childConstructors=[],u.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,t){t=u(t||this.defaultElement||this)[0],this.element=u(t),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=u(),this.hoverable=u(),this.focusable=u(),this.classesElementLookup={},t!==this&&(u.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=u(t.style?t.ownerDocument:t.document||t),this.window=u(this.document[0].defaultView||this.document[0].parentWindow)),this.options=u.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:u.noop,_create:u.noop,_init:u.noop,destroy:function(){var n=this;this._destroy(),u.each(this.classesElementLookup,function(e,t){n._removeClass(t,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:u.noop,widget:function(){return this.element},option:function(e,t){var n,i,r,o=e;if(0===arguments.length)return u.widget.extend({},this.options);if("string"==typeof e)if(o={},e=(n=e.split(".")).shift(),n.length){for(i=o[e]=u.widget.extend({},this.options[e]),r=0;r<n.length-1;r++)i[n[r]]=i[n[r]]||{},i=i[n[r]];if(e=n.pop(),1===arguments.length)return i[e]===undefined?null:i[e];i[e]=t}else{if(1===arguments.length)return this.options[e]===undefined?null:this.options[e];o[e]=t}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(e){var t,n,i;for(t in e)i=this.classesElementLookup[t],e[t]!==this.options.classes[t]&&i&&i.length&&(n=u(i.get()),this._removeClass(i,t),n.addClass(this._classes({element:n,keys:t,classes:e,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(r){function e(e,t){var n,i;for(i=0;i<e.length;i++)n=a.classesElementLookup[e[i]]||u(),n=r.add?u(u.unique(n.get().concat(r.element.get()))):u(n.not(r.element).get()),a.classesElementLookup[e[i]]=n,o.push(e[i]),t&&r.classes[e[i]]&&o.push(r.classes[e[i]])}var o=[],a=this;return r=u.extend({element:this.element,classes:this.options.classes||{}},r),this._on(r.element,{remove:"_untrackClassesElement"}),r.keys&&e(r.keys.match(/\S+/g)||[],!0),r.extra&&e(r.extra.match(/\S+/g)||[]),o.join(" ")},_untrackClassesElement:function(n){var i=this;u.each(i.classesElementLookup,function(e,t){-1!==u.inArray(n.target,t)&&(i.classesElementLookup[e]=u(t.not(n.target).get()))})},_removeClass:function(e,t,n){return this._toggleClass(e,t,n,!1)},_addClass:function(e,t,n){return this._toggleClass(e,t,n,!0)},_toggleClass:function(e,t,n,i){i="boolean"==typeof i?i:n;var r="string"==typeof e||null===e,o={extra:r?t:n,keys:r?e:t,element:r?this.element:e,add:i};return o.element.toggleClass(this._classes(o),i),this},_on:function(a,s,e){var l,f=this;"boolean"!=typeof a&&(e=s,s=a,a=!1),e?(s=l=u(s),this.bindings=this.bindings.add(s)):(e=s,s=this.element,l=this.widget()),u.each(e,function(e,t){function n(){if(a||!0!==f.options.disabled&&!u(this).hasClass("ui-state-disabled"))return("string"==typeof t?f[t]:t).apply(f,arguments)}"string"!=typeof t&&(n.guid=t.guid=t.guid||n.guid||u.guid++);var i=e.match(/^([\w:-]*)\s*(.*)$/),r=i[1]+f.eventNamespace,o=i[2];o?l.on(r,o,n):s.on(r,n)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(t).off(t),this.bindings=u(this.bindings.not(e).get()),this.focusable=u(this.focusable.not(e).get()),this.hoverable=u(this.hoverable.not(e).get())},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(u(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(u(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(u(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(u(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,t,n){var i,r,o=this.options[e];if(n=n||{},(t=u.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],r=t.originalEvent)for(i in r)i in t||(t[i]=r[i]);return this.element.trigger(t,n),!(u.isFunction(o)&&!1===o.apply(this.element[0],[t].concat(n))||t.isDefaultPrevented())}},u.each({show:"fadeIn",hide:"fadeOut"},function(o,a){u.Widget.prototype["_"+o]=function(t,e,n){var i;"string"==typeof e&&(e={effect:e});var r=e?!0===e||"number"==typeof e?a:e.effect||a:o;"number"==typeof(e=e||{})&&(e={duration:e}),i=!u.isEmptyObject(e),e.complete=n,e.delay&&t.delay(e.delay),i&&u.effects&&u.effects.effect[r]?t[o](e):r!==o&&t[r]?t[r](e.duration,e.easing,n):t.queue(function(e){u(this)[o](),n&&n.call(t[0]),e()})}});u.widget}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}(function(l){"use strict";var i=0,t=l,n="parseJSON";"JSON"in window&&"parse"in JSON&&(t=JSON,n="parse"),l.ajaxTransport("iframe",function(r){if(r.async){var o,a,t,s=r.initialIframeSrc||"javascript:false;";return{send:function(e,n){(o=l('<form style="display:none;"></form>')).attr("accept-charset",r.formAcceptCharset),t=/\?/.test(r.url)?"&":"?","DELETE"===r.type?(r.url=r.url+t+"_method=DELETE",r.type="POST"):"PUT"===r.type?(r.url=r.url+t+"_method=PUT",r.type="POST"):"PATCH"===r.type&&(r.url=r.url+t+"_method=PATCH",r.type="POST"),a=l('<iframe src="'+s+'" name="iframe-transport-'+(i+=1)+'"></iframe>').bind("load",function(){var i,t=l.isArray(r.paramName)?r.paramName:[r.paramName];a.unbind("load").bind("load",function(){var e;try{if(!(e=a.contents()).length||!e[0].firstChild)throw new Error}catch(t){e=undefined}n(200,"success",{iframe:e}),l('<iframe src="'+s+'"></iframe>').appendTo(o),window.setTimeout(function(){o.remove()},0)}),o.prop("target",a.prop("name")).prop("action",r.url).prop("method",r.type),r.formData&&l.each(r.formData,function(e,t){l('<input type="hidden"/>').prop("name",t.name).val(t.value).appendTo(o)}),r.fileInput&&r.fileInput.length&&"POST"===r.type&&(i=r.fileInput.clone(),r.fileInput.after(function(e){return i[e]}),r.paramName&&r.fileInput.each(function(e){l(this).prop("name",t[e]||r.paramName)}),o.append(r.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),r.fileInput.removeAttr("form")),o.submit(),i&&i.length&&r.fileInput.each(function(e,t){var n=l(i[e]);l(t).prop("name",n.prop("name")).attr("form",n.attr("form")),n.replaceWith(t)})}),o.append(a).appendTo(document.body)},abort:function(){a&&a.unbind("load").prop("src",s),o&&o.remove()}}}}),l.ajaxSetup({converters:{"iframe text":function(e){return e&&l(e[0].body).text()},"iframe json":function(e){return e&&t[n](l(e[0].body).text())},"iframe html":function(e){return e&&l(e[0].body).html()},"iframe xml":function(e){var t=e&&e[0];return t&&l.isXMLDoc(t)?t:l.parseXML(t.XMLDocument&&t.XMLDocument.xml||l(t.body).html())},"iframe script":function(e){return e&&l.globalEval(l(e[0].body).text())}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(_){"use strict";function e(n){var i="dragover"===n;return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=e.dataTransfer;t&&-1!==_.inArray("Files",t.types)&&!1!==this._trigger(n,_.Event(n,{delegatedEvent:e}))&&(e.preventDefault(),i&&(t.dropEffect="copy"))}}_.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||_('<input type="file"/>').prop("disabled")),_.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),_.support.xhrFormDataFileUpload=!!window.FormData,_.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),_.widget("blueimp.fileupload",{options:{dropZone:_(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(n,e){return n=this.messages[n]||n.toString(),e&&_.each(e,function(e,t){n=n.replace("{"+e+"}",t)}),n},formData:function(e){return e.serializeArray()},add:function(e,t){if(e.isDefaultPrevented())return!1;(t.autoUpload||!1!==t.autoUpload&&_(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:_.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var i=e-this.timestamp;return(!this.bitrate||!n||n<i)&&(this.bitrate=(t-this.loaded)*(1e3/i)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&_.support.xhrFileUpload||_.support.xhrFormDataFileUpload)},_getFormData:function(e){var n;return"function"===_.type(e.formData)?e.formData(e.form):_.isArray(e.formData)?e.formData:"object"===_.type(e.formData)?(n=[],_.each(e.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(e){var n=0;return _.each(e,function(e,t){n+=t.size||1}),n},_initProgressObject:function(e){var t={loaded:0,total:0,bitrate:0};e._progress?_.extend(e._progress,t):e._progress=t},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var n,i=Date.now?Date.now():(new Date).getTime();if(t._time&&t.progressInterval&&i-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=i,n=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=n-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(i,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=n,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(i,n,t.bitrateInterval),this._trigger("progress",_.Event("progress",{delegatedEvent:e}),t),this._trigger("progressall",_.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(n){var i=this,e=n.xhr?n.xhr():_.ajaxSettings.xhr();e.upload&&(_(e.upload).bind("progress",function(e){var t=e.originalEvent;e.lengthComputable=t.lengthComputable,e.loaded=t.loaded,e.total=t.total,i._onProgress(e,n)}),n.xhr=function(){return e})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(n){var i,r=this,e=n.files[0],t=n.multipart||!_.support.xhrFileUpload,o="array"===_.type(n.paramName)?n.paramName[0]:n.paramName;n.headers=_.extend({},n.headers),n.contentRange&&(n.headers["Content-Range"]=n.contentRange),t&&!n.blob&&this._isInstanceOf("File",e)||(n.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.uploadName||e.name)+'"'),t?_.support.xhrFormDataFileUpload&&(n.postMessage?(i=this._getFormData(n),n.blob?i.push({name:o,value:n.blob}):_.each(n.files,function(e,t){i.push({name:"array"===_.type(n.paramName)&&n.paramName[e]||o,value:t})})):(r._isInstanceOf("FormData",n.formData)?i=n.formData:(i=new FormData,_.each(this._getFormData(n),function(e,t){i.append(t.name,t.value)})),n.blob?i.append(o,n.blob,e.uploadName||e.name):_.each(n.files,function(e,t){(r._isInstanceOf("File",t)||r._isInstanceOf("Blob",t))&&i.append("array"===_.type(n.paramName)&&n.paramName[e]||o,t,t.uploadName||t.name)})),n.data=i):(n.contentType=e.type||"application/octet-stream",n.data=n.blob||e),n.blob=null},_initIframeSettings:function(e){var t=_("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t&&t!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(e){var t=_(e.fileInput),i=e.paramName;return i?_.isArray(i)||(i=[i]):(i=[],t.each(function(){for(var e=_(this),t=e.prop("name")||"files[]",n=(e.prop("files")||[1]).length;n;)i.push(t),n-=1}),i.length||(i=[t.prop("name")||"files[]"])),i},_initFormSettings:function(e){e.form&&e.form.length||(e.form=_(e.fileInput.prop("form")),e.form.length||(e.form=_(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===_.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var t=_.extend({},this.options,e);return this._initFormSettings(t),this._initDataSettings(t),t},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,n){var i=_.Deferred(),r=i.promise();return t=t||this.options.context||r,!0===e?i.resolveWith(t,n):!1===e&&i.rejectWith(t,n),r.abort=i.promise,this._enhancePromise(r)},_addConvenienceMethods:function(e,n){var i=this,r=function(e){return _.Deferred().resolveWith(i,e).promise()};n.process=function(e,t){return(e||t)&&(n._processQueue=this._processQueue=(this._processQueue||r([this])).then(function(){return n.errorThrown?_.Deferred().rejectWith(i,[n]).promise():r(arguments)}).then(e,t)),this._processQueue||r([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=!1!==i._trigger("submit",_.Event("submit",{delegatedEvent:e}),this)&&i._onSend(e,this)),this.jqXHR||i._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._trigger("fail",null,this),i._getXHRPromise(!1))},n.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),i=n&&1<n.length&&parseInt(n[1],10);return i&&i+1},_chunkedUpload:function(o,e){o.uploadedBytes=o.uploadedBytes||0;var t,a,s=this,n=o.files[0],l=n.size,f=o.uploadedBytes,u=o.maxChunkSize||l,d=this._blobSlice,c=_.Deferred(),i=c.promise();return!(!(this._isXHRUpload(o)&&d&&(f||("function"===_.type(u)?u(o):u)<l))||o.data)&&(!!e||(l<=f?(n.error=o.i18n("uploadedBytes"),this._getXHRPromise(!1,o.context,[null,"error",n.error])):(a=function(){var i=_.extend({},o),r=i._progress.loaded;i.blob=d.call(n,f,f+("function"===_.type(u)?u(i):u),n.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+f+"-"+(f+i.chunkSize-1)+"/"+l,s._trigger("chunkbeforesend",null,i),s._initXHRData(i),s._initProgressListener(i),t=(!1!==s._trigger("chunksend",null,i)&&_.ajax(i)||s._getXHRPromise(!1,i.context)).done(function(e,t,n){f=s._getUploadedBytes(n)||f+i.chunkSize,r+i.chunkSize-i._progress.loaded&&s._onProgress(_.Event("progress",{lengthComputable:!0,loaded:f-i.uploadedBytes,total:f-i.uploadedBytes}),i),o.uploadedBytes=i.uploadedBytes=f,i.result=e,i.textStatus=t,i.jqXHR=n,s._trigger("chunkdone",null,i),s._trigger("chunkalways",null,i),f<l?a():c.resolveWith(i.context,[e,t,n])}).fail(function(e,t,n){i.jqXHR=e,i.textStatus=t,i.errorThrown=n,s._trigger("chunkfail",null,i),s._trigger("chunkalways",null,i),c.rejectWith(i.context,[e,t,n])})},this._enhancePromise(i),i.abort=function(){return t.abort()},a(),i)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(e,t,n,i){var r=i._progress.total,o=i._response;i._progress.loaded<r&&this._onProgress(_.Event("progress",{lengthComputable:!0,loaded:r,total:r}),i),o.result=i.result=e,o.textStatus=i.textStatus=t,o.jqXHR=i.jqXHR=n,this._trigger("done",null,i)},_onFail:function(e,t,n,i){var r=i._response;i.recalculateProgress&&(this._progress.loaded-=i._progress.loaded,this._progress.total-=i._progress.total),r.jqXHR=i.jqXHR=e,r.textStatus=i.textStatus=t,r.errorThrown=i.errorThrown=n,this._trigger("fail",null,i)},_onAlways:function(e,t,n,i){this._trigger("always",null,i)},_onSend:function(e,t){t.submit||this._addConvenienceMethods(e,t);var n,i,r,o,a=this,s=a._getAJAXSettings(t),l=function(){return a._sending+=1,s._bitrateTimer=new a._BitrateTimer,n=n||((i||!1===a._trigger("send",_.Event("send",{delegatedEvent:e}),s))&&a._getXHRPromise(!1,s.context,i)||a._chunkedUpload(s)||_.ajax(s)).done(function(e,t,n){a._onDone(e,t,n,s)}).fail(function(e,t,n){a._onFail(e,t,n,s)}).always(function(e,t,n){if(a._onAlways(e,t,n,s),a._sending-=1,a._active-=1,s.limitConcurrentUploads&&s.limitConcurrentUploads>a._sending)for(var i=a._slots.shift();i;){if("pending"===a._getDeferredState(i)){i.resolve();break}i=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(e,s),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(r=_.Deferred(),this._slots.push(r),o=r.then(l)):(this._sequence=this._sequence.then(l,l),o=this._sequence),o.abort=function(){return i=[undefined,"abort","abort"],n?n.abort():(r&&r.rejectWith(s.context,i),l())},this._enhancePromise(o)):l()},_onAdd:function(i,r){var o,e,a,t,s=this,l=!0,n=_.extend({},this.options,r),f=r.files,u=f.length,d=n.limitMultiFileUploads,c=n.limitMultiFileUploadSize,p=n.limitMultiFileUploadSizeOverhead,h=0,g=this._getParamName(n),m=0;if(!u)return!1;if(c&&f[0].size===undefined&&(c=undefined),(n.singleFileUploads||d||c)&&this._isXHRUpload(n))if(n.singleFileUploads||c||!d)if(!n.singleFileUploads&&c)for(a=[],o=[],t=0;t<u;t+=1)h+=f[t].size+p,(t+1===u||h+f[t+1].size+p>c||d&&d<=t+1-m)&&(a.push(f.slice(m,t+1)),(e=g.slice(m,t+1)).length||(e=g),o.push(e),m=t+1,h=0);else o=g;else for(a=[],o=[],t=0;t<u;t+=d)a.push(f.slice(t,t+d)),(e=g.slice(t,t+d)).length||(e=g),o.push(e);else a=[f],o=[g];return r.originalFiles=f,_.each(a||f,function(e,t){var n=_.extend({},r);return n.files=a?t:[t],n.paramName=o[e],s._initResponseObject(n),s._initProgressObject(n),s._addConvenienceMethods(i,n),l=s._trigger("add",_.Event("add",{delegatedEvent:i}),n)}),l},_replaceFileInput:function(e){var n=e.fileInput,i=n.clone(!0),t=n.is(document.activeElement);e.fileInputClone=i,_("<form></form>").append(i)[0].reset(),n.after(i).detach(),t&&i.focus(),_.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?i[0]:t}),n[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,n){var e,i=this,r=_.Deferred(),o=[],a=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])},s=function(e){i._handleFileTreeEntries(e,n+t.name+"/").done(function(e){r.resolve(e)}).fail(a)},l=function(){e.readEntries(function(e){e.length?(o=o.concat(e),l()):s(o)},a)};return n=n||"",t.isFile?t._file?(t._file.relativePath=n,r.resolve(t._file)):t.file(function(e){e.relativePath=n,r.resolve(e)},a):t.isDirectory?(e=t.createReader(),l()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(e,t){var n=this;return _.when.apply(_,_.map(e,function(e){return n._handleFileTreeEntry(e,t)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){var t=(e=e||{}).items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?this._handleFileTreeEntries(_.map(t,function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()})):_.Deferred().resolve(_.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){var t,n,i=(e=_(e)).prop("webkitEntries")||e.prop("entries");if(i&&i.length)return this._handleFileTreeEntries(i);if((t=_.makeArray(e.prop("files"))).length)t[0].name===undefined&&t[0].fileName&&_.each(t,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(n=e.prop("value")))return _.Deferred().resolve([]).promise();t=[{name:n.replace(/^.*\\/,"")}]}return _.Deferred().resolve(t).promise()},_getFileInputFiles:function(e){return e instanceof _&&1!==e.length?_.when.apply(_,_.map(e,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(t){var n=this,i={fileInput:_(t.target),form:_(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(e){i.files=e,n.options.replaceFileInput&&n._replaceFileInput(i),!1!==n._trigger("change",_.Event("change",{delegatedEvent:t}),i)&&n._onAdd(t,i)})},_onPaste:function(e){var t=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,i={files:[]};t&&t.length&&(_.each(t,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&i.files.push(n)}),!1!==this._trigger("paste",_.Event("paste",{delegatedEvent:e}),i)&&this._onAdd(e,i))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,e=t.dataTransfer,i={};e&&e.files&&e.files.length&&(t.preventDefault(),this._getDroppedFiles(e).always(function(e){i.files=e,!1!==n._trigger("drop",_.Event("drop",{delegatedEvent:t}),i)&&n._onAdd(t,i)}))},_onDragOver:e("dragover"),_onDragEnter:e("dragenter"),_onDragLeave:e("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),_.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(e,t){var n=-1!==_.inArray(e,this._specialOptions);n&&this._destroyEventHandlers(),this._super(e,t),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;e.fileInput===undefined?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof _||(e.fileInput=_(e.fileInput)),e.dropZone instanceof _||(e.dropZone=_(e.dropZone)),e.pasteZone instanceof _||(e.pasteZone=_(e.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(e,t){return"url"!==e&&"string"===_.type(t)&&/^\/.*\/[igm]{0,3}$/.test(t)},_initDataAttributes:function(){var r=this,o=this.options,a=this.element.data();_.each(this.element[0].attributes,function(e,t){var n,i=t.name.toLowerCase();/^data-/.test(i)&&(i=i.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),n=a[i],r._isRegExpOption(i,n)&&(n=r._getRegExp(n)),o[i]=n)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=_.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n,i,r=this,o=_.Deferred(),e=o.promise();return e.abort=function(){return i=!0,n?n.abort():(o.reject(null,"abort","abort"),e)},this._getFileInputFiles(t.fileInput).always(function(e){i||(e.length?(t.files=e,(n=r._onSend(null,t)).then(function(e,t,n){o.resolve(e,t,n)},function(e,t,n){o.reject(e,t,n)})):o.reject())}),this._enhancePromise(e)}if(t.files=_.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});var _nfs_store={fs_browser:function(l){"use strict";var f={},e=function(){return $('.container-browser-outer[data-container-id="'+v+'"] .container-browser')},u=function(e,t,n,i){r("download",e,t),r("trash",e,t),r("move-files",e,t),t?(r("rename-file",e,t),r("rename-folder",e,t)):(r("rename-file",e,t=1!=n),r("rename-folder",e,t=1!=i))},r=function(e,t,n){n||(n=!("true"==y.attr("data-can-submit-"+e)));var i=n?"disabled":null;$("#container-browse-"+e+"-"+v).attr("disabled",i),$("#container-browse-"+e+"-in-form-"+v).attr("disabled",i)},d=function(e,t){$("#container-browse-download-"+v+" .btn-caption").html(t)},t=function(){var e=$("#container-browse-download-in-form-"+v),t=e.parents("form").first();t.removeAttr("data-remote"),t.removeData("remote"),e.click()},i=function(e,t,n){var i=$("#container-browse-"+t+"-in-form-"+v),r=i.parents("form").first();if(r&&0!==r.length){var o=r.find(".extra_params");if(o.html(""),n)for(var a in n)if(n.hasOwnProperty(a)){var s=n[a];s=s.replace(/"/,"&quot;"),o.append('<input type="hidden" name="nfs_store_download['+a+']" value="'+s+'" />')}r.attr("data-remote","true"),r[0].app_callback=function(){c(l,v)},i.click()}},c=function(e,t){$('.refresh-container-list[data-container-id="'+t+'"]').click(),n(e)},n=function(e){l.removeClass("ajax-running"),u(e,!0),s(e)},o=function(e,t,n){t.stopPropagation();var i=y.find('.folder-icon[aria-controls="'+e.attr("id")+'"]');n?(i.removeClass("folder-open"),i.addClass("glyphicon-folder-close"),i.removeClass("glyphicon-folder-open"),i.attr("title","expand folder")):(i.addClass("folder-open"),i.addClass("glyphicon-folder-open"),i.removeClass("glyphicon-folder-close"),i.attr("title","shrink folder"))},a=function(e,t){var n=l.find(".container-browser");if(n.addClass("browser-hide-meta browser-hide-classifications"),e||(e=$('input[name="container-meta-controls-'+v+'"]:checked')),e){var i=e.val();n.removeClass("browser-hide-"+i)}var r=l.parents(".common-template-item.is-activity-log").first(),o=r.hasClass("col-md-8"),a=!1;r.removeClass("col-md-8 col-lg-6 col-lg-8 col-md-12 col-lg-12"),"classifications"==i?r.addClass("col-md-12 col-lg-12"):"meta"==i?r.addClass("col-md-12 col-lg-12"):(a=!0,r.addClass("col-md-8 col-lg-6")),o!=a&&window.setTimeout(function(){t||_fpa.utils.jump_to_linked_item(r,null,{no_highlight:!0}),_fpa.form_utils.resize_children(l)},100)},s=function(e){var t=y.find('.container-entry input[type="checkbox"]:checked'),n=y.find('.container-folder input[type="checkbox"]:checked'),i=t.length,r=n.length,o=t.first().siblings(".browse-filename").html(),a=t.first().parents(".container-folder-items"),s=a.not('[data-folder-items="."]').last();0!=s.length&&-1!=s.attr("data-folder-items").indexOf("__mounted-archive__")||(s=a.last()),s=s.prev().add(s);var l=a.first();return l=l.prev().add(l),d(e,"download "+i+" "+(1!=i?"files":"file")),u(e,!i,i,r),y.find(".container-entry.checked").removeClass("checked"),t.each(function(){$(this).is(":checked")&&$(this).parent().addClass("checked")}),y.find(".container-folder.checked").removeClass("checked"),n.each(function(){$(this).is(":checked")&&$(this).parent().addClass("checked")}),f={total_checked:i,total_checked_folders:r,first_file:o,$folder_top:s,$folder_in:l}},p=function(e){var t=e.parents(".container-folder-items").first(),n=t.attr("data-folder-items"),i=t.find('> .container-entry input[type="checkbox"]'),r=i.length==i.closest(":checked").length;y.find('.container-folder input[type="checkbox"][data-folder-path="'+n+'"] ').prop("checked",r),s(e)},h=function(e){var t=e.attr("data-folder-path"),n=e.is(":checked");y.find('.container-folder-items[data-folder-items="'+t+'"] li input[type="checkbox"]').prop("checked",n),s(e)},g=function(e){var t=$($(this).attr("data-target-browser")),n={};b.find(".container-browse-action-extra-params").each(function(){var e=$(this);n[e.attr("name")]=e.val()}),i(t,e,n),u(t,!0),b.modal("hide")},m=function(e,t){if(e=e.replace(/^\.?\/?/,"")){if(t)var n=[t,e].join("/");else n=e;n=(n=n.replace(/^\.?\/?/,"")).replace(/^[^\/]+\.__mounted-archive__(\/|$)/,"");b.find(
'input[name="new_path"]').val(n)}},_=function(){if(e=b.find(".browse-move-to-folders .container-folder.checked [data-folder-path]").first().attr("data-folder-path"))var e=(e=e.replace(/^\.?\/?/,"")).replace(/^[^\/]+\.__mounted-archive__(\/|$)/,"");b.find(".container-browser-move-from").html(e)},v=function(e){var t=e.attr("data-container-id");return t||e.parents(".container-browser-outer").attr("data-container-id")}(l),y=e();l.on("change",'.container-browser .container-entry input[type="checkbox"]',function(){p($(this))}).on("change",'.container-browser .container-folder input[type="checkbox"]',function(){h($(this))}).on("hidden.bs.collapse",".container-browser .container-folder-items",function(e){o($(this),e,!0)}).on("shown.bs.collapse",".container-browser .container-folder-items",function(e){o($(this),e,!1)}).on("click",".container-browse-download",function(){var e=$($(this).attr("data-target-browser"));t(e),u(e,!0),d(e,"request submitted")}).on("click",".container-browse-trash-submit",function(){var e=$($(this).attr("data-target-browser"));i(e,"trash"),u(e,!0)}).on("click",".container-browse-trigger-file-action",function(){var e=$($(this).attr("data-target-browser")),t=$(this).attr("data-trigger-file-action");i(e,"trigger-file-action-"+t),u(e,!0),window.setTimeout(function(){c(l,v)},1e4)}).on("click",".container-browse-move-files",function(){$($(this).attr("data-target-browser"));var e=$("#container-browse-move-files-form-"+v).html(),t="Move Files to a folder";_fpa.show_modal(e,t);var n=f.$folder_top,i=(n.find(".container-folder, .container-folder-items"),b.find(".browse-move-to-folders"));n.clone().appendTo(i),n.first().hasClass("root-folder")&&i.find(".container-folder-items").each(function(){var e=$(this);0<=e.attr("data-folder-items").indexOf(".__mounted-archive__")&&(e.prev().remove(),e.remove())}),i.find(".container-entry").remove(),i.find(".container-folder-items").each(function(){var e=$(this),n=e.prev(),t=e.attr("id");e.attr("id","bmtf-"+t),e.attr("aria-expanded","true"),e.addClass("in");var i=e.attr("data-folder-items");$('<a class="container-add"><input type="checkbox" class="container-folder-add hidden" data-folder-path="'+i+'" /> <span class="glyphicon glyphicon-plus"></span> folder</a>').appendTo(n).on("click",function(e){e.preventDefault(),$(this).find("input.container-folder-add").prop("checked",!0).change();var t=b.find(".container-new-folder-name");t.slideDown(),m(t.val(),i),t.on("keyup",function(){var e=$(this).val();m(e,i)}),n.append(t)})}),i.find(".folder-icon").each(function(){var e=$(this),t=e.attr("href");if(t){var n="#bmtf-"+t.replace(/^#/,"");e.attr("href",n),e.attr("aria-controls",n)}e.addClass("folder-open glyphicon-folder-open").removeClass("glyphicon-folder")});var r=i.find('input[type="checkbox"]');r.each(function(){$(this).prop("checked",!1)}),b.find(".container-new-folder-name").parent().slideUp(),i.on("change",'input[type="checkbox"]',function(){var e=$(this),t=e.attr("data-folder-path");r.not('[data-folder-path="'+t+'"]').prop("checked",!1);var n=b.find(".container-new-folder-name");e.hasClass("container-folder-add")||n.slideUp(),m(t)}),_()}).on("click",".container-browse-rename-file",function(){$($(this).attr("data-target-browser"));var e=$("#container-browse-rename-file-form-"+v).html(),t="Rename file";_fpa.show_modal(e,t),b.find('input[name="new_name"]').val(f.first_file)});var b=$("#primary-modal");b.on("click",".container-browse-move-files-submit",function(){g("move-files")}).on("click",".container-browse-rename-file-submit",function(){g("rename-file")}),$(document).on("click",'.refresh-container-list[data-container-id="'+v+'"]',function(){l.find(".container-browser").addClass("ajax-running")}).on("change",'input[name="container-meta-controls-'+v+'"]',function(){a($(this))});var w=$('input[name="container-meta-controls-'+v+'"]:checked');return a(w,!0),n(l),this},uploader:function(l){"use strict";function n(e,t){if(f)t=null;else{e&&(m=0,o=null,p=e,g=Math.ceil(p.size/h),a=t,!1,d=[]);var n=new FileReader;n.onload=v,n.onerror=y;var i=m*h,r=i+h>=p.size?p.size:i+h;n.readAsArrayBuffer(c.call(p,i,r))}}var o,a,f,s,i,u={url:"/nfs_store/chunk",dataType:"json",autoUpload:!1,dropZone:l.find(".upload-dropzone"),disableImageResize:!0,singleFileUploads:!0,sequentialUploads:!0,previewMaxWidth:100,previewMaxHeight:100,previewCrop:!0,maxChunkSize:1e7,headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}},d=[],c=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,p=null,h=u.maxChunkSize,g=0,m=0,r=new SparkMD5.ArrayBuffer,_=new SparkMD5.ArrayBuffer,v=function(e){var t=e.target.result;_.reset(),_.append(t),d.push(_.end()),r.append(t),++m<g?n():(o=r.end(),!0,a&&a(o))},y=function(){!0},b=function(e,t,n,i,r){var o=l.find(".template .file-block").clone(!0).attr("data-file-index",t);o.find(".file-name").text(n.name),f=!1,o.find(".button-upload-abort").on("click",function(){var e=$(this),t=e.data();e.hide(),f=!0,o.find(".button-upload-resume").show(),t.abort()}).data(e),o.find(".button-upload-resume").on("click",function(){$(this).hide(),o.find(".button-upload-abort").show(),f=!1,C(o),P(r,i)}),o.find(".started-at").html((new Date).toLocaleTimeString());var a=l.find(".data-context");o.appendTo(a),o.data(e);var s=a.get(0).getBoundingClientRect();return!(0<=s.top&&s.top<=.8*$(window).height())&&$.scrollTo(a,0,{offset:.8*-$(window).height()}),o},w=function(e){e.removeClass("process-ready").addClass("process-complete"),e.removeClass("progress-running"),k(e),console.log("completed upload of file")},x=function(e,t){t||(t=S()),e.join||(e=[e]),t.find(".file-error").text("file upload failed: "+e.join(" | ")),t.find(".progress-bar").addClass("progress-bar-failed").removeClass("progress-bar-success"),t.find(".progress-bar-status-text").text("failed"),t.removeClass("progress-running"),k(t),D()},C=function(e){e.addClass("process-ready").removeClass("process-complete"),e.find(".file-error").text(""),e.find(".progress-bar").removeClass("progress-bar-failed").addClass("progress-bar-success"),e.find(".progress-bar-status-text").text("processing")},k=function(e){e.find(".button-upload-abort").hide()},D=function(){l.find(".fileinput-button").show()},e=function(){l.find(".fileinput-button").hide()},t=function(){l.find(".data-context .file-block[data-file-index]").remove()},S=function(){return l.find(".data-context .file-block.process-ready").first()},A=function(){return l.find(".data-context .file-block")},E=function(e){var t=[],n=e.jqXHR.responseJSON;if(n&&n.message)return t.push(n.message),t;var i=e.jqXHR.getResponseHeader("X-Upload-Errors"),r=JSON.parse(i);for(var o in r)r.hasOwnProperty(o)&&t.push(o.replace("_"," ")+" "+r[o].join("; "));return 0==t.length&&t.push("unknown server error"),t},F=function(){l.find(".refresh-container-list").click()},T=function(){var e=I(),t=j(),n={activity_log_id:e.activity_log_id,activity_log_type:e.activity_log_type,container_id:t,"do":"done",uploaded_ids:s.join(",")};$.ajax({url:u.url+"/"+t,data:n,type:"PUT",success:function(){console.log("Sent all done message")}})},j=function(){return l.find("#uploader_container_id").val()},I=function(){var e=l.find(".nfs-store-container-block");return{activity_log_id:e.attr("data-activity-log-id"),activity_log_type:e.attr("data-activity-log-type")}},P=function(r,o){var e=S();if(0!=e.length){var a=e.data();f=!1,e.addClass("progress-running"),e.find(".progress-bar-status-text").text("processing"),i=i||A().length.toString()+"--"+Date.now().toString()+"--"+Math.random().toString(),n(a.files[0],function(e){a.formData||(a.formData={}),a.formData.file_hash=e,a.formData.container_id=j(),a.formData.upload_set=i,a.files[0].relativePath&&""!=a.files[0].relativePath&&(a.formData.relative_path=a.files[0].relativePath),1==d.length&&(a.formData.chunk_hash=d.shift());var t=I();if(r){var n={file_name:a.files[0].name,file_hash:a.formData.file_hash,relative_path:a.formData.relative_path,activity_log_id:t.activity_log_id,activity_log_type:t.activity_log_type};$.getJSON(u.url+"/"+j(),n,function(e){if("found"==e.result&&!e.completed){var t=e.file_size,n=e.chunk_count;a.uploadedBytes=t;for(var i=0;i<n;i++)a.formData.chunk_hash=d.shift();$.blueimp.fileupload.prototype.options.add.call(r,o,a)}setTimeout(function(){a.submit()},100)}).fail(function(e){var t=["The upload failed"];e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),x(t)})}else setTimeout(function(){a.submit()},100)})}};l.find(".upload-dropzone").on("dragover",function(){$(this).addClass("on-drag")}).on("dragleave",function(){$(this).removeClass("on-drag")}).on("drop",function(){l.find(".fileinput-button").is(":visible")?(e(),t(),$(this).removeClass("on-drag")):console.log("Upload not enabled!")});l.find("input.nfs-store-fileupload").fileupload(u).on("click",function(){t()}).on("fileuploadadd",function(i,r){if("false"!=l.find(".container-browser").attr("data-container-writable")){e();var o=this;$.each(r.files,function(e,t){var n=0==S().length;b(r,e,t,i,o);n&&(s=[],setTimeout(function(){P(o,i)},1e3))})}else console.log("Upload not enabled!")}).on("fileuploadchunkbeforesend",function(e,t){t.formData||(t.formData={}),t.formData.chunk_hash=d.shift(),t.formData.upload_set=i,S().find(".progress-bar-status-text").text("uploading")}).on("fileuploadchunksend",function(){return!f}).on("fileuploadprocessalways",function(e,t){console.log("fileuploadprocessalways");var n=0,i=t.files[n],r=S();r.find(".progress-bar-status-text").text("uploading"),i.error&&r.find(".file-error").text(i.error)}).on("fileuploadprogress",function(e,t){var n=S(),i=parseInt(t.loaded/t.total*100,10);n.find(".progress .progress-bar").css("width",i+"%");var r=n.get(0).getBoundingClientRect();!(0<=r.top&&r.top<=.8*$(window).height())&&$.scrollTo(n,0,{offset:.8*-$(window).height()})}).on("fileuploaddone",function(e,t){console.log("fileuploadaddone");var n=t.result.file,i=S();n.url?(i.find(".progress-bar-status-text").text("completed"),s.push(n.id)):n.error&&i.find(".file-error").text(n.error)}).on("fileuploadfail",function(e,t){var n;console.log("fileuploadfail"),n=f?["Upload canceled"]:E(t),x(n)}).on("fileuploadalways",function(n,e){console.log("fileuploadalways");var i=this;$.each(e.files,function(){var e=S();e.find(".ended-at").text((new Date).toLocaleTimeString()),w(e);var t=S();!f&&0<t.length?P(i,n):(D(),F(),T())})}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?undefined:"disabled")}};(function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)})(function(v){"use strict";function y(e){return!e.nodeName||-1!==v.inArray(e.nodeName.toLowerCase(),["iframe","#document","html","body"])}function t(e){return v.isFunction(e)||v.isPlainObject(e)?e:{top:e,left:e}}var b=v.scrollTo=function(e,t,n){return v(window).scrollTo(e,t,n)};return b.defaults={axis:"xy",duration:0,limit:!0},v.fn.scrollTo=function(e,n,m){"object"==typeof n&&(m=n,n=0),"function"==typeof m&&(m={onAfter:m}),"max"===e&&(e=9e9),m=v.extend({},b.defaults,m),n=n||m.duration;var _=m.queue&&1<m.axis.length;return _&&(n/=2),m.offset=t(m.offset),m.over=t(m.over),this.each(function(){function l(e){var t=v.extend({},m,{queue:!0,duration:n,complete:e&&function(){e.call(d,p,m)}});c.animate(h,t)}if(null!==e){var f,u=y(this),d=u?this.contentWindow||window:this,c=v(d),p=e,h={};switch(typeof p){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(p)){p=t(p);break}p=u?v(p):v(p,d);case"object":if(0===p.length)return;(p.is||p.style)&&(f=(p=v(p)).offset())}var g=v.isFunction(m.offset)&&m.offset(d,p)||m.offset;v.each(m.axis.split(""),function(e,t){var n="x"===t?"Left":"Top",i=n.toLowerCase(),r="scroll"+n,o=c[r](),a=b.max(d,t);if(f)h[r]=f[i]+(u?0:o-c.offset()[i]),m.margin&&(h[r]-=parseInt(p.css("margin"+n),10)||0,h[r]-=parseInt(p.css("border"+n+"Width"),10)||0),h[r]+=g[i]||0,m.over[i]&&(h[r]+=p["x"===t?"width":"height"]()*m.over[i]);else{var s=p[i];h[r]=s.slice&&"%"===s.slice(-1)?parseFloat(s)/100*a:s}m.limit&&/^\d+$/.test(h[r])&&(h[r]=h[r]<=0?0:Math.min(h[r],a)),!e&&1<m.axis.length&&(o===h[r]?h={}:_&&(l(m.onAfterFirst),h={}))}),l(m.onAfter)}})},b.max=function(e,t){var n="x"===t?"Width":"Height",i="scroll"+n;if(!y(e))return e[i]-v(e)[n.toLowerCase()]();var r="client"+n,o=e.ownerDocument||e.document,a=o.documentElement,s=o.body;return Math.max(a[i],s[i])-Math.min(a[r],s[r])},v.Tween.propHooks.scrollLeft=v.Tween.propHooks.scrollTop={get:function(e){return v(e.elem)[e.prop]()},set:function(e){var t=this.get(e);if(e.options.interrupt&&e._last&&e._last!==t)return v(e.elem).stop();var n=Math.round(e.now);t!==n&&(v(e.elem)[e.prop](n),e._last=this.get(e))}},b}),function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(n){t=self}t.SparkMD5=e()}}(function(u){"use strict";function f(e,t){var n=e[0],i=e[1],r=e[2],o=e[3];i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&r)+t[1]-389564586|0)<<12|o>>>20)+n|0)&n|~o&i)+t[2]+606105819|0)<<17|r>>>15)+o|0)&o|~r&n)+t[3]-1044525330|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&r)+t[5]+1200080426|0)<<12|o>>>20)+n|0)&n|~o&i)+t[6]-1473231341|0)<<17|r>>>15)+o|0)&o|~r&n)+t[7]-45705983|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&r)+t[9]-1958414417|0)<<12|o>>>20)+n|0)&n|~o&i)+t[10]-42063|0)<<17|r>>>15)+o|0)&o|~r&n)+t[11]-1990404162|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&r)+t[13]-40341101|0)<<12|o>>>20)+n|0)&n|~o&i)+t[14]-1502002290|0)<<17|r>>>15)+o|0)&o|~r&n)+t[15]+1236535329|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[1]-165796510|0)<<5|n>>>27)+i|0)&r|i&~r)+t[6]-1069501632|0)<<9|o>>>23)+n|0)&i|n&~i)+t[11]+643717713|0)<<14|r>>>18)+o|0)&n|o&~n)+t[0]-373897302|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[5]-701558691|0)<<5|n>>>27)+i|0)&r|i&~r)+t[10]+38016083|0)<<9|o>>>23)+n|0)&i|n&~i)+t[15]-660478335|0)<<14|r>>>18)+o|0)&n|o&~n)+t[4]-405537848|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[9]+568446438|0)<<5|n>>>27)+i|0)&r|i&~r)+t[14]-1019803690|0)<<9|o>>>23)+n|0)&i|n&~i)+t[3]-187363961|0)<<14|r>>>18)+o|0)&n|o&~n)+t[8]+1163531501|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[13]-1444681467|0)<<5|n>>>27)+i|0)&r|i&~r)+t[2]-51403784|0)<<9|o>>>23)+n|0)&i|n&~i)+t[7]+1735328473|0)<<14|r>>>18)+o|0)&n|o&~n)+t[12]-1926607734|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[5]-378558|0)<<4|n>>>28)+i|0)^i^r)+t[8]-2022574463|0)<<11|o>>>21)+n|0)^n^i)+t[11]+1839030562|0)<<16|r>>>16)+o|0)^o^n)+t[14]-35309556|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[1]-1530992060|0)<<4|n>>>28)+i|0)^i^r)+t[4]+1272893353|0)<<11|o>>>21)+n|0)^n^i)+t[7]-155497632|0)<<16|r>>>16)+o|0)^o^n)+t[10]-1094730640|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[13]+681279174|0)<<4|n>>>28)+i|0)^i^r)+t[0]-358537222|0)<<11|o>>>21)+n|0)^n^i)+t[3]-722521979|0)<<16|r>>>16)+o|0)^o^n)+t[6]+76029189|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[9]-640364487|0)<<4|n>>>28)+i|0)^i^r)+t[12]-421815835|0)<<11|o>>>21)+n|0)^n^i)+t[15]+530742520|0)<<16|r>>>16)+o|0)^o^n)+t[2]-995338651|0)<<23|i>>>9)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[0]-198630844|0)<<6|n>>>26)+i|0)|~r))+t[7]+1126891415|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[14]-1416354905|0)<<15|r>>>17)+o|0)|~n))+t[5]-57434055|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[12]+1700485571|0)<<6|n>>>26)+i|0)|~r))+t[3]-1894986606|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[10]-1051523|0)<<15|r>>>17)+o|0)|~n))+t[1]-2054922799|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[8]+1873313359|0)<<6|n>>>26)+i|0)|~r))+t[15]-30611744|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[6]-1560198380|0)<<15|r>>>17)+o|0)|~n))+t[13]+1309151649|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[4]-145523070|0)<<6|n>>>26)+i|0)|~r))+t[11]-1120210379|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[2]+718787259|0)<<15|r>>>17)+o|0)|~n))+t[9]-343485551|0)<<21|i>>>11)+r|0,e[0]=n+e[0]|0,e[1]=i+e[1]|0,e[2]=r+e[2]|0,e[3]=o+e[3]|0}function d(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function c(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function i(e){var t,n,i,r,o,a,s=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)f(l,d(e.substring(t-64,t)));for(n=(e=e.substring(t-64)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),55<t)for(f(l,i),t=0;t<16;t+=1)i[t]=0;return r=(r=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),a=parseInt(r[1],16)||0,i[14]=o,i[15]=a,f(l,i),l}function r(e){var t,n,i,r,o,a,s=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)f(l,c(e.subarray(t-64,t)));for(n=(e=t-64<s?e.subarray(t-64):new Uint8Array(0)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)i[t>>2]|=e[t]<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),55<t)for(f(l,i),t=0;t<16;t+=1)i[t]=0;return r=(r=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),a=parseInt(r[1],16)||0,i[14]=o,i[15]=a,f(l,i),l}function n(e){var t,n="";for(t=0;t<4;t+=1)n+=g[e>>8*t+4&15]+g[e>>8*t&15];return n}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=n(e[t]);return e.join("")}function o(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function t(e,t){var n,i=e.length,r=new ArrayBuffer(i),o=new Uint8Array(r);for(n=0;n<i;n+=1)o[n]=e.charCodeAt(n);return t?o:r}function s(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function l(e,t,n){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e)),i.set(new Uint8Array(t),e.byteLength),n?i:i.buffer}function p(e){var t,n=[],i=e.length;for(t=0;t<i-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function h(){this.reset()}var g=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==a(i("hello"))&&function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function f(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(e,t){var n,i,r,o,a=this.byteLength,s=f(e,a),l=a;return t!==u&&(l=f(t,a)),l<s?new ArrayBuffer(0):(n=l-s,i=new ArrayBuffer(n),r=new Uint8Array(i),o=new Uint8Array(this,s,n),r.set(o),i)}}(),h.prototype.append=function(e){return this.appendBinary(o(e)),this},h.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)f(this._hash,d(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},h.prototype.end=function(e){var t,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=i.charCodeAt(t)<<(t%4<<3);return this._finish(o,r),n=a(this._hash),e&&(n=p(n)),this.reset(),n},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},h.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(e,t){var n,i,r,o=t;if(e[o>>2]|=128<<(o%4<<3),55<o)for(f(this._hash,e),o=0;o<16;o+=1)e[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),r=parseInt(n[1],16)||0,e[14]=i,e[15]=r,f(this._hash,e)},h.hash=function(e,t){return h.hashBinary(o(e),t)},h.hashBinary=function(e,t){var n=a(i(e));return t?p(n):n},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(e){var t,n=l(this._buff.buffer,e,!0),i=n.length;for(this._length+=e.byteLength,t=64;t<=i;t+=64)f(this._hash,c(n.subarray(t-64,t)));return this._buff=t-64<i?new Uint8Array(n.buffer.slice(t-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=i[t]<<(t%4<<3);return this._finish(o,r),n=a(this._hash),e&&(n=p(n)),this.reset(),n},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);return e.buff=s(e.buff),e},h.ArrayBuffer.prototype.setState=function(e){return e.buff=t(e.buff,!0),h.prototype.setState.call(this,e)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(e,t){var n=a(r(new Uint8Array(e)));return t?p(n):n},h});
<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Fpa-phase3</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.0/favicon_red.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2015-12-14T13:29:36-05:00">2015-12-14T13:29:36-05:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="red">70.92%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         141.35
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>78</b> files in total.
    <b>2586</b> relevant lines. 
    <span class="green"><b>1834</b> lines covered</span> and
    <span class="red"><b>752</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#3d52d552acca5a1602ad089aa844269e07a78f72" class="src_link" title="app/controllers/addresses_controller.rb">app/controllers/addresses_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>2.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#02df4104396e8908b2167c5e4b5a1d4b2ba0da1a" class="src_link" title="app/controllers/admin/accuracy_scores_controller.rb">app/controllers/admin/accuracy_scores_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a08d692090b4e60683f484233ba2c26c9a50adb3" class="src_link" title="app/controllers/admin/action_logs_controller.rb">app/controllers/admin/action_logs_controller.rb</a></td>
        <td class="red strong">30.0 %</td>
        <td>36</td>
        <td>20</td>
        <td>6</td>
        <td>14</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2eb45cafc15ccec83eec92cd43e05ca55d4a4e5d" class="src_link" title="app/controllers/admin/colleges_controller.rb">app/controllers/admin/colleges_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b798379305fa3e589ef0848a0ad58fbf9c77e595" class="src_link" title="app/controllers/admin/dynamic_models_controller.rb">app/controllers/admin/dynamic_models_controller.rb</a></td>
        <td class="red strong">70.0 %</td>
        <td>22</td>
        <td>10</td>
        <td>7</td>
        <td>3</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#19518024bafdd733461d01d78b61fb5aa112b7ce" class="src_link" title="app/controllers/admin/external_links_controller.rb">app/controllers/admin/external_links_controller.rb</a></td>
        <td class="red strong">80.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>4</td>
        <td>1</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4fd2822da64e849cb850b894d2023a9ea35179b5" class="src_link" title="app/controllers/admin/general_selections_controller.rb">app/controllers/admin/general_selections_controller.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>24</td>
        <td>12</td>
        <td>10</td>
        <td>2</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#087dc0be179ffab4df96d929d26539245c2ecfd5" class="src_link" title="app/controllers/admin/item_flag_names_controller.rb">app/controllers/admin/item_flag_names_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8718b84c23f8554caa4dc37be88c503157674d7f" class="src_link" title="app/controllers/admin/manage_users_controller.rb">app/controllers/admin/manage_users_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>63</td>
        <td>37</td>
        <td>37</td>
        <td>0</td>
        <td>4.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#05fb131d761e6cc0252ff9a68353c987443f1222" class="src_link" title="app/controllers/admin/reports_controller.rb">app/controllers/admin/reports_controller.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>24</td>
        <td>12</td>
        <td>8</td>
        <td>4</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#84718f4950b9b69b66339fd7df614acffe8e11de" class="src_link" title="app/controllers/admin/sage_assignments_controller.rb">app/controllers/admin/sage_assignments_controller.rb</a></td>
        <td class="red strong">26.67 %</td>
        <td>52</td>
        <td>30</td>
        <td>8</td>
        <td>22</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b02621eb3923c4e8edf0a99f8a60fc94663aaa7a" class="src_link" title="app/controllers/admin/user_authorizations_controller.rb">app/controllers/admin/user_authorizations_controller.rb</a></td>
        <td class="red strong">77.78 %</td>
        <td>37</td>
        <td>18</td>
        <td>14</td>
        <td>4</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9bb59fc39f6409f37ec986bf43ed35a9a126e171" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="red strong">65.09 %</td>
        <td>172</td>
        <td>106</td>
        <td>69</td>
        <td>37</td>
        <td>110.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#523801ce21092ad013198388d39bd5b472091267" class="src_link" title="app/controllers/concerns/admin_controller_handler.rb">app/controllers/concerns/admin_controller_handler.rb</a></td>
        <td class="green strong">90.38 %</td>
        <td>195</td>
        <td>104</td>
        <td>94</td>
        <td>10</td>
        <td>38.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fdbd1f992e19e5f58d3980b99ed63bc5d5a7777e" class="src_link" title="app/controllers/concerns/controller_utils.rb">app/controllers/concerns/controller_utils.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>44</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>817.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0136d940b22eecc79e6f400c7bc8e10f60bc275d" class="src_link" title="app/controllers/concerns/master_handler.rb">app/controllers/concerns/master_handler.rb</a></td>
        <td class="green strong">91.76 %</td>
        <td>166</td>
        <td>85</td>
        <td>78</td>
        <td>7</td>
        <td>44.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d7c27593da0819da96ee3aa118d6a5a8b9e5f679" class="src_link" title="app/controllers/concerns/master_search.rb">app/controllers/concerns/master_search.rb</a></td>
        <td class="red strong">55.22 %</td>
        <td>163</td>
        <td>67</td>
        <td>37</td>
        <td>30</td>
        <td>7.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9005f4da15251d710f6c48586711ec788046cedd" class="src_link" title="app/controllers/definitions_controller.rb">app/controllers/definitions_controller.rb</a></td>
        <td class="yellow strong">90.0 %</td>
        <td>51</td>
        <td>20</td>
        <td>18</td>
        <td>2</td>
        <td>8.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#30dbdd2a9a36f1066d811670b12c8fa66acda8dc" class="src_link" title="app/controllers/item_flags_controller.rb">app/controllers/item_flags_controller.rb</a></td>
        <td class="green strong">97.78 %</td>
        <td>84</td>
        <td>45</td>
        <td>44</td>
        <td>1</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#81b97db9b808541b660990310bcda52d878fbec0" class="src_link" title="app/controllers/masters_controller.rb">app/controllers/masters_controller.rb</a></td>
        <td class="yellow strong">83.64 %</td>
        <td>102</td>
        <td>55</td>
        <td>46</td>
        <td>9</td>
        <td>11.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1914f54c0af454341740a28eb126391a5a4fdf67" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#53bf0d048f8bca2922f29b19778551e452e55cf9" class="src_link" title="app/controllers/player_contacts_controller.rb">app/controllers/player_contacts_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fc1fc4b5ad0f9504c900fffe67dea4da2e05aca3" class="src_link" title="app/controllers/player_infos_controller.rb">app/controllers/player_infos_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9abad669ca5fd84b56f84cb34553249dceeafa0b" class="src_link" title="app/controllers/pro_infos_controller.rb">app/controllers/pro_infos_controller.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>29</td>
        <td>15</td>
        <td>9</td>
        <td>6</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5d587db5e2251adb04867bb73cd4726480d74380" class="src_link" title="app/controllers/protocol_events_controller.rb">app/controllers/protocol_events_controller.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>50</td>
        <td>32</td>
        <td>28</td>
        <td>4</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ca24beb8d51b543df621c667f4f668fa66f0b0ab" class="src_link" title="app/controllers/protocols_controller.rb">app/controllers/protocols_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#094d745b9ba08060c10b2779a385264df86813bb" class="src_link" title="app/controllers/reports_controller.rb">app/controllers/reports_controller.rb</a></td>
        <td class="red strong">21.32 %</td>
        <td>252</td>
        <td>136</td>
        <td>29</td>
        <td>107</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#902072f6c900407dc389676429dab718c5fdfcc5" class="src_link" title="app/controllers/sage_assignments_controller.rb">app/controllers/sage_assignments_controller.rb</a></td>
        <td class="red strong">57.14 %</td>
        <td>12</td>
        <td>7</td>
        <td>4</td>
        <td>3</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#22db40a6130130b7f2f820a2da1893565a534b17" class="src_link" title="app/controllers/scantrons_controller.rb">app/controllers/scantrons_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c15ef96a21554680d4a9f755c4b9939279a53886" class="src_link" title="app/controllers/sub_processes_controller.rb">app/controllers/sub_processes_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>30</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>4.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3a4823be60f4cf1e321fff637c3d2b90b574aa38" class="src_link" title="app/controllers/tracker_histories_controller.rb">app/controllers/tracker_histories_controller.rb</a></td>
        <td class="red strong">72.0 %</td>
        <td>45</td>
        <td>25</td>
        <td>18</td>
        <td>7</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#40b3ac5979c0fa42fe8e7b5172f08ca81ff18bf3" class="src_link" title="app/controllers/trackers_controller.rb">app/controllers/trackers_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>26</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>4.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7b3558e2806fa4875bb1d0535978d2cdc5ad3d57" class="src_link" title="app/helpers/addresses_helper.rb">app/helpers/addresses_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fc0134917d4f7fea5483b4f35f177948a9ea420e" class="src_link" title="app/helpers/admin_helper.rb">app/helpers/admin_helper.rb</a></td>
        <td class="red strong">31.25 %</td>
        <td>33</td>
        <td>16</td>
        <td>5</td>
        <td>11</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a11f63a483af63b82c57334ebcd72eaa73b5cf9c" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="green strong">96.88 %</td>
        <td>68</td>
        <td>32</td>
        <td>31</td>
        <td>1</td>
        <td>7.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bd0cc68f37cf55552fefa410090747b45a42f29e" class="src_link" title="app/helpers/colleges_helper.rb">app/helpers/colleges_helper.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>8</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#adb3fb94e429b0da088ae8a815bc0be93c028a5b" class="src_link" title="app/helpers/general_selections_helper.rb">app/helpers/general_selections_helper.rb</a></td>
        <td class="red strong">16.67 %</td>
        <td>36</td>
        <td>18</td>
        <td>3</td>
        <td>15</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e76d32342699189f11a8b0babaf798d2a2a2dd60" class="src_link" title="app/helpers/item_flag_names_helper.rb">app/helpers/item_flag_names_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>8</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f977333907c7fe73c3a2b47c649ce613bbc41786" class="src_link" title="app/helpers/item_flags_helper.rb">app/helpers/item_flags_helper.rb</a></td>
        <td class="red strong">45.0 %</td>
        <td>38</td>
        <td>20</td>
        <td>9</td>
        <td>11</td>
        <td>1.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a9ea82560d5866ffd8a2b6847e527d9773898e4d" class="src_link" title="app/helpers/manage_users_helper.rb">app/helpers/manage_users_helper.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>3</td>
        <td>2</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7d4434fe223047a8fdfc34b8ae595733c650b129" class="src_link" title="app/helpers/player_infos_helper.rb">app/helpers/player_infos_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>35.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d31761a5436407aaaa247244ed9cfa1d9c6092d8" class="src_link" title="app/helpers/protocols_helper.rb">app/helpers/protocols_helper.rb</a></td>
        <td class="yellow strong">82.76 %</td>
        <td>60</td>
        <td>29</td>
        <td>24</td>
        <td>5</td>
        <td>147.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#27d5c7c7a524ebbe6644e431cf2d95eff1e81126" class="src_link" title="app/helpers/reports_helper.rb">app/helpers/reports_helper.rb</a></td>
        <td class="red strong">11.11 %</td>
        <td>72</td>
        <td>36</td>
        <td>4</td>
        <td>32</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7a0e45bf9bbdb4a2d3ec7041c59a8904f6e407bd" class="src_link" title="app/models/accuracy_score.rb">app/models/accuracy_score.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>22</td>
        <td>13</td>
        <td>12</td>
        <td>1</td>
        <td>215.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a84033f6307212cecb04f0471e0d732fa16e5258" class="src_link" title="app/models/address.rb">app/models/address.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>88</td>
        <td>48</td>
        <td>48</td>
        <td>0</td>
        <td>8.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#023b3b1a04409f4bb74916f6f5c8664d61780124" class="src_link" title="app/models/address_state.rb">app/models/address_state.rb</a></td>
        <td class="red strong">80.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>4</td>
        <td>1</td>
        <td>8.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5ff4a9d72d9b6881ecff2b4c947c2dcb43dc0cf8" class="src_link" title="app/models/admin.rb">app/models/admin.rb</a></td>
        <td class="green strong">96.43 %</td>
        <td>59</td>
        <td>28</td>
        <td>27</td>
        <td>1</td>
        <td>96.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3fe68e17741ff6e4677d36e1615a8d9be61b5883" class="src_link" title="app/models/application.rb">app/models/application.rb</a></td>
        <td class="red strong">62.5 %</td>
        <td>33</td>
        <td>16</td>
        <td>10</td>
        <td>6</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b160023a4d514c27ebbed47dd74a3eedcb700a5e" class="src_link" title="app/models/college.rb">app/models/college.rb</a></td>
        <td class="yellow strong">89.09 %</td>
        <td>98</td>
        <td>55</td>
        <td>49</td>
        <td>6</td>
        <td>19.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2e0342d36f44f3455138737e8140e7d5f1d19f5a" class="src_link" title="app/models/concerns/action_logging.rb">app/models/concerns/action_logging.rb</a></td>
        <td class="green strong">91.67 %</td>
        <td>28</td>
        <td>12</td>
        <td>11</td>
        <td>1</td>
        <td>152.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#54d9b6b6af789bb9768c955fbccda37bf74cd052" class="src_link" title="app/models/concerns/admin_handler.rb">app/models/concerns/admin_handler.rb</a></td>
        <td class="red strong">77.42 %</td>
        <td>55</td>
        <td>31</td>
        <td>24</td>
        <td>7</td>
        <td>1801.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ba40741aa680f4fea33bdfd05bb56a14432007d5" class="src_link" title="app/models/concerns/email_validator.rb">app/models/concerns/email_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>8.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8556113e8e5dc0030552f1743e300f8b6139ce5e" class="src_link" title="app/models/concerns/phone_validator.rb">app/models/concerns/phone_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>13.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4ac397411420be86725e6e5a0ae4362fee6ad1e2" class="src_link" title="app/models/concerns/selector_cache.rb">app/models/concerns/selector_cache.rb</a></td>
        <td class="red strong">74.7 %</td>
        <td>158</td>
        <td>83</td>
        <td>62</td>
        <td>21</td>
        <td>557.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#629e917dbe53705a6551541a95706af1366a708c" class="src_link" title="app/models/concerns/source_validator.rb">app/models/concerns/source_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>41.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fac0fc1ae37681e88f7db12476c8f8b995cdf768" class="src_link" title="app/models/concerns/standard_authentication.rb">app/models/concerns/standard_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>235.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#28e153cf04871da06adfed4e67df133f71c813ce" class="src_link" title="app/models/concerns/tracker_handler.rb">app/models/concerns/tracker_handler.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>58</td>
        <td>32</td>
        <td>32</td>
        <td>0</td>
        <td>46.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#00dee317d6486be39bfc0e61aa284dd497fa50ed" class="src_link" title="app/models/concerns/user_handler.rb">app/models/concerns/user_handler.rb</a></td>
        <td class="green strong">97.35 %</td>
        <td>221</td>
        <td>113</td>
        <td>110</td>
        <td>3</td>
        <td>663.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99707eb199e012a3a9c3a5324962c57e642974d8" class="src_link" title="app/models/concerns/zip_validator.rb">app/models/concerns/zip_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>14.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5a49de125c9407187782b84c454e08302f9991f0" class="src_link" title="app/models/dynamic_model.rb">app/models/dynamic_model.rb</a></td>
        <td class="red strong">26.56 %</td>
        <td>243</td>
        <td>128</td>
        <td>34</td>
        <td>94</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c7366c5d8013baccd2ce4e28f174ae6aa46066db" class="src_link" title="app/models/external_link.rb">app/models/external_link.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#af98140a1b26920ff9e5e518e1682ad2758f0aa7" class="src_link" title="app/models/general_selection.rb">app/models/general_selection.rb</a></td>
        <td class="green strong">96.55 %</td>
        <td>59</td>
        <td>29</td>
        <td>28</td>
        <td>1</td>
        <td>640.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#16d28da60e0f0f5c6d4d4522ba0b38fb179b260e" class="src_link" title="app/models/item_flag.rb">app/models/item_flag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>115</td>
        <td>58</td>
        <td>58</td>
        <td>0</td>
        <td>48.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#73328a99e127221cd02ed24a384585bcacbdbb3b" class="src_link" title="app/models/item_flag_name.rb">app/models/item_flag_name.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>26</td>
        <td>16</td>
        <td>12</td>
        <td>4</td>
        <td>51.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1befacb49a983ae4c74694b5802259f714e0db49" class="src_link" title="app/models/master.rb">app/models/master.rb</a></td>
        <td class="yellow strong">87.1 %</td>
        <td>425</td>
        <td>186</td>
        <td>162</td>
        <td>24</td>
        <td>230.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e1b4db774c16bbc02e02b4cff7656bb25f0f0a98" class="src_link" title="app/models/player_contact.rb">app/models/player_contact.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>14.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#46cb3fa9156911bd72fb7482f8c1de2e978cb988" class="src_link" title="app/models/player_info.rb">app/models/player_info.rb</a></td>
        <td class="green strong">90.91 %</td>
        <td>77</td>
        <td>44</td>
        <td>40</td>
        <td>4</td>
        <td>75.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c71ced2163cf3e6353bb659168f30e1c07412441" class="src_link" title="app/models/pro_info.rb">app/models/pro_info.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>10.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e01ababc9446f439b95e4d039d71550a43d901b5" class="src_link" title="app/models/protocol.rb">app/models/protocol.rb</a></td>
        <td class="green strong">92.86 %</td>
        <td>28</td>
        <td>14</td>
        <td>13</td>
        <td>1</td>
        <td>211.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#98590394c0bc46d6acc2f42cfe4c93d212e16e51" class="src_link" title="app/models/protocol_event.rb">app/models/protocol_event.rb</a></td>
        <td class="red strong">76.47 %</td>
        <td>32</td>
        <td>17</td>
        <td>13</td>
        <td>4</td>
        <td>1006.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#56b5a12bb9520f23d8ff6e830a614d24ee0e5a91" class="src_link" title="app/models/report.rb">app/models/report.rb</a></td>
        <td class="red strong">18.14 %</td>
        <td>384</td>
        <td>215</td>
        <td>39</td>
        <td>176</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4a65739570344d003364109276fc6f1c2f106c74" class="src_link" title="app/models/sage_assignment.rb">app/models/sage_assignment.rb</a></td>
        <td class="red strong">42.31 %</td>
        <td>101</td>
        <td>52</td>
        <td>22</td>
        <td>30</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1a818d2e95a029f4ef8784be1e2da04115b26da8" class="src_link" title="app/models/scantron.rb">app/models/scantron.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>25</td>
        <td>12</td>
        <td>10</td>
        <td>2</td>
        <td>11.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5dc6cb468d885b4d4b16a2a7c269d548e1af81d4" class="src_link" title="app/models/sub_process.rb">app/models/sub_process.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>23</td>
        <td>13</td>
        <td>11</td>
        <td>2</td>
        <td>2.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#16874e21f199af1671f2bd73cb5fdae457ec0fdc" class="src_link" title="app/models/tracker.rb">app/models/tracker.rb</a></td>
        <td class="green strong">96.23 %</td>
        <td>209</td>
        <td>106</td>
        <td>102</td>
        <td>4</td>
        <td>288.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#103f97233dd2e31753992438b2ac9a62aa0cdabd" class="src_link" title="app/models/tracker_history.rb">app/models/tracker_history.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2c0b033daf85fa819de42760d05b5170de1ae026" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="yellow strong">83.78 %</td>
        <td>77</td>
        <td>37</td>
        <td>31</td>
        <td>6</td>
        <td>192.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c5950c1fa459c0888705c815c5da7d71d6bef7e3" class="src_link" title="app/models/user_authorization.rb">app/models/user_authorization.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>45.3</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="red">71.11%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         43.04
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>32</b> files in total.
    <b>945</b> relevant lines. 
    <span class="green"><b>672</b> lines covered</span> and
    <span class="red"><b>273</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#3d52d552acca5a1602ad089aa844269e07a78f72" class="src_link" title="app/controllers/addresses_controller.rb">app/controllers/addresses_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>2.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#02df4104396e8908b2167c5e4b5a1d4b2ba0da1a" class="src_link" title="app/controllers/admin/accuracy_scores_controller.rb">app/controllers/admin/accuracy_scores_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a08d692090b4e60683f484233ba2c26c9a50adb3" class="src_link" title="app/controllers/admin/action_logs_controller.rb">app/controllers/admin/action_logs_controller.rb</a></td>
        <td class="red strong">30.0 %</td>
        <td>36</td>
        <td>20</td>
        <td>6</td>
        <td>14</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2eb45cafc15ccec83eec92cd43e05ca55d4a4e5d" class="src_link" title="app/controllers/admin/colleges_controller.rb">app/controllers/admin/colleges_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b798379305fa3e589ef0848a0ad58fbf9c77e595" class="src_link" title="app/controllers/admin/dynamic_models_controller.rb">app/controllers/admin/dynamic_models_controller.rb</a></td>
        <td class="red strong">70.0 %</td>
        <td>22</td>
        <td>10</td>
        <td>7</td>
        <td>3</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#19518024bafdd733461d01d78b61fb5aa112b7ce" class="src_link" title="app/controllers/admin/external_links_controller.rb">app/controllers/admin/external_links_controller.rb</a></td>
        <td class="red strong">80.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>4</td>
        <td>1</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4fd2822da64e849cb850b894d2023a9ea35179b5" class="src_link" title="app/controllers/admin/general_selections_controller.rb">app/controllers/admin/general_selections_controller.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>24</td>
        <td>12</td>
        <td>10</td>
        <td>2</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#087dc0be179ffab4df96d929d26539245c2ecfd5" class="src_link" title="app/controllers/admin/item_flag_names_controller.rb">app/controllers/admin/item_flag_names_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8718b84c23f8554caa4dc37be88c503157674d7f" class="src_link" title="app/controllers/admin/manage_users_controller.rb">app/controllers/admin/manage_users_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>63</td>
        <td>37</td>
        <td>37</td>
        <td>0</td>
        <td>4.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#05fb131d761e6cc0252ff9a68353c987443f1222" class="src_link" title="app/controllers/admin/reports_controller.rb">app/controllers/admin/reports_controller.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>24</td>
        <td>12</td>
        <td>8</td>
        <td>4</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#84718f4950b9b69b66339fd7df614acffe8e11de" class="src_link" title="app/controllers/admin/sage_assignments_controller.rb">app/controllers/admin/sage_assignments_controller.rb</a></td>
        <td class="red strong">26.67 %</td>
        <td>52</td>
        <td>30</td>
        <td>8</td>
        <td>22</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b02621eb3923c4e8edf0a99f8a60fc94663aaa7a" class="src_link" title="app/controllers/admin/user_authorizations_controller.rb">app/controllers/admin/user_authorizations_controller.rb</a></td>
        <td class="red strong">77.78 %</td>
        <td>37</td>
        <td>18</td>
        <td>14</td>
        <td>4</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9bb59fc39f6409f37ec986bf43ed35a9a126e171" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="red strong">65.09 %</td>
        <td>172</td>
        <td>106</td>
        <td>69</td>
        <td>37</td>
        <td>110.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#523801ce21092ad013198388d39bd5b472091267" class="src_link" title="app/controllers/concerns/admin_controller_handler.rb">app/controllers/concerns/admin_controller_handler.rb</a></td>
        <td class="green strong">90.38 %</td>
        <td>195</td>
        <td>104</td>
        <td>94</td>
        <td>10</td>
        <td>38.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fdbd1f992e19e5f58d3980b99ed63bc5d5a7777e" class="src_link" title="app/controllers/concerns/controller_utils.rb">app/controllers/concerns/controller_utils.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>44</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>817.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0136d940b22eecc79e6f400c7bc8e10f60bc275d" class="src_link" title="app/controllers/concerns/master_handler.rb">app/controllers/concerns/master_handler.rb</a></td>
        <td class="green strong">91.76 %</td>
        <td>166</td>
        <td>85</td>
        <td>78</td>
        <td>7</td>
        <td>44.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d7c27593da0819da96ee3aa118d6a5a8b9e5f679" class="src_link" title="app/controllers/concerns/master_search.rb">app/controllers/concerns/master_search.rb</a></td>
        <td class="red strong">55.22 %</td>
        <td>163</td>
        <td>67</td>
        <td>37</td>
        <td>30</td>
        <td>7.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9005f4da15251d710f6c48586711ec788046cedd" class="src_link" title="app/controllers/definitions_controller.rb">app/controllers/definitions_controller.rb</a></td>
        <td class="yellow strong">90.0 %</td>
        <td>51</td>
        <td>20</td>
        <td>18</td>
        <td>2</td>
        <td>8.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#30dbdd2a9a36f1066d811670b12c8fa66acda8dc" class="src_link" title="app/controllers/item_flags_controller.rb">app/controllers/item_flags_controller.rb</a></td>
        <td class="green strong">97.78 %</td>
        <td>84</td>
        <td>45</td>
        <td>44</td>
        <td>1</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#81b97db9b808541b660990310bcda52d878fbec0" class="src_link" title="app/controllers/masters_controller.rb">app/controllers/masters_controller.rb</a></td>
        <td class="yellow strong">83.64 %</td>
        <td>102</td>
        <td>55</td>
        <td>46</td>
        <td>9</td>
        <td>11.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1914f54c0af454341740a28eb126391a5a4fdf67" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#53bf0d048f8bca2922f29b19778551e452e55cf9" class="src_link" title="app/controllers/player_contacts_controller.rb">app/controllers/player_contacts_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fc1fc4b5ad0f9504c900fffe67dea4da2e05aca3" class="src_link" title="app/controllers/player_infos_controller.rb">app/controllers/player_infos_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9abad669ca5fd84b56f84cb34553249dceeafa0b" class="src_link" title="app/controllers/pro_infos_controller.rb">app/controllers/pro_infos_controller.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>29</td>
        <td>15</td>
        <td>9</td>
        <td>6</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5d587db5e2251adb04867bb73cd4726480d74380" class="src_link" title="app/controllers/protocol_events_controller.rb">app/controllers/protocol_events_controller.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>50</td>
        <td>32</td>
        <td>28</td>
        <td>4</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ca24beb8d51b543df621c667f4f668fa66f0b0ab" class="src_link" title="app/controllers/protocols_controller.rb">app/controllers/protocols_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#094d745b9ba08060c10b2779a385264df86813bb" class="src_link" title="app/controllers/reports_controller.rb">app/controllers/reports_controller.rb</a></td>
        <td class="red strong">21.32 %</td>
        <td>252</td>
        <td>136</td>
        <td>29</td>
        <td>107</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#902072f6c900407dc389676429dab718c5fdfcc5" class="src_link" title="app/controllers/sage_assignments_controller.rb">app/controllers/sage_assignments_controller.rb</a></td>
        <td class="red strong">57.14 %</td>
        <td>12</td>
        <td>7</td>
        <td>4</td>
        <td>3</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#22db40a6130130b7f2f820a2da1893565a534b17" class="src_link" title="app/controllers/scantrons_controller.rb">app/controllers/scantrons_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c15ef96a21554680d4a9f755c4b9939279a53886" class="src_link" title="app/controllers/sub_processes_controller.rb">app/controllers/sub_processes_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>30</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>4.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3a4823be60f4cf1e321fff637c3d2b90b574aa38" class="src_link" title="app/controllers/tracker_histories_controller.rb">app/controllers/tracker_histories_controller.rb</a></td>
        <td class="red strong">72.0 %</td>
        <td>45</td>
        <td>25</td>
        <td>18</td>
        <td>7</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#40b3ac5979c0fa42fe8e7b5172f08ca81ff18bf3" class="src_link" title="app/controllers/trackers_controller.rb">app/controllers/trackers_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>26</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>4.9</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="red">72.89%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         217.53
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>35</b> files in total.
    <b>1472</b> relevant lines. 
    <span class="green"><b>1073</b> lines covered</span> and
    <span class="red"><b>399</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#7a0e45bf9bbdb4a2d3ec7041c59a8904f6e407bd" class="src_link" title="app/models/accuracy_score.rb">app/models/accuracy_score.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>22</td>
        <td>13</td>
        <td>12</td>
        <td>1</td>
        <td>215.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a84033f6307212cecb04f0471e0d732fa16e5258" class="src_link" title="app/models/address.rb">app/models/address.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>88</td>
        <td>48</td>
        <td>48</td>
        <td>0</td>
        <td>8.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#023b3b1a04409f4bb74916f6f5c8664d61780124" class="src_link" title="app/models/address_state.rb">app/models/address_state.rb</a></td>
        <td class="red strong">80.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>4</td>
        <td>1</td>
        <td>8.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5ff4a9d72d9b6881ecff2b4c947c2dcb43dc0cf8" class="src_link" title="app/models/admin.rb">app/models/admin.rb</a></td>
        <td class="green strong">96.43 %</td>
        <td>59</td>
        <td>28</td>
        <td>27</td>
        <td>1</td>
        <td>96.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3fe68e17741ff6e4677d36e1615a8d9be61b5883" class="src_link" title="app/models/application.rb">app/models/application.rb</a></td>
        <td class="red strong">62.5 %</td>
        <td>33</td>
        <td>16</td>
        <td>10</td>
        <td>6</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b160023a4d514c27ebbed47dd74a3eedcb700a5e" class="src_link" title="app/models/college.rb">app/models/college.rb</a></td>
        <td class="yellow strong">89.09 %</td>
        <td>98</td>
        <td>55</td>
        <td>49</td>
        <td>6</td>
        <td>19.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2e0342d36f44f3455138737e8140e7d5f1d19f5a" class="src_link" title="app/models/concerns/action_logging.rb">app/models/concerns/action_logging.rb</a></td>
        <td class="green strong">91.67 %</td>
        <td>28</td>
        <td>12</td>
        <td>11</td>
        <td>1</td>
        <td>152.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#54d9b6b6af789bb9768c955fbccda37bf74cd052" class="src_link" title="app/models/concerns/admin_handler.rb">app/models/concerns/admin_handler.rb</a></td>
        <td class="red strong">77.42 %</td>
        <td>55</td>
        <td>31</td>
        <td>24</td>
        <td>7</td>
        <td>1801.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ba40741aa680f4fea33bdfd05bb56a14432007d5" class="src_link" title="app/models/concerns/email_validator.rb">app/models/concerns/email_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>8.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8556113e8e5dc0030552f1743e300f8b6139ce5e" class="src_link" title="app/models/concerns/phone_validator.rb">app/models/concerns/phone_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>13.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4ac397411420be86725e6e5a0ae4362fee6ad1e2" class="src_link" title="app/models/concerns/selector_cache.rb">app/models/concerns/selector_cache.rb</a></td>
        <td class="red strong">74.7 %</td>
        <td>158</td>
        <td>83</td>
        <td>62</td>
        <td>21</td>
        <td>557.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#629e917dbe53705a6551541a95706af1366a708c" class="src_link" title="app/models/concerns/source_validator.rb">app/models/concerns/source_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>41.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fac0fc1ae37681e88f7db12476c8f8b995cdf768" class="src_link" title="app/models/concerns/standard_authentication.rb">app/models/concerns/standard_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>235.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#28e153cf04871da06adfed4e67df133f71c813ce" class="src_link" title="app/models/concerns/tracker_handler.rb">app/models/concerns/tracker_handler.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>58</td>
        <td>32</td>
        <td>32</td>
        <td>0</td>
        <td>46.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#00dee317d6486be39bfc0e61aa284dd497fa50ed" class="src_link" title="app/models/concerns/user_handler.rb">app/models/concerns/user_handler.rb</a></td>
        <td class="green strong">97.35 %</td>
        <td>221</td>
        <td>113</td>
        <td>110</td>
        <td>3</td>
        <td>663.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99707eb199e012a3a9c3a5324962c57e642974d8" class="src_link" title="app/models/concerns/zip_validator.rb">app/models/concerns/zip_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>14.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5a49de125c9407187782b84c454e08302f9991f0" class="src_link" title="app/models/dynamic_model.rb">app/models/dynamic_model.rb</a></td>
        <td class="red strong">26.56 %</td>
        <td>243</td>
        <td>128</td>
        <td>34</td>
        <td>94</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c7366c5d8013baccd2ce4e28f174ae6aa46066db" class="src_link" title="app/models/external_link.rb">app/models/external_link.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#af98140a1b26920ff9e5e518e1682ad2758f0aa7" class="src_link" title="app/models/general_selection.rb">app/models/general_selection.rb</a></td>
        <td class="green strong">96.55 %</td>
        <td>59</td>
        <td>29</td>
        <td>28</td>
        <td>1</td>
        <td>640.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#16d28da60e0f0f5c6d4d4522ba0b38fb179b260e" class="src_link" title="app/models/item_flag.rb">app/models/item_flag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>115</td>
        <td>58</td>
        <td>58</td>
        <td>0</td>
        <td>48.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#73328a99e127221cd02ed24a384585bcacbdbb3b" class="src_link" title="app/models/item_flag_name.rb">app/models/item_flag_name.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>26</td>
        <td>16</td>
        <td>12</td>
        <td>4</td>
        <td>51.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1befacb49a983ae4c74694b5802259f714e0db49" class="src_link" title="app/models/master.rb">app/models/master.rb</a></td>
        <td class="yellow strong">87.1 %</td>
        <td>425</td>
        <td>186</td>
        <td>162</td>
        <td>24</td>
        <td>230.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e1b4db774c16bbc02e02b4cff7656bb25f0f0a98" class="src_link" title="app/models/player_contact.rb">app/models/player_contact.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>14.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#46cb3fa9156911bd72fb7482f8c1de2e978cb988" class="src_link" title="app/models/player_info.rb">app/models/player_info.rb</a></td>
        <td class="green strong">90.91 %</td>
        <td>77</td>
        <td>44</td>
        <td>40</td>
        <td>4</td>
        <td>75.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c71ced2163cf3e6353bb659168f30e1c07412441" class="src_link" title="app/models/pro_info.rb">app/models/pro_info.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>10.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e01ababc9446f439b95e4d039d71550a43d901b5" class="src_link" title="app/models/protocol.rb">app/models/protocol.rb</a></td>
        <td class="green strong">92.86 %</td>
        <td>28</td>
        <td>14</td>
        <td>13</td>
        <td>1</td>
        <td>211.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#98590394c0bc46d6acc2f42cfe4c93d212e16e51" class="src_link" title="app/models/protocol_event.rb">app/models/protocol_event.rb</a></td>
        <td class="red strong">76.47 %</td>
        <td>32</td>
        <td>17</td>
        <td>13</td>
        <td>4</td>
        <td>1006.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#56b5a12bb9520f23d8ff6e830a614d24ee0e5a91" class="src_link" title="app/models/report.rb">app/models/report.rb</a></td>
        <td class="red strong">18.14 %</td>
        <td>384</td>
        <td>215</td>
        <td>39</td>
        <td>176</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4a65739570344d003364109276fc6f1c2f106c74" class="src_link" title="app/models/sage_assignment.rb">app/models/sage_assignment.rb</a></td>
        <td class="red strong">42.31 %</td>
        <td>101</td>
        <td>52</td>
        <td>22</td>
        <td>30</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1a818d2e95a029f4ef8784be1e2da04115b26da8" class="src_link" title="app/models/scantron.rb">app/models/scantron.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>25</td>
        <td>12</td>
        <td>10</td>
        <td>2</td>
        <td>11.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5dc6cb468d885b4d4b16a2a7c269d548e1af81d4" class="src_link" title="app/models/sub_process.rb">app/models/sub_process.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>23</td>
        <td>13</td>
        <td>11</td>
        <td>2</td>
        <td>2.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#16874e21f199af1671f2bd73cb5fdae457ec0fdc" class="src_link" title="app/models/tracker.rb">app/models/tracker.rb</a></td>
        <td class="green strong">96.23 %</td>
        <td>209</td>
        <td>106</td>
        <td>102</td>
        <td>4</td>
        <td>288.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#103f97233dd2e31753992438b2ac9a62aa0cdabd" class="src_link" title="app/models/tracker_history.rb">app/models/tracker_history.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2c0b033daf85fa819de42760d05b5170de1ae026" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="yellow strong">83.78 %</td>
        <td>77</td>
        <td>37</td>
        <td>31</td>
        <td>6</td>
        <td>192.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c5950c1fa459c0888705c815c5da7d71d6bef7e3" class="src_link" title="app/models/user_authorization.rb">app/models/user_authorization.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>45.3</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="red">52.66%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         27.52
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>11</b> files in total.
    <b>169</b> relevant lines. 
    <span class="green"><b>89</b> lines covered</span> and
    <span class="red"><b>80</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#7b3558e2806fa4875bb1d0535978d2cdc5ad3d57" class="src_link" title="app/helpers/addresses_helper.rb">app/helpers/addresses_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fc0134917d4f7fea5483b4f35f177948a9ea420e" class="src_link" title="app/helpers/admin_helper.rb">app/helpers/admin_helper.rb</a></td>
        <td class="red strong">31.25 %</td>
        <td>33</td>
        <td>16</td>
        <td>5</td>
        <td>11</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a11f63a483af63b82c57334ebcd72eaa73b5cf9c" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="green strong">96.88 %</td>
        <td>68</td>
        <td>32</td>
        <td>31</td>
        <td>1</td>
        <td>7.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bd0cc68f37cf55552fefa410090747b45a42f29e" class="src_link" title="app/helpers/colleges_helper.rb">app/helpers/colleges_helper.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>8</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#adb3fb94e429b0da088ae8a815bc0be93c028a5b" class="src_link" title="app/helpers/general_selections_helper.rb">app/helpers/general_selections_helper.rb</a></td>
        <td class="red strong">16.67 %</td>
        <td>36</td>
        <td>18</td>
        <td>3</td>
        <td>15</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e76d32342699189f11a8b0babaf798d2a2a2dd60" class="src_link" title="app/helpers/item_flag_names_helper.rb">app/helpers/item_flag_names_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>8</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f977333907c7fe73c3a2b47c649ce613bbc41786" class="src_link" title="app/helpers/item_flags_helper.rb">app/helpers/item_flags_helper.rb</a></td>
        <td class="red strong">45.0 %</td>
        <td>38</td>
        <td>20</td>
        <td>9</td>
        <td>11</td>
        <td>1.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a9ea82560d5866ffd8a2b6847e527d9773898e4d" class="src_link" title="app/helpers/manage_users_helper.rb">app/helpers/manage_users_helper.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>3</td>
        <td>2</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7d4434fe223047a8fdfc34b8ae595733c650b129" class="src_link" title="app/helpers/player_infos_helper.rb">app/helpers/player_infos_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>35.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d31761a5436407aaaa247244ed9cfa1d9c6092d8" class="src_link" title="app/helpers/protocols_helper.rb">app/helpers/protocols_helper.rb</a></td>
        <td class="yellow strong">82.76 %</td>
        <td>60</td>
        <td>29</td>
        <td>24</td>
        <td>5</td>
        <td>147.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#27d5c7c7a524ebbe6644e431cf2d95eff1e81126" class="src_link" title="app/helpers/reports_helper.rb">app/helpers/reports_helper.rb</a></td>
        <td class="red strong">11.11 %</td>
        <td>72</td>
        <td>36</td>
        <td>4</td>
        <td>32</td>
        <td>0.1</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.10.0 
        and simplecov-html v0.10.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="3d52d552acca5a1602ad089aa844269e07a78f72">
  <div class="header">
    <h3>app/controllers/addresses_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AddressesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    # Force the state and country codes to uppercase to allow the edit selectors to work as expected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    object_instance.state = object_instance.state.upcase if object_instance.state</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    object_instance.country = object_instance.country.upcase if object_instance.country</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="15">
          <span class="hits">11</span>
          
          <code class="ruby">      params.require(:address).permit(:master_id, :street, :street2, :street3, :city, :state, :zip, :source, :rank, :rec_type, :country, :region, :postal_code)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="02df4104396e8908b2167c5e4b5a1d4b2ba0da1a">
  <div class="header">
    <h3>app/controllers/admin/accuracy_scores_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::AccuracyScoresController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="7">
          <span class="hits">11</span>
          
          <code class="ruby">      params.require(:accuracy_score).permit(:name, :value, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a08d692090b4e60683f484233ba2c26c9a50adb3">
  <div class="header">
    <h3>app/controllers/admin/action_logs_controller.rb</h3>
    <h4><span class="red">30.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ActionLogsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">#  before_action :authenticate_admin!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @action_logs = Dir.glob(&quot;action_logs/*_action_log-*.log&quot;).sort.map {|a| a.gsub(&#39;action_logs/&#39;,&#39;&#39;)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    id = params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    logger.info &quot;ID: #{id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    raise &quot;Bad file requested&quot; if id.nil? || id.index(/\.\.|\/|\\|~/)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    f = File.basename(id, &#39;.log&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    logger.info &quot;File: #{f}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    fn = &quot;action_logs/#{f}.log&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    @action_log = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    File.open(fn).each { |l|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      if l[0].to_s != &#39;#&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">        ls = l.split(&#39; -- : &#39;,2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">        j = JSON.parse ls.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">        @action_log &lt;&lt; {title: ls.first, detail: j }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    render json: @action_log</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_instance_from_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2eb45cafc15ccec83eec92cd43e05ca55d4a4e5d">
  <div class="header">
    <h3>app/controllers/admin/colleges_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::CollegesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="7">
          <span class="hits">12</span>
          
          <code class="ruby">        params.require(object_name.to_sym).permit(:name, :synonym_for_id, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b798379305fa3e589ef0848a0ad58fbf9c77e595">
  <div class="header">
    <h3>app/controllers/admin/dynamic_models_controller.rb</h3>
    <h4><span class="red">70.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::DynamicModelsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method :permitted_params, :objects_instance, :human_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def view_folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      &#39;admin/common_templates&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      @permitted_params = [:id, :name, :category, :table_name, :table_key_name, :primary_key_name, :foreign_key_name, :result_order, :field_list, :position, :description, :disabled]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      params.require(object_name.to_sym).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="19518024bafdd733461d01d78b61fb5aa112b7ce">
  <div class="header">
    <h3>app/controllers/admin/external_links_controller.rb</h3>
    <h4><span class="red">80.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class  Admin::ExternalLinksController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">      params.require(:external_link).permit(:name, :value, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4fd2822da64e849cb850b894d2023a9ea35179b5">
  <div class="header">
    <h3>app/controllers/admin/general_selections_controller.rb</h3>
    <h4><span class="yellow">83.33 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::GeneralSelectionsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      GeneralSelection.item_types.map {|g| [g,g]}.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      :item_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def default_index_order      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      {updated_at: :desc}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="21">
          <span class="hits">13</span>
          
          <code class="ruby">      params.require(:general_selection).permit(:name, :value, :item_type, :disabled, :edit_if_set, :edit_always, :create_with, :position, :lock, :description)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="087dc0be179ffab4df96d929d26539245c2ecfd5">
  <div class="header">
    <h3>app/controllers/admin/item_flag_names_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ItemFlagNamesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="6">
          <span class="hits">12</span>
          
          <code class="ruby">      params.require(:item_flag_name).permit(:name, :item_type, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8718b84c23f8554caa4dc37be88c503157674d7f">
  <div class="header">
    <h3>app/controllers/admin/manage_users_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ManageUsersController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  #before_action :before_update, only: [:update]    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">    if params[:gen_new_pw] == &quot;1&quot;      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      @user.force_password_reset </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      logger.info &quot;Force password reset&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      flash[:info] = &quot;New password #{@user.new_password}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="15">
          <span class="hits">7</span>
          
          <code class="ruby">    @user.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="16">
          <span class="hits">7</span>
          
          <code class="ruby">    if @user.update(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="17">
          <span class="hits">5</span>
          
          <code class="ruby">      @users = User.all</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="18">
          <span class="hits">5</span>
          
          <code class="ruby">      @updated_with = @user</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">      render partial: &#39;index&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">      logger.warn &quot;Error updating #{human_name}: #{object_instance.errors.inspect}&quot;      </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">      flash.now[:warning] = &quot;Error updating #{human_name}: #{error_message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">      edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="29">
          <span class="hits">5</span>
          
          <code class="ruby">    set_object_instance primary_model.new(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="30">
          <span class="hits">5</span>
          
          <code class="ruby">    object_instance.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="31">
          <span class="hits">5</span>
          
          <code class="ruby">    if object_instance.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="32">
          <span class="hits">3</span>
          
          <code class="ruby">      @users = User.all</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">      @updated_with = @user</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">      render partial: &#39;index&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">      logger.warn &quot;Error creating #{human_name}: #{object_instance.errors.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">      flash.now[:warning] = &quot;Error creating #{human_name}: #{error_message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="38">
          <span class="hits">2</span>
          
          <code class="ruby">      new use_current_object: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    def primary_model </code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="45">
          <span class="hits">16</span>
          
          <code class="ruby">      User  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_name </code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="48">
          <span class="hits">40</span>
          
          <code class="ruby">      @object_name = &#39;user&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    def objects_name </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="51">
          <span class="hits">2</span>
          
          <code class="ruby">      &#39;users&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    def human_name </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="54">
          <span class="hits">8</span>
          
          <code class="ruby">      &#39;user&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="61">
          <span class="hits">12</span>
          
          <code class="ruby">      params.require(:user).permit(:email, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="05fb131d761e6cc0252ff9a68353c987443f1222">
  <div class="header">
    <h3>app/controllers/admin/reports_controller.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ReportsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  require &#39;csv&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def default_index_order</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      { updated_at: :desc }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      :report_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      Report::ReportTypes.map {|g| [g,g.to_s.humanize]}.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      params.require(:report).permit(:id, :name, :primary_table, :sql, :description, :disabled, :report_type, :auto, :searchable, :position, :search_attrs, :edit_model, :edit_field_names, :selection_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="84718f4950b9b69b66339fd7df614acffe8e11de">
  <div class="header">
    <h3>app/controllers/admin/sage_assignments_controller.rb</h3>
    <h4><span class="red">26.67 %</span> covered</h4>
    <div>
      <b>30</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>22</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::SageAssignmentsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @sage_assignments = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    @assigned_count = SageAssignment.assigned.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    @unassigned_count = SageAssignment.unassigned.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    render &#39;admin_handler/index&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def show </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    if params[:id] == &#39;report&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      rep_type = params[:rep_type]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      r = Report.where(name: &quot;Sage #{rep_type}&quot;, disabled: false).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      unless r &amp;&amp; r.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">        flash[:alert] = &quot;No report named Sage Assignments is available&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">        redirect_to admin_sage_assignments_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      redirect_to report_path(r)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    @sage_assignment = SageAssignment.new </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    cc = secure_params[:create_count]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    if cc.blank? || cc.to_i &lt; 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      @sage_assignment = SageAssignment.new </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">      flash.now[:alert] = &quot;Number of IDs to create must be at least 1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      @sage_assignment.errors.add :create_count, &quot;must be at least 1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      render &#39;new&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    @sage_assignments = SageAssignment.generate_ids(current_admin, cc.to_i)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      params.require(:sage_assignment).permit(:create_count)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b02621eb3923c4e8edf0a99f8a60fc94663aaa7a">
  <div class="header">
    <h3>app/controllers/admin/user_authorizations_controller.rb</h3>
    <h4><span class="red">77.78 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::UserAuthorizationsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method  :has_authorization_options, :user_id_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      User.active.map {|u| [u.id.to_s, u.email] }.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      :user_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def has_authorization_options</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      UserAuthorization.authorizations.map {|m| [m.to_s.titleize, m]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def user_id_options</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      User.active.map {|u| [u.email, u.id]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def view_folder</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="25">
          <span class="hits">32</span>
          
          <code class="ruby">      &#39;admin/common_templates&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="29">
          <span class="hits">12</span>
          
          <code class="ruby">      @permitted_params = [:id, :has_authorization, :disabled, :user_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="33">
          <span class="hits">12</span>
          
          <code class="ruby">      params.require(object_name.to_sym).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9bb59fc39f6409f37ec986bf43ed35a9a126e171">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4><span class="red">65.09 %</span> covered</h4>
    <div>
      <b>106</b> relevant lines. 
      <span class="green"><b>69</b> lines covered</span> and
      <span class="red"><b>37</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ControllerUtils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # Prevent CSRF attacks by raising an exception.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # For APIs, you may want to use :null_session instead.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  protect_from_forgery with: :exception</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :prevent_cache</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :setup_navs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from Exception, :with =&gt; :unhandled_exception_handler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from RuntimeError, :with =&gt; :runtime_error_handler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from ActiveRecord::RecordNotFound, :with =&gt; :runtime_record_not_found_handler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from ActionController::RoutingError, :with =&gt; :routing_error_handler </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from ActionController::InvalidAuthenticityToken, :with =&gt; :bad_auth_token</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from FphsException, :with =&gt; :fphs_app_exception_handler  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from PG::RaiseException, :with =&gt; :fphs_app_exception_handler  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def unhandled_exception_handler e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      respond_to do |type|        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;A unexpected error occurred. Contact the administrator if this condition persists. #{e.message}&quot;, :status =&gt; 500 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;A unexpected error occurred. Contact the administrator if this condition persists. #{e.message}&quot;}, :status =&gt; 500 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def fphs_app_exception_handler e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      respond_to do |type|        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;#{e.message}&quot;, :status =&gt; 400 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;#{e.message}&quot;}, :status =&gt; 500 }        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    def runtime_error_handler e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      respond_to do |type|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;A server error occurred. Contact the administrator if this condition persists. #{e.message}&quot;, :status =&gt; 500 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;A server error occurred. Contact the administrator if this condition persists.&quot;}, :status =&gt; 500 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">    def routing_error_handler  e</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="53">
          <span class="hits">9</span>
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="54">
          <span class="hits">9</span>
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="55">
          <span class="hits">9</span>
          
          <code class="ruby">      respond_to do |type|</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="56">
          <span class="hits">18</span>
          
          <code class="ruby">        type.html { render :text =&gt; &quot;The request URL does not exist.&quot;, :status =&gt; 404 }</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="57">
          <span class="hits">9</span>
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;The request URL does not exist.&quot;}, :status =&gt; 404 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="59">
          <span class="hits">9</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">    def bad_auth_token e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">      respond_to do |type|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;The information could not be submitted. Try returning to the home page to refresh the page.&quot;, :status =&gt; 401 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;The information could not be submitted. Try returning to the home page to refresh the page.&quot;}, :status =&gt; 401 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    def runtime_record_not_found_handler e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">      respond_to do |type|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;A database record was not found. Contact the administrator if this condition persists. #{e.message}&quot;, :status =&gt; 404 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;A database record was not found. Contact the administrator if this condition persists.&quot;}, :status =&gt; 404 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_cache</code>
        </li>
      
        <li class="covered" data-hits="567" data-linenumber="83">
          <span class="hits">567</span>
          
          <code class="ruby">      response.headers[&quot;Cache-Control&quot;] = &quot;no-cache, no-store, max-age=0, must-revalidate&quot;</code>
        </li>
      
        <li class="covered" data-hits="567" data-linenumber="84">
          <span class="hits">567</span>
          
          <code class="ruby">      response.headers[&quot;Pragma&quot;] = &quot;no-cache&quot;</code>
        </li>
      
        <li class="covered" data-hits="567" data-linenumber="85">
          <span class="hits">567</span>
          
          <code class="ruby">      response.headers[&quot;Expires&quot;] = &quot;Fri, 01 Jan 1990 00:00:00 GMT&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      # Prevent access to any management page unless the user is an administrator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">    def check_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">      redirect_to &#39;/pages&#39; and return unless current_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">    def setup_navs</code>
        </li>
      
        <li class="covered" data-hits="567" data-linenumber="94">
          <span class="hits">567</span>
          
          <code class="ruby">      @primary_navs = []</code>
        </li>
      
        <li class="covered" data-hits="567" data-linenumber="95">
          <span class="hits">567</span>
          
          <code class="ruby">      @secondary_navs = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="567" data-linenumber="97">
          <span class="hits">567</span>
          
          <code class="ruby">      admin_sub = []</code>
        </li>
      
        <li class="covered" data-hits="567" data-linenumber="98">
          <span class="hits">567</span>
          
          <code class="ruby">      if current_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="156" data-linenumber="100">
          <span class="hits">156</span>
          
          <code class="ruby">        admin_sub &lt;&lt; {label: &#39;manage&#39;, url: &#39;/&#39;, route: &#39;#root&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="156" data-linenumber="102">
          <span class="hits">156</span>
          
          <code class="ruby">        admin_sub &lt;&lt; {label: &#39;password&#39;, url: &quot;/admins/edit&quot;}</code>
        </li>
      
        <li class="covered" data-hits="156" data-linenumber="103">
          <span class="hits">156</span>
          
          <code class="ruby">        admin_sub &lt;&lt; {label: &#39;logout_admin&#39;, url: &quot;/admins/sign_out&quot;, extras: {method: :delete}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="410" data-linenumber="106">
          <span class="hits">410</span>
          
          <code class="ruby">        admin_sub &lt;&lt; {label: &#39;Admin Login&#39;, url: &#39;/admins/sign_in&#39;, route: &#39;admins#sign_in&#39;, }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="566" data-linenumber="109">
          <span class="hits">566</span>
          
          <code class="ruby">      if current_user </code>
        </li>
      
        <li class="covered" data-hits="222" data-linenumber="110">
          <span class="hits">222</span>
          
          <code class="ruby">        user_sub = []</code>
        </li>
      
        <li class="covered" data-hits="222" data-linenumber="111">
          <span class="hits">222</span>
          
          <code class="ruby">        user_sub &lt;&lt; {label: &#39;password&#39;, url: &quot;/users/edit&quot;}</code>
        </li>
      
        <li class="covered" data-hits="222" data-linenumber="112">
          <span class="hits">222</span>
          
          <code class="ruby">        user_sub &lt;&lt; {label: &#39;logout&#39;, url: &quot;/users/sign_out&quot;, extras: {method: :delete}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="565" data-linenumber="114">
          <span class="hits">565</span>
          
          <code class="ruby">      if current_user  || current_admin</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="115">
          <span class="hits">365</span>
          
          <code class="ruby">        @secondary_navs &lt;&lt; {label: &#39;&lt;span class=&quot;glyphicon glyphicon-wrench&quot; title=&quot;administrator&quot;&gt;&lt;/span&gt;&#39;, url: &quot;#&quot;, sub: admin_sub, extras: {}}</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="116">
          <span class="hits">365</span>
          
          <code class="ruby">        @secondary_navs &lt;&lt; {label: &#39;&lt;span class=&quot;glyphicon glyphicon-user&quot; &gt;&lt;/span&gt;&#39;, url: &quot;#&quot;, sub: user_sub, extras: {title: current_email}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">      end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="565" data-linenumber="120">
          <span class="hits">565</span>
          
          <code class="ruby">      if current_user</code>
        </li>
      
        <li class="covered" data-hits="222" data-linenumber="121">
          <span class="hits">222</span>
          
          <code class="ruby">        @primary_navs &lt;&lt; {label: &#39;Research&#39;, url: &#39;/masters/&#39;, route: &#39;masters#index&#39;}</code>
        </li>
      
        <li class="covered" data-hits="222" data-linenumber="122">
          <span class="hits">222</span>
          
          <code class="ruby">        @primary_navs &lt;&lt; {label: &#39;Create MSID&#39;, url: &#39;/masters/new&#39;, route: &#39;masters#new&#39;}  if current_user.can? :create_msid        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="565" data-linenumber="126">
          <span class="hits">565</span>
          
          <code class="ruby">      if current_user || current_admin</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="127">
          <span class="hits">365</span>
          
          <code class="ruby">        @primary_navs &lt;&lt; {label: &#39;Reports&#39;, url: &#39;/reports&#39;, route: &#39;reports#index&#39;} if current_admin || current_user.can?(:view_reports)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="953" data-linenumber="130">
          <span class="hits">953</span>
          
          <code class="ruby">      res  = @primary_navs.select {|n| n[:route] == &quot;#{controller_name}##{action_name}&quot; }            </code>
        </li>
      
        <li class="covered" data-hits="565" data-linenumber="131">
          <span class="hits">565</span>
          
          <code class="ruby">      res.first[:active] = true if res &amp;&amp; res.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">    def current_email</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="136">
          <span class="hits">365</span>
          
          <code class="ruby">      return nil unless current_user || current_admin</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="137">
          <span class="hits">365</span>
          
          <code class="ruby">      (current_user || current_admin).email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">    def not_authorized</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">      flash[:danger] = &quot;You are not authorized to perform the requested action&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">      render text: flash[:danger], status: :unauthorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">    def not_found</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="146">
          <span class="hits">9</span>
          
          <code class="ruby">      flash[:danger] = &quot;Requested information not found&quot;</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="147">
          <span class="hits">9</span>
          
          <code class="ruby">      raise ActionController::RoutingError.new(&#39;Not Found&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">    def bad_request</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">      flash[:danger] = &quot;The request failed to validate&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">      render text: flash[:danger], status: 422</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">    def unexpected_error msg</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">      flash[:danger] = &quot;An error occurred: #{msg}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      render text: flash[:danger], status: 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">    def general_error msg, level=:info</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="161">
          
          
          <code class="ruby">      flash[level] = &quot;Error: #{msg}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="162">
          
          
          <code class="ruby">      render text: flash[level], status: 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">    def authenticate_user_or_admin!</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="166">
          <span class="hits">34</span>
          
          <code class="ruby">      if !current_user &amp;&amp; !current_admin</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="167">
          <span class="hits">12</span>
          
          <code class="ruby">        redirect_to new_user_session_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="169">
          <span class="hits">34</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="523801ce21092ad013198388d39bd5b472091267">
  <div class="header">
    <h3>app/controllers/concerns/admin_controller_handler.rb</h3>
    <h4><span class="green">90.38 %</span> covered</h4>
    <div>
      <b>104</b> relevant lines. 
      <span class="green"><b>94</b> lines covered</span> and
      <span class="red"><b>10</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AdminControllerHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="6">
          <span class="hits">14</span>
          
          <code class="ruby">    before_action :authenticate_admin!</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="7">
          <span class="hits">14</span>
          
          <code class="ruby">    before_action :set_instance_from_id, only: [:edit, :update, :destroy]    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="9">
          <span class="hits">14</span>
          
          <code class="ruby">    after_action :do_log_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="11">
          <span class="hits">14</span>
          
          <code class="ruby">    helper_method :filters, :filters_on, :index_path, :index_params, :permitted_params, :objects_instance, :human_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def index    </code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="15">
          <span class="hits">50</span>
          
          <code class="ruby">    pm = primary_model    </code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="16">
          <span class="hits">50</span>
          
          <code class="ruby">    pm = pm.where filter_params if filter_params</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="17">
          <span class="hits">50</span>
          
          <code class="ruby">    set_objects_instance pm.order(default_index_order)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="18">
          <span class="hits">50</span>
          
          <code class="ruby">    response_to_index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def new options = {}</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="24">
          <span class="hits">31</span>
          
          <code class="ruby">    set_object_instance primary_model.new unless options[:use_current_object]</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="25">
          <span class="hits">31</span>
          
          <code class="ruby">    render partial: view_path(&#39;form&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="29">
          <span class="hits">27</span>
          
          <code class="ruby">    render partial: view_path(&#39;form&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="34">
          <span class="hits">50</span>
          
          <code class="ruby">    set_object_instance primary_model.new(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="35">
          <span class="hits">50</span>
          
          <code class="ruby">    object_instance.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="36">
          <span class="hits">50</span>
          
          <code class="ruby">    if object_instance.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      #redirect_to index_path, notice: &quot;#{human_name} created successfully&quot;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="38">
          <span class="hits">24</span>
          
          <code class="ruby">      @updated_with = object_instance      </code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="39">
          <span class="hits">24</span>
          
          <code class="ruby">      index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="41">
          <span class="hits">26</span>
          
          <code class="ruby">      logger.warn &quot;Error creating #{human_name}: #{object_instance.errors.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="42">
          <span class="hits">26</span>
          
          <code class="ruby">      flash.now[:warning] = &quot;Error creating #{human_name}: #{error_message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="43">
          <span class="hits">26</span>
          
          <code class="ruby">      new use_current_object: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="48">
          <span class="hits">40</span>
          
          <code class="ruby">    object_instance.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="49">
          <span class="hits">40</span>
          
          <code class="ruby">    if object_instance.update(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="50">
          <span class="hits">24</span>
          
          <code class="ruby">      flash.now[:notice] = &quot;#{human_name} updated successfully&quot;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="51">
          <span class="hits">24</span>
          
          <code class="ruby">      @updated_with = object_instance      </code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="52">
          <span class="hits">24</span>
          
          <code class="ruby">      index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="54">
          <span class="hits">16</span>
          
          <code class="ruby">      logger.warn &quot;Error updating #{human_name}: #{object_instance.errors.inspect}&quot;      </code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="55">
          <span class="hits">16</span>
          
          <code class="ruby">      flash.now[:warning] = &quot;Error updating #{human_name}: #{error_message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="56">
          <span class="hits">16</span>
          
          <code class="ruby">      edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">    def index_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">      permitted_params + [:admin_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">    def index_partial </code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="76">
          <span class="hits">48</span>
          
          <code class="ruby">      view = &#39;index&#39;</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="77">
          <span class="hits">48</span>
          
          <code class="ruby">      return view unless view_folder</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="78">
          <span class="hits">6</span>
          
          <code class="ruby">      [view_folder, view].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">    def view_path view            </code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="82">
          <span class="hits">76</span>
          
          <code class="ruby">      unless view_folder</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="83">
          <span class="hits">66</span>
          
          <code class="ruby">        return &#39;admin_handler/index&#39; if view == &#39;index&#39;</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="84">
          <span class="hits">50</span>
          
          <code class="ruby">        return view </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="86">
          <span class="hits">10</span>
          
          <code class="ruby">        [view_folder, view].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    def view_folder</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    def response_to_index  </code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="95">
          <span class="hits">66</span>
          
          <code class="ruby">      respond_to do |format|      </code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="96">
          <span class="hits">66</span>
          
          <code class="ruby">        format.html { </code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="97">
          <span class="hits">66</span>
          
          <code class="ruby">          if @updated_with</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="98">
          <span class="hits">48</span>
          
          <code class="ruby">            render partial: index_partial</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="100">
          <span class="hits">18</span>
          
          <code class="ruby">            render view_path(&#39;index&#39;) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">          end        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="103">
          <span class="hits">66</span>
          
          <code class="ruby">        format.all { render json: objects_instance.as_json(except: [:created_at, :updated_at, :id, :admin_id, :user_id])}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">    def log_action action, sub, results, status=&quot;OK&quot;, extras={}</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="108">
          <span class="hits">138</span>
          
          <code class="ruby">      extras[:master_id] ||= nil</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="109">
          <span class="hits">138</span>
          
          <code class="ruby">      extras[:msid] ||= nil</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="110">
          <span class="hits">138</span>
          
          <code class="ruby">      current_admin.log_action action, sub, results, request.method_symbol, params, status, extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">    def do_log_action</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="115">
          <span class="hits">138</span>
          
          <code class="ruby">      len = (@master_objects ? @master_objects.length : 0)</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="116">
          <span class="hits">138</span>
          
          <code class="ruby">      log_action &quot;#{controller_name}##{action_name}&quot;, &quot;AUTO&quot;, len</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">    def primary_model </code>
        </li>
      
        <li class="covered" data-hits="152" data-linenumber="120">
          <span class="hits">152</span>
          
          <code class="ruby">      controller_name.classify.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_name </code>
        </li>
      
        <li class="covered" data-hits="488" data-linenumber="123">
          <span class="hits">488</span>
          
          <code class="ruby">      controller_name.singularize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">    def objects_name </code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="126">
          <span class="hits">48</span>
          
          <code class="ruby">      controller_name.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">    def human_name </code>
        </li>
      
        <li class="covered" data-hits="108" data-linenumber="129">
          <span class="hits">108</span>
          
          <code class="ruby">      controller_name.singularize.humanize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">    def default_index_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">    def filter_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">    def error_message</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="144">
          <span class="hits">46</span>
          
          <code class="ruby">      res = &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="145">
          <span class="hits">46</span>
          
          <code class="ruby">      object_instance.errors.full_messages.each do |message|</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="146">
          <span class="hits">58</span>
          
          <code class="ruby">        res &lt;&lt; &quot;; &quot; unless res.blank?</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="147">
          <span class="hits">58</span>
          
          <code class="ruby">        res &lt;&lt; &quot;#{message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="149">
          <span class="hits">46</span>
          
          <code class="ruby">      res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">    def index_path opt={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">      redir = {controller: controller_name, action: :index}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">      redir.merge! @parent_param if @parent_param</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">      redir.merge! opt</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      f = filter_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">      redir[:filter] ||= f if f</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby">      url_for(redir)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_instance_from_id</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="164">
          <span class="hits">56</span>
          
          <code class="ruby">      return if params[:id] == &#39;cancel&#39;</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="165">
          <span class="hits">56</span>
          
          <code class="ruby">      set_object_instance primary_model.find(params[:id])            </code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="166">
          <span class="hits">56</span>
          
          <code class="ruby">      @id = object_instance.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_object_instance o</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="170">
          <span class="hits">118</span>
          
          <code class="ruby">      instance_variable_set(&quot;@#{object_name}&quot;, o)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_objects_instance o</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="174">
          <span class="hits">50</span>
          
          <code class="ruby">      instance_variable_set(&quot;@#{objects_name}&quot;, o)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    # This is not used: def object_instance=(o)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">    # ... since it requires self. prefix to make it work in controller, and is </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    # therefore more confusing than helpful</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_instance</code>
        </li>
      
        <li class="covered" data-hits="386" data-linenumber="182">
          <span class="hits">386</span>
          
          <code class="ruby">      instance_variable_get(&quot;@#{object_name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">    def objects_instance</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">      instance_variable_get(&quot;@#{objects_name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">    def filter_params</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="190">
          <span class="hits">50</span>
          
          <code class="ruby">      return nil if params[:filter].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">      params.require(:filter).permit(filters_on)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fdbd1f992e19e5f58d3980b99ed63bc5d5a7777e">
  <div class="header">
    <h3>app/controllers/concerns/controller_utils.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ControllerUtils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def log_action action, sub, results, status=&quot;OK&quot;, extras={}</code>
        </li>
      
        <li class="covered" data-hits="166" data-linenumber="6">
          <span class="hits">166</span>
          
          <code class="ruby">    extras[:master_id] ||= nil</code>
        </li>
      
        <li class="covered" data-hits="166" data-linenumber="7">
          <span class="hits">166</span>
          
          <code class="ruby">    extras[:msid] ||= nil</code>
        </li>
      
        <li class="covered" data-hits="166" data-linenumber="8">
          <span class="hits">166</span>
          
          <code class="ruby">    current_user.log_action action, sub, results, request.method_symbol, params, status, extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def params_nil_if_blank p</code>
        </li>
      
        <li class="covered" data-hits="1126" data-linenumber="12">
          <span class="hits">1126</span>
          
          <code class="ruby">    p1 = p.dup</code>
        </li>
      
        <li class="covered" data-hits="1126" data-linenumber="13">
          <span class="hits">1126</span>
          
          <code class="ruby">    p.each do |k,v|     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="3458" data-linenumber="15">
          <span class="hits">3458</span>
          
          <code class="ruby">      if v.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="1047" data-linenumber="16">
          <span class="hits">1047</span>
          
          <code class="ruby">        p1[k] = params_nil_if_blank v </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      elsif v.is_a? Array</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="18">
          <span class="hits">96</span>
          
          <code class="ruby">        va = v.reject {|v1| v1.blank?}</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="19">
          <span class="hits">48</span>
          
          <code class="ruby">        va = nil if va.length == 0</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="20">
          <span class="hits">48</span>
          
          <code class="ruby">        p1[k] = va</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      elsif v.blank?</code>
        </li>
      
        <li class="covered" data-hits="1779" data-linenumber="22">
          <span class="hits">1779</span>
          
          <code class="ruby">        p1[k] = nil        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1126" data-linenumber="26">
          <span class="hits">1126</span>
          
          <code class="ruby">    p1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def params_downcase p</code>
        </li>
      
        <li class="covered" data-hits="1126" data-linenumber="30">
          <span class="hits">1126</span>
          
          <code class="ruby">    p1 = p.dup</code>
        </li>
      
        <li class="covered" data-hits="1126" data-linenumber="31">
          <span class="hits">1126</span>
          
          <code class="ruby">    p.each do |k,v|           </code>
        </li>
      
        <li class="covered" data-hits="3458" data-linenumber="32">
          <span class="hits">3458</span>
          
          <code class="ruby">      if v.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="1047" data-linenumber="33">
          <span class="hits">1047</span>
          
          <code class="ruby">        p1[k] = params_downcase v </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      elsif v.is_a?(String) &amp;&amp; !v.blank?</code>
        </li>
      
        <li class="covered" data-hits="572" data-linenumber="35">
          <span class="hits">572</span>
          
          <code class="ruby">        p1[k] = v.downcase        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1126" data-linenumber="39">
          <span class="hits">1126</span>
          
          <code class="ruby">    p1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0136d940b22eecc79e6f400c7bc8e10f60bc275d">
  <div class="header">
    <h3>app/controllers/concerns/master_handler.rb</h3>
    <h4><span class="green">91.76 %</span> covered</h4>
    <div>
      <b>85</b> relevant lines. 
      <span class="green"><b>78</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MasterHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  UseMasterParam = %w(new create index) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="7">
          <span class="hits">7</span>
          
          <code class="ruby">    before_action :authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">    before_action :set_me_and_master, only: [:index, :new, :edit, :create, :update, :destroy]</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="9">
          <span class="hits">7</span>
          
          <code class="ruby">    before_action :set_instance_from_id, only: [:show]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="11">
          <span class="hits">7</span>
          
          <code class="ruby">    after_action :do_log_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def do_log_action</code>
        </li>
      
        <li class="covered" data-hits="141" data-linenumber="15">
          <span class="hits">141</span>
          
          <code class="ruby">    len = (@master_objects ? @master_objects.length : 0)</code>
        </li>
      
        <li class="covered" data-hits="141" data-linenumber="16">
          <span class="hits">141</span>
          
          <code class="ruby">    extras = {}</code>
        </li>
      
        <li class="covered" data-hits="141" data-linenumber="17">
          <span class="hits">141</span>
          
          <code class="ruby">    if @master</code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="18">
          <span class="hits">135</span>
          
          <code class="ruby">      extras[:master_id] = @master.id </code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="19">
          <span class="hits">135</span>
          
          <code class="ruby">      extras[:msid] = @master.msid     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="21">
          <span class="hits">6</span>
          
          <code class="ruby">      extras[:master_id] = nil</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="22">
          <span class="hits">6</span>
          
          <code class="ruby">      extras[:msid] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="141" data-linenumber="24">
          <span class="hits">141</span>
          
          <code class="ruby">    log_action &quot;#{controller_name}##{action_name}&quot;, &quot;AUTO&quot;, len, &quot;OK&quot;, extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def primary_model </code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="28">
          <span class="hits">38</span>
          
          <code class="ruby">    controller_name.classify.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def object_name </code>
        </li>
      
        <li class="covered" data-hits="391" data-linenumber="31">
          <span class="hits">391</span>
          
          <code class="ruby">    controller_name.singularize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def objects_name </code>
        </li>
      
        <li class="covered" data-hits="364" data-linenumber="34">
          <span class="hits">364</span>
          
          <code class="ruby">    controller_name.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def human_name </code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="37">
          <span class="hits">34</span>
          
          <code class="ruby">    controller_name.singularize.humanize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="41">
          <span class="hits">57</span>
          
          <code class="ruby">    set_objects_instance @master_objects</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="42">
          <span class="hits">57</span>
          
          <code class="ruby">    s = {objects_name =&gt; @master_objects.as_json, multiple_results: objects_name}</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="43">
          <span class="hits">57</span>
          
          <code class="ruby">    if object_instance</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      s[:original_item] = object_instance</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      s[objects_name] &lt;&lt;  object_instance</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="47">
          <span class="hits">57</span>
          
          <code class="ruby">    s[:master_id] = @master.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="49">
          <span class="hits">57</span>
          
          <code class="ruby">    logger.debug &quot;List: #{s} with objects_instance @#{objects_name}&quot;</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="50">
          <span class="hits">57</span>
          
          <code class="ruby">    render json: s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="54">
          <span class="hits">38</span>
          
          <code class="ruby">    p = {object_name =&gt; object_instance.as_json}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="56">
          <span class="hits">38</span>
          
          <code class="ruby">    logger.debug &quot;p: #{p} for object_instance&quot;</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="57">
          <span class="hits">38</span>
          
          <code class="ruby">    render json: p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="61">
          <span class="hits">7</span>
          
          <code class="ruby">    set_object_instance @master_objects.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="62">
          <span class="hits">7</span>
          
          <code class="ruby">    render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="66">
          <span class="hits">5</span>
          
          <code class="ruby">    render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="71">
          <span class="hits">39</span>
          
          <code class="ruby">    set_object_instance @master_objects.build(secure_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="73">
          <span class="hits">39</span>
          
          <code class="ruby">    if object_instance.save</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="74">
          <span class="hits">16</span>
          
          <code class="ruby">      if object_instance.has_multiple_results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">        @master_objects = object_instance.multiple_results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">        index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="78">
          <span class="hits">16</span>
          
          <code class="ruby">        show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="81">
          <span class="hits">23</span>
          
          <code class="ruby">      logger.warn &quot;Error creating #{human_name}: #{object_instance.errors.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="82">
          <span class="hits">23</span>
          
          <code class="ruby">      render json: object_instance.errors, status: :unprocessable_entity     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="87">
          <span class="hits">26</span>
          
          <code class="ruby">    if object_instance.update(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="88">
          <span class="hits">15</span>
          
          <code class="ruby">      if object_instance.has_multiple_results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">        @master_objects = object_instance.multiple_results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">        index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="92">
          <span class="hits">15</span>
          
          <code class="ruby">        show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="96">
          <span class="hits">11</span>
          
          <code class="ruby">      logger.warn &quot;Error updating #{human_name}: #{object_instance.errors.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="97">
          <span class="hits">11</span>
          
          <code class="ruby">      render json: object_instance.errors, status: :unprocessable_entity </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">  def flags</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_me_and_master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      # Generically retrieve the current object referenced by parameter :id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">      # Store it into the @singlular_name instance variable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">      # This is the equivalent of e.g.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">      # @player_info  = PlayerInfo.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">      # This allows for us to retrieve the @master consistently, so that the master association</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      # is not used repetitively (potentially breaking the current_user functionality and poor performance)</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="121">
          <span class="hits">136</span>
          
          <code class="ruby">      if UseMasterParam.include? action_name </code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="122">
          <span class="hits">104</span>
          
          <code class="ruby">        @master = Master.find(params[:master_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="124">
          <span class="hits">32</span>
          
          <code class="ruby">        object = primary_model.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="125">
          <span class="hits">32</span>
          
          <code class="ruby">        set_object_instance object</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="126">
          <span class="hits">32</span>
          
          <code class="ruby">        @master = object.master</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="127">
          <span class="hits">32</span>
          
          <code class="ruby">        @id = object.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">      # Get the list of objects related to the master, in other words triggering the association</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">      # off of the master object</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="132">
          <span class="hits">136</span>
          
          <code class="ruby">      @master_objects = @master.send(objects_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="134">
          <span class="hits">136</span>
          
          <code class="ruby">      @master.current_user = current_user  </code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="135">
          <span class="hits">136</span>
          
          <code class="ruby">      @master.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="136">
          <span class="hits">136</span>
          
          <code class="ruby">      @master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_instance_from_id</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="142">
          <span class="hits">6</span>
          
          <code class="ruby">      return if params[:id] == &#39;cancel&#39;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="143">
          <span class="hits">6</span>
          
          <code class="ruby">      set_object_instance primary_model.find(params[:id])            </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="144">
          <span class="hits">6</span>
          
          <code class="ruby">      @id = object_instance.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_object_instance o</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="149">
          <span class="hits">84</span>
          
          <code class="ruby">      instance_variable_set(&quot;@#{object_name}&quot;, o)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_objects_instance o</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="153">
          <span class="hits">57</span>
          
          <code class="ruby">      instance_variable_set(&quot;@#{objects_name}&quot;, o)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">    # This is not used: def object_instance=(o)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    # ... since it requires self. prefix to make it work in controller, and is </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    # therefore more confusing than helpful</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_instance</code>
        </li>
      
        <li class="covered" data-hits="269" data-linenumber="161">
          <span class="hits">269</span>
          
          <code class="ruby">      instance_variable_get(&quot;@#{object_name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d7c27593da0819da96ee3aa118d6a5a8b9e5f679">
  <div class="header">
    <h3>app/controllers/concerns/master_search.rb</h3>
    <h4><span class="red">55.22 %</span> covered</h4>
    <div>
      <b>67</b> relevant lines. 
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>30</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MasterSearch</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def run search_type</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="9">
          <span class="hits">25</span>
          
          <code class="ruby">    msid = nil</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="10">
          <span class="hits">25</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="12">
          <span class="hits">25</span>
          
          <code class="ruby">      if search_type == &#39;MSID&#39;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="13">
          <span class="hits">6</span>
          
          <code class="ruby">        if !params[:master][:msid].blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="14">
          <span class="hits">2</span>
          
          <code class="ruby">          msid = params[:master][:msid].to_s </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="15">
          <span class="hits">2</span>
          
          <code class="ruby">          msid = msid.split(/[,| ]/) if msid.index(/[,| ]/)        </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="16">
          <span class="hits">2</span>
          
          <code class="ruby">          @masters = Master.where msid: msid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">        elsif !params[:master][:pro_id].blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="18">
          <span class="hits">2</span>
          
          <code class="ruby">          proid = params[:master][:pro_id].to_s</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">          proid = proid.split(/[,| ]/) if proid.index(/[,| ]/)        </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">          @masters = Master.where pro_id: proid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        elsif !params[:master][:id].blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">          id = params[:master][:id].to_s </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">          id = id.split(/[,| ]/) if id.index(/[,| ]/)        </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">          @masters = Master.where id: id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      elsif search_type == &#39;SIMPLE&#39;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="27">
          <span class="hits">3</span>
          
          <code class="ruby">        @masters = Master.search_on_params search_params[:master]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      elsif search_type == &#39;REPORT&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">        search_type = &quot;REPORT: #{@report.name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">        m_field = @report.field_index(&#39;master_id&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">        render text: &quot;query must return a master_id field to function as a search&quot; and return  unless m_field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        ids = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        @results.each_row {|r| ids &lt;&lt; r[m_field]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        #If the msid is an array of items then return the results in the order of the list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">        @masters = Master.where &quot;id in(?)&quot;, ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="47">
          <span class="hits">16</span>
          
          <code class="ruby">        @masters = Master.search_on_params search_params[:master]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="50">
          <span class="hits">25</span>
          
          <code class="ruby">      if @masters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        #If the msid is an array of items then return the results in the order of the list</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="53">
          <span class="hits">25</span>
          
          <code class="ruby">        if msid.is_a? Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">          i = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">          #@masters = @masters.take(ResultsLimit)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">          msid.each do |d|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">            m1 = @masters.select {|n| n.msid.to_s == d}.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">            m1.force_order = i if m1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">            i += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">          @masters = @masters.sort {|m,n| m.force_order &lt;=&gt; n.force_order}              </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="65">
          <span class="hits">25</span>
          
          <code class="ruby">        original_length = @masters.length</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="66">
          <span class="hits">25</span>
          
          <code class="ruby">        @masters = @masters[0, return_results_limit]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="68">
          <span class="hits">25</span>
          
          <code class="ruby">        m = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">          masters: @masters.as_json(include: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">            player_infos: {order: Master::PlayerInfoRankOrderClause, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">              include: {              </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">                item_flags: {include: [:item_flag_name], methods: [:method_id, :item_type_us]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">              },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">              methods: [:user_name, :accuracy_score_name, :source_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            pro_infos: {}, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            player_contacts: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">              order: {rank: :desc},             </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">              methods: [:user_name, :rank_name, :source_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">            addresses: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">              order: {rank: :desc},             </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">              methods: [:user_name, :rank_name, :state_name, :country_name, :source_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">#           Loading trackers dynamically provides a significant speed up, and this may become more important as the tracker usage grows</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">#           trackers: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">#              order: &quot;protocol.position #{Master::TrackerEventOrderClause}&quot;,                </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">#              methods: [:protocol_name, :protocol_position, :sub_process_name, :event_name, :tracker_history_length, :user_name, :record_type_us, :record_type, :record_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">#            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">            latest_tracker_history: {            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">              methods: [:protocol_name, :protocol_position, :sub_process_name, :event_name, :user_name, :record_type_us, :record_type, :record_id, :event_description, :event_milestone]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">#            scantrons: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">#              order: {scantron_id: :asc},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">#              methods: [:user_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">#            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">#            sage_assignments: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">#              order: {sage_id: :asc},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">#              methods: [:user_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">#            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">          }) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="105">
          <span class="hits">25</span>
          
          <code class="ruby">        m[:count] = {count: original_length,  show_count: @masters.length}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="107">
          <span class="hits">25</span>
          
          <code class="ruby">        log_action &quot;master search&quot;, search_type, @masters.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">        # Return no results      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">        m = {message: &quot;no conditions were specified&quot;, masters: [], count: {count: 0, show_count: 0} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">        log_action &quot;master search&quot;, search_type, 0, &quot;no conditions specified&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">      logger.error &quot;Error in MastersController#index: #{e.inspect}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">      m = {error: &quot;: unable to search - please check your search criteria.&quot;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">      render json: m, status: 400</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="120">
          <span class="hits">25</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="121">
          <span class="hits">25</span>
          
          <code class="ruby">      format.json {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">        # This is standard, not an export</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="123">
          <span class="hits">25</span>
          
          <code class="ruby">        render json: m        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="125">
          <span class="hits">25</span>
          
          <code class="ruby">      format.csv {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">        return not_authorized unless current_user.can? :export_csv</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">        ma = m[:masters].first </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">        #return bad_request unless ma</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">        unless ma</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">          flash[:warning] = &quot;no results to export&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">          redirect_to(&quot;/masters/&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">          return </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">        res = [(ma.map {|k,v| k} + (ma[&#39;player_infos&#39;].first ||{}).map {|k,v| &quot;player.#{k}&quot;} +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">              (ma[&#39;pro_infos&#39;].first ||{}).map {|k,v| &quot;pro.#{k}&quot;}).to_csv]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">        m[:masters].each do |ma| </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">          res &lt;&lt; (ma.map {|k,v| v.is_a?(Hash) || v.is_a?(Array) ? &#39;&#39; : v }   +  (ma[&#39;player_infos&#39;].first || {}).map {|k,v| v} +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">              (ma[&#39;pro_infos&#39;].first || {}).map {|k,v| v}).to_csv </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">        send_data res.join(&quot;&quot;), filename: &quot;report.csv&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">    def return_results_limit</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="155">
          <span class="hits">25</span>
          
          <code class="ruby">      e = 0</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="156">
          <span class="hits">25</span>
          
          <code class="ruby">      r = params[:res_limit]</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="157">
          <span class="hits">25</span>
          
          <code class="ruby">      e = r.to_i unless r.blank?    </code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="158">
          <span class="hits">25</span>
          
          <code class="ruby">      e = 100 if e == 0</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="159">
          <span class="hits">25</span>
          
          <code class="ruby">      @return_results_limit = e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9005f4da15251d710f6c48586711ec788046cedd">
  <div class="header">
    <h3>app/controllers/definitions_controller.rb</h3>
    <h4><span class="yellow">90.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class DefinitionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user_or_admin!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  Available = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    &quot;protocol_events&quot; =&gt; :selector_collection, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    &quot;protocols&quot; =&gt; :selector_collection, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    &quot;sub_processes&quot; =&gt; :selector_collection, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    &quot;colleges&quot; =&gt; :selector_array, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    &quot;accuracy_scores&quot; =&gt; :selector_collection,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    &quot;external_links&quot; =&gt; :selector_collection,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    &quot;users&quot; =&gt; :active_id_name_list,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    &quot;general_selections&quot; =&gt; :selector_collection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  }.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="17">
          <span class="hits">14</span>
          
          <code class="ruby">    def_type = params[:id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="19">
          <span class="hits">14</span>
          
          <code class="ruby">    item_selector = available def_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # We will return a 404 if either the def_type requested by a user is nil, or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # the def_type does not appear in the Available list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # This protects against insecure requests</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="23">
          <span class="hits">14</span>
          
          <code class="ruby">    return not_found unless item_selector</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="25">
          <span class="hits">10</span>
          
          <code class="ruby">    item = @def_class.classify.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="27">
          <span class="hits">10</span>
          
          <code class="ruby">    j = item.send(item_selector, @filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="29">
          <span class="hits">10</span>
          
          <code class="ruby">    render json: j</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    # This both looks up the selector method to use, and protects against insecure </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # user-generated requests to access unexpected methods and classes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def available def_type</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="40">
          <span class="hits">14</span>
          
          <code class="ruby">      return nil unless def_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="42">
          <span class="hits">14</span>
          
          <code class="ruby">      def_type_split = def_type.split(&#39;-&#39;)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="43">
          <span class="hits">14</span>
          
          <code class="ruby">      filter = def_type_split[1]</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="44">
          <span class="hits">14</span>
          
          <code class="ruby">      if filter</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">        fs = filter.split(&#39;+&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">        @filter = {fs.first =&gt; fs.last}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="48">
          <span class="hits">14</span>
          
          <code class="ruby">      @def_class = def_type_split.first</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="49">
          <span class="hits">14</span>
          
          <code class="ruby">      Available[@def_class]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="30dbdd2a9a36f1066d811670b12c8fa66acda8dc">
  <div class="header">
    <h3>app/controllers/item_flags_controller.rb</h3>
    <h4><span class="green">97.78 %</span> covered</h4>
    <div>
      <b>45</b> relevant lines. 
      <span class="green"><b>44</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ItemFlagsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_parent_item</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_item, only: [:show]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="9">
          <span class="hits">6</span>
          
          <code class="ruby">    @item_flags = @item.item_flags</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">    s = @item_flags.as_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">    k = &quot;item_flags&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">    res = {item_flags: s, item_id: @item.id, item_type: @item_type.singularize, item_types_name: @item_type, master_id: @master.id, update_action: @update_action}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="16">
          <span class="hits">6</span>
          
          <code class="ruby">    render json: {k =&gt; res}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="20">
          <span class="hits">4</span>
          
          <code class="ruby">    index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    @item_flag = @item.item_flags.build</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="30">
          <span class="hits">12</span>
          
          <code class="ruby">    flag_list = secure_params[:item_flag_name_id].select {|f| !f.blank?}.map {|f| f.to_i}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="32">
          <span class="hits">4</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="33">
          <span class="hits">4</span>
          
          <code class="ruby">      @update_action = ItemFlag.set_flags flag_list, @item, current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    rescue ActiveRecord::RecordInvalid =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      logger.warn &quot;Bad request in create item flags: #{e.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      @item_flags = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      return bad_request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="40">
          <span class="hits">3</span>
          
          <code class="ruby">    show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_item</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      return if params[:id] == &#39;cancel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">      @item_flag = @item.item_flags.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      @id = @item_flag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_parent_item</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="52">
          <span class="hits">13</span>
          
          <code class="ruby">      @item_type = item_controller = params[:item_controller]      </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="53">
          <span class="hits">13</span>
          
          <code class="ruby">      item_class_name = item_controller.singularize.camelize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      # We will return a 404 if the requested item_class_name is not one of the valid set.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      # This prevents insecure requests from the user being used to access objects below</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="57">
          <span class="hits">13</span>
          
          <code class="ruby">      icn = ItemFlag.works_with item_class_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="59">
          <span class="hits">13</span>
          
          <code class="ruby">      return not_found unless icn</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="61">
          <span class="hits">8</span>
          
          <code class="ruby">      if defined? icn.constantize</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="62">
          <span class="hits">8</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="63">
          <span class="hits">8</span>
          
          <code class="ruby">          item_class = icn.constantize </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        rescue          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">          item_class = &quot;DynamicModel::#{icn}&quot;.constantize rescue nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="69">
          <span class="hits">8</span>
          
          <code class="ruby">      raise &quot;Failed to get #{item_class_name}&quot; unless item_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="71">
          <span class="hits">8</span>
          
          <code class="ruby">      @item = item_class.find(params[:item_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="73">
          <span class="hits">8</span>
          
          <code class="ruby">      raise &quot;Failed to get @item for #{item_class_name}&quot; unless @item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="75">
          <span class="hits">8</span>
          
          <code class="ruby">      @master = @item.master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="77">
          <span class="hits">8</span>
          
          <code class="ruby">      raise &quot;Failed to get @master for #{@item.inspect}&quot; unless @master</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="78">
          <span class="hits">8</span>
          
          <code class="ruby">      @master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="82">
          <span class="hits">4</span>
          
          <code class="ruby">      params.require(:item_flag).permit(item_flag_name_id: [])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="81b97db9b808541b660990310bcda52d878fbec0">
  <div class="header">
    <h3>app/controllers/masters_controller.rb</h3>
    <h4><span class="yellow">83.64 %</span> covered</h4>
    <div>
      <b>55</b> relevant lines. 
      <span class="green"><b>46</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class MastersController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authorized?, only: [:new, :create]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterSearch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  ResultsLimit = Master.results_limit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    #search_params</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="12">
          <span class="hits">30</span>
          
          <code class="ruby">    redirect_to &#39;/masters/search/&#39; and return if search_params.nil? || search_params.length == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="14">
          <span class="hits">25</span>
          
          <code class="ruby">    search_type = params[:mode] </code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="15">
          <span class="hits">25</span>
          
          <code class="ruby">    search_type = &#39;ADVANCED&#39; if search_type.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="18">
          <span class="hits">25</span>
          
          <code class="ruby">    run search_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    if params[:type] == &#39;msid&#39; &amp;&amp; params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      @master = Master.find_by_msid(params[:id]) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      return not_found unless @master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      @msid = @master.msid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    elsif params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      @master = Master.find(params[:id]) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      return not_found unless @master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      @master_id = @master.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    search</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def search</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="39">
          <span class="hits">7</span>
          
          <code class="ruby">    @msid ||= params[:nav_q]</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="40">
          <span class="hits">7</span>
          
          <code class="ruby">    @master_pro_id ||= params[:nav_q_pro_id]</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="41">
          <span class="hits">7</span>
          
          <code class="ruby">    @master_id ||= params[:nav_q_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="43">
          <span class="hits">7</span>
          
          <code class="ruby">    @master_req_format = params[:req_format] || &#39;reg&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="45">
          <span class="hits">7</span>
          
          <code class="ruby">    @master =  Master.new </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    # Advanced search fields</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="48">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.pro_infos.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="49">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.player_infos.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="50">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.addresses.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="51">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.player_contacts.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="52">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.trackers.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="53">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.tracker_histories.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="54">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.scantrons.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="55">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.sage_assignments.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    # NOT conditions</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="58">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.not_trackers.build</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="59">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.not_tracker_histories.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    # Simple search fields</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="62">
          <span class="hits">7</span>
          
          <code class="ruby">    @master.general_infos.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="65">
          <span class="hits">7</span>
          
          <code class="ruby">    render :search</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    @master = Master.new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    # Unfortunately there is no easy way to force the create request to fail for the purposes of testing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    # Therefore we provide a way to force an apparent failure in the test environment.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    # This is necessary in order to allow testing of what appears to be a false positive for this action in Brakeman</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="77">
          <span class="hits">2</span>
          
          <code class="ruby">    @master = Master.create_master_records current_user unless Rails.env.test? &amp;&amp; params[:testfail] == &#39;testfail&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="78">
          <span class="hits">2</span>
          
          <code class="ruby">    if @master &amp;&amp; @master.id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to @master, notice:  &quot;Created Master Record with MSID #{@master.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to new_master_url, notice: &quot;Error creating Master Record: #{Application.record_error_message @master}&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">  def search_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="79" data-linenumber="89">
          <span class="hits">79</span>
          
          <code class="ruby">    p = params_nil_if_blank params</code>
        </li>
      
        <li class="covered" data-hits="79" data-linenumber="90">
          <span class="hits">79</span>
          
          <code class="ruby">    p = params_downcase p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">    #p = p.permit(:master_id, player_info_attributes: [:first_name, :middle_name, :last_name, :nick_name, :birth_date, :death_date, :start_year], player_contacts_attributes: [], pro_info_attributes: [], address_attributes: [], manual_investigation_attributes: [])</code>
        </li>
      
        <li class="covered" data-hits="79" data-linenumber="92">
          <span class="hits">79</span>
          
          <code class="ruby">    p = p.except(:utf8, :controller, :action).permit!</code>
        </li>
      
        <li class="covered" data-hits="79" data-linenumber="93">
          <span class="hits">79</span>
          
          <code class="ruby">    logger.debug &quot;Screened params: #{p.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="79" data-linenumber="94">
          <span class="hits">79</span>
          
          <code class="ruby">    p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def authorized?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="98">
          <span class="hits">3</span>
          
          <code class="ruby">    return true if current_user.can? :create_msid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">    return not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1914f54c0af454341740a28eb126391a5a4fdf67">
  <div class="header">
    <h3>app/controllers/pages_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PagesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user_or_admin!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="4">
          <span class="hits">8</span>
          
          <code class="ruby">    if current_user &amp;&amp; ! current_admin</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="5">
          <span class="hits">5</span>
          
          <code class="ruby">      redirect_to :masters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="53bf0d048f8bca2922f29b19778551e452e55cf9">
  <div class="header">
    <h3>app/controllers/player_contacts_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PlayerContactsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="8">
          <span class="hits">13</span>
          
          <code class="ruby">      params.require(:player_contact).permit(:master_id, :data, :rec_type, :source, :rank)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fc1fc4b5ad0f9504c900fffe67dea4da2e05aca3">
  <div class="header">
    <h3>app/controllers/player_infos_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PlayerInfosController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="7">
          <span class="hits">12</span>
          
          <code class="ruby">      params.require(:player_info).permit(:master_id, :first_name, :last_name, :middle_name, :nick_name, :birth_date, :death_date, :start_year, :end_year, :rank, :occupation_category, :company, :company_description, :transaction_status, :transaction_substatus, :user_id, :college, :source, :notes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9abad669ca5fd84b56f84cb34553249dceeafa0b">
  <div class="header">
    <h3>app/controllers/pro_infos_controller.rb</h3>
    <h4><span class="red">60.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProInfosController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      params.require(:pro_info).permit(:master_id, :user_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5d587db5e2251adb04867bb73cd4726480d74380">
  <div class="header">
    <h3>app/controllers/protocol_events_controller.rb</h3>
    <h4><span class="yellow">87.5 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>28</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProtocolEventsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_protocol, only: [:index, :new, :show, :edit]    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_protocol_for_edit, only: [:create, :update]    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="7">
          <span class="hits">8</span>
          
          <code class="ruby">    if params[:all]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      @protocol_events = ProtocolEvent.all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      @sub_process_name = &quot;All Sub Processes&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="11">
          <span class="hits">8</span>
          
          <code class="ruby">      @protocol_events = @sub_process.protocol_events</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="12">
          <span class="hits">8</span>
          
          <code class="ruby">      @sub_process_name = @sub_process.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">    response_to_index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def new options = {}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="18">
          <span class="hits">3</span>
          
          <code class="ruby">    @protocol_event = @sub_process.protocol_events.build unless options[:use_current_object]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">    render partial: &#39;form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_protocol</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="26">
          <span class="hits">4</span>
          
          <code class="ruby">      return if params[:all]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="28">
          <span class="hits">4</span>
          
          <code class="ruby">      if @protocol_event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">        @protocol = @protocol_event.protocol</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        @sub_process = @protocol_event.sub_process      </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="31">
          <span class="hits">3</span>
          
          <code class="ruby">      elsif params[:protocol_id].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">        @protocol = Protocol.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">        @sub_process = SubProcess.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="35">
          <span class="hits">3</span>
          
          <code class="ruby">        @protocol = Protocol.find(params[:protocol_id])      </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">        @sub_process = SubProcess.find(params[:sub_process_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_protocol_for_edit</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="41">
          <span class="hits">10</span>
          
          <code class="ruby">      @sub_process = SubProcess.find(secure_params[:sub_process_id])</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="42">
          <span class="hits">10</span>
          
          <code class="ruby">      @protocol = @sub_process.protocol</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="43">
          <span class="hits">10</span>
          
          <code class="ruby">      @parent_param = {protocol_id: @protocol.id, sub_process_id: @sub_process.id} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="48">
          <span class="hits">20</span>
          
          <code class="ruby">      params.require(:protocol_event).permit(:name, :sub_process_id, :disabled, :milestone, :description)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ca24beb8d51b543df621c667f4f668fa66f0b0ab">
  <div class="header">
    <h3>app/controllers/protocols_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProtocolsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="7">
          <span class="hits">10</span>
          
          <code class="ruby">      params.require(:protocol).permit(:name, :disabled, :position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="094d745b9ba08060c10b2779a385264df86813bb">
  <div class="header">
    <h3>app/controllers/reports_controller.rb</h3>
    <h4><span class="red">21.32 %</span> covered</h4>
    <div>
      <b>136</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>107</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ReportsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterSearch</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  require &#39;csv&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user_or_admin!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authorized?, only: [:index]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_editable_instance_from_id, only: [:edit, :update]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  after_action :clear_results, only: [:show, :run]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  after_action :do_log_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method :filters, :filters_on, :index_path, :permitted_params</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  ResultsLimit = Master.results_limit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # List of available reports</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def index    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    @no_create = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    pm = Report.enabled    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    pm = pm.where filter_params if filter_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    @reports = pm.order  auto: :desc, report_type: :asc, position: :asc </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    respond_to do |format|      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      format.html { render :index }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      format.all { render json: @reports.as_json(except: [:created_at, :updated_at, :id, :admin_id, :user_id])}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    id = params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    redirect_to :index if id.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    id = id.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    redirect_to :index unless id &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    search_attrs = params[:search_attrs]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    @report = Report.find(id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    options = {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    @report.current_user = current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    if params[:commit] == &#39;count&#39;    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      options[:count_only] = true </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      @count_only = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    if search_attrs &amp;&amp; search_attrs.is_a?(Hash) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      options[:filter_previous] = true if search_attrs[:_filter_previous_]==&#39;true&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      no_run = !search_attrs[:no_run].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    @editable = @report.editable_data? &amp;&amp; (current_admin || current_user.can?(:edit_report_data))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    return unless @report.searchable || authorized?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">    if search_attrs &amp;&amp; !no_run</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">      begin        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">        @results =  @report.run(search_attrs, options) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      rescue ActiveRecord::PreparedStatementInvalid =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">        logger.info &quot;Prepared statement invalid in reports_controller (#{search_attrs}) show: #{e.inspect}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        @results = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">        flash.now[:danger] = &quot;Generated SQL invalid.\n#{@report.clean_sql}\n#{e.to_s}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">        respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">          format.html {</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">            if params[:part] == &#39;results&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">              render text: &quot;Generated SQL invalid.\n#{@report.clean_sql}\n#{e.to_s}&quot;, status: 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">              render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">          format.json { </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">            return general_error &quot;invalid query for report. Please check search fields or try to run the report again.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">        end     </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">      if params[:commit] == &#39;search&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">        run &#39;REPORT&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">        format.html {</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">          if params[:part] == &#39;results&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">            render partial: &#39;results&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">            render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">        format.json {          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">          render json: {results: @results, search_attributes: @report.search_attr_values}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">        format.csv { </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">          res_a = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">          blank_value = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">          if params[:csv_blank]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">            blank_value = &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">          end          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">          res_a &lt;&lt; @results.fields.to_csv</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">          @results.each_row do |row| </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">            res_a &lt;&lt; (row.collect {|val|  val || blank_value}).to_csv</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">          send_data res_a.join(&quot;&quot;), filename: &quot;report.csv&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">    elsif params[:get_filter_previous]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">      render partial: &#39;filter_on&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">      @report.search_attr_values = search_attrs</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">        format.html { </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="122">
          
          
          <code class="ruby">          if params[:part] == &#39;form&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">            render partial: &#39;form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">            render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">        }        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">      end     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">    render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">  def update    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">    if @report_item.respond_to? :master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">      @master = @report_item.master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">      @master.current_user = current_user if @master      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    elsif @report_item.respond_to? :user_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">      @report_item.user_id = current_user.id </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">    return not_authorized unless @report.editable_data?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby">    if @report_item.update(secure_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">      #redirect_to show_path(id: @report.id), notice: &quot;#{@report_item.human_name} updated successfully&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">      #render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">      # Need to update the master_id manually, since it could have been set by a trigger</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">      res = @report_item.class.find(@report_item.id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">      @report_item.master_id = res.master_id if res.respond_to?(:master_id) &amp;&amp; res.master_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">      render json: {report_item: @report_item}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">      logger.warn &quot;Error updating #{@report_item}: #{@report_item.errors.inspect}&quot;      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      flash.now[:warning] = &quot;Error updating #{@report_item}: #{error_message}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">      edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">    def error_message</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="166">
          
          
          <code class="ruby">      res = &quot;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">      @report_item.errors.full_messages.each do |message|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">        res &lt;&lt; &quot;; &quot; unless res.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby">        res &lt;&lt; &quot;#{message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">      res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">      :report_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby">      Report::ReportTypes.map {|g| [g,g.to_s.humanize]}.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">    def filter_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="184">
          
          
          <code class="ruby">      return nil if params[:filter].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">      params.require(:filter).permit(filters_on)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">#    def secure_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">#      params.require(:report).permit(:id,  :search_attrs)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">#    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">    def connection</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby">      @connection ||= ActiveRecord::Base.connection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">    def clear_results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">      # Needed to help control memory usage, according to PG:Result documentation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby">      @results.clear if @results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">    def authorized?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">      return true if current_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">      return true if current_user.can? :view_reports</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="206">
          
          
          <code class="ruby">      return not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">    def index_path p</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">      reports_path p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">    def do_log_action</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">      len = (@results ? @results.count : 0)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">      extras = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">      extras[:master_id] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">      extras[:msid] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">      log_action &quot;#{controller_name}##{action_name}&quot;, &quot;AUTO&quot;, len, &quot;OK&quot;, extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">    ### For editable reports</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">      @permitted_params = @report.edit_fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">    end          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="231">
          
          
          <code class="ruby">      params.require(report_params_holder).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_editable_instance_from_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">      id = params[:report_id]      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">      id = id.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">      @report = Report.find(id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby">      return if params[:id] == &#39;cancel&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">      @report_item = report_model.find(params[:id])            </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby">      @id = @report_item.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">    def report_model</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="245">
          
          
          <code class="ruby">      @report.edit_model_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="248">
          <span class="hits">1</span>
          
          <code class="ruby">    def report_params_holder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">      &quot;report_#{@report.edit_model.classify.underscore}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="902072f6c900407dc389676429dab718c5fdfcc5">
  <div class="header">
    <h3>app/controllers/sage_assignments_controller.rb</h3>
    <h4><span class="red">57.14 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SageAssignmentsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      res = params.require(:sage_assignment).permit(:master_id, :sage_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      res[:sage_id] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="22db40a6130130b7f2f820a2da1893565a534b17">
  <div class="header">
    <h3>app/controllers/scantrons_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ScantronsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="8">
          <span class="hits">14</span>
          
          <code class="ruby">      params.require(:scantron).permit(:master_id, :scantron_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c15ef96a21554680d4a9f755c4b9939279a53886">
  <div class="header">
    <h3>app/controllers/sub_processes_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SubProcessesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_protocol, only: [:index, :new, :show, :edit]    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_protocol_for_edit, only: [:create, :update]    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="6">
          <span class="hits">8</span>
          
          <code class="ruby">    @sub_processes = @protocol.sub_processes</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="7">
          <span class="hits">8</span>
          
          <code class="ruby">    response_to_index    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def new options = {}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">    @sub_process = @protocol.sub_processes.build unless options[:use_current_object]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="12">
          <span class="hits">3</span>
          
          <code class="ruby">    render partial: &#39;form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_protocol</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="19">
          <span class="hits">4</span>
          
          <code class="ruby">      @protocol = Protocol.find(params[:protocol_id])      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_protocol_for_edit</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="23">
          <span class="hits">10</span>
          
          <code class="ruby">      @protocol = Protocol.find(secure_params[:protocol_id])      </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="24">
          <span class="hits">10</span>
          
          <code class="ruby">      @parent_param = {protocol_id: @protocol.id} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="28">
          <span class="hits">20</span>
          
          <code class="ruby">      params.require(:sub_process).permit(:name, :disabled, :protocol_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3a4823be60f4cf1e321fff637c3d2b90b574aa38">
  <div class="header">
    <h3>app/controllers/tracker_histories_controller.rb</h3>
    <h4><span class="red">72.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TrackerHistoriesController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_parent_item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="7">
          <span class="hits">3</span>
          
          <code class="ruby">    if @tracker</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="8">
          <span class="hits">3</span>
          
          <code class="ruby">      logger.info &quot;Getting tracker item tracker histories&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="9">
          <span class="hits">3</span>
          
          <code class="ruby">      @tracker_histories = @tracker.tracker_histories.order Master::TrackerHistoryEventOrderClause</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    elsif @master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      logger.info &quot;Getting master tracker histories&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      @tracker_histories = @master.tracker_histories.order Master::TrackerHistoryEventOrderClause</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      render code: 404</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="18">
          <span class="hits">3</span>
          
          <code class="ruby">    logger.info &quot;Tracker histories returned #{@tracker_histories.length} items&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="20">
          <span class="hits">3</span>
          
          <code class="ruby">    if params[:skip_last]==&#39;true&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      # Remove a current tracker item from the list.</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="22">
          <span class="hits">10</span>
          
          <code class="ruby">      mid = @tracker_histories.max_by {|x| x.id}      </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="23">
          <span class="hits">10</span>
          
          <code class="ruby">      @tracker_histories = @tracker_histories.reject {|x| x.id == mid.id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="26">
          <span class="hits">3</span>
          
          <code class="ruby">    render json: {tracker_histories: @tracker_histories, master_id: @master.id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_parent_item</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">      if params[:tracker_id].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">        @tracker = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">        @master = Master.find(params[:master_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">        @tracker = Tracker.find(params[:tracker_id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="38">
          <span class="hits">3</span>
          
          <code class="ruby">        @master = @tracker.master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      params.require(:tracker).permit(:master_id,  :protocol_id, :event, :event_date, :sub_process_id, :outcome, :outcome_date, :user_id, :notes, :item_id, :item_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="40b3ac5979c0fa42fe8e7b5172f08ca81ff18bf3">
  <div class="header">
    <h3>app/controllers/trackers_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TrackersController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :merge_if_exists, only: [:create]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def merge_if_exists</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="10">
          <span class="hits">10</span>
          
          <code class="ruby">      @tracker = @master_objects.build(secure_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="12">
          <span class="hits">10</span>
          
          <code class="ruby">      res = @tracker.merge_if_exists</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      # If the tracker record exists with the requested protocol then return the updated record and show the result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      # Otherwise just follow the default record creation flow</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="16">
          <span class="hits">10</span>
          
          <code class="ruby">      if res</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">        @tracker = res</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">        show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="24">
          <span class="hits">25</span>
          
          <code class="ruby">      params.require(:tracker).permit(:master_id,  :protocol_id, :protocol_event_id, :event_date, :sub_process_id, :user_id, :notes, :item_id, :item_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7b3558e2806fa4875bb1d0535978d2cdc5ad3d57">
  <div class="header">
    <h3>app/helpers/addresses_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AddressesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def state_hash</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="4">
          <span class="hits">7</span>
          
          <code class="ruby">    AddressState.id_value_pairs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"> </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fc0134917d4f7fea5483b4f35f177948a9ea420e">
  <div class="header">
    <h3>app/helpers/admin_helper.rb</h3>
    <h4><span class="red">31.25 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AdminHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_path id, opt={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    redir = {action: :edit, id: id}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    redir.merge! opt</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    url_for(redir)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_edit_cancel</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">     link_to &#39;cancel&#39;, &quot;#&quot;, id: &quot;admin-edit-cancel&quot;, class: &quot;btn btn-danger&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_edit_btn id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">     link_to &#39;&#39;, edit_path(id, filter: params[:filter]), remote: true, class: &#39;edit-entity glyphicon glyphicon-pencil&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def show_filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    res = &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    if respond_to?(:filters) &amp;&amp;  filters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      res = &quot;#{link_to(&quot;all&quot;, index_path(filter: &quot;&quot;), class: &quot;btn btn-default btn-sm&quot; )}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      filters.each do |k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">        res &lt;&lt; link_to(v, index_path(filter: {filters_on =&gt; k}), class: &quot;btn btn-default btn-sm&quot; )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    res.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end   </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a11f63a483af63b82c57334ebcd72eaa73b5cf9c">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4><span class="green">96.88 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ApplicationHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def object_name    </code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="5">
          <span class="hits">19</span>
          
          <code class="ruby">    (@object_name || controller_name.singularize)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def object_instance</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="9">
          <span class="hits">19</span>
          
          <code class="ruby">    instance_variable_get(&quot;@#{object_name}&quot;)    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def hyphenated_name</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="13">
          <span class="hits">21</span>
          
          <code class="ruby">    controller_name.singularize.hyphenate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_email</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="18">
          <span class="hits">41</span>
          
          <code class="ruby">    return nil unless current_user || current_admin</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="19">
          <span class="hits">18</span>
          
          <code class="ruby">    (current_user || current_admin).email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def env_name</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="23">
          <span class="hits">32</span>
          
          <code class="ruby">    (ENV[&#39;FPHS_ENV_NAME&#39;] || &#39;unknown&#39;).gsub(&#39; &#39;,&#39;_&#39;).underscore.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def body_classes</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    &quot; class=\&quot;#{controller_name} #{action_name} #{env_name}\&quot;&quot;.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def zip_field_props init={}</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="31">
          <span class="hits">7</span>
          
          <code class="ruby">    init.merge({pattern: &quot;\\d{5,5}(-\\d{4,4})?&quot;})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def inline_cancel_button class_extras=&quot;pull-right&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="35">
          <span class="hits">3</span>
          
          <code class="ruby">    logger.info &quot;Doing inline_cancel_button for #{object_instance}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">    if object_instance.id </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      cancel_href = &quot;/masters/#{object_instance.master_id}/#{controller_name}/#{object_instance.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">      cancel_href = &quot;/masters/#{object_instance.master_id}/#{controller_name}/cancel&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="43">
          <span class="hits">3</span>
          
          <code class="ruby">    &quot;&lt;a class=\&quot;show-entity show-#{hyphenated_name} #{class_extras} glyphicon glyphicon-remove-sign\&quot; title=\&quot;cancel\&quot; href=\&quot;#{cancel_href}\&quot; data-remote=\&quot;true\&quot; data-#{hyphenated_name}-id=\&quot;#{object_instance.id}\&quot; data-result-target=\&quot;##{hyphenated_name}-#{@master.id}-#{@id}\&quot; data-template=\&quot;#{hyphenated_name}-result-template\&quot; data-toggle=\&quot;scrollto-result\&quot; #{!@id ? &quot;data-target=\&quot;#master-#{@master.id}\&quot;&quot; : &quot;&quot;}&gt;&lt;/a&gt;&quot;.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_form_id</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="47">
          <span class="hits">3</span>
          
          <code class="ruby">    &quot;#{hyphenated_name}-edit-form-#{@master.id}-#{@id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_form_hash extras={}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="51">
          <span class="hits">3</span>
          
          <code class="ruby">    res = extras.dup </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="53">
          <span class="hits">3</span>
          
          <code class="ruby">    res[:remote] = true</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="54">
          <span class="hits">3</span>
          
          <code class="ruby">    res[:html] ||= {}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="55">
          <span class="hits">3</span>
          
          <code class="ruby">    res[:html].merge!(&quot;data-result-target&quot; =&gt; &quot;##{hyphenated_name}-#{@master.id}-#{@id}&quot;, &quot;data-template&quot; =&gt; &quot;#{hyphenated_name}-result-template&quot;)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="56">
          <span class="hits">3</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_edit_controls</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">    h = &quot;&lt;div class=\&quot;admin-edit-controls\&quot;&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      #{link_to &quot;cancel&quot;, url_for(action: :edit)} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      #{link_to &quot;admin menu&quot;, &#39;/&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      &lt;/div&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    &quot;.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="bd0cc68f37cf55552fefa410090747b45a42f29e">
  <div class="header">
    <h3>app/helpers/colleges_helper.rb</h3>
    <h4><span class="red">50.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CollegesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def college_array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    res = College.selector_array.map {|c| c.titleize}.uniq!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    res.to_json.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="adb3fb94e429b0da088ae8a815bc0be93c028a5b">
  <div class="header">
    <h3>app/helpers/general_selections_helper.rb</h3>
    <h4><span class="red">16.67 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>15</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module GeneralSelectionsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def general_selection_block_id item_type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    &quot;##{item_type}-definitions-#{@id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def general_selection type, options={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    raise &quot;Item type not recognized&quot; unless GeneralSelection.item_types.include? type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    cond = {item_type: type}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    attr = [:name, :value, :create_with, :edit_if_set, :edit_always, :lock, :description]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    res_attr = GeneralSelection.selector_attributes(attr, cond)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    if @id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      # Get results to check if the item is set to lock, and the value is set </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      res = res_attr.select {|a| !!a[5] &amp;&amp; a[1] == options[:value]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      # If the current value is not set to lock, check for edit_always or edit_if_set and the value is that set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      res  = res_attr.select {|a| !!a[4] || !!a[3] &amp;&amp; a[1] == options[:value] } if res.length == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      res  = res_attr.select {|a| !!a[2]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    unless options[:return_all]      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      res.collect! {|a| [a[0], a[1]]} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    res.map! {|a| [&quot;#{a[1]} - #{a[0]}&quot;, a[1]]} if options[:present] == :hyphenate_name_val</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    res.sort! {|a,b| a[1].to_i &lt;=&gt; b[1].to_i} if options[:order] == :value_number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    res.sort! {|a,b| b[1].to_i &lt;=&gt; a[1].to_i} if options[:order] == :value_number_desc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e76d32342699189f11a8b0babaf798d2a2a2dd60">
  <div class="header">
    <h3>app/helpers/item_flag_names_helper.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ItemFlagNamesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_types_array    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    ItemFlag.use_with_class_names.collect {|v| v.singularize.underscore}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f977333907c7fe73c3a2b47c649ce613bbc41786">
  <div class="header">
    <h3>app/helpers/item_flags_helper.rb</h3>
    <h4><span class="red">45.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ItemFlagsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def flag_edit_form_id </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    &quot;item-flag-edit-form-#{@master.id}-#{@item_type}-#{@item.id}-#{@id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def flag_edit_form_hash extras={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    extras.merge({url: &quot;/masters/#{@master.id}/#{@item.item_type}/#{@item.id}/item_flags&quot;, action: :post, remote: true, html: {&quot;data-result-target&quot; =&gt; &quot;#item-flag-#{@master.id}-#{@item_type}-#{@item.id}-#{@id}&quot;, &quot;data-template&quot; =&gt; &quot;item-flags-result-template&quot;}})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_flag_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    &quot;#{url_for([@master, @item])}/item_flags/#{@id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def flag_inline_cancel_button</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    if @id </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      cancel_href = item_flag_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      cancel_href = &quot;#{item_flag_path}cancel&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    &quot;&lt;a class=\&quot;show-entity show-item-flag pull-right glyphicon glyphicon-remove-sign\&quot; title=\&quot;cancel\&quot; href=\&quot;#{cancel_href}\&quot; data-remote=\&quot;true\&quot; data-item-flag-id=\&quot;#{@id}\&quot; data-result-target=\&quot;#item-flag-#{@master.id}-#{@item.id}-#{@id}\&quot; data-template=\&quot;item-flag-result-template\&quot;&gt;&lt;/a&gt;&quot;.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_flags_array item_type=nil</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="26">
          <span class="hits">7</span>
          
          <code class="ruby">    item_type ||= @item_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="28">
          <span class="hits">7</span>
          
          <code class="ruby">    ItemFlagName.selector_collection(item_type: item_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def flags_selected item=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    item ||= @item</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    s = item.item_flags.map {|i| i.item_flag_name_id}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    logger.info &quot;Selected #{s}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a9ea82560d5866ffd8a2b6847e527d9773898e4d">
  <div class="header">
    <h3>app/helpers/manage_users_helper.rb</h3>
    <h4><span class="red">60.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ManageUsersHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_path user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    manage_user_path(user)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def users_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    manage_users_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7d4434fe223047a8fdfc34b8ae595733c650b129">
  <div class="header">
    <h3>app/helpers/player_infos_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module PlayerInfosHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def player_info_rank_array_pair</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="5">
          <span class="hits">105</span>
          
          <code class="ruby">    AccuracyScore.selector_name_value_pair.map {|a| [&quot;#{a.last} - #{a.first}&quot;, a.last]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d31761a5436407aaaa247244ed9cfa1d9c6092d8">
  <div class="header">
    <h3>app/helpers/protocols_helper.rb</h3>
    <h4><span class="yellow">82.76 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ProtocolsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    res = Protocol.selector_array_pair</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_array_without_updates</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="9">
          <span class="hits">50</span>
          
          <code class="ruby">    res = Protocol.selector_array_pair.reject {|a| a.first == Protocol::RecordUpdatesProtocolName}</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="10">
          <span class="hits">10</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def sub_processes_array</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="14">
          <span class="hits">14</span>
          
          <code class="ruby">    res = SubProcess.selector_attributes [:name, :id, :protocol_name]</code>
        </li>
      
        <li class="covered" data-hits="126" data-linenumber="15">
          <span class="hits">126</span>
          
          <code class="ruby">    res  = res.map {|a| [&quot;#{a.last} - #{a.first}&quot;, a[1]]}</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="16">
          <span class="hits">14</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def sub_processes_array_with_class</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="21">
          <span class="hits">31</span>
          
          <code class="ruby">    res = SubProcess.selector_attributes [:name, :id, :protocol_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="279" data-linenumber="23">
          <span class="hits">279</span>
          
          <code class="ruby">    res = res.map {|a| [a.first, a[1], {&quot;data-filter-id&quot; =&gt; a.last}]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="25">
          <span class="hits">31</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_events_array_with_class options={}</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="29">
          <span class="hits">31</span>
          
          <code class="ruby">    res = ProtocolEvent.selector_attributes [:name, :id, :sub_process_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1156" data-linenumber="31">
          <span class="hits">1156</span>
          
          <code class="ruby">    pes = res.collect {|a| a[2]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="33">
          <span class="hits">31</span>
          
          <code class="ruby">    if options[:add_empty]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      # look for missing items</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="35">
          <span class="hits">14</span>
          
          <code class="ruby">      missing = []</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="36">
          <span class="hits">14</span>
          
          <code class="ruby">      sub_processes_array.each do |a|</code>
        </li>
      
        <li class="covered" data-hits="112" data-linenumber="37">
          <span class="hits">112</span>
          
          <code class="ruby">        missing &lt;&lt; [options[:add_empty], &#39;(null)&#39;, {&quot;data-filter-id&quot; =&gt; a[1]} ] unless pes.include? a[1]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="2281" data-linenumber="43">
          <span class="hits">2281</span>
          
          <code class="ruby">    res = res.select {|a| a.last}.map {|a| [a.first, a[1], {&quot;data-filter-id&quot; =&gt; a.last}]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="45">
          <span class="hits">31</span>
          
          <code class="ruby">    res += missing if missing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="47">
          <span class="hits">31</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_events_name_array_with_class</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    res = ProtocolEvent.selector_attributes [:name, :sub_process_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    res = res.map {|a| [a.first, a.first.downcase, {&quot;data-filter-id&quot; =&gt; a.last}]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="27d5c7c7a524ebbe6644e431cf2d95eff1e81126">
  <div class="header">
    <h3>app/helpers/reports_helper.rb</h3>
    <h4><span class="red">11.11 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>32</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ReportsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def report_edit_btn id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">     link_to &#39;&#39;, edit_report_path(id, report_id: @report.id, filter: params[:filter]), remote: true, class: &#39;edit-entity glyphicon glyphicon-pencil&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def report_edit_cancel</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">     link_to &#39;cancel&#39;, &quot;#&quot;, id: &quot;report-edit-cancel&quot;, class: &quot;btn btn-danger&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def report_field name, type, value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    if type.is_a? String    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      type_string = type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    elsif type.is_a? Hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      type_string = type.first.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      type_val = type.first.last      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      c = type_string.to_s.classify.constantize rescue nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    use_dropdown = nil    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    value ||= Report.calculate_default(type_val[&#39;default&#39;], type_string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    if c &amp;&amp; c.respond_to?(:all_name_value_enable_flagged) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      if type_val[&#39;item_type&#39;] == &#39;all&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        type_filter = nil     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      elsif type_val[&#39;item_type&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">        type_filter = {item_type: type_val[&#39;item_type&#39;]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">         </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      unless @report_page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">        type_filter ||= {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">        type_filter[:disabled] = false        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      use_dropdown = options_for_select(c.all_name_value_enable_flagged(type_filter), value) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    if type_val[&#39;label&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      main_field = label_tag type_val[&#39;label&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      main_field = label_tag name </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    if type_val[&#39;multiple&#39;] == &#39;multiple&#39; || type_val[&#39;multiple&#39;] == &#39;multiple-regex&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      if use_dropdown </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">        main_field &lt;&lt; select_tag(&quot;search_attrs[#{name}]&quot;, use_dropdown , multiple: true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">        main_field &lt;&lt; text_field_tag(&quot;multiple_attrs[#{name}]&quot;, &#39;&#39;, type: type_string, class: &#39;form-control no-auto-submit&#39;  , data: {attribute: name})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">        main_field &lt;&lt; link_to( &quot;+&quot;, &quot;add_multiple_attrs[#{name}]&quot;, data: {attribute: name}, class: &#39;btn btn-default add-btn&#39;, title: &#39;add to search&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">        v = value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">        v = value.join(&quot;\n&quot;) if value.is_a? Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">        main_field &lt;&lt; text_area_tag(&quot;search_attrs[#{name}]&quot;, v, class: &#39;auto-grow&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      if use_dropdown </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        main_field &lt;&lt; select_tag(&quot;search_attrs[#{name}]&quot;, use_dropdown , include_blank: &#39;select&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        main_field &lt;&lt; text_field_tag(&quot;search_attrs[#{name}]&quot;, value, type: type_string, class: &#39;form-control&#39; )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7a0e45bf9bbdb4a2d3ec7041c59a8904f6e407bd">
  <div class="header">
    <h3>app/models/accuracy_score.rb</h3>
    <h4><span class="green">92.31 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AccuracyScore &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="2775" data-linenumber="5">
          <span class="hits">2775</span>
          
          <code class="ruby">  default_scope {order  :value}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_value_change,  on: :update  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :value, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def full_label</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    &quot;#{value} - #{name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_value_change </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="18">
          <span class="hits">8</span>
          
          <code class="ruby">      if value_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">        errors.add(:value, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a84033f6307212cecb04f0471e0d732fa16e5258">
  <div class="header">
    <h3>app/models/address.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>48</b> relevant lines. 
      <span class="green"><b>48</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Address &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  PrimaryRank = 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  SecondaryRank = 5</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  InactiveRank = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :zip, zip: true, allow_blank: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :source, source: true, allow_blank: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :rank, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :handle_country</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :handle_primary_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.states</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="16">
          <span class="hits">31</span>
          
          <code class="ruby">    AddressState.id_value_pairs    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_state_name code</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="20">
          <span class="hits">50</span>
          
          <code class="ruby">    return unless code</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="21">
          <span class="hits">31</span>
          
          <code class="ruby">    states[code.upcase] </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def state_name </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="25">
          <span class="hits">8</span>
          
          <code class="ruby">    Address.get_state_name self.state</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_country_name code</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="29">
          <span class="hits">20</span>
          
          <code class="ruby">    return unless code</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="30">
          <span class="hits">6</span>
          
          <code class="ruby">    country_code = code.upcase</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="31">
          <span class="hits">6</span>
          
          <code class="ruby">    country = ISO3166::Country[country_code]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="32">
          <span class="hits">6</span>
          
          <code class="ruby">    country.translations[I18n.locale.to_s] || country.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def country_name</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="37">
          <span class="hits">8</span>
          
          <code class="ruby">    Address.get_country_name self.country</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    # Only one address for a master can be set as Primary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    # If a new item is added, or an existed item is updated with Primary rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    # update the existing record(s) with Primary status to be Secondary</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def handle_primary_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="47">
          <span class="hits">42</span>
          
          <code class="ruby">      if self.rank.to_i == PrimaryRank</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="48">
          <span class="hits">8</span>
          
          <code class="ruby">        logger.info &quot;Address rank set as primary in address #{self.id}. Setting other addresses for this master to secondary if they were primary.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="50">
          <span class="hits">8</span>
          
          <code class="ruby">        self.master.addresses.where(rank: PrimaryRank).each do |a|</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="51">
          <span class="hits">11</span>
          
          <code class="ruby">          if a.id != self.id</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="52">
          <span class="hits">3</span>
          
          <code class="ruby">            logger.info &quot;Address #{a.id} has primary rank currently. Setting it to secondary&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="53">
          <span class="hits">3</span>
          
          <code class="ruby">            a.rank = SecondaryRank</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="54">
          <span class="hits">3</span>
          
          <code class="ruby">            a.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="55">
          <span class="hits">3</span>
          
          <code class="ruby">            multiple_results &lt;&lt; a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    # Validate state and zip for US country and region / postal code for non-US    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">    def handle_country</code>
        </li>
      
        <li class="covered" data-hits="43" data-linenumber="64">
          <span class="hits">43</span>
          
          <code class="ruby">      if country</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="65">
          <span class="hits">7</span>
          
          <code class="ruby">        self.country = country.downcase        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="67">
          <span class="hits">7</span>
          
          <code class="ruby">        if country.downcase == &#39;us&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="68">
          <span class="hits">2</span>
          
          <code class="ruby">          self.region = nil</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">          self.postal_code = nil</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">          return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="72">
          <span class="hits">5</span>
          
          <code class="ruby">          if region.blank? &amp;&amp; postal_code.blank?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">            self.errors.add :country, &quot;was not USA and province/county and postal code are blank. At least one must be entered for countries other than USA.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">            return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="76">
          <span class="hits">4</span>
          
          <code class="ruby">            self.state = nil</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="77">
          <span class="hits">4</span>
          
          <code class="ruby">            self.zip = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="79">
          <span class="hits">4</span>
          
          <code class="ruby">            return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="84">
          <span class="hits">36</span>
          
          <code class="ruby">        true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="023b3b1a04409f4bb74916f6f5c8664d61780124">
  <div class="header">
    <h3>app/models/address_state.rb</h3>
    <h4><span class="red">80.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AddressState</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.all_name_value_enable_flagged attr=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    id_value_pairs.map {|k,v| [v,k.downcase]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.id_value_pairs</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="8">
          <span class="hits">38</span>
          
          <code class="ruby">    {&quot;AL&quot; =&gt; &quot;Alabama&quot;, &quot;AK&quot; =&gt; &quot;Alaska&quot;, &quot;AZ&quot; =&gt; &quot;Arizona&quot;, &quot;AR&quot; =&gt; &quot;Arkansas&quot;, &quot;CA&quot; =&gt; &quot;California&quot;, &quot;CO&quot; =&gt; &quot;Colorado&quot;, &quot;CT&quot; =&gt; &quot;Connecticut&quot;, &quot;DE&quot; =&gt; &quot;Delaware&quot;, &quot;DC&quot; =&gt; &quot;District of Columbia&quot;, &quot;FL&quot; =&gt; &quot;Florida&quot;, &quot;GA&quot; =&gt; &quot;Georgia&quot;, &quot;HI&quot; =&gt; &quot;Hawaii&quot;, &quot;ID&quot; =&gt; &quot;Idaho&quot;, &quot;IL&quot; =&gt; &quot;Illinois&quot;, &quot;IN&quot; =&gt; &quot;Indiana&quot;, &quot;IA&quot; =&gt; &quot;Iowa&quot;, &quot;KS&quot; =&gt; &quot;Kansas&quot;, &quot;KY&quot; =&gt; &quot;Kentucky&quot;, &quot;LA&quot; =&gt; &quot;Louisiana&quot;, &quot;ME&quot; =&gt; &quot;Maine&quot;, &quot;MD&quot; =&gt; &quot;Maryland&quot;, &quot;MA&quot; =&gt; &quot;Massachusetts&quot;, &quot;MI&quot; =&gt; &quot;Michigan&quot;, &quot;MN&quot; =&gt; &quot;Minnesota&quot;, &quot;MS&quot; =&gt; &quot;Mississippi&quot;, &quot;MO&quot; =&gt; &quot;Missouri&quot;, &quot;MT&quot; =&gt; &quot;Montana&quot;, &quot;NE&quot; =&gt; &quot;Nebraska&quot;, &quot;NV&quot; =&gt; &quot;Nevada&quot;, &quot;NH&quot; =&gt; &quot;New Hampshire&quot;, &quot;NJ&quot; =&gt; &quot;New Jersey&quot;, &quot;NM&quot; =&gt; &quot;New Mexico&quot;, &quot;NY&quot; =&gt; &quot;New York&quot;, &quot;NC&quot; =&gt; &quot;North Carolina&quot;, &quot;ND&quot; =&gt; &quot;North Dakota&quot;, &quot;OH&quot; =&gt; &quot;Ohio&quot;, &quot;OK&quot; =&gt; &quot;Oklahoma&quot;, &quot;OR&quot; =&gt; &quot;Oregon&quot;, &quot;PA&quot; =&gt; &quot;Pennsylvania&quot;, &quot;RI&quot; =&gt; &quot;Rhode Island&quot;, &quot;SC&quot; =&gt; &quot;South Carolina&quot;, &quot;SD&quot; =&gt; &quot;South Dakota&quot;, &quot;TN&quot; =&gt; &quot;Tennessee&quot;, &quot;TX&quot; =&gt; &quot;Texas&quot;, &quot;UT&quot; =&gt; &quot;Utah&quot;, &quot;VT&quot; =&gt; &quot;Vermont&quot;, &quot;VA&quot; =&gt; &quot;Virginia&quot;, &quot;WA&quot; =&gt; &quot;Washington&quot;, &quot;WV&quot; =&gt; &quot;West Virginia&quot;, &quot;WI&quot; =&gt; &quot;Wisconsin&quot;, &quot;WY&quot; =&gt; &quot;Wyoming&quot;, &quot;AS&quot; =&gt; &quot;American Samoa&quot;, &quot;GU&quot; =&gt; &quot;Guam&quot;, &quot;MP&quot; =&gt; &quot;Northern Mariana Islands&quot;, &quot;PR&quot; =&gt; &quot;Puerto Rico&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5ff4a9d72d9b6881ecff2b4c947c2dcb43dc0cf8">
  <div class="header">
    <h3>app/models/admin.rb</h3>
    <h4><span class="green">96.43 %</span> covered</h4>
    <div>
      <b>28</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActionLogging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include StandardAuthentication</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  devise :database_authenticatable, :trackable, :timeoutable, :lockable, :validatable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_email_change, on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_reenabling_admin, on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_not_in_setup_script, on: :create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def enabled?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    !self.disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def timeout_in</code>
        </li>
      
        <li class="covered" data-hits="145" data-linenumber="18">
          <span class="hits">145</span>
          
          <code class="ruby">    return Settings::AdminTimeout</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # Standard Devise callback to allow accounts to be disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def active_for_authentication?</code>
        </li>
      
        <li class="covered" data-hits="147" data-linenumber="23">
          <span class="hits">147</span>
          
          <code class="ruby">    super &amp;&amp; !self.disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # Standard Devise callback to tell user that an account has been disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def inactive_message</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    !self.disabled  ? super : :account_has_been_disabled    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  # Simple way to ensure that this is not being run from inside Passenger</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def in_setup_script</code>
        </li>
      
        <li class="covered" data-hits="1177" data-linenumber="33">
          <span class="hits">1177</span>
          
          <code class="ruby">    ENV[&#39;FPHS_ADMIN_SETUP&#39;]==&#39;yes&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_s</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="37">
          <span class="hits">9</span>
          
          <code class="ruby">    email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  protected  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_email_change </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="43">
          <span class="hits">9</span>
          
          <code class="ruby">      if email_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:email, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_reenabling_admin</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="49">
          <span class="hits">9</span>
          
          <code class="ruby">      if disabled_changed? &amp;&amp; self.persisted? &amp;&amp; self.disabled != true &amp;&amp; !in_setup_script</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">        errors.add(:disabled, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_not_in_setup_script</code>
        </li>
      
        <li class="covered" data-hits="1174" data-linenumber="56">
          <span class="hits">1174</span>
          
          <code class="ruby">      errors.add(:admin, &quot;can only create admins in console&quot;) unless in_setup_script</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3fe68e17741ff6e4677d36e1615a8d9be61b5883">
  <div class="header">
    <h3>app/models/application.rb</h3>
    <h4><span class="red">62.5 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Application  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.version    </code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="4">
          <span class="hits">32</span>
          
          <code class="ruby">    @@version ||= File.read(&#39;./version.txt&#39;).gsub(&quot;\n&quot;,&#39;&#39;)    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.server_cache_version</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="8">
          <span class="hits">9</span>
          
          <code class="ruby">    Rails.cache.fetch(&#39;server_cache_version&#39;){</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="9">
          <span class="hits">3</span>
          
          <code class="ruby">      Time.now.to_f.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.record_error_message record</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    res = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    return &quot;unexpected error&quot; unless record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    record.errors.each do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      res &lt;&lt; r.join(&#39; &#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    res.join &quot;; &quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.hide_messages</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    @@hide_messages ||= [I18n.translate(&#39;devise.sessions.signed_in&#39;)]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    Rails.logger.info &quot;Hide messages: #{@@hide_messages}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    @@hide_messages</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b160023a4d514c27ebbed47dd74a3eedcb700a5e">
  <div class="header">
    <h3>app/models/college.rb</h3>
    <h4><span class="yellow">89.09 %</span> covered</h4>
    <div>
      <b>55</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class College &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="7">
          <span class="hits">49</span>
          
          <code class="ruby">  default_scope -&gt; {order  &quot;colleges.updated_at DESC nulls last&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :downcase_name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_name_change,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :check_synonym</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :either_admin_or_user, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true, uniqueness: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # Override standard #all method to pull from cache if available</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.all</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="17">
          <span class="hits">212</span>
          
          <code class="ruby">    Rails.cache.fetch gen_cache_key do</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="18">
          <span class="hits">96</span>
          
          <code class="ruby">      super      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # Check if the college with &#39;name&#39; exists. If so, return truthy value</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.exists? name</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="24">
          <span class="hits">91</span>
          
          <code class="ruby">    res = all.exists? name: name.downcase    </code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="25">
          <span class="hits">91</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # Create a new named college (working as the specified user) if the college does not exist already</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_if_new name, user    </code>
        </li>
      
        <li class="covered" data-hits="90" data-linenumber="30">
          <span class="hits">90</span>
          
          <code class="ruby">    return if exists? name</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="31">
          <span class="hits">13</span>
          
          <code class="ruby">    logger.info &quot;Adding new college to list: #{name}&quot;</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="32">
          <span class="hits">13</span>
          
          <code class="ruby">    c = College.new </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="33">
          <span class="hits">13</span>
          
          <code class="ruby">    c.name = name.downcase</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="34">
          <span class="hits">13</span>
          
          <code class="ruby">    c.current_user = user</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="35">
          <span class="hits">12</span>
          
          <code class="ruby">    c.save!</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="36">
          <span class="hits">12</span>
          
          <code class="ruby">    c</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  # Required to get user email address for admin view of who created the college record</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    return nil unless user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    user.email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user= new_user    </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="46">
          <span class="hits">13</span>
          
          <code class="ruby">    raise &quot;bad user set&quot; unless new_user.is_a? User</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="47">
          <span class="hits">12</span>
          
          <code class="ruby">    @user_set = true </code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="48">
          <span class="hits">12</span>
          
          <code class="ruby">    self.user = new_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_set?</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="52">
          <span class="hits">41</span>
          
          <code class="ruby">    !!@user_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  # Lookup the name of the record this is a synonym for</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def synonym_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">    return nil unless synonym_for_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    c = College.find_by_id(synonym_for_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">    return nil unless c</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">    c.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_name_change</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="68">
          <span class="hits">5</span>
          
          <code class="ruby">        errors.add(:name, &quot;change not allowed!&quot;) if name_changed? &amp;&amp; self.persisted? &amp;&amp; !admin_set?      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">    def ensure_admin_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      # Override the standard test for admin being set, since users can create (but not update) colleges</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="73">
          <span class="hits">47</span>
          
          <code class="ruby">      errors.add(:admin, &quot;has not been set&quot;) if self.persisted? &amp;&amp; !admin_set?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">    #Validate that the college this record is being set as a synonym for actually exists</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    def check_synonym</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="79">
          <span class="hits">47</span>
          
          <code class="ruby">      if synonym_for_id </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="80">
          <span class="hits">4</span>
          
          <code class="ruby">        sc = College.find_by_id(synonym_for_id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="81">
          <span class="hits">4</span>
          
          <code class="ruby">        if !sc || sc.disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">          errors.add :synonym, &quot;does not exist as a college already&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">          return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="87">
          <span class="hits">46</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    def either_admin_or_user</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="91">
          <span class="hits">41</span>
          
          <code class="ruby">      errors.add(:user, &quot;has not been set when not acting as admin&quot;) unless user_set? || admin_set?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    def downcase_name</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="95">
          <span class="hits">47</span>
          
          <code class="ruby">      return unless self.name</code>
        </li>
      
        <li class="covered" data-hits="43" data-linenumber="96">
          <span class="hits">43</span>
          
          <code class="ruby">      self.name = self.name.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2e0342d36f44f3455138737e8140e7d5f1d19f5a">
  <div class="header">
    <h3>app/models/concerns/action_logging.rb</h3>
    <h4><span class="green">91.67 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ActionLogging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def session_class_name</code>
        </li>
      
        <li class="covered" data-hits="608" data-linenumber="6">
          <span class="hits">608</span>
          
          <code class="ruby">    self.class.name.downcase.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def action_logger</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # We are using syslog now, so push everything out through the same logger</code>
        </li>
      
        <li class="covered" data-hits="304" data-linenumber="11">
          <span class="hits">304</span>
          
          <code class="ruby">    Rails.logger</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def log_action action, sub, results, method, params, status=&quot;OK&quot;, extras={}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="304" data-linenumber="16">
          <span class="hits">304</span>
          
          <code class="ruby">    res = {user: self.id, user_type: session_class_name, email: self.email, action: action, sub: sub, method: method, params: params, results: results, status: status, action_at: DateTime.now.iso8601}</code>
        </li>
      
        <li class="covered" data-hits="304" data-linenumber="17">
          <span class="hits">304</span>
          
          <code class="ruby">    res.merge! extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Note: the prefix on the front of the message is used by rsyslog to filter messages to the correct file</code>
        </li>
      
        <li class="covered" data-hits="304" data-linenumber="20">
          <span class="hits">304</span>
          
          <code class="ruby">    action_logger.info(&quot;fphs_#{session_class_name}_actions=#{res.to_json}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def after_database_authentication</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    log_action &quot;#{session_class_name} login&quot;, &quot;LOGIN&quot;, 0, :post, {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="54d9b6b6af789bb9768c955fbccda37bf74cd052">
  <div class="header">
    <h3>app/models/concerns/admin_handler.rb</h3>
    <h4><span class="red">77.42 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="5">
          <span class="hits">12</span>
          
          <code class="ruby">    belongs_to :admin</code>
        </li>
      
        <li class="covered" data-hits="585" data-linenumber="6">
          <span class="hits">585</span>
          
          <code class="ruby">    scope :active, -&gt; {where &quot;disabled is null or disabled = false&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="8">
          <span class="hits">12</span>
          
          <code class="ruby">    before_validation :ensure_admin_set</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="9">
          <span class="hits">12</span>
          
          <code class="ruby">    before_create :setup_values</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def setup_values    </code>
        </li>
      
        <li class="covered" data-hits="5471" data-linenumber="13">
          <span class="hits">5471</span>
          
          <code class="ruby">    disabled = false if disabled.nil?    </code>
        </li>
      
        <li class="covered" data-hits="5471" data-linenumber="14">
          <span class="hits">5471</span>
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def enabled?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    !disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    return unless admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    admin.email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin= new_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    raise &quot;can not change admin&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_id= new_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    raise &quot;can not change admin id&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_admin= new_admin    </code>
        </li>
      
        <li class="covered" data-hits="7434" data-linenumber="35">
          <span class="hits">7434</span>
          
          <code class="ruby">    raise &quot;Bad Admin&quot; unless new_admin.is_a?(Admin) &amp;&amp; new_admin.id &amp;&amp; !new_admin.disabled    </code>
        </li>
      
        <li class="covered" data-hits="7434" data-linenumber="36">
          <span class="hits">7434</span>
          
          <code class="ruby">    @admin_set = true</code>
        </li>
      
        <li class="covered" data-hits="7434" data-linenumber="37">
          <span class="hits">7434</span>
          
          <code class="ruby">    @current_admin = new_admin</code>
        </li>
      
        <li class="covered" data-hits="7434" data-linenumber="38">
          <span class="hits">7434</span>
          
          <code class="ruby">    write_attribute(:admin_id, new_admin.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    return nil unless @admin_set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    @current_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  # use this to check whether a current admin user has been assigned to act on this record  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_set?</code>
        </li>
      
        <li class="covered" data-hits="7456" data-linenumber="48">
          <span class="hits">7456</span>
          
          <code class="ruby">    !!@admin_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def ensure_admin_set</code>
        </li>
      
        <li class="covered" data-hits="7087" data-linenumber="52">
          <span class="hits">7087</span>
          
          <code class="ruby">    errors.add(:admin, &quot;has not been set&quot;) unless admin_set?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ba40741aa680f4fea33bdfd05bb56a14432007d5">
  <div class="header">
    <h3>app/models/concerns/email_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class EmailValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="3">
          <span class="hits">4</span>
          
          <code class="ruby">    record.errors.add attribute, (options[:message] || &quot;is not an email&quot;) unless</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="4">
          <span class="hits">28</span>
          
          <code class="ruby">      value =~ /\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\z/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8556113e8e5dc0030552f1743e300f8b6139ce5e">
  <div class="header">
    <h3>app/models/concerns/phone_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PhoneValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="3">
          <span class="hits">7</span>
          
          <code class="ruby">    record.errors.add attribute, (options[:message] || &quot;is not a valid phone number&quot;) unless</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="4">
          <span class="hits">46</span>
          
          <code class="ruby">      value =~ /\([0-9]{3}\)[0-9]{3}-[0-9]{4}.*/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4ac397411420be86725e6e5a0ae4362fee6ad1e2">
  <div class="header">
    <h3>app/models/concerns/selector_cache.rb</h3>
    <h4><span class="red">74.7 %</span> covered</h4>
    <div>
      <b>83</b> relevant lines. 
      <span class="green"><b>62</b> lines covered</span> and
      <span class="red"><b>21</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="8">
          <span class="hits">9</span>
          
          <code class="ruby">    before_save :invalidate_cache</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="9">
          <span class="hits">9</span>
          
          <code class="ruby">    before_create :invalidate_cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="738" data-linenumber="11">
          <span class="hits">738</span>
          
          <code class="ruby">    scope :enabled, -&gt; { where &quot;disabled is null OR disabled = FALSE&quot; }    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  class_methods do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_cache?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def downcase_if_string val</code>
        </li>
      
        <li class="covered" data-hits="688" data-linenumber="21">
          <span class="hits">688</span>
          
          <code class="ruby">      if val.is_a? String</code>
        </li>
      
        <li class="covered" data-hits="282" data-linenumber="22">
          <span class="hits">282</span>
          
          <code class="ruby">        val.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="406" data-linenumber="24">
          <span class="hits">406</span>
          
          <code class="ruby">        val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def gen_cache_key</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="29">
          <span class="hits">212</span>
          
          <code class="ruby">      self.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def array_cache_key </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="33">
          <span class="hits">4</span>
          
          <code class="ruby">      logger.debug &quot;Getting #{self.to_s} array cache key&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">      &quot;#{self.to_s}_array&quot;      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def array_pair_cache_key </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="37">
          <span class="hits">10</span>
          
          <code class="ruby">      &quot;#{self.to_s}_hash&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def collection_cache_key</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="40">
          <span class="hits">13</span>
          
          <code class="ruby">      logger.debug &quot;Getting #{self.to_s} collection cache key&quot;</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="41">
          <span class="hits">13</span>
          
          <code class="ruby">      &quot;#{self.to_s}_collection&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def nv_pair_cache_key </code>
        </li>
      
        <li class="covered" data-hits="2044" data-linenumber="44">
          <span class="hits">2044</span>
          
          <code class="ruby">      &quot;#{self.to_s}_nameval&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    def nv_all_cache_key </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">      &quot;#{self.to_s}_namevalall&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def attributes_cache_key</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="50">
          <span class="hits">76</span>
          
          <code class="ruby">      &quot;#{self.to_s}_attributes&quot;      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_array conditions=nil, attribute=:name</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">      ckey=&quot;#{array_cache_key}#{conditions}:#{attribute}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="56">
          <span class="hits">18</span>
          
          <code class="ruby">        enabled.where(conditions).collect {|c| c.send(attribute) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      }    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_array_pair conditions=nil</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="61">
          <span class="hits">10</span>
          
          <code class="ruby">      ckey=&quot;#{array_pair_cache_key}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="63">
          <span class="hits">10</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="64">
          <span class="hits">10</span>
          
          <code class="ruby">        enabled.where(conditions).collect {|c| [c.name, c.id] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_name_value_pair conditions=nil</code>
        </li>
      
        <li class="covered" data-hits="2037" data-linenumber="69">
          <span class="hits">2037</span>
          
          <code class="ruby">      ckey=&quot;#{nv_pair_cache_key}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="2037" data-linenumber="71">
          <span class="hits">2037</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="816" data-linenumber="72">
          <span class="hits">816</span>
          
          <code class="ruby">        enabled.where(conditions).collect {|c| [c.name, downcase_if_string(c.value)] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_name_value_pair_no_downcase conditions=nil</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="77">
          <span class="hits">7</span>
          
          <code class="ruby">      ckey=&quot;#{nv_pair_cache_key}-nd-#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="79">
          <span class="hits">7</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="80">
          <span class="hits">2</span>
          
          <code class="ruby">        enabled.where(conditions).collect {|c| [c.name, c.value] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_attributes attributes, conditions=nil</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="85">
          <span class="hits">76</span>
          
          <code class="ruby">      ckey=&quot;#{attributes_cache_key}#{attributes}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="87">
          <span class="hits">76</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="88">
          <span class="hits">6</span>
          
          <code class="ruby">        enabled.where(conditions).collect do |c|</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="89">
          <span class="hits">104</span>
          
          <code class="ruby">          a = [] </code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="90">
          <span class="hits">104</span>
          
          <code class="ruby">          attributes.each do |att|</code>
        </li>
      
        <li class="covered" data-hits="312" data-linenumber="91">
          <span class="hits">312</span>
          
          <code class="ruby">            a &lt;&lt; c.send(att)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="93">
          <span class="hits">104</span>
          
          <code class="ruby">          a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_collection conditions=nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="100">
          <span class="hits">13</span>
          
          <code class="ruby">      ckey=&quot;#{collection_cache_key}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="102">
          <span class="hits">13</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="103">
          <span class="hits">5</span>
          
          <code class="ruby">        enabled.where(conditions)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">    def all_name_value_enable_flagged conditions=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">      ckey=&quot;#{nv_all_cache_key}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">        if conditions &amp;&amp; conditions[:disabled] == false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">          res = active</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">          conditions.delete :disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">          res = all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">        res.where(conditions).collect {|c| </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">          name = &#39;&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">          if c.respond_to?(:parent_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="122">
          
          
          <code class="ruby">            v = c.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">            vlabel = &quot;(#{c.parent_name}) &quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">            name = c.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          elsif c.respond_to?(:value)             </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">            v =  c.value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">            name = c.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">            v = c.id     </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">            name = c.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">          if c.respond_to?(:full_label)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">            name =  c.full_label              </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">          [&quot;#{vlabel}#{name} #{c.disabled ? &#39;[disabled]&#39; : &#39;&#39;}&quot;, downcase_if_string(v)] </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">        }.sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">    def name_for value</code>
        </li>
      
        <li class="covered" data-hits="10890" data-linenumber="144">
          <span class="hits">10890</span>
          
          <code class="ruby">      res = selector_name_value_pair.select{|p| p.last == value}    </code>
        </li>
      
        <li class="covered" data-hits="726" data-linenumber="145">
          <span class="hits">726</span>
          
          <code class="ruby">      res.length == 1 ? res.first.first : nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">  def invalidate_cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12194" data-linenumber="153">
          <span class="hits">12194</span>
          
          <code class="ruby">    logger.info &quot;College added or updated. Invalidating cache.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    # Unfortunately we have no way to clear pattern matched keys with memcached so we just clear the whole cache</code>
        </li>
      
        <li class="covered" data-hits="12194" data-linenumber="155">
          <span class="hits">12194</span>
          
          <code class="ruby">    Rails.cache.clear    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="629e917dbe53705a6551541a95706af1366a708c">
  <div class="header">
    <h3>app/models/concerns/source_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SourceValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="5">
          <span class="hits">55</span>
          
          <code class="ruby">    list = GeneralSelection.item_type_name_value_pair(record)</code>
        </li>
      
        <li class="covered" data-hits="165" data-linenumber="6">
          <span class="hits">165</span>
          
          <code class="ruby">    matches = (list.select {|a| a.last.downcase == value})</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="7">
          <span class="hits">55</span>
          
          <code class="ruby">    unless value.blank? || matches.length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">      Rails.logger.info &quot;Bad source for #{record} in list #{list}. Matches #{matches} with value #{value}&quot;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="9">
          <span class="hits">5</span>
          
          <code class="ruby">      record.errors.add attribute, (options[:message] || &quot;is not a valid Source&quot;) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fac0fc1ae37681e88f7db12476c8f8b995cdf768">
  <div class="header">
    <h3>app/models/concerns/standard_authentication.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module StandardAuthentication</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    before_validation :generate_password, on: :create    </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">    validates_uniqueness_of :email, :case_sensitive =&gt; false, :allow_blank =&gt; false, :if =&gt; :email_changed?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    validates_format_of :email, :with  =&gt; Devise.email_regexp, :allow_blank =&gt; false, :if =&gt; :email_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def force_password_reset</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    unlock_access!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    generate_password</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def new_password</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="16">
          <span class="hits">6</span>
          
          <code class="ruby">    @new_password</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def disable!</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="20">
          <span class="hits">4</span>
          
          <code class="ruby">    self.disabled = true</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="21">
          <span class="hits">4</span>
          
          <code class="ruby">    self.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  protected  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # Generate a random password for a new user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # Return the plain text password in the new_password attribute</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def generate_password</code>
        </li>
      
        <li class="covered" data-hits="1482" data-linenumber="29">
          <span class="hits">1482</span>
          
          <code class="ruby">      generated_password = Devise.friendly_token.first(12)</code>
        </li>
      
        <li class="covered" data-hits="1482" data-linenumber="30">
          <span class="hits">1482</span>
          
          <code class="ruby">      @new_password = generated_password    </code>
        </li>
      
        <li class="covered" data-hits="1482" data-linenumber="31">
          <span class="hits">1482</span>
          
          <code class="ruby">      self.password = generated_password</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="28e153cf04871da06adfed4e67df133f71c813ce">
  <div class="header">
    <h3>app/models/concerns/tracker_handler.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module TrackerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">    belongs_to :protocol</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    belongs_to :sub_process</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">    belongs_to :protocol_event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">    belongs_to :item, polymorphic: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_name</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="15">
          <span class="hits">104</span>
          
          <code class="ruby">    return nil unless self.protocol</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="16">
          <span class="hits">104</span>
          
          <code class="ruby">    self.protocol.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_position</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="20">
          <span class="hits">88</span>
          
          <code class="ruby">    return nil unless self.protocol</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="21">
          <span class="hits">88</span>
          
          <code class="ruby">    self.protocol.position</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def sub_process_name</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="25">
          <span class="hits">100</span>
          
          <code class="ruby">    return nil unless self.sub_process</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="26">
          <span class="hits">100</span>
          
          <code class="ruby">    self.sub_process.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def event_name</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="30">
          <span class="hits">100</span>
          
          <code class="ruby">    return nil unless self.protocol_event</code>
        </li>
      
        <li class="covered" data-hits="98" data-linenumber="31">
          <span class="hits">98</span>
          
          <code class="ruby">    self.protocol_event.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def event_milestone</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="35">
          <span class="hits">92</span>
          
          <code class="ruby">    return nil unless self.protocol_event</code>
        </li>
      
        <li class="covered" data-hits="90" data-linenumber="36">
          <span class="hits">90</span>
          
          <code class="ruby">    self.protocol_event.milestone</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def event_description    </code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="40">
          <span class="hits">33</span>
          
          <code class="ruby">    return nil unless self.protocol_event    </code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="41">
          <span class="hits">33</span>
          
          <code class="ruby">    self.protocol_event.description</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def record_type    </code>
        </li>
      
        <li class="covered" data-hits="219" data-linenumber="45">
          <span class="hits">219</span>
          
          <code class="ruby">    self.attributes[&#39;item_type&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def record_id</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="49">
          <span class="hits">100</span>
          
          <code class="ruby">    self.attributes[&#39;item_id&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def record_type_us</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="53">
          <span class="hits">92</span>
          
          <code class="ruby">    return unless self.record_type</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="54">
          <span class="hits">27</span>
          
          <code class="ruby">    self.record_type.underscore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="00dee317d6486be39bfc0e61aa284dd497fa50ed">
  <div class="header">
    <h3>app/models/concerns/user_handler.rb</h3>
    <h4><span class="green">97.35 %</span> covered</h4>
    <div>
      <b>113</b> relevant lines. 
      <span class="green"><b>110</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="6">
          <span class="hits">8</span>
          
          <code class="ruby">    attr_accessor :no_track</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # Standard associations</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="8">
          <span class="hits">8</span>
          
          <code class="ruby">    Rails.logger.debug &quot;Associating master as inverse of #{assoc_inverse}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="10">
          <span class="hits">8</span>
          
          <code class="ruby">    belongs_to :master, assoc_rules</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="11">
          <span class="hits">8</span>
          
          <code class="ruby">    belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="13">
          <span class="hits">8</span>
          
          <code class="ruby">    has_many :item_flags, as: :item</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">    has_many :trackers, as: :item if self != Tracker &amp;&amp; self != TrackerHistory</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Ensure the user id is saved</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">    before_validation :force_write_user    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="19">
          <span class="hits">8</span>
          
          <code class="ruby">    before_validation :downcase_attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # This validation ensures that the user ID has been set in the master object </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # It implicitly reinforces security, in that the user must be authenticated for</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # the user to have been set</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="24">
          <span class="hits">8</span>
          
          <code class="ruby">    validate :user_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="26">
          <span class="hits">8</span>
          
          <code class="ruby">    validate :source_correct</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="27">
          <span class="hits">8</span>
          
          <code class="ruby">    validate :rank_correct</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="29">
          <span class="hits">8</span>
          
          <code class="ruby">    after_save :check_status</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="30">
          <span class="hits">8</span>
          
          <code class="ruby">    after_save :track_record_update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  class_methods do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    def uses_item_flags?</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="36">
          <span class="hits">93</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def foreign_key_name</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="40">
          <span class="hits">16</span>
          
          <code class="ruby">      @foreign_key_name = :master_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def primary_key_name</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="44">
          <span class="hits">16</span>
          
          <code class="ruby">      @primary_key_name = :id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def assoc_rules</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="48">
          <span class="hits">8</span>
          
          <code class="ruby">      r = {inverse_of: assoc_inverse}      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="49">
          <span class="hits">8</span>
          
          <code class="ruby">      r[:foreign_key] = self.foreign_key_name if self.foreign_key_name &amp;&amp; self.foreign_key_name != :master_id</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="50">
          <span class="hits">8</span>
          
          <code class="ruby">      r[:primary_key] = self.primary_key_name if self.primary_key_name &amp;&amp; self.primary_key_name != :id</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="51">
          <span class="hits">8</span>
          
          <code class="ruby">      r</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def assoc_inverse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      # The plural model name</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="57">
          <span class="hits">16</span>
          
          <code class="ruby">      self.to_s.underscore.pluralize.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_rank_name value</code>
        </li>
      
        <li class="covered" data-hits="333" data-linenumber="61">
          <span class="hits">333</span>
          
          <code class="ruby">      GeneralSelection.name_for self, value, :rank    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_source_name value</code>
        </li>
      
        <li class="covered" data-hits="916" data-linenumber="64">
          <span class="hits">916</span>
          
          <code class="ruby">      GeneralSelection.name_for self, value, :source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_admin?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">    if respond_to?(:master) &amp;&amp; master      </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">      master.is_admin?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def master_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3216" data-linenumber="78">
          <span class="hits">3216</span>
          
          <code class="ruby">    if respond_to?(:master) &amp;&amp; master      </code>
        </li>
      
        <li class="covered" data-hits="3216" data-linenumber="79">
          <span class="hits">3216</span>
          
          <code class="ruby">      current_user = master.current_user      </code>
        </li>
      
        <li class="covered" data-hits="3216" data-linenumber="80">
          <span class="hits">3216</span>
          
          <code class="ruby">      current_user </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    else      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_name</code>
        </li>
      
        <li class="covered" data-hits="485" data-linenumber="87">
          <span class="hits">485</span>
          
          <code class="ruby">    logger.debug &quot;Getting username for #{self.user}&quot;</code>
        </li>
      
        <li class="covered" data-hits="485" data-linenumber="88">
          <span class="hits">485</span>
          
          <code class="ruby">    return nil unless self.user</code>
        </li>
      
        <li class="covered" data-hits="485" data-linenumber="89">
          <span class="hits">485</span>
          
          <code class="ruby">    self.user.email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  # Prevent user from being set directly, to avoid accidental or malicious changes to the recorded user in records</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">  def user= u</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    raise &quot;can not set user=&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id= u</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">    raise &quot;can not set user_id=&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  def rank_name</code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="103">
          <span class="hits">135</span>
          
          <code class="ruby">    return nil unless respond_to? :rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="105">
          <span class="hits">135</span>
          
          <code class="ruby">    self.class.get_rank_name self.rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">  def source_name</code>
        </li>
      
        <li class="covered" data-hits="588" data-linenumber="109">
          <span class="hits">588</span>
          
          <code class="ruby">    return nil unless respond_to? :source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="588" data-linenumber="111">
          <span class="hits">588</span>
          
          <code class="ruby">    self.class.get_source_name self.source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_action</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="116">
          <span class="hits">93</span>
          
          <code class="ruby">    @update_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">  def multiple_results</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="120">
          <span class="hits">6</span>
          
          <code class="ruby">    @multiple_results ||= []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">  def multiple_results=mr</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">    @multiple_results = mr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_multiple_results</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="128">
          <span class="hits">31</span>
          
          <code class="ruby">    @multiple_results &amp;&amp; @multiple_results.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_type</code>
        </li>
      
        <li class="covered" data-hits="396" data-linenumber="132">
          <span class="hits">396</span>
          
          <code class="ruby">    self.class.name.singularize.underscore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_status</code>
        </li>
      
        <li class="covered" data-hits="1007" data-linenumber="136">
          <span class="hits">1007</span>
          
          <code class="ruby">    @was_created = id_changed? ? &#39;created&#39; : false</code>
        </li>
      
        <li class="covered" data-hits="1007" data-linenumber="137">
          <span class="hits">1007</span>
          
          <code class="ruby">    @was_updated = updated_at_changed? ? &#39;updated&#39; : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">  def _created</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="141">
          <span class="hits">93</span>
          
          <code class="ruby">    @was_created</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">  def _updated</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="145">
          <span class="hits">93</span>
          
          <code class="ruby">    @was_updated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json extras={}</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="149">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:include] ||= {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    # Re-enable the following line if there is a need to incorporate item flags back into all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    # objects attached to a master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="153">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:include][:item_flags] = {include: [:item_flag_name], methods: [:method_id, :item_type_us]} if self.class.uses_item_flags?</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="154">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] ||= []</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="155">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :user_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">    # update_action can be used by requestor to identify whether the record was just updated (saved) or not</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="157">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :update_action</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="158">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :item_type</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="159">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :_created</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="160">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :_updated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="162">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :rank_name if respond_to? :rank        </code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="163">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :state_name if respond_to? :state</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="164">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :country_name if respond_to? :country</code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="165">
          <span class="hits">93</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :source_name if respond_to? :source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="93" data-linenumber="167">
          <span class="hits">93</span>
          
          <code class="ruby">    super(extras)    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">    def creatable_without_user</code>
        </li>
      
        <li class="covered" data-hits="2142" data-linenumber="173">
          <span class="hits">2142</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">    def downcase_attributes    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="178">
          <span class="hits">1071</span>
          
          <code class="ruby">      ignore = [&#39;item_type&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="15139" data-linenumber="180">
          <span class="hits">15139</span>
          
          <code class="ruby">      self.attributes.reject {|k,v| ignore.include? k}.each do |k, v|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13417" data-linenumber="182">
          <span class="hits">13417</span>
          
          <code class="ruby">        logger.info &quot;Downcasing attribute (#{k})&quot;</code>
        </li>
      
        <li class="covered" data-hits="13417" data-linenumber="183">
          <span class="hits">13417</span>
          
          <code class="ruby">        self.send(&quot;#{k}=&quot;.to_sym, v.downcase) if self.attributes[k].is_a? String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="185">
          <span class="hits">1071</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">    def user_set </code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="189">
          <span class="hits">1071</span>
          
          <code class="ruby">      return true if creatable_without_user &amp;&amp; !persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="191">
          <span class="hits">1071</span>
          
          <code class="ruby">      unless self.user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby">        errors.add :user, &quot;must be authenticated and set&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">    def force_write_user</code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="196">
          <span class="hits">1071</span>
          
          <code class="ruby">      return true if creatable_without_user &amp;&amp; !persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="198">
          <span class="hits">1071</span>
          
          <code class="ruby">      raise &quot;bad user being pulled from master_user&quot; unless master_user.is_a?(User) &amp;&amp; master_user.persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="200">
          <span class="hits">1071</span>
          
          <code class="ruby">      write_attribute :user_id, master_user.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">    def track_record_update</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="204">
          <span class="hits">910</span>
          
          <code class="ruby">      return if no_track</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="205">
          <span class="hits">910</span>
          
          <code class="ruby">      @update_action = true</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="206">
          <span class="hits">910</span>
          
          <code class="ruby">      Tracker.track_record_update self </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">    def source_correct      </code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="210">
          <span class="hits">1071</span>
          
          <code class="ruby">      if respond_to?(:source) &amp;&amp; self.source       </code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="211">
          <span class="hits">197</span>
          
          <code class="ruby">        errors.add :source, &quot;(#{self.source}) not a valid value&quot; unless source_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">      end      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">    def rank_correct      </code>
        </li>
      
        <li class="covered" data-hits="1071" data-linenumber="217">
          <span class="hits">1071</span>
          
          <code class="ruby">      if respond_to?(:rank) &amp;&amp; self.rank</code>
        </li>
      
        <li class="covered" data-hits="240" data-linenumber="218">
          <span class="hits">240</span>
          
          <code class="ruby">        errors.add :rank, &quot;(#{self.rank}) not a valid value&quot; unless rank_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">      end      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="99707eb199e012a3a9c3a5324962c57e642974d8">
  <div class="header">
    <h3>app/models/concerns/zip_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ZipValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="3">
          <span class="hits">6</span>
          
          <code class="ruby">    record.errors.add attribute, (options[:message] || &quot;is not a valid ZIP&quot;) unless</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="4">
          <span class="hits">48</span>
          
          <code class="ruby">      value =~ /^[0-9]{5}(-[0-9]{4})?$/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5a49de125c9407187782b84c454e08302f9991f0">
  <div class="header">
    <h3>app/models/dynamic_model.rb</h3>
    <h4><span class="red">26.56 %</span> covered</h4>
    <div>
      <b>128</b> relevant lines. 
      <span class="green"><b>34</b> lines covered</span> and
      <span class="red"><b>94</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class DynamicModel &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="5">
          <span class="hits">25</span>
          
          <code class="ruby">  default_scope -&gt; {order disabled: :asc, category: :asc, position: :asc,  updated_at: :desc }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :editable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  after_commit :reload_model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.orientation category</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    return :horizontal if category.to_s.include?(&#39;history&#39;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    return :vertical</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def reload_model</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    generate_model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Now forcibly set the Master association:</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    dm = self</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    Master.has_many dm.model_association_name, inverse_of: :master , class_name: &quot;DynamicModel::#{dm.model_class_name}&quot;, foreign_key: dm.foreign_key_name, primary_key: dm.primary_key_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    self.class.routes_reload</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.categories</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="27">
          <span class="hits">14</span>
          
          <code class="ruby">    active.select(:category).distinct(:category).unscope(:order).map {|s| s.category||&#39;default&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # This is intentionally a class variable, to capture the model names for all dynamic models</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.model_names</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    @model_names ||= []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.model_names= m</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    @model_names = m</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.model_name_strings</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    model_names.map {|m| m.to_s}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.models</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    @models ||= {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_def_name </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    table_name.singularize.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_association_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    table_name.pluralize.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_path_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">    table_name.pluralize.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_data_template_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">    model_association_name.to_s.hyphenate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_class_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    table_name.singularize.camelcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_def</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">    self.class.models[model_def_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_models</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">    dma = DynamicModel.active</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    logger.info &quot;Generating dynamic models #{DynamicModel.active.length}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">    dma.each do |dm|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">      dm.generate_model       </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">    rescue =&gt;e      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">      Rails.logger.warn &quot; Failed to generate dynamic models. Hopefully this is during a migration. #{e.inspect}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  def generate_model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">    obj = self</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">    failed = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">    if enabled? &amp;&amp; !failed # !DynamicModel.const_defined?(model_class_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">        pkn = (self.primary_key_name).to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">        fkn = (self.foreign_key_name || &#39;master_id&#39;).to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">        tkn = (self.table_key_name || &#39;id&#39;).to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">        man = self.model_association_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">        ro = self.result_order </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">        a_new_class = Class.new(ActiveRecord::Base) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">          def self.is_dynamic_module</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">            true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">          self.table_name = obj.table_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">          def self.assoc_inverse= man</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">            @assoc_inverse = man</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">          def self.assoc_inverse</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">            @assoc_inverse </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">          def self.foreign_key_name= fkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">            @foreign_key_name = fkn</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">          end          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">          def self.foreign_key_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">            @foreign_key_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">          def self.primary_key_name= pkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">            @primary_key_name = pkn</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">          end          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">          def self.primary_key_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">            @primary_key_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">          def self.result_order= ro</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">            @result_order = ro </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">            unless ro.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">              default_scope -&gt; {order ro}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">          end          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">          def self.result_order</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">            @result_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">          self.primary_key = tkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">          self.foreign_key_name = fkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">          self.primary_key_name = pkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">          self.assoc_inverse = man</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">          self.result_order = ro</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">          def master_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">            master.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="147">
          
          
          <code class="ruby">          def self.find id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby">            find_by(primary_key =&gt; id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">          def id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">            self.attributes[self.class.primary_key.to_s]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">        a_new_controller = Class.new(ApplicationController) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="159">
          
          
          <code class="ruby">          def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">          def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">          def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">          def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="172">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">          def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby">          private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="181">
          
          
          <code class="ruby">            def secure_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">        m_name = model_class_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="187">
          
          
          <code class="ruby">        res = DynamicModel.const_set(model_class_name, a_new_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">        # Do the include after naming, to ensure the correct names are used during initialization</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="189">
          
          
          <code class="ruby">        res.include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby">        c_name = &quot;#{table_name.pluralize.camelcase}Controller&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">        res2 = DynamicModel.const_set(c_name, a_new_controller)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">        # Do the include after naming, to ensure the correct names are used during initialization</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">        res2.include MasterHandler  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="197">
          
          
          <code class="ruby">        logger.info &quot;Model Name: #{m_name} + Controller #{c_name}. Def:\n#{res}\n#{res2}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby">        tn = model_def_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">        self.class.models[tn] = res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">        unless self.class.model_names.include? tn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">          self.class.model_names &lt;&lt; tn</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">      rescue=&gt;e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">        failed = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">        logger.info &quot;Failure creating a dynamic model definition. #{e.inspect}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">    if failed || !enabled?    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">      logger.info &quot;Removed disabled model #{tn}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="213">
          
          
          <code class="ruby">      self.class.models.delete(tn)  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">      self.class.model_names -= [tn]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.routes_load</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">    mn = model_names</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">    Rails.application.routes.draw do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">      resources :masters do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">        namespace :dynamic_model do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">          mn.each do |pg|         </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="228">
          
          
          <code class="ruby">            resources pg.to_s.pluralize.to_sym, except: [:destroy]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.routes_reload</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">    Rails.application.reload_routes!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">    Rails.application.routes_reloader.reload!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby"># Force the initialization. Do this here, rather than an initializer, since forces a reload if rails reloads classes in development mode.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">DynamicModel.define_models</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c7366c5d8013baccd2ce4e28f174ae6aa46066db">
  <div class="header">
    <h3>app/models/external_link.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ExternalLink &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="af98140a1b26920ff9e5e518e1682ad2758f0aa7">
  <div class="header">
    <h3>app/models/general_selection.rb</h3>
    <h4><span class="green">96.55 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>28</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class GeneralSelection &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # Handle general selection functionality, typically for looking up drop-down values from cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  BasicItemTypes = [:player_infos_source, :player_contacts_type, :player_contacts_source, :addresses_type, :addresses_source, :addresses_rank, :player_contacts_rank]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="4176" data-linenumber="9">
          <span class="hits">4176</span>
          
          <code class="ruby">  default_scope {order  item_type: :asc, disabled: :asc, position: :asc}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_value_change,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :value, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_types</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    BasicItemTypes + Report.item_types</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # Format the item type source string for looking up different selection types from the general_selections table  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_type_source_for record, type=:source</code>
        </li>
      
        <li class="covered" data-hits="1304" data-linenumber="22">
          <span class="hits">1304</span>
          
          <code class="ruby">    if record.respond_to?(:class) &amp;&amp; record.class != Class</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="23">
          <span class="hits">55</span>
          
          <code class="ruby">      klass = record.class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1249" data-linenumber="25">
          <span class="hits">1249</span>
          
          <code class="ruby">      klass = record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end      </code>
        </li>
      
        <li class="covered" data-hits="1304" data-linenumber="27">
          <span class="hits">1304</span>
          
          <code class="ruby">    &quot;#{klass.name.pluralize.underscore}_#{type}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # Get an array of name value pairs for a particular record, and the type of attribute it corresponds to</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_type_name_value_pair record, type=:source</code>
        </li>
      
        <li class="covered" data-hits="1304" data-linenumber="32">
          <span class="hits">1304</span>
          
          <code class="ruby">    src = item_type_source_for record, type  </code>
        </li>
      
        <li class="covered" data-hits="1304" data-linenumber="33">
          <span class="hits">1304</span>
          
          <code class="ruby">    selector_name_value_pair(item_type: src)       </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # Quickly lookup the name for a general_selection record with a specific value, corresponding to a &#39;record&#39;, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # with the type of attribute it corresponds to </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.name_for record, value, type=:source</code>
        </li>
      
        <li class="covered" data-hits="1249" data-linenumber="39">
          <span class="hits">1249</span>
          
          <code class="ruby">    res = item_type_name_value_pair record, type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="4413" data-linenumber="41">
          <span class="hits">4413</span>
          
          <code class="ruby">    resn = res.select {|l| l.last.to_s == value.to_s}</code>
        </li>
      
        <li class="covered" data-hits="1249" data-linenumber="42">
          <span class="hits">1249</span>
          
          <code class="ruby">    if resn.length == 1</code>
        </li>
      
        <li class="covered" data-hits="947" data-linenumber="43">
          <span class="hits">947</span>
          
          <code class="ruby">      return resn.first.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    return        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_value_change </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="51">
          <span class="hits">5</span>
          
          <code class="ruby">      if value_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:value, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="54">
          <span class="hits">5</span>
          
          <code class="ruby">      if item_type_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:item_type, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="16d28da60e0f0f5c6d4d4522ba0b38fb179b260e">
  <div class="header">
    <h3>app/models/item_flag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>58</b> relevant lines. 
      <span class="green"><b>58</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ItemFlag &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :item, polymorphic: true, inverse_of: :item_flags</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :item_flag_name  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_item_change,  on: :update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # We must have a user set to save a record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Since we don&#39;t include the UserHandler module, it is necessary for users of this class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # to explicitly set the user.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # In future we can consider incorporating this into the UserHandler structure, but currently</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # all UserHandler classes belong directly to a master, and flags only belong to a master indirectly</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # through an item.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # Since an item_flag entry is only created or deleted (not updated), setting the user explicitly on </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # create is reasonable.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :user, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_flag_name_id, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_flag_name, presence: true  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :works_with_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1185" data-linenumber="24">
          <span class="hits">1185</span>
          
          <code class="ruby">  default_scope -&gt; {where &quot;disabled is null or disabled = false&quot;}  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.works_with class_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # Get the value from the array and return it, so we can return a value that is not the original passed in (failing Brakeman test otherwise)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="28">
          <span class="hits">13</span>
          
          <code class="ruby">    pos = use_with_class_names.index(class_name.underscore)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="29">
          <span class="hits">13</span>
          
          <code class="ruby">    if pos      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="30">
          <span class="hits">8</span>
          
          <code class="ruby">      use_with_class_names[pos.to_i].camelize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.use_with_class_names</code>
        </li>
      
        <li class="covered" data-hits="1406" data-linenumber="37">
          <span class="hits">1406</span>
          
          <code class="ruby">    Master.reflect_on_all_associations(:has_many).select {|v| v.options[:source] != :item_flags}.collect {|v| v.plural_name.singularize}.sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def works_with_class</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="41">
          <span class="hits">17</span>
          
          <code class="ruby">    self.class.use_with_class_names.include? item_type    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  # Create and remove flags for the underlying item.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  # Returns true if flags were added or removed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.set_flags flag_list, item, current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="50">
          <span class="hits">5</span>
          
          <code class="ruby">    current_flags = item.item_flags.map {|f| f.item_flag_name_id}.uniq</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="51">
          <span class="hits">4</span>
          
          <code class="ruby">    added_flags = flag_list - current_flags</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="52">
          <span class="hits">4</span>
          
          <code class="ruby">    removed_flags =  current_flags - flag_list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">    logger.info &quot;Current flags #{current_flags} in #{item}&quot;    </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">    logger.info &quot;Removing flags #{removed_flags} from #{item}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="56">
          <span class="hits">4</span>
          
          <code class="ruby">    logger.info &quot;Adding flags #{added_flags} to #{item}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="58">
          <span class="hits">4</span>
          
          <code class="ruby">    item.item_flags.where(item_flag_name_id: removed_flags).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">        i.disabled = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">        i.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="63">
          <span class="hits">4</span>
          
          <code class="ruby">    added_flags.each do |f|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="64">
          <span class="hits">4</span>
          
          <code class="ruby">      unless f.blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="65">
          <span class="hits">4</span>
          
          <code class="ruby">        i = item.item_flags.build item_flag_name_id: f, user: current_user</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="66">
          <span class="hits">4</span>
          
          <code class="ruby">        logger.info &quot;Added flag #{f} to #{item}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="67">
          <span class="hits">4</span>
          
          <code class="ruby">        i.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    # Reload the association to have it register the changes    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="72">
          <span class="hits">3</span>
          
          <code class="ruby">    item.item_flags.reload        </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="73">
          <span class="hits">3</span>
          
          <code class="ruby">    item.master.current_user = current_user      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="75">
          <span class="hits">6</span>
          
          <code class="ruby">    logger.info &quot;Remaining flags in #{item} for #{item.master_user}: #{item.item_flags.map {|f| f.id}}&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="76">
          <span class="hits">3</span>
          
          <code class="ruby">    if added_flags.length &gt; 0 || removed_flags.length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="77">
          <span class="hits">3</span>
          
          <code class="ruby">      ItemFlag.track_flag_updates item, added_flags, removed_flags</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">      update_action = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="81">
          <span class="hits">3</span>
          
          <code class="ruby">    return update_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">  def method_id </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="86">
          <span class="hits">6</span>
          
          <code class="ruby">    self.item.master_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_type_us</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="90">
          <span class="hits">6</span>
          
          <code class="ruby">    self.item_type.underscore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json options={}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="95">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:methods] ||= []</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="96">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:methods] += [:method_id, :item_type_us]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="97">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:include] ||=[]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="98">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:include] &lt;&lt; :item_flag_name</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="99">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:done] = true</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="100">
          <span class="hits">6</span>
          
          <code class="ruby">    super(options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.track_flag_updates item, added_flags, removed_flags</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="107">
          <span class="hits">3</span>
          
          <code class="ruby">      logger.info &quot;Track record update for added item_flags #{added_flags} and removed #{removed_flags}&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="108">
          <span class="hits">3</span>
          
          <code class="ruby">      Tracker.track_flag_update item, added_flags, removed_flags</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_item_change</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">      errors.add :item_flag_name_id, &quot;can not be changed&quot; if item_flag_name_id_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="73328a99e127221cd02ed24a384585bcacbdbb3b">
  <div class="header">
    <h3>app/models/item_flag_name.rb</h3>
    <h4><span class="red">75.0 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ItemFlagName &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_item_type_change,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true, uniqueness: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="807" data-linenumber="8">
          <span class="hits">807</span>
          
          <code class="ruby">  default_scope -&gt; {order  &quot;item_flag_names.updated_at DESC nulls last&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.enabled_for? item_type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    logger.debug &quot;Checking we&#39;re enabled for #{item_type}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    l = selector_array item_type: item_type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    l.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_types</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    selector_array(nil, :item_type).uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_item_type_change </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="22">
          <span class="hits">7</span>
          
          <code class="ruby">      if item_type_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">        errors.add(:item_type, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1befacb49a983ae4c74694b5802259f714e0db49">
  <div class="header">
    <h3>app/models/master.rb</h3>
    <h4><span class="yellow">87.1 %</span> covered</h4>
    <div>
      <b>186</b> relevant lines. 
      <span class="green"><b>162</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Master &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  MasterRank  = &quot;master_rank desc nulls last, masters.id desc nulls last&quot;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  PlayerInfoRankOrderClause = &quot;case when rank is null then -1000 when rank &gt; #{PlayerInfo::BestAccuracyScore} then rank * -1 else rank end desc nulls last&quot;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  RankNotNullClause = &#39; case rank when null then -1 else rank * -1 end&#39;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  TrackerEventOrderClause = &#39;protocols.position asc, event_date DESC NULLS last, trackers.updated_at DESC NULLS last &#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  TrackerHistoryEventOrderClause = &#39;event_date DESC NULLS last, tracker_history.updated_at DESC NULLS last &#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # inverse_of required to ensure the current_user propagates between associated models correctly</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="13">
          <span class="hits">547</span>
          
          <code class="ruby">  has_many :player_infos, -&gt; { order(PlayerInfoRankOrderClause)  } , inverse_of: :master  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :pro_infos , inverse_of: :master  </code>
        </li>
      
        <li class="covered" data-hits="415" data-linenumber="15">
          <span class="hits">415</span>
          
          <code class="ruby">  has_many :player_contacts, -&gt; { order(RankNotNullClause)}, inverse_of: :master</code>
        </li>
      
        <li class="covered" data-hits="410" data-linenumber="16">
          <span class="hits">410</span>
          
          <code class="ruby">  has_many :addresses, -&gt; { order(RankNotNullClause)}  , inverse_of: :master</code>
        </li>
      
        <li class="covered" data-hits="337" data-linenumber="17">
          <span class="hits">337</span>
          
          <code class="ruby">  has_many :trackers, -&gt; { includes(:protocol).order(TrackerEventOrderClause)}, inverse_of: :master</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="18">
          <span class="hits">10</span>
          
          <code class="ruby">  has_many :tracker_histories, -&gt; { order(TrackerHistoryEventOrderClause)}, inverse_of: :master</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :scantrons,  inverse_of: :master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # Sage Assignments need a special build, which handles the allocation of an existing item from the table</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # when an instance is created. Within the structure we have, it is necessary to override the master.sage_assignments.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # method to ensure everything works as expected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :sage_assignments,  inverse_of: :master do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def build att=nil</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="26">
          <span class="hits">7</span>
          
          <code class="ruby">      SageAssignment.master_build proxy_association.owner, att</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="363" data-linenumber="30">
          <span class="hits">363</span>
          
          <code class="ruby">  has_many :latest_tracker_history, -&gt; { order(id: :desc).limit(1)},  class_name: &#39;TrackerHistory&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  # This association is provided to allow &#39;simple&#39; search on names in player_infos OR pro_infos </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :general_infos, class_name: &#39;ProInfo&#39; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  # Associations to allow advanced searches for NOT </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="36">
          <span class="hits">8</span>
          
          <code class="ruby">  has_many :not_tracker_histories, -&gt; { order(TrackerHistoryEventOrderClause)},  class_name: &#39;TrackerHistory&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="37">
          <span class="hits">8</span>
          
          <code class="ruby">  has_many :not_trackers, -&gt; { order(TrackerEventOrderClause)},  class_name: &#39;Tracker&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :set_user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_user_updates,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :user, presence: true  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  before_create :assign_msid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  DynamicModel.active.each do |dm|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    has_many dm.model_association_name, inverse_of: :master , class_name: &quot;DynamicModel::#{dm.model_class_name}&quot;, foreign_key: dm.foreign_key_name, primary_key: dm.primary_key_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    Rails.logger.debug &quot;Associated master with #{dm.model_association_name} with class_name: DynamicModel::#{dm.model_class_name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  Master.reflect_on_all_associations(:has_many).each do |assoc| </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    # This association is provided to allow generic search on flagged associated object</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="53">
          <span class="hits">12</span>
          
          <code class="ruby">    has_many &quot;#{assoc.plural_name}_item_flags&quot;.to_sym, through: assoc.plural_name, source: :item_flags</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="54">
          <span class="hits">12</span>
          
          <code class="ruby">    Rails.logger.debug &quot;Associated master with #{assoc.plural_name}_item_flags through #{assoc.plural_name} with source :item_flags&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  # Nested attributes for advanced search form</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  accepts_nested_attributes_for :general_infos, :player_infos, :pro_infos, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">                                :scantrons, :sage_assignments, :player_contacts, :addresses, :trackers, :tracker_histories,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                                :not_trackers, :not_tracker_histories</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  SimplePlayerJoin = &quot;LEFT JOIN player_infos on masters.id = player_infos.master_id LEFT JOIN pro_infos as pro_infos on masters.id = pro_infos.master_id&quot;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  NotTrackerJoin = :no_join #&#39;INNER JOIN trackers &quot;not_trackers&quot; on masters.id = not_trackers.master_id&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  NotTrackerHistoryJoin = :no_join #&#39;INNER JOIN tracker_history &quot;not_tracker_histories&quot; on masters.id = not_tracker_histories.master_id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  # AltConditions allows certain search fields to be handled differently from a plain equality match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # Simply define a hash for the table containing the symbolized field names to be handled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  # Use a hash with :value to define a predefined matching clause:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  # :starts_with is the equivalent of &quot;?%&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  # :contains is the equivalent of &quot;%?%&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  # :is  and :is_not are the equivalent of &quot;?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  # :do_nothing forces this attribute to be skipped</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  # Subsequent symbols in the array can be used to modify the string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  # :strip_spaces removes all spaces from the string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  # :upcase makes the whole string uppercase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  # The :conditioncan be specified to state the actual query condition</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  # :starts with and :contains both default to &quot;field_name LIKE ?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  # :is_not default to &quot;field_name &lt;&gt; ?&quot;  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  # note that ? characters will be replaced by the field search value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  # Optionally add a value (symbol or array of symbols or string specifying full join clause) for :joins</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  # to specify specific tables to add to the inner join list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  AltConditions = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    player_infos: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      first_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      middle_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      nick_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">      notes: {value: :contains},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      younger_than: {value: :years, condition: &quot;player_infos.birth_date is not null  AND ((current_date - interval ? )) &lt; player_infos.birth_date&quot;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      older_than: {value: :years, condition: &quot;player_infos.birth_date is not null  AND ((current_date - interval ?)) &gt; player_infos.birth_date&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    pro_infos: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      first_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      middle_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      nick_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      less_than_career_years: {value: :is, condition: &quot;pro_infos.start_year is not null AND pro_infos.end_year IS NOT NULL  AND (pro_infos.end_year - pro_infos.start_year) &lt; ?&quot;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      more_than_career_years: {value: :is, condition: &quot;pro_infos.start_year is not null AND pro_infos.end_year IS NOT NULL  AND (pro_infos.end_year - pro_infos.start_year) &gt; ?&quot;}            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    addresses: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">      street: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      zip: {value: :starts_with}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    player_contacts: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      data: {value: [:starts_with, :strip_non_alpha_numeric], condition: &quot;regexp_replace(player_contacts.data, &#39;\\W+&#39;, &#39;&#39;, &#39;g&#39;) LIKE ?&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    not_trackers: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      protocol_event_id: {value: :is, condition: &quot;NOT EXISTS (select NULL from trackers t_inner where t_inner.protocol_event_id EQUALS_OR_IS_NULL ? AND t_inner.sub_process_id = :not_trackers_sub_process_id  AND t_inner.master_id = masters.id)&quot;, joins: NotTrackerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      sub_process_id: {value: :is, condition: &quot;TRUE&quot;, joins: NotTrackerJoin}    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    not_tracker_histories: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">      protocol_event_id: {value: :is, condition: &quot;NOT EXISTS (select NULL from tracker_history th_inner where th_inner.protocol_event_id EQUALS_OR_IS_NULL ? AND th_inner.sub_process_id = :not_tracker_histories_sub_process_id AND th_inner.master_id = masters.id)&quot;, joins: NotTrackerHistoryJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      sub_process_id: {value: :is, condition: &quot;TRUE&quot;, joins: NotTrackerHistoryJoin}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">    general_infos: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">      first_name: {value: :starts_with, condition: &quot;(player_infos.first_name LIKE ? OR pro_infos.first_name LIKE ? OR player_infos.nick_name LIKE ? OR pro_infos.nick_name LIKE ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">      last_name: {value: :is, condition: &quot;(player_infos.last_name = ? OR pro_infos.last_name = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">      birth_date: {value: :is, condition: &quot;(player_infos.birth_date = ? OR pro_infos.birth_date = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">      death_date: {value: :is, condition: &quot;(player_infos.death_date = ? OR pro_infos.death_date = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      start_year: {value: :is, condition: &quot;(player_infos.start_year = ? OR pro_infos.start_year = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">      end_year: {value: :is, condition: &quot;(player_infos.end_year = ? OR pro_infos.end_year = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      college: {value: :is, condition: &quot;(player_infos.college = ? OR pro_infos.college = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">      contact_data: {value: [:starts_with, :strip_non_alpha_numeric], condition: &quot;regexp_replace(player_contacts.data, &#39;\\W+&#39;, &#39;&#39;, &#39;g&#39;) LIKE ?&quot;, joins: :player_contacts}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  # Don&#39;t automatically generate a join for specific AltConditions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  # This allows for a :joins definition in AltConditions to define a LEFT OUTER JOIN on the primary table, for example</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">  NoDefaultJoinFor = [:general_infos, :not_trackers, :not_tracker_histories ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :force_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.results_limit</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="136">
          <span class="hits">47</span>
          
          <code class="ruby">    r = nil</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="137">
          <span class="hits">47</span>
          
          <code class="ruby">    e = ENV[&#39;FPHS_RESULT_LIMIT&#39;]     </code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="138">
          <span class="hits">47</span>
          
          <code class="ruby">    r = e.to_i if e</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="139">
          <span class="hits">47</span>
          
          <code class="ruby">    r = nil if r == 0</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="140">
          <span class="hits">47</span>
          
          <code class="ruby">    r    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  # Build a Master search using the Master and nested attributes passed in</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">  # Any attributes that are nil will be rejected and will not appear in the query</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  # Tables will only be joined if the nested attributes for the association have one or more</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  # attributes that are not nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.search_on_params params, conditions={}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="149">
          <span class="hits">45</span>
          
          <code class="ruby">    joins = [] # list of joined tables</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="150">
          <span class="hits">45</span>
          
          <code class="ruby">    wheres = {} # set of equality where clauses</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="151">
          <span class="hits">45</span>
          
          <code class="ruby">    wheresalt = [nil, {}] # list of non-equality where clauses (such as LIKE)</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="152">
          <span class="hits">45</span>
          
          <code class="ruby">    selects = [&quot;masters.id&quot;, &quot;masters.pro_info_id&quot;, &quot;masters.pro_id&quot;, &quot;masters.msid&quot;, &quot;masters.rank as master_rank&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="154">
          <span class="hits">45</span>
          
          <code class="ruby">    params.each do |params_key,params_val|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="156">
          <span class="hits">189</span>
          
          <code class="ruby">      if params_val.is_a? Hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="158">
          <span class="hits">189</span>
          
          <code class="ruby">        if params_val.first.first == &quot;0&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">          # Grab the first array item from the parameters if there is one to reset the context</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="160">
          <span class="hits">189</span>
          
          <code class="ruby">          params_val = params_val.first.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">        # Handle nested attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">        # Get the key name for the table by removing the _attributes extension from the key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="166">
          <span class="hits">189</span>
          
          <code class="ruby">        if params_key.to_s.include? &#39;_attributes&#39;</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="167">
          <span class="hits">189</span>
          
          <code class="ruby">          condition_key = params_key.to_s.gsub(&#39;_attributes&#39;,&#39;&#39;).to_sym</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="168">
          <span class="hits">189</span>
          
          <code class="ruby">          r = Master.reflect_on_association(condition_key)</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="169">
          <span class="hits">189</span>
          
          <code class="ruby">          logger.debug &quot;condition_key: #{condition_key}&quot;</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="170">
          <span class="hits">189</span>
          
          <code class="ruby">          logger.debug &quot;Reflection: #{r.klass.table_name}&quot;</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="171">
          <span class="hits">189</span>
          
          <code class="ruby">          logger.debug &quot;Source Reflection: #{r.source_reflection.name &amp;&amp; r.source_reflection.name}&quot;          </code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="172">
          <span class="hits">189</span>
          
          <code class="ruby">          if r.klass #r.source_reflection # </code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="173">
          <span class="hits">189</span>
          
          <code class="ruby">            condition_table =  r.klass.table_name #r.source_reflection.name.to_s #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">            condition_table = r.plural_name.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">          # Generate a pluralized table name for associations that are has_one</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="180">
          
          
          <code class="ruby">          condition_table = params_key.to_s.pluralize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">        # Keep only non-nil attributes for the primary wheres that don&#39;t have an alternative condition string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="887" data-linenumber="185">
          <span class="hits">887</span>
          
          <code class="ruby">        basic_condition_attribs = params_val.select{|key1,v1| !v1.nil? &amp;&amp; !alt_condition(condition_key, [key1, v1])}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">        # Pull the attributes with an alternative condition string (note that this returns nil values too)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">        # format: {condition: condition_clause, reference: {reference_name =&gt; value}, joins: joins_clauses} </code>
        </li>
      
        <li class="covered" data-hits="976" data-linenumber="189">
          <span class="hits">976</span>
          
          <code class="ruby">        alt_condition_attribs = params_val.select{|_,v1| !v1.nil? }.map{|v2| alt_condition(condition_key, v2) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="191">
          <span class="hits">189</span>
          
          <code class="ruby">        logger.debug &quot;Param: #{params_key} has condition_table: #{condition_table}&quot;</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="192">
          <span class="hits">189</span>
          
          <code class="ruby">        logger.debug &quot;basic_condition_attribs #{basic_condition_attribs} -- alt_condition_attribs #{alt_condition_attribs}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">        # If we have a set of attributes that is not empty </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">        # add the equality conditions to the list of wheres</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="196">
          <span class="hits">189</span>
          
          <code class="ruby">        if basic_condition_attribs.length &gt; 0 || alt_condition_attribs.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">          # When this is a basic condition</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="199">
          <span class="hits">56</span>
          
          <code class="ruby">          if basic_condition_attribs.length &gt; 0            </code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="200">
          <span class="hits">23</span>
          
          <code class="ruby">            logger.debug &quot;This is a basic condition for condition_table #{condition_table}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">            # When the where for the condition_table is an array of key/values already, just add to it</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">            # otherwise store the basic condition attributes directly</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="203">
          <span class="hits">23</span>
          
          <code class="ruby">            if wheres[condition_table] &amp;&amp; wheres[condition_table].first.last.is_a?(Array)              </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">              wheres[condition_table][basic_condition_attribs.first.first] += basic_condition_attribs.first.last </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">            else              </code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="206">
          <span class="hits">23</span>
          
          <code class="ruby">              wheres[condition_table] = basic_condition_attribs </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">          # When there is a defined alternative condition</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="210">
          <span class="hits">56</span>
          
          <code class="ruby">          if alt_condition_attribs.length &gt; 0          </code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="211">
          <span class="hits">56</span>
          
          <code class="ruby">            logger.info &quot;Merging alternative conditions FOR #{alt_condition_attribs}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">            # For each alternative condition attribute, check if it has a defined condition, then</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">            # generate alternative where clauses</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="214">
          <span class="hits">56</span>
          
          <code class="ruby">            alt_condition_attribs.each do |alt_condition_attrib|</code>
        </li>
      
        <li class="covered" data-hits="89" data-linenumber="215">
          <span class="hits">89</span>
          
          <code class="ruby">              if alt_condition_attrib &amp;&amp; alt_condition_attrib[:condition]</code>
        </li>
      
        <li class="covered" data-hits="53" data-linenumber="216">
          <span class="hits">53</span>
          
          <code class="ruby">                logger.info &quot;Alt Condition: #{alt_condition_attrib[:condition]}&quot;</code>
        </li>
      
        <li class="covered" data-hits="53" data-linenumber="217">
          <span class="hits">53</span>
          
          <code class="ruby">                wheresalt[0] = &quot;#{wheresalt[0]}#{wheresalt[0] ? &quot; AND &quot; : &#39;&#39;}#{alt_condition_attrib[:condition]}&quot;</code>
        </li>
      
        <li class="covered" data-hits="53" data-linenumber="218">
          <span class="hits">53</span>
          
          <code class="ruby">                wheresalt[1].merge! alt_condition_attrib[:reference]</code>
        </li>
      
        <li class="covered" data-hits="53" data-linenumber="219">
          <span class="hits">53</span>
          
          <code class="ruby">                if alt_condition_attrib[:joins].is_a?(Symbol) &amp;&amp; alt_condition_attrib[:joins] != :no_join</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="220">
          <span class="hits">7</span>
          
          <code class="ruby">                  joins &lt;&lt; alt_condition_attrib[:joins] </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="221">
          <span class="hits">7</span>
          
          <code class="ruby">                  logger.info &quot;Adding alt join #{alt_condition_attrib[:joins]}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">                elsif alt_condition_attrib[:joins].is_a? String</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="223">
          <span class="hits">30</span>
          
          <code class="ruby">                  joins &lt;&lt; alt_condition_attrib[:joins] </code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="224">
          <span class="hits">30</span>
          
          <code class="ruby">                  logger.info &quot;Adding alt joins #{alt_condition_attrib[:joins]}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">                elsif alt_condition_attrib[:joins].is_a? Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="226">
          
          
          <code class="ruby">                  joins += alt_condition_attrib[:joins] </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">                  logger.info &quot;Adding alt joins #{alt_condition_attrib[:joins]}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                else</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="229">
          <span class="hits">16</span>
          
          <code class="ruby">                  logger.info &quot;Not Adding alt joins&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="235">
          <span class="hits">56</span>
          
          <code class="ruby">          logger.debug &quot;Adding condition_key to joins: #{condition_key}&quot;</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="236">
          <span class="hits">56</span>
          
          <code class="ruby">          joins &lt;&lt; condition_key unless NoDefaultJoinFor.include?(condition_key)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="237">
          <span class="hits">56</span>
          
          <code class="ruby">          logger.info &quot;adding standard join params_val=#{condition_table.to_sym} when basic_condition_attribs = #{basic_condition_attribs}&quot;</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="238">
          <span class="hits">56</span>
          
          <code class="ruby">          conditions[condition_key] = basic_condition_attribs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">        # Always add the table to the list of joins and select (so we can get the data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">      elsif !params_val.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">        # Handle Master level attributes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="244">
          
          
          <code class="ruby">        wheres[params_key] = params_val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">    # No conditions were recognized. Exit now.</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="251">
          <span class="hits">45</span>
          
          <code class="ruby">    return nil if wheres.length == 0 &amp;&amp; !wheresalt.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="253">
          <span class="hits">45</span>
          
          <code class="ruby">    logger.debug &quot;joins: #{joins}&quot;</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="254">
          <span class="hits">45</span>
          
          <code class="ruby">    logger.debug &quot;Standard wheres: #{wheres}&quot;</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="255">
          <span class="hits">45</span>
          
          <code class="ruby">    logger.debug &quot;Alt wheres: #{wheresalt}&quot;</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="256">
          <span class="hits">45</span>
          
          <code class="ruby">    res = Master.select(selects).joins(joins).uniq.where(wheres)</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="257">
          <span class="hits">45</span>
          
          <code class="ruby">    res = res.where(wheresalt.first, wheresalt.last) if wheresalt.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="259">
          <span class="hits">45</span>
          
          <code class="ruby">    default_sort res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">  def accuracy_rank</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="264">
          
          
          <code class="ruby">    pi = player_infos.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="265">
          
          
          <code class="ruby">    return -1000 unless pi</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="266">
          
          
          <code class="ruby">    pi.accuracy_rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.default_sort res    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">    # Note that this sorts first, based on the Master rank, which is calculated through a trigger from player info accuracy</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="271">
          <span class="hits">45</span>
          
          <code class="ruby">    if results_limit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="272">
          
          
          <code class="ruby">      res = res.order(MasterRank).take(results_limit) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="274">
          <span class="hits">45</span>
          
          <code class="ruby">      res = res.order(MasterRank).all #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="20969" data-linenumber="276">
          <span class="hits">20969</span>
          
          <code class="ruby">    logger.info &quot;sorted to #{res.map {|a| [a.id, a.master_rank]}  } &quot;</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="277">
          <span class="hits">45</span>
          
          <code class="ruby">    res        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.alt_condition table_name, condition    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="282">
          <span class="hits">178</span>
          
          <code class="ruby">    logger.debug &quot;Getting alt_condition for #{table_name} =&gt; #{condition}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="284">
          <span class="hits">178</span>
          
          <code class="ruby">    ckey = condition.first</code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="285">
          <span class="hits">178</span>
          
          <code class="ruby">    cval = condition.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="287">
          <span class="hits">178</span>
          
          <code class="ruby">    return if !table_name || !condition || ckey.nil? || cval.nil?</code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="288">
          <span class="hits">178</span>
          
          <code class="ruby">    altable = AltConditions[table_name]</code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="289">
          <span class="hits">178</span>
          
          <code class="ruby">    return unless altable</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="290">
          <span class="hits">128</span>
          
          <code class="ruby">    altable = altable.dup</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="291">
          <span class="hits">128</span>
          
          <code class="ruby">    altdef = altable[ckey.to_sym]</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="292">
          <span class="hits">128</span>
          
          <code class="ruby">    return unless altdef</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="293">
          <span class="hits">106</span>
          
          <code class="ruby">    altdef = altdef.dup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="296">
          <span class="hits">106</span>
          
          <code class="ruby">    cond_op = altdef[:value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="298">
          <span class="hits">106</span>
          
          <code class="ruby">    if cond_op == :do_nothing || cond_op == :is_not_null &amp;&amp; (cval.blank? || cval == &#39;(null)&#39;)      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="299">
          
          
          <code class="ruby">      return {} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="302">
          <span class="hits">106</span>
          
          <code class="ruby">    cond_op = [cond_op] unless cond_op.is_a? Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="304">
          <span class="hits">106</span>
          
          <code class="ruby">    refname = &quot;#{table_name}_#{ckey}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="307">
          <span class="hits">106</span>
          
          <code class="ruby">    if altdef[:condition]</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="308">
          <span class="hits">78</span>
          
          <code class="ruby">      alt  = altdef[:condition]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">    elsif cond_op.include?(:starts_with) || cond_op.include?(:contains)</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="310">
          <span class="hits">28</span>
          
          <code class="ruby">      alt = &quot;#{table_name}.#{ckey} LIKE ?&quot;      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">    elsif cond_op.include?(:is_not)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="312">
          
          
          <code class="ruby">      alt = &quot;#{table_name}.#{ckey} &lt;&gt; ?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="314">
          
          
          <code class="ruby">      alt = &quot;#{table_name}.#{ckey} = ?&quot;      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="317">
          <span class="hits">106</span>
          
          <code class="ruby">    if altdef[:value].is_a? Array</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="318">
          <span class="hits">14</span>
          
          <code class="ruby">      altdef[:value].each do |d|</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="319">
          <span class="hits">28</span>
          
          <code class="ruby">        if d == :strip_spaces</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="320">
          
          
          <code class="ruby">          cval.gsub!(&#39; &#39;,&#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">        elsif d == :strip_non_alpha_numeric</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="322">
          <span class="hits">14</span>
          
          <code class="ruby">          cval.gsub!(/\W+/,&#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">        elsif d == :upcase</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">          cval.upcase!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="329">
          <span class="hits">106</span>
          
          <code class="ruby">    cval = nil if cval == &#39;(null)&#39; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="331">
          <span class="hits">106</span>
          
          <code class="ruby">    if cval.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="332">
          
          
          <code class="ruby">      eoin = &#39;IS&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="334">
          <span class="hits">106</span>
          
          <code class="ruby">      eoin = &#39;=&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="336">
          <span class="hits">106</span>
          
          <code class="ruby">    alt = alt.gsub(&#39;EQUALS_OR_IS_NULL&#39;, eoin )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="338">
          <span class="hits">106</span>
          
          <code class="ruby">    alt = alt.gsub(&#39;?&#39;, &quot;:#{refname}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="340">
          <span class="hits">106</span>
          
          <code class="ruby">    cvaltotal = &quot;#{cval}%&quot; if cond_op.include? :starts_with</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="341">
          <span class="hits">106</span>
          
          <code class="ruby">    cvaltotal = &quot;%#{cval}%&quot; if cond_op.include? :contains</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="342">
          <span class="hits">106</span>
          
          <code class="ruby">    cvaltotal = cval if cond_op.include? :is</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="343">
          <span class="hits">106</span>
          
          <code class="ruby">    cvaltotal = &quot;#{cval} years&quot; if cond_op.include? :years</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="344">
          <span class="hits">106</span>
          
          <code class="ruby">    cvaltotal = &quot;#{cval}&quot; if cond_op.include? :is_not</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="346">
          <span class="hits">106</span>
          
          <code class="ruby">    joins = altdef[:joins]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="348">
          <span class="hits">106</span>
          
          <code class="ruby">    res = {condition: alt, reference: {refname.to_sym =&gt; cvaltotal}, joins: joins}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="350">
          <span class="hits">106</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">  # Current admin is not stored, but may be used in validations for administrative level changes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_admin=ca</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="355">
          <span class="hits">136</span>
          
          <code class="ruby">    @current_admin = ca.is_a?(Admin)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_admin?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="359">
          <span class="hits">2</span>
          
          <code class="ruby">    !!@current_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user= cu</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="543" data-linenumber="364">
          <span class="hits">543</span>
          
          <code class="ruby">    if cu.is_a? User</code>
        </li>
      
        <li class="covered" data-hits="543" data-linenumber="365">
          <span class="hits">543</span>
          
          <code class="ruby">      @current_user = cu</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="366">
          
          
          <code class="ruby">    elsif cu.is_a? Integer</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="367">
          
          
          <code class="ruby">      @current_user = User.find cu</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">    else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="369">
          
          
          <code class="ruby">      raise &quot;Attempting to set current_user with non user: #{cu}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user</code>
        </li>
      
        <li class="covered" data-hits="3216" data-linenumber="374">
          <span class="hits">3216</span>
          
          <code class="ruby">    logger.info &quot;Getting current user: #{@user_id} from #{self}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">    # Do not get the user association when requesting the current_user, since we </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">    # do not want the value that has been persisted in the data</code>
        </li>
      
        <li class="covered" data-hits="3216" data-linenumber="377">
          <span class="hits">3216</span>
          
          <code class="ruby">    @current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">  # Prevent user from being set directly, to avoid accidental or malicious changes to the recorded user in records</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">  def user= u</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="382">
          
          
          <code class="ruby">    raise &quot;can not set user=&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id= u</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="386">
          
          
          <code class="ruby">    raise &quot;can not set user_id=&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_master_records user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="391">
          <span class="hits">2</span>
          
          <code class="ruby">    raise &quot;no user specified&quot; unless user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="393">
          <span class="hits">2</span>
          
          <code class="ruby">    m = Master.create!(current_user: user)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="394">
          <span class="hits">2</span>
          
          <code class="ruby">    m.player_infos.create!</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="395">
          <span class="hits">2</span>
          
          <code class="ruby">    return m</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="396">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="398">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">  def assign_msid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="402">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="400" data-linenumber="403">
          <span class="hits">400</span>
          
          <code class="ruby">    max_msid = Master.maximum(:msid) || 0</code>
        </li>
      
        <li class="covered" data-hits="400" data-linenumber="404">
          <span class="hits">400</span>
          
          <code class="ruby">    self.msid = max_msid + 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">  def prevent_user_updates</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="409">
          <span class="hits">3</span>
          
          <code class="ruby">    errors.add :pro_id, &quot;can not be updated by users&quot; if pro_id_changed?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="410">
          <span class="hits">3</span>
          
          <code class="ruby">    errors.add :msid, &quot;can not be updated by users&quot; if msid_changed?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="411">
          <span class="hits">3</span>
          
          <code class="ruby">    errors.add &quot;pro info association&quot;, &quot;can not be updated by users&quot; if pro_info_id_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_user</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="415">
          <span class="hits">403</span>
          
          <code class="ruby">    cu = @current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby">    # Set the user association when current_user is set</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="417">
          <span class="hits">403</span>
          
          <code class="ruby">    if cu.is_a?(User) &amp;&amp; cu.persisted?</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="418">
          <span class="hits">403</span>
          
          <code class="ruby">      write_attribute :user_id, cu.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">    else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="420">
          
          
          <code class="ruby">      raise &quot;Attempting to set user with non user: #{cu}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e1b4db774c16bbc02e02b4cff7656bb25f0f0a98">
  <div class="header">
    <h3>app/models/player_contact.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PlayerContact &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  PrimaryRank = 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  SecondaryRank = 5</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  InactiveRank = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :data, email: true, if: :is_email?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :data, phone: true, if: :is_phone?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :source, source: true, allow_blank: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :rank, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :handle_primary_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def is_email?</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="18">
          <span class="hits">75</span>
          
          <code class="ruby">      rec_type == &#39;email&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def is_phone?</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="21">
          <span class="hits">75</span>
          
          <code class="ruby">      rec_type == &#39;phone&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    # A master record can only have one email and one phone with rank set to Primary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # If a new player contact record is created or an existing record is updated with Primary rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # then update any other records for the master of that type (email or phone) to Secondary</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def handle_primary_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="29">
          <span class="hits">61</span>
          
          <code class="ruby">      if self.rank.to_i == PrimaryRank</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="30">
          <span class="hits">27</span>
          
          <code class="ruby">        logger.info &quot;Player Contact rank set as primary in contact #{self.id} for type #{self.rec_type}. </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">                    Setting other player contacts for this master to secondary if they were primary and have the type #{self.rec_type}.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="33">
          <span class="hits">27</span>
          
          <code class="ruby">        self.master.player_contacts.where(rank: PrimaryRank, rec_type: self.rec_type).each do |a|</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="34">
          <span class="hits">30</span>
          
          <code class="ruby">          logger.info &quot;Player Contact #{a.id} has primary rank currently. Current ID is #{self.id}&quot;</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="35">
          <span class="hits">30</span>
          
          <code class="ruby">          if a.id != self.id </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">            logger.info &quot;Player Contact #{a.id} has primary rank currently. Setting it to secondary&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">            a.rank = 5</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="38">
          <span class="hits">3</span>
          
          <code class="ruby">            a.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="39">
          <span class="hits">3</span>
          
          <code class="ruby">            multiple_results &lt;&lt; a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="46cb3fa9156911bd72fb7482f8c1de2e978cb988">
  <div class="header">
    <h3>app/models/player_info.rb</h3>
    <h4><span class="green">90.91 %</span> covered</h4>
    <div>
      <b>44</b> relevant lines. 
      <span class="green"><b>40</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PlayerInfo &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  BestAccuracyScore = 12</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  FollowUpScore = 881</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  BirthDateRanks = 1..BestAccuracyScore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Allow simple search and compound searches to function</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :contact_data, :younger_than, :older_than, :age</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_user_changes, on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :dates_sensible</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :source, presence: true, if: :rank?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :check_college</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def accuracy_rank    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    if rank &amp;&amp; rank &gt; BestAccuracyScore  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      return rank * -1 </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    elsif !rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      return rank </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def accuracy_score_name </code>
        </li>
      
        <li class="covered" data-hits="367" data-linenumber="30">
          <span class="hits">367</span>
          
          <code class="ruby">    rank_name    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # Override the standard rank_name, to ensure correct validation, since </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  # player ranks are a special case and are defined as AccuracyScore instances</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def rank_name    </code>
        </li>
      
        <li class="covered" data-hits="496" data-linenumber="36">
          <span class="hits">496</span>
          
          <code class="ruby">    PlayerInfo.get_rank_name self.rank    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_rank_name value</code>
        </li>
      
        <li class="covered" data-hits="726" data-linenumber="39">
          <span class="hits">726</span>
          
          <code class="ruby">    AccuracyScore.name_for(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"> </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json extras={}</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="43">
          <span class="hits">8</span>
          
          <code class="ruby">    extras[:include] ||= {}</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="44">
          <span class="hits">8</span>
          
          <code class="ruby">    extras[:include][:item_flags] = {include: [:item_flag_name], methods: [:method_id, :item_type_us]}    </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="45">
          <span class="hits">8</span>
          
          <code class="ruby">    extras[:methods] ||= []</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="46">
          <span class="hits">8</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :accuracy_score_name</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="47">
          <span class="hits">8</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :source_name</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="48">
          <span class="hits">8</span>
          
          <code class="ruby">    super(extras)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">    def dates_sensible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="54">
          <span class="hits">149</span>
          
          <code class="ruby">      latest_year = Time.now.year+1</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="55">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;start year&#39;, &quot;is after #{latest_year}&quot;) if start_year &amp;&amp; start_year &gt; latest_year</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="56">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;end year&#39;, &quot;is after  #{latest_year}&quot;) if end_year &amp;&amp; end_year &gt; latest_year</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="57">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;start year&#39;, &#39;and end year are not sensible&#39;) if end_year &amp;&amp; start_year &amp;&amp; start_year &gt; end_year</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="58">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;birth date&#39;, &#39;and death date are not sensible&#39;) if birth_date &amp;&amp; death_date &amp;&amp; birth_date &gt; death_date</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="59">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;birth date&#39;, &#39;is after today&#39;) if birth_date &amp;&amp; birth_date &gt; DateTime.now</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="60">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;death date&#39;, &#39;is after today&#39;) if death_date &amp;&amp; death_date &gt; DateTime.now</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="61">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;start year&#39;, &quot;is more than 30 years after birth date&quot;) if start_year &amp;&amp; birth_date &amp;&amp; start_year &gt; (birth_date + 29.years).year</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="62">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;start year&#39;, &quot;is less than 19 years after birth date&quot;) if start_year &amp;&amp; birth_date &amp;&amp; start_year &lt; (birth_date + 19.years).year</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      # Make this restriction less strict... Only prevent birth date for &#39;real&#39; players.</code>
        </li>
      
        <li class="covered" data-hits="149" data-linenumber="65">
          <span class="hits">149</span>
          
          <code class="ruby">      errors.add(&#39;birth date&#39;, &quot;must be set if rank is set to \&quot;#{BirthDateRanks}\&quot;&quot;) if !birth_date &amp;&amp; rank &amp;&amp; BirthDateRanks.include?(rank)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    def check_college</code>
        </li>
      
        <li class="covered" data-hits="134" data-linenumber="69">
          <span class="hits">134</span>
          
          <code class="ruby">      College.create_if_new college, user unless college.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_user_changes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="74">
          <span class="hits">18</span>
          
          <code class="ruby">      errors.add :source, &quot;can not be updated by a user after a record has been created. Contact an administrator to change this field.&quot; if source_changed? &amp;&amp; !source_was.nil? &amp;&amp; !is_admin?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c71ced2163cf3e6353bb659168f30e1c07412441">
  <div class="header">
    <h3>app/models/pro_info.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProInfo &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_update :prevent_save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Handle special functionality and allow simple search and compound searches to function</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :enable_updates, :contact_data, :less_than_career_years, :more_than_career_years</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">      return false unless @enable_updates</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # Override to not track this</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def track_record_update</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="17">
          <span class="hits">97</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e01ababc9446f439b95e4d039d71550a43d901b5">
  <div class="header">
    <h3>app/models/protocol.rb</h3>
    <h4><span class="green">92.86 %</span> covered</h4>
    <div>
      <b>14</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Protocol &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  RecordUpdatesProtocolName = &#39;Updates&#39;.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :sub_processes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2173" data-linenumber="10">
          <span class="hits">2173</span>
          
          <code class="ruby">  default_scope -&gt; { order position: :asc }</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="11">
          <span class="hits">84</span>
          
          <code class="ruby">  scope :updates, -&gt; { where name: RecordUpdatesProtocolName}</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="12">
          <span class="hits">67</span>
          
          <code class="ruby">  scope :selectable, -&gt; { enabled.where(&quot;name &lt;&gt; ?&quot;, RecordUpdatesProtocolName)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # A simple method to cache the record that is used to indicate Tracker Updates</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # so that we can quickly and repetitively user this</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.record_updates_protocol</code>
        </li>
      
        <li class="covered" data-hits="550" data-linenumber="23">
          <span class="hits">550</span>
          
          <code class="ruby">    Rails.cache.fetch &quot;record_updates_protocol&quot; do</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="24">
          <span class="hits">83</span>
          
          <code class="ruby">      enabled.updates.take</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="98590394c0bc46d6acc2f42cfe4c93d212e16e51">
  <div class="header">
    <h3>app/models/protocol_event.rb</h3>
    <h4><span class="red">76.47 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProtocolEvent &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :sub_process</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :sub_process, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="17102" data-linenumber="10">
          <span class="hits">17102</span>
          
          <code class="ruby">  default_scope -&gt; {order :name }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    sub_process.protocol if sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    protocol.name if protocol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def sub_process_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    sub_process.name if sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    &quot;#{protocol_name} #{sub_process_name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="56b5a12bb9520f23d8ff6e830a614d24ee0e5a91">
  <div class="header">
    <h3>app/models/report.rb</h3>
    <h4><span class="red">18.14 %</span> covered</h4>
    <div>
      <b>215</b> relevant lines. 
      <span class="green"><b>39</b> lines covered</span> and
      <span class="red"><b>176</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Report &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :check_attr_def</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :report_type, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :counts, -&gt; {where report_type: &#39;count&#39;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :regular, -&gt; {where report_type: &#39;regular_report&#39;}</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="14">
          <span class="hits">15</span>
          
          <code class="ruby">  scope :searchable, -&gt; {where(searchable: true).order(position: :asc)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :editable_data_reports, -&gt; {where(&quot;edit_model IS NOT NULL AND edit_model &lt;&gt; &#39;&#39;&quot;) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  ReportTypes = [:count, :regular_report, :search]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  ReportIdAttribName = &#39;_report_id_&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  class BadSearchCriteria &lt; FphsException</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def message </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      &quot;Bad search criteria were entered. Please check entries and try again.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_types</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    res = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    editable_data_reports.each do |r|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      unless r.selection_fields.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">        res += r.selection_fields.split(/[^a-zA-Z0-9_]/).collect {|c| &quot;report_#{r.name.id_underscore}_#{c.downcase}&quot;.to_sym}        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      end      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def editable_data?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    !edit_model.blank? </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_model_class</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">    return unless editable_data?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    model_class_name = edit_model.camelize.classify</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    logger.info &quot;Getting model class name: #{model_class_name}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    if Report.const_defined?(model_class_name)    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      Report.const_get(model_class_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      obj_table_name = edit_model.downcase</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      a_new_class = Class.new(ActiveRecord::Base) do </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">        self.table_name = obj_table_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">      res = Report.const_set(model_class_name, a_new_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_fields</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">    res =  edit_field_names.split(/[^a-zA-Z0-9_]/).select {|s| !s.blank?}.collect {|s| s.to_sym}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">    logger.info &quot;Edit fields: #{res.inspect}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def report_identifier</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    name.id_underscore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def clean_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">    @clean_sql</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">  def filtering_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">    @filtering_on</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def filter_previous_clause?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">    sql.include?(&#39;:filter_previous&#39;) || sql.include?(&#39;:ids_filter_previous&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user= cu</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">    @current_user = cu</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">    @current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  def search_attr_values</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">    @search_attr_values || &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">  def search_attr_values= sav</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">    @search_attr_values = sav</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">  def filtering_list</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">    logger.info &quot;Reading filtering list for #{current_user}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">    return nil unless current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">    key_list = &quot;report-list: #{current_user.id}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">    Rails.cache.read(key_list)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  def filtering_ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">    return nil unless current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">    key = &quot;report-results: #{current_user.id}&quot;      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">    Rails.cache.read key  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">  def write_filtering_list list</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">    logger.info &quot;Writing filtering list for #{current_user}, #{list}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    return nil unless current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">    key_list = &quot;report-list: #{current_user.id}&quot;        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">    Rails.cache.write(key_list, list)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">  def write_filtering_ids ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">    logger.info &quot;Writing filtering ids for #{current_user}, #{ids}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">    return nil unless current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">    key = &quot;report-results: #{current_user.id}&quot;    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">    Rails.cache.write(key, ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">  def search_attributes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">    @search_attrs = {} if self.search_attrs.blank?  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">      @search_attrs ||= JSON.parse self.search_attrs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    rescue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="128">
          
          
          <code class="ruby">      @search_attrs ||= YAML.load self.search_attrs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">  def run  search_attr_values, options={}        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">    @search_attr_values = search_attr_values    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">    @clean_sql = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">    report_definition = self</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">    filtering_previous = false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">    using_defaults = (@search_attr_values == &#39;_use_defaults_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">    raise Report::BadSearchCriteria unless search_attrs_prep</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">    sql = report_definition.sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">    primary_table = &#39;masters&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="145">
          
          
          <code class="ruby">    sql.strip!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">    sql = sql[0..-2] if sql.last == &#39;;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby">    ids = filtering_ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="149">
          
          
          <code class="ruby">    @search_attr_values[:ids_filter_previous] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">    if current_user &amp;&amp; options[:filter_previous] &amp;&amp; !using_defaults</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">      logger.info &quot;Trying to get data from cache (#{current_user.id} :#{ids}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">      if ids &amp;&amp; sql.include?(&quot;:filter_previous&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">        inner_sql = &quot; inner join (select id master_id from masters where id in (:filter_previous_ids)) filter_previous_alias using(master_id) &quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">        clean_inner_sql = ActiveRecord::Base.send(:sanitize_sql, [inner_sql, {filter_previous_ids: ids}], primary_table)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">        sql.gsub!(&quot;:filter_previous&quot;, clean_inner_sql) if clean_inner_sql</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">        filtering_previous = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="161">
          
          
          <code class="ruby">      filtering_previous = true if sql.include?(&#39;:ids_filter_previous&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">    if filtering_previous</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="165">
          
          
          <code class="ruby">      @filtering_on = ids        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="166">
          
          
          <code class="ruby">      @search_attr_values[:ids_filter_previous] = @filtering_on        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="170">
          
          
          <code class="ruby">    if sql.include?(&quot;:filter_previous&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">      sql.gsub!(&quot;:filter_previous&quot;, &#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="174">
          
          
          <code class="ruby">    if options[:count_only]      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">      sql = &quot;select count(*) \&quot;result_count\&quot; from (#{sql}) t&quot;  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="178">
          
          
          <code class="ruby">    res=[]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="180">
          
          
          <code class="ruby">    logger.info &quot;Preparing with #{@search_attr_values}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">    # get arbitrary data from a table</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    # Perform this within a transaction to avoid unexpected data or or definition updates</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">    # Note that Postgres is really a requirement for a transaction to protect against DDL. Either way, limiting grants </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">    # on DDL to the Rails user is expected.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">    self.class.connection.transaction do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="187">
          
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="188">
          
          
          <code class="ruby">        clean_sql = ActiveRecord::Base.send(:sanitize_sql, [sql, @search_attr_values], primary_table)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">      rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="190">
          
          
          <code class="ruby">        logger.info &quot;Unabled to sanitize sql: #{e.inspect}.\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">        raise Report::BadSearchCriteria</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">      @clean_sql = clean_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby">      res = self.class.connection.execute(clean_sql)                </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">      raise ActiveRecord::Rollback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="198">
          
          
          <code class="ruby">    @results = res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">    # Store the results to the cache</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">    if current_user &amp;&amp; !using_defaults</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="202">
          
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">        m_field = field_index(&#39;master_id&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">        ids = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="205">
          
          
          <code class="ruby">        if m_field</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="206">
          
          
          <code class="ruby">          ids = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">          res.each_row {|r| ids &lt;&lt; r[m_field]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="209">
          
          
          <code class="ruby">        write_filtering_ids ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">        if filtering_previous</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">          list = filtering_list || []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">          list = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">        l = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">        if @search_attr_values</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="219">
          
          
          <code class="ruby">          l = @search_attr_values.dup</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">          l.delete(:ids_filter_previous)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="221">
          
          
          <code class="ruby">          l.delete(:_report_id_)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="222">
          
          
          <code class="ruby">          l.delete(:_filter_previous_)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="223">
          
          
          <code class="ruby">          l.delete(:no_run)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="225">
          
          
          <code class="ruby">        list &lt;&lt; {name: name, id: id, search_params: l, results_length: @results.count}        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="229">
          
          
          <code class="ruby">        write_filtering_list list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">      rescue =&gt;e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">        write_filtering_ids nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">        write_filtering_list nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">        logger.warn &quot;Failed to write cache for #{current_user.id} =&gt; #{e.inspect}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">    @results </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">  # Get the table names corresponding to each column in the results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby">  # Since PG only returns oid values for each</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">  def result_tables</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">    return unless @results #&amp;&amp; @results.count &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="251">
          
          
          <code class="ruby">    return @result_tables if @result_tables</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="253">
          
          
          <code class="ruby">    @result_tables = {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="254">
          
          
          <code class="ruby">    logger.info &quot;Getting the array of result_tables&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="255">
          
          
          <code class="ruby">    i = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="256">
          
          
          <code class="ruby">    @results.fields.each do |col|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="257">
          
          
          <code class="ruby">      oid = @results.ftable(i).to_i.to_s #make sure it&#39;s clean and usable</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="258">
          
          
          <code class="ruby">      logger.info &quot;OID: #{oid}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="259">
          
          
          <code class="ruby">      unless @result_tables.has_key? oid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="260">
          
          
          <code class="ruby">        clean_sql = &quot;select relname from pg_class where oid=#{oid.to_i}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="261">
          
          
          <code class="ruby">        get_res = self.class.connection.execute(clean_sql)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="263">
          
          
          <code class="ruby">        table_name = get_res.first.first.last if get_res &amp;&amp; get_res.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="265">
          
          
          <code class="ruby">        @result_tables[oid] = table_name </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="267">
          
          
          <code class="ruby">      i+=1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="269">
          
          
          <code class="ruby">    @result_tables</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">  def result_tables_by_index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="274">
          
          
          <code class="ruby">    return unless @results &amp;&amp; @results.count &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="276">
          
          
          <code class="ruby">    return @result_tables_oid if @result_tables_oid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="278">
          
          
          <code class="ruby">    l = @results.fields.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="280">
          
          
          <code class="ruby">    logger.info &quot;Setting up oids for tables in #{l} columns&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby">    @result_tables_oid = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="283">
          
          
          <code class="ruby">    (0..l-1).each do |i|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="284">
          
          
          <code class="ruby">      oid = @results.ftable(i).to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="285">
          
          
          <code class="ruby">      logger.info &quot;Getting oid: #{oid} for col #{i}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="286">
          
          
          <code class="ruby">      @result_tables_oid[i] = result_tables[oid]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="288">
          
          
          <code class="ruby">    @result_tables_oid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">  def use_defaults</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="292">
          
          
          <code class="ruby">    @search_attr_values = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="294">
          
          
          <code class="ruby">    search_attributes.each do |k,v|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="296">
          
          
          <code class="ruby">      @search_attr_values[k.to_sym] = self.class.calculate_default v.first.last[&#39;default&#39;], v.first.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="298">
          
          
          <code class="ruby">    logger.info &quot;Using defaults as search attributes #{@search_attr_values}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="299">
          
          
          <code class="ruby">    @search_attr_values</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">  def search_attrs_prep </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">    @search_attr_values = use_defaults if @search_attr_values == &#39;_use_defaults_&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">    all_blank = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="309">
          
          
          <code class="ruby">    search_attributes.each do |k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="310">
          
          
          <code class="ruby">      search_attr_values[k.to_sym] = nil unless search_attr_values.has_key? k.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="314">
          
          
          <code class="ruby">    search_attr_values.each do |k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="315">
          
          
          <code class="ruby">      all_blank &amp;&amp;= (k.to_s != ReportIdAttribName &amp;&amp; (search_attributes[k.to_s].nil? || v.blank?))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="317">
          
          
          <code class="ruby">      if v.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="318">
          
          
          <code class="ruby">        search_attr_values[k] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">      elsif v.is_a? Hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="320">
          
          
          <code class="ruby">        search_attr_values[k] = v.collect{|k,v| v}      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">      elsif v.is_a?(String) &amp;&amp; v.include?(&quot;\n&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="322">
          
          
          <code class="ruby">        if search_attributes[k.to_s].first.last[&#39;multiple&#39;] == &#39;multiple-regex&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="323">
          
          
          <code class="ruby">          search_attr_values[k] = &quot;(#{v.split(&quot;\n&quot;).map{|a| a.squish}.join(&#39;|&#39;)})&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="325">
          
          
          <code class="ruby">          search_attr_values[k] = v.split(&quot;\n&quot;).map{|a| a.squish}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="332">
          
          
          <code class="ruby">    return false if all_blank &amp;&amp; search_attributes.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="334">
          
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.calculate_default default, type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="339">
          
          
          <code class="ruby">    default ||= &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="341">
          
          
          <code class="ruby">    res = default</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="342">
          
          
          <code class="ruby">    if default.is_a? String</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="343">
          
          
          <code class="ruby">      m = default.scan /(-\d+) (days|day|months|month|years|year)/</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="344">
          
          
          <code class="ruby">      if m.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="345">
          
          
          <code class="ruby">        t = m.first.last      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="346">
          
          
          <code class="ruby">        res = DateTime.now + m.first.first.to_i.send(t)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">      elsif default == &#39;now&#39;  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="348">
          
          
          <code class="ruby">        res = DateTime.now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="352">
          
          
          <code class="ruby">    if type == &#39;date&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="353">
          
          
          <code class="ruby">      res = res.strftime(&#39;%Y-%m-%d&#39;) rescue nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="356">
          
          
          <code class="ruby">    res </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">  def field_index name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="360">
          
          
          <code class="ruby">    m_field = nil    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="361">
          
          
          <code class="ruby">    i = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="362">
          
          
          <code class="ruby">    @results.fields.each do |f|           </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="363">
          
          
          <code class="ruby">      if f == name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="364">
          
          
          <code class="ruby">        m_field = i  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="365">
          
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="367">
          
          
          <code class="ruby">      i+=1          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="370">
          
          
          <code class="ruby">    return m_field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_attr_def</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="375">
          
          
          <code class="ruby">    errmsg = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="376">
          
          
          <code class="ruby">    begin    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="377">
          
          
          <code class="ruby">      s = search_attributes </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">    rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="379">
          
          
          <code class="ruby">      errmsg = e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="381">
          
          
          <code class="ruby">    errors.add :search_attributes, &quot;definition can not be parsed. Check the YAML or JSON is valid. #{errmsg.message}&quot; unless s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4a65739570344d003364109276fc6f1c2f106c74">
  <div class="header">
    <h3>app/models/sage_assignment.rb</h3>
    <h4><span class="red">42.31 %</span> covered</h4>
    <div>
      <b>52</b> relevant lines. 
      <span class="green"><b>22</b> lines covered</span> and
      <span class="red"><b>30</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SageAssignment &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :sage_id, presence: true,  length: {is: 10}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :sage_id_tests    </code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="6">
          <span class="hits">45</span>
          
          <code class="ruby">  default_scope -&gt; {order id: :desc}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :assigned, -&gt; {where &quot;master_id is not null&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :unassigned, -&gt; {where &quot;master_id is null&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :return_all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :create_count, :just_assigned</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  class NoUnassignedAvailable &lt; FphsException</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def message</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      &quot;No available Sage IDs for assignment&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def return_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    self.multiple_results = self.master.sage_assignments.all if self.master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # We assign the next available </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.assign_next_available_id master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    sage_assignment = self.next_available</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    raise NoUnassignedAvailable  unless sage_assignment</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    sage_assignment.assigned_by = &quot;fphsapp&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    sage_assignment.master = master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    sage_assignment.just_assigned = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    sage_assignment</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.next_available</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    s = SageAssignment.unassigned.unscope(:order).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    logger.info &quot;Got next available Sage id #{s.id}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.generate_ids admin, count=10</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    raise &quot;Only admins can perform this function&quot; unless admin &amp;&amp; admin.enabled?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    res = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    (1..count).each do |c|      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">        s = SecureRandom.random_number(8_999_999_999) + 1_000_000_000</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">        item = SageAssignment.new(sage_id: s.to_s, admin_id: admin.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">        item.no_track = true      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        item.save!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">        res &lt;&lt; item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      rescue PG::UniqueViolation =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        logger.info &quot;Failed to create a Sage Assignment record due to an random duplicate&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.master_build owner, att=nil</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="69">
          <span class="hits">7</span>
          
          <code class="ruby">    if att</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">      SageAssignment.assign_next_available_id owner</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="72">
          <span class="hits">7</span>
          
          <code class="ruby">      SageAssignment.new master: owner</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_status</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">    @was_created = id_changed? || just_assigned ? &#39;created&#39; : false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">    @was_updated = updated_at_changed? ? &#39;updated&#39; : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">    def sage_id_tests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">      if persisted? &amp;&amp; sage_id_changed? </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">        errors.add :sage_id, &quot;can not be changed&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">      if persisted? &amp;&amp; master_id_changed? &amp;&amp; !master_id_was.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">        errors.add :master, &quot;record this sage ID is associated with can not be changed&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">    def creatable_without_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  </code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1a818d2e95a029f4ef8784be1e2da04115b26da8">
  <div class="header">
    <h3>app/models/scantron.rb</h3>
    <h4><span class="yellow">83.33 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Scantron &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :scantron_id, presence: true,  numericality: { only_integer: true, greater_than: 0, less_than: 1000000 }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :scantron_id_tests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  default_scope -&gt;{}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def scantron_id_tests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="13">
          <span class="hits">44</span>
          
          <code class="ruby">      if scantron_id_changed? || !persisted? </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="15">
          <span class="hits">44</span>
          
          <code class="ruby">        s = Scantron.find_by_scantron_id(self.scantron_id)</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="16">
          <span class="hits">44</span>
          
          <code class="ruby">        if s           </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">          errors.add :scantron_id, &quot;already exists in this master record&quot; if s.master_id == self.master_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">          errors.add :scantron_id, &quot;already exists in another master record (#{s.master.msid ? &quot;MSID: #{s.master.msid}&quot; : &quot;master ID: #{s.master_id}&quot;})&quot; if s.master_id != self.master_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5dc6cb468d885b4d4b16a2a7c269d548e1af81d4">
  <div class="header">
    <h3>app/models/sub_process.rb</h3>
    <h4><span class="yellow">84.62 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SubProcess &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :protocol</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :protocol_events</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :protocol, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_name</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="16">
          <span class="hits">16</span>
          
          <code class="ruby">    protocol ? protocol.name : &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    protocol_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="16874e21f199af1671f2bd73cb5fdae457ec0fdc">
  <div class="header">
    <h3>app/models/tracker.rb</h3>
    <h4><span class="green">96.23 %</span> covered</h4>
    <div>
      <b>106</b> relevant lines. 
      <span class="green"><b>102</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Tracker &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include TrackerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :tracker_histories, inverse_of: :tracker</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_protocol_change,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :check_protocol_event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :check_sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :protocol, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # Expect an event date event if a protocol_event is not registered</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">#  validates :protocol_event_id, presence: true, if: :event_date?  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">#  validates :event_date, presence: true, if: :protocol_event_id?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :event_date, presence: true, if: :sub_process_id?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  # We can&#39;t use this, since the error attribute is not translatable, and therefore we can&#39;t get sub_process to appear to users as &#39;status&#39;  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  #  validates :sub_process, presence: true, if: :protocol_id?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # _merged attribute is used to indicate if a tracker record was merged into an existing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # record on creation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :_merged</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # Check whether a tracker record with the same protocol already exists for this master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # If it does then we will update the existing record rather than creating a new one.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # From a user perspective this ensures that the current status of the tracker always maintains only one</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # state for a protocol.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def merge_if_exists</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="201" data-linenumber="31">
          <span class="hits">201</span>
          
          <code class="ruby">    t = self.master.trackers.where(protocol_id: self.protocol_id).take(1)</code>
        </li>
      
        <li class="covered" data-hits="201" data-linenumber="32">
          <span class="hits">201</span>
          
          <code class="ruby">    if t.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="34">
          <span class="hits">114</span>
          
          <code class="ruby">      t = t.first</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="35">
          <span class="hits">114</span>
          
          <code class="ruby">      logger.info &quot;Updating existing tracker record #{t.id} instead of creating a new one&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="37">
          <span class="hits">114</span>
          
          <code class="ruby">      t.sub_process = self.sub_process</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="38">
          <span class="hits">114</span>
          
          <code class="ruby">      t.protocol_event = self.protocol_event</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="39">
          <span class="hits">114</span>
          
          <code class="ruby">      t.event_date = self.event_date</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="40">
          <span class="hits">114</span>
          
          <code class="ruby">      t.notes = self.notes</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="41">
          <span class="hits">114</span>
          
          <code class="ruby">      t._merged = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="43">
          <span class="hits">114</span>
          
          <code class="ruby">      res = t.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="45">
          <span class="hits">114</span>
          
          <code class="ruby">      if res </code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="46">
          <span class="hits">114</span>
          
          <code class="ruby">        return t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      elsif !errors || errors.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">         errors.add :protocol, &quot;tracker could not be merged&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      else    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  # does a standard merge_if_exists, but always attempts to save the result</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  def merge_if_exists!</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="59">
          <span class="hits">189</span>
          
          <code class="ruby">    t = merge_if_exists || self</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="60">
          <span class="hits">189</span>
          
          <code class="ruby">    t.save!    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  # Called by UserHandler managed records to save the latest update to the tracker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.track_record_update record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="66">
          <span class="hits">910</span>
          
          <code class="ruby">    return nil if record.is_a?(Tracker) || record.is_a?(TrackerHistory)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="268" data-linenumber="68">
          <span class="hits">268</span>
          
          <code class="ruby">    t = update_tracker :record, record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="268" data-linenumber="70">
          <span class="hits">268</span>
          
          <code class="ruby">    cp = &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="268" data-linenumber="71">
          <span class="hits">268</span>
          
          <code class="ruby">    ignore = %w(created_at updated_at user_id user id)</code>
        </li>
      
        <li class="covered" data-hits="268" data-linenumber="72">
          <span class="hits">268</span>
          
          <code class="ruby">    new_rec = record.id_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2851" data-linenumber="74">
          <span class="hits">2851</span>
          
          <code class="ruby">    record.changes.reject {|k,v| ignore.include? k}.each do |k,v| </code>
        </li>
      
        <li class="covered" data-hits="1814" data-linenumber="75">
          <span class="hits">1814</span>
          
          <code class="ruby">      fromv = v.first</code>
        </li>
      
        <li class="covered" data-hits="1814" data-linenumber="76">
          <span class="hits">1814</span>
          
          <code class="ruby">      tov = v.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      # Exclude where both to and from are blank (since a form update will cause a switch of nil and &quot;&quot;) which is meaningless</code>
        </li>
      
        <li class="covered" data-hits="1814" data-linenumber="79">
          <span class="hits">1814</span>
          
          <code class="ruby">      unless v.first.blank? &amp;&amp; v.last.blank?</code>
        </li>
      
        <li class="covered" data-hits="1809" data-linenumber="80">
          <span class="hits">1809</span>
          
          <code class="ruby">        kname = (&quot;#{k.to_s}_name&quot;).to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1809" data-linenumber="82">
          <span class="hits">1809</span>
          
          <code class="ruby">        if record.respond_to? kname      </code>
        </li>
      
        <li class="covered" data-hits="405" data-linenumber="83">
          <span class="hits">405</span>
          
          <code class="ruby">          n = record.class.send(&quot;get_#{k}_name&quot;.to_s, tov)</code>
        </li>
      
        <li class="covered" data-hits="405" data-linenumber="84">
          <span class="hits">405</span>
          
          <code class="ruby">          tov = &quot;(#{tov}) #{n}&quot; unless n.is_a?(String) &amp;&amp; tov.is_a?(String) &amp;&amp; tov.downcase == n.downcase</code>
        </li>
      
        <li class="covered" data-hits="405" data-linenumber="85">
          <span class="hits">405</span>
          
          <code class="ruby">          n = record.class.send(&quot;get_#{k}_name&quot;.to_s, fromv)</code>
        </li>
      
        <li class="covered" data-hits="405" data-linenumber="86">
          <span class="hits">405</span>
          
          <code class="ruby">          fromv = &quot;(#{fromv}) #{n}&quot; unless n.is_a?(String) &amp;&amp; fromv.is_a?(String) &amp;&amp; fromv.downcase == n.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1809" data-linenumber="89">
          <span class="hits">1809</span>
          
          <code class="ruby">        fromv = &#39;-&#39; if fromv.blank?</code>
        </li>
      
        <li class="covered" data-hits="1809" data-linenumber="90">
          <span class="hits">1809</span>
          
          <code class="ruby">        tov = &#39;-&#39; if tov.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1809" data-linenumber="92">
          <span class="hits">1809</span>
          
          <code class="ruby">        cp &lt;&lt; &quot;#{k.humanize} #{new_rec ? &#39;&#39; : &quot;from #{fromv}&quot;} #{new_rec ? &#39;&#39; : &#39;to &#39;}#{tov}; &quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="268" data-linenumber="97">
          <span class="hits">268</span>
          
          <code class="ruby">    t.notes = cp</code>
        </li>
      
        <li class="covered" data-hits="268" data-linenumber="98">
          <span class="hits">268</span>
          
          <code class="ruby">    t.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  # Called by item flag controller to save the aggregate set of item_flag changes to the tracker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.track_flag_update record, added_flags, removed_flags</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="105">
          <span class="hits">3</span>
          
          <code class="ruby">    return nil if record.is_a?(Tracker) || record.is_a?(TrackerHistory)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="107">
          <span class="hits">3</span>
          
          <code class="ruby">    t = update_tracker :flag, record</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="108">
          <span class="hits">3</span>
          
          <code class="ruby">    cp = &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="110">
          <span class="hits">3</span>
          
          <code class="ruby">    if added_flags.length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="111">
          <span class="hits">3</span>
          
          <code class="ruby">      cp &lt;&lt; &quot;added  flags: &quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="112">
          <span class="hits">6</span>
          
          <code class="ruby">      added_flags.each {|k| cp &lt;&lt; &quot;#{ItemFlagName.find(k).name}; &quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="115">
          <span class="hits">3</span>
          
          <code class="ruby">    if removed_flags.length &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">      cp &lt;&lt; &quot;removed flags: &quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">      removed_flags.each {|k| cp &lt;&lt; &quot;#{ItemFlagName.find(k).name}; &quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="120">
          <span class="hits">3</span>
          
          <code class="ruby">    t.notes = cp</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="121">
          <span class="hits">3</span>
          
          <code class="ruby">    res = t.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="122">
          <span class="hits">3</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_tracker type, record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="127">
          <span class="hits">271</span>
          
          <code class="ruby">    t = get_or_create_record_updates_tracker record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="129">
          <span class="hits">271</span>
          
          <code class="ruby">    t.set_record_updates_sub_process type</code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="130">
          <span class="hits">271</span>
          
          <code class="ruby">    t.set_record_updates_event record  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="132">
          <span class="hits">271</span>
          
          <code class="ruby">    t.event_date = DateTime.now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="134">
          <span class="hits">271</span>
          
          <code class="ruby">    t.item_id = record.id    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="135">
          <span class="hits">271</span>
          
          <code class="ruby">    t.item_type = record.class.name</code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="136">
          <span class="hits">271</span>
          
          <code class="ruby">    raise &quot;Bad item for tracker (#{type} / #{record.class.name} / #{record.id})&quot; unless t.item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="138">
          <span class="hits">271</span>
          
          <code class="ruby">    return t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_record_updates_event record</code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="142">
          <span class="hits">271</span>
          
          <code class="ruby">    new_rec = record.id_changed?    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="143">
          <span class="hits">271</span>
          
          <code class="ruby">    rec_type = &quot;#{new_rec ? &#39;created&#39; : &#39;updated&#39;} #{record.class.name.underscore.humanize.downcase}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="145">
          <span class="hits">271</span>
          
          <code class="ruby">    self.protocol_event = Rails.cache.fetch &quot;record_updates_protocol_events_#{rec_type}&quot; do</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="146">
          <span class="hits">106</span>
          
          <code class="ruby">      self.sub_process.protocol_events.where(name: rec_type).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="149">
          <span class="hits">271</span>
          
          <code class="ruby">    raise &quot;Bad protocol_event (#{rec_type}) for tracker #{record}&quot; unless self.protocol_event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_record_updates_sub_process type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="155">
          <span class="hits">271</span>
          
          <code class="ruby">    self.sub_process = Rails.cache.fetch &quot;record_updates_sub_process_#{type}&quot; do</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="156">
          <span class="hits">83</span>
          
          <code class="ruby">      Protocol.record_updates_protocol.sub_processes.where(name: &quot;#{type} updates&quot;).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="159">
          <span class="hits">271</span>
          
          <code class="ruby">    raise &quot;Bad sub_process for tracker (#{type})&quot; unless self.sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_or_create_record_updates_tracker record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="165">
          <span class="hits">271</span>
          
          <code class="ruby">    t = record.master.trackers.where(protocol_id: Protocol.record_updates_protocol).first    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="166">
          <span class="hits">271</span>
          
          <code class="ruby">    t ||= record.master.trackers.new protocol: Protocol.record_updates_protocol    </code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="167">
          <span class="hits">271</span>
          
          <code class="ruby">    t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">  def tracker_history_length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="173">
          <span class="hits">55</span>
          
          <code class="ruby">    tracker_histories.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">  def prevent_protocol_change </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="309" data-linenumber="179">
          <span class="hits">309</span>
          
          <code class="ruby">    errors.add(:protocol, &quot;change not allowed!&quot;) if protocol_id_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_protocol_event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="651" data-linenumber="185">
          <span class="hits">651</span>
          
          <code class="ruby">    errors.add(:method, &#39; must be selected&#39;) if protocol_event_id.nil? &amp;&amp; sub_process &amp;&amp; sub_process.protocol_events.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="651" data-linenumber="190">
          <span class="hits">651</span>
          
          <code class="ruby">    errors.add(:status, &#39; must be selected&#39;) if sub_process_id.nil? &amp;&amp; protocol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json extras={}</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="194">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] ||= []</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="195">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :protocol_name</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="196">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :protocol_position</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="197">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :sub_process_name</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="198">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :event_name</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="199">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :event_milestone</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="200">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :tracker_history_length</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="201">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_type_us</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="202">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_type</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="203">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_id</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="204">
          <span class="hits">55</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :_merged</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="206">
          <span class="hits">55</span>
          
          <code class="ruby">    super(extras)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="103f97233dd2e31753992438b2ac9a62aa0cdabd">
  <div class="header">
    <h3>app/models/tracker_history.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TrackerHistory &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  self.table_name = &#39;tracker_history&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include TrackerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :tracker, inverse_of: :tracker_histories</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json extras={}</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">    extras[:methods] ||= []</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="13">
          <span class="hits">4</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :protocol_name</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :sub_process_name</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="15">
          <span class="hits">4</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :event_name</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_type_us</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="17">
          <span class="hits">4</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_type</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="18">
          <span class="hits">4</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_id</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="19">
          <span class="hits">4</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :event_milestone</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="21">
          <span class="hits">4</span>
          
          <code class="ruby">    super(extras)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2c0b033daf85fa819de42760d05b5170de1ae026">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4><span class="yellow">83.78 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class User &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActionLogging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include StandardAuthentication</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  devise :database_authenticatable, :trackable, :timeoutable, :lockable, :validatable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="4337" data-linenumber="11">
          <span class="hits">4337</span>
          
          <code class="ruby">  default_scope -&gt; {order email: :asc}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.active_id_name_list filter=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    active.map {|u| {id: u.id, value: u.id, name: u.email} }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.all_name_value_enable_flagged type_filter=nil    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    if type_filter &amp;&amp; type_filter[:disabled] == false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      res = active</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      type_filter.delete :disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      res = all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    res.map{|u| [&quot;#{u.email} #{u.disabled ? &#39;[disabled]&#39; : &#39;&#39;}&quot;, u.id]  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def timeout_in  </code>
        </li>
      
        <li class="covered" data-hits="307" data-linenumber="30">
          <span class="hits">307</span>
          
          <code class="ruby">    Settings::UserTimeout</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # Standard Devise callback to allow accounts to be disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def active_for_authentication?</code>
        </li>
      
        <li class="covered" data-hits="206" data-linenumber="35">
          <span class="hits">206</span>
          
          <code class="ruby">    super &amp;&amp; !self.disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # Standard Devise callback to tell user that an account has been disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def inactive_message</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    !self.disabled  ? super : :account_has_been_disabled    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def can? auth</code>
        </li>
      
        <li class="covered" data-hits="490" data-linenumber="44">
          <span class="hits">490</span>
          
          <code class="ruby">    UserAuthorization.user_can? self, auth</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_s</code>
        </li>
      
        <li class="covered" data-hits="495" data-linenumber="48">
          <span class="hits">495</span>
          
          <code class="ruby">    email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    # Override included functionality that ensures an administrator has been set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    # Limit it to check for an administrator when email or disabled flag change</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    # This is required since user tracking and password updates are allowed in </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    # standard operation, but the user can not reset a disabled flag or their email address</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">    def ensure_admin_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="321" data-linenumber="59">
          <span class="hits">321</span>
          
          <code class="ruby">      if !admin_set? &amp;&amp; !self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:admin, &quot;account must be used to create user&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="320" data-linenumber="64">
          <span class="hits">320</span>
          
          <code class="ruby">      if email_changed? &amp;&amp; self.persisted? &amp;&amp; !admin_set?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:email, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="69">
          <span class="hits">319</span>
          
          <code class="ruby">      if disabled_changed? &amp;&amp; self.persisted? &amp;&amp; !admin_set?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:disabled, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="318" data-linenumber="74">
          <span class="hits">318</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c5950c1fa459c0888705c815c5da7d71d6bef7e3">
  <div class="header">
    <h3>app/models/user_authorization.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class UserAuthorization &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :correct_authorization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.authorizations</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="9">
          <span class="hits">92</span>
          
          <code class="ruby">    [:export_csv, :export_json, :create_msid, :view_reports, :view_external_links, :edit_report_data]    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.user_can? user, auth</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="531" data-linenumber="14">
          <span class="hits">531</span>
          
          <code class="ruby">    self.active.where(user_id: user.id, has_authorization: auth.to_s).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    def correct_authorization</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="20">
          <span class="hits">37</span>
          
          <code class="ruby">      if self.user.nil? || self.user.id.nil? </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="21">
          <span class="hits">4</span>
          
          <code class="ruby">        errors.add :user, &quot;must be set&quot;</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="22">
          <span class="hits">33</span>
          
          <code class="ruby">      elsif has_authorization.nil? || !self.class.authorizations.include?(self.has_authorization.to_sym)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">        errors.add :has_authorization, &quot;is an invalid value&quot;        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="25">
          <span class="hits">31</span>
          
          <code class="ruby">        res = self.class.user_can? self.user, self.has_authorization</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="26">
          <span class="hits">31</span>
          
          <code class="ruby">        if res &amp;&amp; res.id != self.id # If the user has the authorization set and it is not this record</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">          errors.add :user, &quot;already has the authorization #{self.has_authorization}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  </code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>

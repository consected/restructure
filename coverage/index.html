<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Fphs</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.0/favicon_red.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2016-02-02T11:44:08-05:00">2016-02-02T11:44:08-05:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="red">61.91%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         89.73
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>81</b> files in total.
    <b>2917</b> relevant lines. 
    <span class="green"><b>1806</b> lines covered</span> and
    <span class="red"><b>1111</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#e19574ea0a452c2e34c1e84365e7355495f8de36" class="src_link" title="app/controllers/addresses_controller.rb">app/controllers/addresses_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>14</td>
        <td>14</td>
        <td>0</td>
        <td>2.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#24217f351db6f12120448e75a6adf17226f30483" class="src_link" title="app/controllers/admin/accuracy_scores_controller.rb">app/controllers/admin/accuracy_scores_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#db91bf96c2bf62623ef757317783bbffe72511c2" class="src_link" title="app/controllers/admin/action_logs_controller.rb">app/controllers/admin/action_logs_controller.rb</a></td>
        <td class="red strong">30.0 %</td>
        <td>36</td>
        <td>20</td>
        <td>6</td>
        <td>14</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#605d8150e8955f0ebf23df20fd68039c87172a02" class="src_link" title="app/controllers/admin/colleges_controller.rb">app/controllers/admin/colleges_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#661ad02bf3be490cbea8939e5674f25c4220d524" class="src_link" title="app/controllers/admin/dynamic_models_controller.rb">app/controllers/admin/dynamic_models_controller.rb</a></td>
        <td class="red strong">70.0 %</td>
        <td>22</td>
        <td>10</td>
        <td>7</td>
        <td>3</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5a2bdcf75bd93dc54a1e3a282b0530b4076ae4a6" class="src_link" title="app/controllers/admin/external_links_controller.rb">app/controllers/admin/external_links_controller.rb</a></td>
        <td class="red strong">80.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>4</td>
        <td>1</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#648e5c4d0989e6c032eedce17d88102c5da2660f" class="src_link" title="app/controllers/admin/general_selections_controller.rb">app/controllers/admin/general_selections_controller.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>24</td>
        <td>12</td>
        <td>10</td>
        <td>2</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ea37691e482710ed425a71883f30d210acee3c77" class="src_link" title="app/controllers/admin/item_flag_names_controller.rb">app/controllers/admin/item_flag_names_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0ff7941ce0fd0dee700ea03ddcfee453665007bd" class="src_link" title="app/controllers/admin/manage_users_controller.rb">app/controllers/admin/manage_users_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>63</td>
        <td>37</td>
        <td>37</td>
        <td>0</td>
        <td>4.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#006a7675b420114e09b93d83d709ddff5463b333" class="src_link" title="app/controllers/admin/reports_controller.rb">app/controllers/admin/reports_controller.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>24</td>
        <td>12</td>
        <td>8</td>
        <td>4</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2f6e71f03c590d5b8f2e7c05f11ecf0bf6462d74" class="src_link" title="app/controllers/admin/sage_assignments_controller.rb">app/controllers/admin/sage_assignments_controller.rb</a></td>
        <td class="red strong">26.67 %</td>
        <td>52</td>
        <td>30</td>
        <td>8</td>
        <td>22</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#28f91ce012cf6104acb568a8bd336f11a423530b" class="src_link" title="app/controllers/admin/user_authorizations_controller.rb">app/controllers/admin/user_authorizations_controller.rb</a></td>
        <td class="red strong">77.78 %</td>
        <td>37</td>
        <td>18</td>
        <td>14</td>
        <td>4</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#55b4535afd0f986bceb082a7fcf64377004f96c4" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="red strong">65.09 %</td>
        <td>172</td>
        <td>106</td>
        <td>69</td>
        <td>37</td>
        <td>81.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0da0d90060a8f5b306b835750e0a3c780a5248ee" class="src_link" title="app/controllers/concerns/admin_controller_handler.rb">app/controllers/concerns/admin_controller_handler.rb</a></td>
        <td class="green strong">90.38 %</td>
        <td>195</td>
        <td>104</td>
        <td>94</td>
        <td>10</td>
        <td>38.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2e640a64f36fe309b76a01ce56bd0a4c096ea54e" class="src_link" title="app/controllers/concerns/controller_utils.rb">app/controllers/concerns/controller_utils.rb</a></td>
        <td class="yellow strong">82.61 %</td>
        <td>44</td>
        <td>23</td>
        <td>19</td>
        <td>4</td>
        <td>29.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f346528597f0126f80e5ea649bdd0269ad38d059" class="src_link" title="app/controllers/concerns/master_handler.rb">app/controllers/concerns/master_handler.rb</a></td>
        <td class="green strong">92.13 %</td>
        <td>175</td>
        <td>89</td>
        <td>82</td>
        <td>7</td>
        <td>28.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#660d3b1876fb736fc90c6aeef3dde478897a7f0c" class="src_link" title="app/controllers/concerns/master_search.rb">app/controllers/concerns/master_search.rb</a></td>
        <td class="red strong">52.24 %</td>
        <td>163</td>
        <td>67</td>
        <td>35</td>
        <td>32</td>
        <td>2.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#aaae36fdeb5a870ad47eeaec03fbc6fb2a9c9951" class="src_link" title="app/controllers/definitions_controller.rb">app/controllers/definitions_controller.rb</a></td>
        <td class="yellow strong">90.0 %</td>
        <td>51</td>
        <td>20</td>
        <td>18</td>
        <td>2</td>
        <td>2.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9eea0d0cee816b2707a5e74ac18342d455e24e84" class="src_link" title="app/controllers/item_flags_controller.rb">app/controllers/item_flags_controller.rb</a></td>
        <td class="green strong">97.78 %</td>
        <td>84</td>
        <td>45</td>
        <td>44</td>
        <td>1</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b3aa97caf735069b9b5381a36067c9b21615eb02" class="src_link" title="app/controllers/masters_controller.rb">app/controllers/masters_controller.rb</a></td>
        <td class="red strong">53.7 %</td>
        <td>102</td>
        <td>54</td>
        <td>29</td>
        <td>25</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d9a34e0c1950a7be87bdcf206916e5f9adfd2358" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ca7505c027580ff6348a91237350aed052da100a" class="src_link" title="app/controllers/player_contacts_controller.rb">app/controllers/player_contacts_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>3.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4518e3cba77f87829e779a83d4033e138d48bc30" class="src_link" title="app/controllers/player_infos_controller.rb">app/controllers/player_infos_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>3.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#33d6e5f79ad1f82b44d7bbcd10144c5f8b306a35" class="src_link" title="app/controllers/pro_infos_controller.rb">app/controllers/pro_infos_controller.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>29</td>
        <td>15</td>
        <td>9</td>
        <td>6</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cd6115050568898166a7e43e5b766c188f2176e8" class="src_link" title="app/controllers/protocol_events_controller.rb">app/controllers/protocol_events_controller.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>50</td>
        <td>32</td>
        <td>28</td>
        <td>4</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8a9725a1348ff49307971e07cddf71ff6c396411" class="src_link" title="app/controllers/protocols_controller.rb">app/controllers/protocols_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#66828b54bb61fb1b5b1539d2fdf810fc5843fcc5" class="src_link" title="app/controllers/reports_controller.rb">app/controllers/reports_controller.rb</a></td>
        <td class="red strong">21.32 %</td>
        <td>252</td>
        <td>136</td>
        <td>29</td>
        <td>107</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#315b54d646a88f5feae70014ca16ffe13eae05e5" class="src_link" title="app/controllers/sage_assignments_controller.rb">app/controllers/sage_assignments_controller.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>6</td>
        <td>4</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a1e5db9cd62c76051b1c17de0b57f4a014d2c215" class="src_link" title="app/controllers/scantrons_controller.rb">app/controllers/scantrons_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b41afa2318e5c430eb283c3062c320aacc0d245e" class="src_link" title="app/controllers/sub_processes_controller.rb">app/controllers/sub_processes_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>30</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>4.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4061f9d046379d73edd4d40121943c4492031e7e" class="src_link" title="app/controllers/tracker_histories_controller.rb">app/controllers/tracker_histories_controller.rb</a></td>
        <td class="red strong">28.0 %</td>
        <td>45</td>
        <td>25</td>
        <td>7</td>
        <td>18</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#558df1fb83adb6f91eb750c3554b76095270210b" class="src_link" title="app/controllers/trackers_controller.rb">app/controllers/trackers_controller.rb</a></td>
        <td class="red strong">76.92 %</td>
        <td>26</td>
        <td>13</td>
        <td>10</td>
        <td>3</td>
        <td>3.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0d7715e18702b940a65c0fad10c7ea9441ea3efe" class="src_link" title="app/helpers/addresses_helper.rb">app/helpers/addresses_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>7</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3ebb82ae1f4fd221fe52d9e531eeb3c0daefb53f" class="src_link" title="app/helpers/admin_helper.rb">app/helpers/admin_helper.rb</a></td>
        <td class="red strong">31.25 %</td>
        <td>33</td>
        <td>16</td>
        <td>5</td>
        <td>11</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f90bdceb10af1da98f21bd1d0b6b21e887cc0900" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="red strong">37.5 %</td>
        <td>68</td>
        <td>32</td>
        <td>12</td>
        <td>20</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94e0cf90e781a2b4d29341db1ebccc4aef0a513a" class="src_link" title="app/helpers/colleges_helper.rb">app/helpers/colleges_helper.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>8</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#478d82f5d7010151450eda0e312a3fbd6313d865" class="src_link" title="app/helpers/general_selections_helper.rb">app/helpers/general_selections_helper.rb</a></td>
        <td class="red strong">15.79 %</td>
        <td>37</td>
        <td>19</td>
        <td>3</td>
        <td>16</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ef95de25ff26de68ea8735bd1b810150369b0d5e" class="src_link" title="app/helpers/item_flag_names_helper.rb">app/helpers/item_flag_names_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>8</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8adec35157febfd95cf5a185c41ac586f81c861b" class="src_link" title="app/helpers/item_flags_helper.rb">app/helpers/item_flags_helper.rb</a></td>
        <td class="red strong">35.0 %</td>
        <td>38</td>
        <td>20</td>
        <td>7</td>
        <td>13</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e9a3428d68e91cc36683fed42fe215114808c962" class="src_link" title="app/helpers/manage_users_helper.rb">app/helpers/manage_users_helper.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>3</td>
        <td>2</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#da9e3638a935e04caee60a318f378149130493c4" class="src_link" title="app/helpers/player_infos_helper.rb">app/helpers/player_infos_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>8</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#86ffddca12321515f7bd15845b631dba7e189e52" class="src_link" title="app/helpers/protocols_helper.rb">app/helpers/protocols_helper.rb</a></td>
        <td class="red strong">24.14 %</td>
        <td>60</td>
        <td>29</td>
        <td>7</td>
        <td>22</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e96d5f64e1f28faa5814dcdbb195192c75e8c5ee" class="src_link" title="app/helpers/reports_helper.rb">app/helpers/reports_helper.rb</a></td>
        <td class="red strong">11.11 %</td>
        <td>72</td>
        <td>36</td>
        <td>4</td>
        <td>32</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f7efb0298613631d00fe3c9c9746a734b2c224a0" class="src_link" title="app/models/accuracy_score.rb">app/models/accuracy_score.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>22</td>
        <td>13</td>
        <td>12</td>
        <td>1</td>
        <td>217.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fec2cc6e63fbaa7dd190173002a74c7b0686e3d7" class="src_link" title="app/models/address.rb">app/models/address.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>88</td>
        <td>48</td>
        <td>48</td>
        <td>0</td>
        <td>8.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7fa2768e566195827c840b66ad02c3e8caf96397" class="src_link" title="app/models/address_state.rb">app/models/address_state.rb</a></td>
        <td class="red strong">80.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>4</td>
        <td>1</td>
        <td>6.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b88e322baeb8e4eee73123940390dbf31d989050" class="src_link" title="app/models/admin.rb">app/models/admin.rb</a></td>
        <td class="green strong">96.43 %</td>
        <td>59</td>
        <td>28</td>
        <td>27</td>
        <td>1</td>
        <td>58.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#aeb8f3c4323ea3d6077a8c2efe863def24954900" class="src_link" title="app/models/application.rb">app/models/application.rb</a></td>
        <td class="red strong">62.5 %</td>
        <td>45</td>
        <td>24</td>
        <td>15</td>
        <td>9</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#60989f04ce10b942c75cb1782352ded5cfdb9adf" class="src_link" title="app/models/college.rb">app/models/college.rb</a></td>
        <td class="yellow strong">89.09 %</td>
        <td>98</td>
        <td>55</td>
        <td>49</td>
        <td>6</td>
        <td>16.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#92f558f21d7056672aedc68a02d856317638c21a" class="src_link" title="app/models/concerns/action_logging.rb">app/models/concerns/action_logging.rb</a></td>
        <td class="green strong">91.67 %</td>
        <td>28</td>
        <td>12</td>
        <td>11</td>
        <td>1</td>
        <td>117.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#398555292d85d0e62e5a1c92b0501c15b333db79" class="src_link" title="app/models/concerns/admin_handler.rb">app/models/concerns/admin_handler.rb</a></td>
        <td class="yellow strong">83.87 %</td>
        <td>55</td>
        <td>31</td>
        <td>26</td>
        <td>5</td>
        <td>1562.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0b0d0bac7828b2f92562f87962127a6c011ca089" class="src_link" title="app/models/concerns/email_validator.rb">app/models/concerns/email_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>9.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4582da0e614b02c4fc871cf89a2141bea8ab3853" class="src_link" title="app/models/concerns/external_id_handler.rb">app/models/concerns/external_id_handler.rb</a></td>
        <td class="red strong">75.36 %</td>
        <td>145</td>
        <td>69</td>
        <td>52</td>
        <td>17</td>
        <td>9.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6b71b8a50eb358042d933c365f5e1ad93f6f78b2" class="src_link" title="app/models/concerns/master_search_handler.rb">app/models/concerns/master_search_handler.rb</a></td>
        <td class="yellow strong">86.36 %</td>
        <td>325</td>
        <td>132</td>
        <td>114</td>
        <td>18</td>
        <td>28.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#06ff909190cbc923ea8f73680accf445042f4bd6" class="src_link" title="app/models/concerns/phone_validator.rb">app/models/concerns/phone_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>13.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d2bdcee76d062d9d49b658ff9f4ac60fbc6f1011" class="src_link" title="app/models/concerns/selector_cache.rb">app/models/concerns/selector_cache.rb</a></td>
        <td class="red strong">56.63 %</td>
        <td>158</td>
        <td>83</td>
        <td>47</td>
        <td>36</td>
        <td>391.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#60e8e1378419a616fe468b81ffcfd9f24aa2903e" class="src_link" title="app/models/concerns/source_validator.rb">app/models/concerns/source_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>40.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#526659279e458ddf3851998c28870bd1e647fda7" class="src_link" title="app/models/concerns/standard_authentication.rb">app/models/concerns/standard_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>150.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#81d5c00a6407037f39288299e2fcb949fa449385" class="src_link" title="app/models/concerns/tracker_handler.rb">app/models/concerns/tracker_handler.rb</a></td>
        <td class="green strong">90.63 %</td>
        <td>58</td>
        <td>32</td>
        <td>29</td>
        <td>3</td>
        <td>5.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1d6a745e555e21c2bf40750c843ddcdfc35308f2" class="src_link" title="app/models/concerns/user_handler.rb">app/models/concerns/user_handler.rb</a></td>
        <td class="green strong">98.25 %</td>
        <td>221</td>
        <td>114</td>
        <td>112</td>
        <td>2</td>
        <td>554.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9e4cd2b8d11449b31e8bae86b8ded09292dcc629" class="src_link" title="app/models/concerns/zip_validator.rb">app/models/concerns/zip_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>14.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cbfa9322b89f5428518a0b4ccc7cdd8589319832" class="src_link" title="app/models/dynamic_model.rb">app/models/dynamic_model.rb</a></td>
        <td class="red strong">25.78 %</td>
        <td>243</td>
        <td>128</td>
        <td>33</td>
        <td>95</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0566ccc727d6edbcf0dde8445a76c370417ae15d" class="src_link" title="app/models/external_link.rb">app/models/external_link.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>6</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a6ade0086539fb2ed04cc9c33c13fba1ee8342e8" class="src_link" title="app/models/general_selection.rb">app/models/general_selection.rb</a></td>
        <td class="green strong">96.55 %</td>
        <td>59</td>
        <td>29</td>
        <td>28</td>
        <td>1</td>
        <td>474.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9d971e01eac2d0eda1e01a3d3ddec13d74794c7f" class="src_link" title="app/models/item_flag.rb">app/models/item_flag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>115</td>
        <td>58</td>
        <td>58</td>
        <td>0</td>
        <td>67.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9dd373790283d270f04af16fa96f9c4f1fc4ea30" class="src_link" title="app/models/item_flag_name.rb">app/models/item_flag_name.rb</a></td>
        <td class="green strong">92.59 %</td>
        <td>43</td>
        <td>27</td>
        <td>25</td>
        <td>2</td>
        <td>51.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e3919ff62130f0f677c7cdbeb435ea105c525eea" class="src_link" title="app/models/master.rb">app/models/master.rb</a></td>
        <td class="yellow strong">81.67 %</td>
        <td>130</td>
        <td>60</td>
        <td>49</td>
        <td>11</td>
        <td>145.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a726b169f874bbacd39b5858c31bd042a5592a67" class="src_link" title="app/models/player_contact.rb">app/models/player_contact.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>13.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bbeb87e908084a50aa0523e111c2b51ac5f1bdf0" class="src_link" title="app/models/player_info.rb">app/models/player_info.rb</a></td>
        <td class="yellow strong">86.49 %</td>
        <td>70</td>
        <td>37</td>
        <td>32</td>
        <td>5</td>
        <td>47.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4b640a21d9d5e69435a3a8b97529f22b0179d942" class="src_link" title="app/models/pro_info.rb">app/models/pro_info.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>6.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d5f026daf6e02450afcf952393f88f4a2f2d2798" class="src_link" title="app/models/protocol.rb">app/models/protocol.rb</a></td>
        <td class="green strong">92.86 %</td>
        <td>28</td>
        <td>14</td>
        <td>13</td>
        <td>1</td>
        <td>229.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fe4b6a68b932989ba3f874b6f9ef47f67325d175" class="src_link" title="app/models/protocol_event.rb">app/models/protocol_event.rb</a></td>
        <td class="red strong">76.47 %</td>
        <td>32</td>
        <td>17</td>
        <td>13</td>
        <td>4</td>
        <td>1088.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#be87dbd7f6a94f8e4d8660b649e40103b8063e35" class="src_link" title="app/models/report.rb">app/models/report.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>389</td>
        <td>389</td>
        <td>0</td>
        <td>389</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8bfe4b86a162622b03e48d44a2ae2405d8e66252" class="src_link" title="app/models/sage_assignment.rb">app/models/sage_assignment.rb</a></td>
        <td class="green strong">92.86 %</td>
        <td>82</td>
        <td>42</td>
        <td>39</td>
        <td>3</td>
        <td>36.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#210f5525362975fba6f66e018a2b9ae5bdb32f64" class="src_link" title="app/models/scantron.rb">app/models/scantron.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>26</td>
        <td>12</td>
        <td>10</td>
        <td>2</td>
        <td>11.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3b1c283e3aa1c8f38d3fa7cd46b4ec497b50142a" class="src_link" title="app/models/sub_process.rb">app/models/sub_process.rb</a></td>
        <td class="red strong">76.92 %</td>
        <td>23</td>
        <td>13</td>
        <td>10</td>
        <td>3</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#70e7bd70f44beed3e60c291d2f9c8b9caa638b06" class="src_link" title="app/models/tracker.rb">app/models/tracker.rb</a></td>
        <td class="green strong">95.08 %</td>
        <td>238</td>
        <td>122</td>
        <td>116</td>
        <td>6</td>
        <td>220.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f10186eb0e018cadb689bffe5e6d20e85a2e8011" class="src_link" title="app/models/tracker_history.rb">app/models/tracker_history.rb</a></td>
        <td class="red strong">40.0 %</td>
        <td>24</td>
        <td>15</td>
        <td>6</td>
        <td>9</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2654514890fd2840274ad6d716454f0187d5ce9c" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="yellow strong">81.08 %</td>
        <td>77</td>
        <td>37</td>
        <td>30</td>
        <td>7</td>
        <td>125.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b13362e548e2211e3a05397ce4d304ef959aa435" class="src_link" title="app/models/user_authorization.rb">app/models/user_authorization.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>30.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ee1ba6643f4204a3cc06f15ea3d6066a07026c03" class="src_link" title="lib/generators/external_id_handler/external_id_handler_generator.rb">lib/generators/external_id_handler/external_id_handler_generator.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>36</td>
        <td>36</td>
        <td>0</td>
        <td>36</td>
        <td>0.0</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="red">68.01%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         17.68
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>32</b> files in total.
    <b>969</b> relevant lines. 
    <span class="green"><b>659</b> lines covered</span> and
    <span class="red"><b>310</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#e19574ea0a452c2e34c1e84365e7355495f8de36" class="src_link" title="app/controllers/addresses_controller.rb">app/controllers/addresses_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>14</td>
        <td>14</td>
        <td>0</td>
        <td>2.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#24217f351db6f12120448e75a6adf17226f30483" class="src_link" title="app/controllers/admin/accuracy_scores_controller.rb">app/controllers/admin/accuracy_scores_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#db91bf96c2bf62623ef757317783bbffe72511c2" class="src_link" title="app/controllers/admin/action_logs_controller.rb">app/controllers/admin/action_logs_controller.rb</a></td>
        <td class="red strong">30.0 %</td>
        <td>36</td>
        <td>20</td>
        <td>6</td>
        <td>14</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#605d8150e8955f0ebf23df20fd68039c87172a02" class="src_link" title="app/controllers/admin/colleges_controller.rb">app/controllers/admin/colleges_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#661ad02bf3be490cbea8939e5674f25c4220d524" class="src_link" title="app/controllers/admin/dynamic_models_controller.rb">app/controllers/admin/dynamic_models_controller.rb</a></td>
        <td class="red strong">70.0 %</td>
        <td>22</td>
        <td>10</td>
        <td>7</td>
        <td>3</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5a2bdcf75bd93dc54a1e3a282b0530b4076ae4a6" class="src_link" title="app/controllers/admin/external_links_controller.rb">app/controllers/admin/external_links_controller.rb</a></td>
        <td class="red strong">80.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>4</td>
        <td>1</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#648e5c4d0989e6c032eedce17d88102c5da2660f" class="src_link" title="app/controllers/admin/general_selections_controller.rb">app/controllers/admin/general_selections_controller.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>24</td>
        <td>12</td>
        <td>10</td>
        <td>2</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ea37691e482710ed425a71883f30d210acee3c77" class="src_link" title="app/controllers/admin/item_flag_names_controller.rb">app/controllers/admin/item_flag_names_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0ff7941ce0fd0dee700ea03ddcfee453665007bd" class="src_link" title="app/controllers/admin/manage_users_controller.rb">app/controllers/admin/manage_users_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>63</td>
        <td>37</td>
        <td>37</td>
        <td>0</td>
        <td>4.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#006a7675b420114e09b93d83d709ddff5463b333" class="src_link" title="app/controllers/admin/reports_controller.rb">app/controllers/admin/reports_controller.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>24</td>
        <td>12</td>
        <td>8</td>
        <td>4</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2f6e71f03c590d5b8f2e7c05f11ecf0bf6462d74" class="src_link" title="app/controllers/admin/sage_assignments_controller.rb">app/controllers/admin/sage_assignments_controller.rb</a></td>
        <td class="red strong">26.67 %</td>
        <td>52</td>
        <td>30</td>
        <td>8</td>
        <td>22</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#28f91ce012cf6104acb568a8bd336f11a423530b" class="src_link" title="app/controllers/admin/user_authorizations_controller.rb">app/controllers/admin/user_authorizations_controller.rb</a></td>
        <td class="red strong">77.78 %</td>
        <td>37</td>
        <td>18</td>
        <td>14</td>
        <td>4</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#55b4535afd0f986bceb082a7fcf64377004f96c4" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="red strong">65.09 %</td>
        <td>172</td>
        <td>106</td>
        <td>69</td>
        <td>37</td>
        <td>81.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0da0d90060a8f5b306b835750e0a3c780a5248ee" class="src_link" title="app/controllers/concerns/admin_controller_handler.rb">app/controllers/concerns/admin_controller_handler.rb</a></td>
        <td class="green strong">90.38 %</td>
        <td>195</td>
        <td>104</td>
        <td>94</td>
        <td>10</td>
        <td>38.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2e640a64f36fe309b76a01ce56bd0a4c096ea54e" class="src_link" title="app/controllers/concerns/controller_utils.rb">app/controllers/concerns/controller_utils.rb</a></td>
        <td class="yellow strong">82.61 %</td>
        <td>44</td>
        <td>23</td>
        <td>19</td>
        <td>4</td>
        <td>29.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f346528597f0126f80e5ea649bdd0269ad38d059" class="src_link" title="app/controllers/concerns/master_handler.rb">app/controllers/concerns/master_handler.rb</a></td>
        <td class="green strong">92.13 %</td>
        <td>175</td>
        <td>89</td>
        <td>82</td>
        <td>7</td>
        <td>28.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#660d3b1876fb736fc90c6aeef3dde478897a7f0c" class="src_link" title="app/controllers/concerns/master_search.rb">app/controllers/concerns/master_search.rb</a></td>
        <td class="red strong">52.24 %</td>
        <td>163</td>
        <td>67</td>
        <td>35</td>
        <td>32</td>
        <td>2.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#aaae36fdeb5a870ad47eeaec03fbc6fb2a9c9951" class="src_link" title="app/controllers/definitions_controller.rb">app/controllers/definitions_controller.rb</a></td>
        <td class="yellow strong">90.0 %</td>
        <td>51</td>
        <td>20</td>
        <td>18</td>
        <td>2</td>
        <td>2.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9eea0d0cee816b2707a5e74ac18342d455e24e84" class="src_link" title="app/controllers/item_flags_controller.rb">app/controllers/item_flags_controller.rb</a></td>
        <td class="green strong">97.78 %</td>
        <td>84</td>
        <td>45</td>
        <td>44</td>
        <td>1</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b3aa97caf735069b9b5381a36067c9b21615eb02" class="src_link" title="app/controllers/masters_controller.rb">app/controllers/masters_controller.rb</a></td>
        <td class="red strong">53.7 %</td>
        <td>102</td>
        <td>54</td>
        <td>29</td>
        <td>25</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d9a34e0c1950a7be87bdcf206916e5f9adfd2358" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ca7505c027580ff6348a91237350aed052da100a" class="src_link" title="app/controllers/player_contacts_controller.rb">app/controllers/player_contacts_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>3.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4518e3cba77f87829e779a83d4033e138d48bc30" class="src_link" title="app/controllers/player_infos_controller.rb">app/controllers/player_infos_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>3.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#33d6e5f79ad1f82b44d7bbcd10144c5f8b306a35" class="src_link" title="app/controllers/pro_infos_controller.rb">app/controllers/pro_infos_controller.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>29</td>
        <td>15</td>
        <td>9</td>
        <td>6</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cd6115050568898166a7e43e5b766c188f2176e8" class="src_link" title="app/controllers/protocol_events_controller.rb">app/controllers/protocol_events_controller.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>50</td>
        <td>32</td>
        <td>28</td>
        <td>4</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8a9725a1348ff49307971e07cddf71ff6c396411" class="src_link" title="app/controllers/protocols_controller.rb">app/controllers/protocols_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#66828b54bb61fb1b5b1539d2fdf810fc5843fcc5" class="src_link" title="app/controllers/reports_controller.rb">app/controllers/reports_controller.rb</a></td>
        <td class="red strong">21.32 %</td>
        <td>252</td>
        <td>136</td>
        <td>29</td>
        <td>107</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#315b54d646a88f5feae70014ca16ffe13eae05e5" class="src_link" title="app/controllers/sage_assignments_controller.rb">app/controllers/sage_assignments_controller.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>6</td>
        <td>4</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a1e5db9cd62c76051b1c17de0b57f4a014d2c215" class="src_link" title="app/controllers/scantrons_controller.rb">app/controllers/scantrons_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b41afa2318e5c430eb283c3062c320aacc0d245e" class="src_link" title="app/controllers/sub_processes_controller.rb">app/controllers/sub_processes_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>30</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>4.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4061f9d046379d73edd4d40121943c4492031e7e" class="src_link" title="app/controllers/tracker_histories_controller.rb">app/controllers/tracker_histories_controller.rb</a></td>
        <td class="red strong">28.0 %</td>
        <td>45</td>
        <td>25</td>
        <td>7</td>
        <td>18</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#558df1fb83adb6f91eb750c3554b76095270210b" class="src_link" title="app/controllers/trackers_controller.rb">app/controllers/trackers_controller.rb</a></td>
        <td class="red strong">76.92 %</td>
        <td>26</td>
        <td>13</td>
        <td>10</td>
        <td>3</td>
        <td>3.9</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="red">63.03%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         140.39
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>37</b> files in total.
    <b>1742</b> relevant lines. 
    <span class="green"><b>1098</b> lines covered</span> and
    <span class="red"><b>644</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#f7efb0298613631d00fe3c9c9746a734b2c224a0" class="src_link" title="app/models/accuracy_score.rb">app/models/accuracy_score.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>22</td>
        <td>13</td>
        <td>12</td>
        <td>1</td>
        <td>217.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fec2cc6e63fbaa7dd190173002a74c7b0686e3d7" class="src_link" title="app/models/address.rb">app/models/address.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>88</td>
        <td>48</td>
        <td>48</td>
        <td>0</td>
        <td>8.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7fa2768e566195827c840b66ad02c3e8caf96397" class="src_link" title="app/models/address_state.rb">app/models/address_state.rb</a></td>
        <td class="red strong">80.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>4</td>
        <td>1</td>
        <td>6.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b88e322baeb8e4eee73123940390dbf31d989050" class="src_link" title="app/models/admin.rb">app/models/admin.rb</a></td>
        <td class="green strong">96.43 %</td>
        <td>59</td>
        <td>28</td>
        <td>27</td>
        <td>1</td>
        <td>58.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#aeb8f3c4323ea3d6077a8c2efe863def24954900" class="src_link" title="app/models/application.rb">app/models/application.rb</a></td>
        <td class="red strong">62.5 %</td>
        <td>45</td>
        <td>24</td>
        <td>15</td>
        <td>9</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#60989f04ce10b942c75cb1782352ded5cfdb9adf" class="src_link" title="app/models/college.rb">app/models/college.rb</a></td>
        <td class="yellow strong">89.09 %</td>
        <td>98</td>
        <td>55</td>
        <td>49</td>
        <td>6</td>
        <td>16.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#92f558f21d7056672aedc68a02d856317638c21a" class="src_link" title="app/models/concerns/action_logging.rb">app/models/concerns/action_logging.rb</a></td>
        <td class="green strong">91.67 %</td>
        <td>28</td>
        <td>12</td>
        <td>11</td>
        <td>1</td>
        <td>117.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#398555292d85d0e62e5a1c92b0501c15b333db79" class="src_link" title="app/models/concerns/admin_handler.rb">app/models/concerns/admin_handler.rb</a></td>
        <td class="yellow strong">83.87 %</td>
        <td>55</td>
        <td>31</td>
        <td>26</td>
        <td>5</td>
        <td>1562.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0b0d0bac7828b2f92562f87962127a6c011ca089" class="src_link" title="app/models/concerns/email_validator.rb">app/models/concerns/email_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>9.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4582da0e614b02c4fc871cf89a2141bea8ab3853" class="src_link" title="app/models/concerns/external_id_handler.rb">app/models/concerns/external_id_handler.rb</a></td>
        <td class="red strong">75.36 %</td>
        <td>145</td>
        <td>69</td>
        <td>52</td>
        <td>17</td>
        <td>9.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6b71b8a50eb358042d933c365f5e1ad93f6f78b2" class="src_link" title="app/models/concerns/master_search_handler.rb">app/models/concerns/master_search_handler.rb</a></td>
        <td class="yellow strong">86.36 %</td>
        <td>325</td>
        <td>132</td>
        <td>114</td>
        <td>18</td>
        <td>28.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#06ff909190cbc923ea8f73680accf445042f4bd6" class="src_link" title="app/models/concerns/phone_validator.rb">app/models/concerns/phone_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>13.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d2bdcee76d062d9d49b658ff9f4ac60fbc6f1011" class="src_link" title="app/models/concerns/selector_cache.rb">app/models/concerns/selector_cache.rb</a></td>
        <td class="red strong">56.63 %</td>
        <td>158</td>
        <td>83</td>
        <td>47</td>
        <td>36</td>
        <td>391.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#60e8e1378419a616fe468b81ffcfd9f24aa2903e" class="src_link" title="app/models/concerns/source_validator.rb">app/models/concerns/source_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>40.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#526659279e458ddf3851998c28870bd1e647fda7" class="src_link" title="app/models/concerns/standard_authentication.rb">app/models/concerns/standard_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>150.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#81d5c00a6407037f39288299e2fcb949fa449385" class="src_link" title="app/models/concerns/tracker_handler.rb">app/models/concerns/tracker_handler.rb</a></td>
        <td class="green strong">90.63 %</td>
        <td>58</td>
        <td>32</td>
        <td>29</td>
        <td>3</td>
        <td>5.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1d6a745e555e21c2bf40750c843ddcdfc35308f2" class="src_link" title="app/models/concerns/user_handler.rb">app/models/concerns/user_handler.rb</a></td>
        <td class="green strong">98.25 %</td>
        <td>221</td>
        <td>114</td>
        <td>112</td>
        <td>2</td>
        <td>554.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9e4cd2b8d11449b31e8bae86b8ded09292dcc629" class="src_link" title="app/models/concerns/zip_validator.rb">app/models/concerns/zip_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>14.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cbfa9322b89f5428518a0b4ccc7cdd8589319832" class="src_link" title="app/models/dynamic_model.rb">app/models/dynamic_model.rb</a></td>
        <td class="red strong">25.78 %</td>
        <td>243</td>
        <td>128</td>
        <td>33</td>
        <td>95</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0566ccc727d6edbcf0dde8445a76c370417ae15d" class="src_link" title="app/models/external_link.rb">app/models/external_link.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>6</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a6ade0086539fb2ed04cc9c33c13fba1ee8342e8" class="src_link" title="app/models/general_selection.rb">app/models/general_selection.rb</a></td>
        <td class="green strong">96.55 %</td>
        <td>59</td>
        <td>29</td>
        <td>28</td>
        <td>1</td>
        <td>474.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9d971e01eac2d0eda1e01a3d3ddec13d74794c7f" class="src_link" title="app/models/item_flag.rb">app/models/item_flag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>115</td>
        <td>58</td>
        <td>58</td>
        <td>0</td>
        <td>67.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9dd373790283d270f04af16fa96f9c4f1fc4ea30" class="src_link" title="app/models/item_flag_name.rb">app/models/item_flag_name.rb</a></td>
        <td class="green strong">92.59 %</td>
        <td>43</td>
        <td>27</td>
        <td>25</td>
        <td>2</td>
        <td>51.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e3919ff62130f0f677c7cdbeb435ea105c525eea" class="src_link" title="app/models/master.rb">app/models/master.rb</a></td>
        <td class="yellow strong">81.67 %</td>
        <td>130</td>
        <td>60</td>
        <td>49</td>
        <td>11</td>
        <td>145.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a726b169f874bbacd39b5858c31bd042a5592a67" class="src_link" title="app/models/player_contact.rb">app/models/player_contact.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>13.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bbeb87e908084a50aa0523e111c2b51ac5f1bdf0" class="src_link" title="app/models/player_info.rb">app/models/player_info.rb</a></td>
        <td class="yellow strong">86.49 %</td>
        <td>70</td>
        <td>37</td>
        <td>32</td>
        <td>5</td>
        <td>47.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4b640a21d9d5e69435a3a8b97529f22b0179d942" class="src_link" title="app/models/pro_info.rb">app/models/pro_info.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>6.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d5f026daf6e02450afcf952393f88f4a2f2d2798" class="src_link" title="app/models/protocol.rb">app/models/protocol.rb</a></td>
        <td class="green strong">92.86 %</td>
        <td>28</td>
        <td>14</td>
        <td>13</td>
        <td>1</td>
        <td>229.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fe4b6a68b932989ba3f874b6f9ef47f67325d175" class="src_link" title="app/models/protocol_event.rb">app/models/protocol_event.rb</a></td>
        <td class="red strong">76.47 %</td>
        <td>32</td>
        <td>17</td>
        <td>13</td>
        <td>4</td>
        <td>1088.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#be87dbd7f6a94f8e4d8660b649e40103b8063e35" class="src_link" title="app/models/report.rb">app/models/report.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>389</td>
        <td>389</td>
        <td>0</td>
        <td>389</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8bfe4b86a162622b03e48d44a2ae2405d8e66252" class="src_link" title="app/models/sage_assignment.rb">app/models/sage_assignment.rb</a></td>
        <td class="green strong">92.86 %</td>
        <td>82</td>
        <td>42</td>
        <td>39</td>
        <td>3</td>
        <td>36.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#210f5525362975fba6f66e018a2b9ae5bdb32f64" class="src_link" title="app/models/scantron.rb">app/models/scantron.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>26</td>
        <td>12</td>
        <td>10</td>
        <td>2</td>
        <td>11.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3b1c283e3aa1c8f38d3fa7cd46b4ec497b50142a" class="src_link" title="app/models/sub_process.rb">app/models/sub_process.rb</a></td>
        <td class="red strong">76.92 %</td>
        <td>23</td>
        <td>13</td>
        <td>10</td>
        <td>3</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#70e7bd70f44beed3e60c291d2f9c8b9caa638b06" class="src_link" title="app/models/tracker.rb">app/models/tracker.rb</a></td>
        <td class="green strong">95.08 %</td>
        <td>238</td>
        <td>122</td>
        <td>116</td>
        <td>6</td>
        <td>220.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f10186eb0e018cadb689bffe5e6d20e85a2e8011" class="src_link" title="app/models/tracker_history.rb">app/models/tracker_history.rb</a></td>
        <td class="red strong">40.0 %</td>
        <td>24</td>
        <td>15</td>
        <td>6</td>
        <td>9</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2654514890fd2840274ad6d716454f0187d5ce9c" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="yellow strong">81.08 %</td>
        <td>77</td>
        <td>37</td>
        <td>30</td>
        <td>7</td>
        <td>125.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b13362e548e2211e3a05397ce4d304ef959aa435" class="src_link" title="app/models/user_authorization.rb">app/models/user_authorization.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>30.1</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="red">28.82%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.29
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>11</b> files in total.
    <b>170</b> relevant lines. 
    <span class="green"><b>49</b> lines covered</span> and
    <span class="red"><b>121</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#0d7715e18702b940a65c0fad10c7ea9441ea3efe" class="src_link" title="app/helpers/addresses_helper.rb">app/helpers/addresses_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>7</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3ebb82ae1f4fd221fe52d9e531eeb3c0daefb53f" class="src_link" title="app/helpers/admin_helper.rb">app/helpers/admin_helper.rb</a></td>
        <td class="red strong">31.25 %</td>
        <td>33</td>
        <td>16</td>
        <td>5</td>
        <td>11</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f90bdceb10af1da98f21bd1d0b6b21e887cc0900" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="red strong">37.5 %</td>
        <td>68</td>
        <td>32</td>
        <td>12</td>
        <td>20</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94e0cf90e781a2b4d29341db1ebccc4aef0a513a" class="src_link" title="app/helpers/colleges_helper.rb">app/helpers/colleges_helper.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>8</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#478d82f5d7010151450eda0e312a3fbd6313d865" class="src_link" title="app/helpers/general_selections_helper.rb">app/helpers/general_selections_helper.rb</a></td>
        <td class="red strong">15.79 %</td>
        <td>37</td>
        <td>19</td>
        <td>3</td>
        <td>16</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ef95de25ff26de68ea8735bd1b810150369b0d5e" class="src_link" title="app/helpers/item_flag_names_helper.rb">app/helpers/item_flag_names_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>8</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8adec35157febfd95cf5a185c41ac586f81c861b" class="src_link" title="app/helpers/item_flags_helper.rb">app/helpers/item_flags_helper.rb</a></td>
        <td class="red strong">35.0 %</td>
        <td>38</td>
        <td>20</td>
        <td>7</td>
        <td>13</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e9a3428d68e91cc36683fed42fe215114808c962" class="src_link" title="app/helpers/manage_users_helper.rb">app/helpers/manage_users_helper.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>3</td>
        <td>2</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#da9e3638a935e04caee60a318f378149130493c4" class="src_link" title="app/helpers/player_infos_helper.rb">app/helpers/player_infos_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>8</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#86ffddca12321515f7bd15845b631dba7e189e52" class="src_link" title="app/helpers/protocols_helper.rb">app/helpers/protocols_helper.rb</a></td>
        <td class="red strong">24.14 %</td>
        <td>60</td>
        <td>29</td>
        <td>7</td>
        <td>22</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e96d5f64e1f28faa5814dcdbb195192c75e8c5ee" class="src_link" title="app/helpers/reports_helper.rb">app/helpers/reports_helper.rb</a></td>
        <td class="red strong">11.11 %</td>
        <td>72</td>
        <td>36</td>
        <td>4</td>
        <td>32</td>
        <td>0.1</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="red">0.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>1</b> files in total.
    <b>36</b> relevant lines. 
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>36</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#ee1ba6643f4204a3cc06f15ea3d6066a07026c03" class="src_link" title="lib/generators/external_id_handler/external_id_handler_generator.rb">lib/generators/external_id_handler/external_id_handler_generator.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>36</td>
        <td>36</td>
        <td>0</td>
        <td>36</td>
        <td>0.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.11.1 
        and simplecov-html v0.10.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="e19574ea0a452c2e34c1e84365e7355495f8de36">
  <div class="header">
    <h3>app/controllers/addresses_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>14</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AddressesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    # Force the state and country codes to uppercase to allow the edit selectors to work as expected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    object_instance.state = object_instance.state.upcase if object_instance.state</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    object_instance.country = object_instance.country.upcase if object_instance.country</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    render partial: edit_form</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def edit_form</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="13">
          <span class="hits">2</span>
          
          <code class="ruby">      &#39;common_templates/edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="17">
          <span class="hits">11</span>
          
          <code class="ruby">      [:master_id,:country,  :street, :street2, :street3, :city, :state, :zip, :region, :postal_code, :source, :rank, :rec_type]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="22">
          <span class="hits">11</span>
          
          <code class="ruby">      params.require(object_name.to_sym).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="24217f351db6f12120448e75a6adf17226f30483">
  <div class="header">
    <h3>app/controllers/admin/accuracy_scores_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::AccuracyScoresController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="7">
          <span class="hits">11</span>
          
          <code class="ruby">      params.require(:accuracy_score).permit(:name, :value, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="db91bf96c2bf62623ef757317783bbffe72511c2">
  <div class="header">
    <h3>app/controllers/admin/action_logs_controller.rb</h3>
    <h4><span class="red">30.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ActionLogsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">#  before_action :authenticate_admin!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @action_logs = Dir.glob(&quot;action_logs/*_action_log-*.log&quot;).sort.map {|a| a.gsub(&#39;action_logs/&#39;,&#39;&#39;)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    id = params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    logger.info &quot;ID: #{id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    raise &quot;Bad file requested&quot; if id.nil? || id.index(/\.\.|\/|\\|~/)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    f = File.basename(id, &#39;.log&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    logger.info &quot;File: #{f}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    fn = &quot;action_logs/#{f}.log&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    @action_log = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    File.open(fn).each { |l|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      if l[0].to_s != &#39;#&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">        ls = l.split(&#39; -- : &#39;,2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">        j = JSON.parse ls.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">        @action_log &lt;&lt; {title: ls.first, detail: j }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    render json: @action_log</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_instance_from_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="605d8150e8955f0ebf23df20fd68039c87172a02">
  <div class="header">
    <h3>app/controllers/admin/colleges_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::CollegesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="7">
          <span class="hits">12</span>
          
          <code class="ruby">        params.require(object_name.to_sym).permit(:name, :synonym_for_id, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="661ad02bf3be490cbea8939e5674f25c4220d524">
  <div class="header">
    <h3>app/controllers/admin/dynamic_models_controller.rb</h3>
    <h4><span class="red">70.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::DynamicModelsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method :permitted_params, :objects_instance, :human_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def view_folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      &#39;admin/common_templates&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      @permitted_params = [:id, :name, :category, :table_name, :table_key_name, :primary_key_name, :foreign_key_name, :result_order, :field_list, :position, :description, :disabled]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      params.require(object_name.to_sym).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5a2bdcf75bd93dc54a1e3a282b0530b4076ae4a6">
  <div class="header">
    <h3>app/controllers/admin/external_links_controller.rb</h3>
    <h4><span class="red">80.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class  Admin::ExternalLinksController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">      params.require(:external_link).permit(:name, :value, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="648e5c4d0989e6c032eedce17d88102c5da2660f">
  <div class="header">
    <h3>app/controllers/admin/general_selections_controller.rb</h3>
    <h4><span class="yellow">83.33 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::GeneralSelectionsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      GeneralSelection.item_types.map {|g| [g,g]}.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      :item_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def default_index_order      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      {updated_at: :desc}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="21">
          <span class="hits">13</span>
          
          <code class="ruby">      params.require(:general_selection).permit(:name, :value, :item_type, :disabled, :edit_if_set, :edit_always, :create_with, :position, :lock, :description)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ea37691e482710ed425a71883f30d210acee3c77">
  <div class="header">
    <h3>app/controllers/admin/item_flag_names_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ItemFlagNamesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="6">
          <span class="hits">11</span>
          
          <code class="ruby">      params.require(:item_flag_name).permit(:name, :item_type, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0ff7941ce0fd0dee700ea03ddcfee453665007bd">
  <div class="header">
    <h3>app/controllers/admin/manage_users_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ManageUsersController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  #before_action :before_update, only: [:update]    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">    if params[:gen_new_pw] == &quot;1&quot;      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      @user.force_password_reset </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      logger.info &quot;Force password reset&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      flash[:info] = &quot;New password #{@user.new_password}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="15">
          <span class="hits">7</span>
          
          <code class="ruby">    @user.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="16">
          <span class="hits">7</span>
          
          <code class="ruby">    if @user.update(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="17">
          <span class="hits">5</span>
          
          <code class="ruby">      @users = User.all</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="18">
          <span class="hits">5</span>
          
          <code class="ruby">      @updated_with = @user</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">      render partial: &#39;index&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">      logger.warn &quot;Error updating #{human_name}: #{object_instance.errors.inspect}&quot;      </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">      flash.now[:warning] = &quot;Error updating #{human_name}: #{error_message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">      edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="29">
          <span class="hits">5</span>
          
          <code class="ruby">    set_object_instance primary_model.new(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="30">
          <span class="hits">5</span>
          
          <code class="ruby">    object_instance.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="31">
          <span class="hits">5</span>
          
          <code class="ruby">    if object_instance.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="32">
          <span class="hits">3</span>
          
          <code class="ruby">      @users = User.all</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">      @updated_with = @user</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">      render partial: &#39;index&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">      logger.warn &quot;Error creating #{human_name}: #{object_instance.errors.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">      flash.now[:warning] = &quot;Error creating #{human_name}: #{error_message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="38">
          <span class="hits">2</span>
          
          <code class="ruby">      new use_current_object: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    def primary_model </code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="45">
          <span class="hits">16</span>
          
          <code class="ruby">      User  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_name </code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="48">
          <span class="hits">40</span>
          
          <code class="ruby">      @object_name = &#39;user&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    def objects_name </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="51">
          <span class="hits">2</span>
          
          <code class="ruby">      &#39;users&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    def human_name </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="54">
          <span class="hits">8</span>
          
          <code class="ruby">      &#39;user&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="61">
          <span class="hits">12</span>
          
          <code class="ruby">      params.require(:user).permit(:email, :disabled)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="006a7675b420114e09b93d83d709ddff5463b333">
  <div class="header">
    <h3>app/controllers/admin/reports_controller.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ReportsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  require &#39;csv&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def default_index_order</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      { updated_at: :desc }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      :item_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      Report.categories.map {|g| [g,g.to_s.humanize]}.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      params.require(:report).permit(:id, :name, :item_type, :primary_table, :sql, :description, :disabled, :report_type, :auto, :searchable, :position, :search_attrs, :edit_model, :edit_field_names, :selection_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2f6e71f03c590d5b8f2e7c05f11ecf0bf6462d74">
  <div class="header">
    <h3>app/controllers/admin/sage_assignments_controller.rb</h3>
    <h4><span class="red">26.67 %</span> covered</h4>
    <div>
      <b>30</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>22</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::SageAssignmentsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @sage_assignments = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    @assigned_count = SageAssignment.assigned.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    @unassigned_count = SageAssignment.unassigned.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    render &#39;admin_handler/index&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def show </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    if params[:id] == &#39;report&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      rep_type = params[:rep_type]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      r = Report.where(name: &quot;Sage #{rep_type}&quot;, disabled: false).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      unless r &amp;&amp; r.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">        flash[:alert] = &quot;No report named Sage Assignments is available&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">        redirect_to admin_sage_assignments_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      redirect_to report_path(r)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    @sage_assignment = SageAssignment.new </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    cc = secure_params[:create_count]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    if cc.blank? || cc.to_i &lt; 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      @sage_assignment = SageAssignment.new </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">      flash.now[:alert] = &quot;Number of IDs to create must be at least 1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      @sage_assignment.errors.add :create_count, &quot;must be at least 1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      render &#39;new&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    @sage_assignments = SageAssignment.generate_ids(current_admin, cc.to_i)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      params.require(:sage_assignment).permit(:create_count)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="28f91ce012cf6104acb568a8bd336f11a423530b">
  <div class="header">
    <h3>app/controllers/admin/user_authorizations_controller.rb</h3>
    <h4><span class="red">77.78 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::UserAuthorizationsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method  :has_authorization_options, :user_id_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      User.active.map {|u| [u.id.to_s, u.email] }.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      :user_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def has_authorization_options</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      UserAuthorization.authorizations.map {|m| [m.to_s.titleize, m]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def user_id_options</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      User.active.map {|u| [u.email, u.id]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def view_folder</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="25">
          <span class="hits">32</span>
          
          <code class="ruby">      &#39;admin/common_templates&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="29">
          <span class="hits">12</span>
          
          <code class="ruby">      @permitted_params = [:id, :has_authorization, :disabled, :user_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="33">
          <span class="hits">12</span>
          
          <code class="ruby">      params.require(object_name.to_sym).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="55b4535afd0f986bceb082a7fcf64377004f96c4">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4><span class="red">65.09 %</span> covered</h4>
    <div>
      <b>106</b> relevant lines. 
      <span class="green"><b>69</b> lines covered</span> and
      <span class="red"><b>37</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ControllerUtils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # Prevent CSRF attacks by raising an exception.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # For APIs, you may want to use :null_session instead.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  protect_from_forgery with: :exception</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :prevent_cache</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :setup_navs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from Exception, :with =&gt; :unhandled_exception_handler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from RuntimeError, :with =&gt; :runtime_error_handler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from ActiveRecord::RecordNotFound, :with =&gt; :runtime_record_not_found_handler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from ActionController::RoutingError, :with =&gt; :routing_error_handler </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from ActionController::InvalidAuthenticityToken, :with =&gt; :bad_auth_token</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from FphsException, :with =&gt; :fphs_app_exception_handler  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from PG::RaiseException, :with =&gt; :fphs_app_exception_handler  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def unhandled_exception_handler e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      respond_to do |type|        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;A unexpected error occurred. Contact the administrator if this condition persists. #{e.message}&quot;, :status =&gt; 500 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;A unexpected error occurred. Contact the administrator if this condition persists. #{e.message}&quot;}, :status =&gt; 500 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def fphs_app_exception_handler e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      respond_to do |type|        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;#{e.message}&quot;, :status =&gt; 400 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;#{e.message}&quot;}, :status =&gt; 500 }        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    def runtime_error_handler e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      respond_to do |type|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;A server error occurred. Contact the administrator if this condition persists. #{e.message}&quot;, :status =&gt; 500 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;A server error occurred. Contact the administrator if this condition persists.&quot;}, :status =&gt; 500 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">    def routing_error_handler  e</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="53">
          <span class="hits">9</span>
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="54">
          <span class="hits">9</span>
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="55">
          <span class="hits">9</span>
          
          <code class="ruby">      respond_to do |type|</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="56">
          <span class="hits">18</span>
          
          <code class="ruby">        type.html { render :text =&gt; &quot;The request URL does not exist.&quot;, :status =&gt; 404 }</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="57">
          <span class="hits">9</span>
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;The request URL does not exist.&quot;}, :status =&gt; 404 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="59">
          <span class="hits">9</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">    def bad_auth_token e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">      respond_to do |type|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;The information could not be submitted. Try returning to the home page to refresh the page.&quot;, :status =&gt; 401 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;The information could not be submitted. Try returning to the home page to refresh the page.&quot;}, :status =&gt; 401 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    def runtime_record_not_found_handler e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">      logger.error e.inspect </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">      logger.error e.backtrace.join(&quot;\n&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">      respond_to do |type|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">        type.html { render :text =&gt; &quot;A database record was not found. Contact the administrator if this condition persists. #{e.message}&quot;, :status =&gt; 404 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">        type.json  { render :json =&gt; {message: &quot;A database record was not found. Contact the administrator if this condition persists.&quot;}, :status =&gt; 404 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_cache</code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="83">
          <span class="hits">429</span>
          
          <code class="ruby">      response.headers[&quot;Cache-Control&quot;] = &quot;no-cache, no-store, max-age=0, must-revalidate&quot;</code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="84">
          <span class="hits">429</span>
          
          <code class="ruby">      response.headers[&quot;Pragma&quot;] = &quot;no-cache&quot;</code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="85">
          <span class="hits">429</span>
          
          <code class="ruby">      response.headers[&quot;Expires&quot;] = &quot;Fri, 01 Jan 1990 00:00:00 GMT&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      # Prevent access to any management page unless the user is an administrator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">    def check_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">      redirect_to &#39;/pages&#39; and return unless current_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">    def setup_navs</code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="94">
          <span class="hits">429</span>
          
          <code class="ruby">      @primary_navs = []</code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="95">
          <span class="hits">429</span>
          
          <code class="ruby">      @secondary_navs = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="97">
          <span class="hits">429</span>
          
          <code class="ruby">      admin_sub = []</code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="98">
          <span class="hits">429</span>
          
          <code class="ruby">      if current_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="151" data-linenumber="100">
          <span class="hits">151</span>
          
          <code class="ruby">        admin_sub &lt;&lt; {label: &#39;manage&#39;, url: &#39;/&#39;, route: &#39;#root&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="151" data-linenumber="102">
          <span class="hits">151</span>
          
          <code class="ruby">        admin_sub &lt;&lt; {label: &#39;password&#39;, url: &quot;/admins/edit&quot;}</code>
        </li>
      
        <li class="covered" data-hits="151" data-linenumber="103">
          <span class="hits">151</span>
          
          <code class="ruby">        admin_sub &lt;&lt; {label: &#39;logout_admin&#39;, url: &quot;/admins/sign_out&quot;, extras: {method: :delete}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="278" data-linenumber="106">
          <span class="hits">278</span>
          
          <code class="ruby">        admin_sub &lt;&lt; {label: &#39;Admin Login&#39;, url: &#39;/admins/sign_in&#39;, route: &#39;admins#sign_in&#39;, }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="109">
          <span class="hits">429</span>
          
          <code class="ruby">      if current_user </code>
        </li>
      
        <li class="covered" data-hits="121" data-linenumber="110">
          <span class="hits">121</span>
          
          <code class="ruby">        user_sub = []</code>
        </li>
      
        <li class="covered" data-hits="121" data-linenumber="111">
          <span class="hits">121</span>
          
          <code class="ruby">        user_sub &lt;&lt; {label: &#39;password&#39;, url: &quot;/users/edit&quot;}</code>
        </li>
      
        <li class="covered" data-hits="121" data-linenumber="112">
          <span class="hits">121</span>
          
          <code class="ruby">        user_sub &lt;&lt; {label: &#39;logout&#39;, url: &quot;/users/sign_out&quot;, extras: {method: :delete}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="114">
          <span class="hits">429</span>
          
          <code class="ruby">      if current_user  || current_admin</code>
        </li>
      
        <li class="covered" data-hits="259" data-linenumber="115">
          <span class="hits">259</span>
          
          <code class="ruby">        @secondary_navs &lt;&lt; {label: &#39;&lt;span class=&quot;glyphicon glyphicon-wrench&quot; title=&quot;administrator&quot;&gt;&lt;/span&gt;&#39;, url: &quot;#&quot;, sub: admin_sub, extras: {}}</code>
        </li>
      
        <li class="covered" data-hits="259" data-linenumber="116">
          <span class="hits">259</span>
          
          <code class="ruby">        @secondary_navs &lt;&lt; {label: &#39;&lt;span class=&quot;glyphicon glyphicon-user&quot; &gt;&lt;/span&gt;&#39;, url: &quot;#&quot;, sub: user_sub, extras: {title: current_email}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">      end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="120">
          <span class="hits">429</span>
          
          <code class="ruby">      if current_user</code>
        </li>
      
        <li class="covered" data-hits="121" data-linenumber="121">
          <span class="hits">121</span>
          
          <code class="ruby">        @primary_navs &lt;&lt; {label: &#39;Research&#39;, url: &#39;/masters/&#39;, route: &#39;masters#index&#39;}</code>
        </li>
      
        <li class="covered" data-hits="121" data-linenumber="122">
          <span class="hits">121</span>
          
          <code class="ruby">        @primary_navs &lt;&lt; {label: &#39;Create MSID&#39;, url: &#39;/masters/new&#39;, route: &#39;masters#new&#39;}  if current_user.can? :create_msid        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="126">
          <span class="hits">429</span>
          
          <code class="ruby">      if current_user || current_admin</code>
        </li>
      
        <li class="covered" data-hits="259" data-linenumber="127">
          <span class="hits">259</span>
          
          <code class="ruby">        @primary_navs &lt;&lt; {label: &#39;Reports&#39;, url: &#39;/reports&#39;, route: &#39;reports#index&#39;} if current_admin || current_user.can?(:view_reports)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="712" data-linenumber="130">
          <span class="hits">712</span>
          
          <code class="ruby">      res  = @primary_navs.select {|n| n[:route] == &quot;#{controller_name}##{action_name}&quot; }            </code>
        </li>
      
        <li class="covered" data-hits="429" data-linenumber="131">
          <span class="hits">429</span>
          
          <code class="ruby">      res.first[:active] = true if res &amp;&amp; res.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">    def current_email</code>
        </li>
      
        <li class="covered" data-hits="259" data-linenumber="136">
          <span class="hits">259</span>
          
          <code class="ruby">      return nil unless current_user || current_admin</code>
        </li>
      
        <li class="covered" data-hits="259" data-linenumber="137">
          <span class="hits">259</span>
          
          <code class="ruby">      (current_user || current_admin).email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">    def not_authorized</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">      flash[:danger] = &quot;You are not authorized to perform the requested action&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">      render text: flash[:danger], status: :unauthorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">    def not_found</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="146">
          <span class="hits">9</span>
          
          <code class="ruby">      flash[:danger] = &quot;Requested information not found&quot;</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="147">
          <span class="hits">9</span>
          
          <code class="ruby">      raise ActionController::RoutingError.new(&#39;Not Found&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">    def bad_request</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">      flash[:danger] = &quot;The request failed to validate&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">      render text: flash[:danger], status: 422</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">    def unexpected_error msg</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">      flash[:danger] = &quot;An error occurred: #{msg}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      render text: flash[:danger], status: 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">    def general_error msg, level=:info</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="161">
          
          
          <code class="ruby">      flash[level] = &quot;Error: #{msg}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="162">
          
          
          <code class="ruby">      render text: flash[level], status: 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">    def authenticate_user_or_admin!</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="166">
          <span class="hits">18</span>
          
          <code class="ruby">      if !current_user &amp;&amp; !current_admin</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="167">
          <span class="hits">11</span>
          
          <code class="ruby">        redirect_to new_user_session_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="169">
          <span class="hits">18</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0da0d90060a8f5b306b835750e0a3c780a5248ee">
  <div class="header">
    <h3>app/controllers/concerns/admin_controller_handler.rb</h3>
    <h4><span class="green">90.38 %</span> covered</h4>
    <div>
      <b>104</b> relevant lines. 
      <span class="green"><b>94</b> lines covered</span> and
      <span class="red"><b>10</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AdminControllerHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="6">
          <span class="hits">14</span>
          
          <code class="ruby">    before_action :authenticate_admin!</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="7">
          <span class="hits">14</span>
          
          <code class="ruby">    before_action :set_instance_from_id, only: [:edit, :update, :destroy]    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="9">
          <span class="hits">14</span>
          
          <code class="ruby">    after_action :do_log_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="11">
          <span class="hits">14</span>
          
          <code class="ruby">    helper_method :filters, :filters_on, :index_path, :index_params, :permitted_params, :objects_instance, :human_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def index    </code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="15">
          <span class="hits">50</span>
          
          <code class="ruby">    pm = primary_model    </code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="16">
          <span class="hits">50</span>
          
          <code class="ruby">    pm = pm.where filter_params if filter_params</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="17">
          <span class="hits">50</span>
          
          <code class="ruby">    set_objects_instance pm.order(default_index_order)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="18">
          <span class="hits">50</span>
          
          <code class="ruby">    response_to_index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def new options = {}</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="24">
          <span class="hits">30</span>
          
          <code class="ruby">    set_object_instance primary_model.new unless options[:use_current_object]</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="25">
          <span class="hits">30</span>
          
          <code class="ruby">    render partial: view_path(&#39;form&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="29">
          <span class="hits">27</span>
          
          <code class="ruby">    render partial: view_path(&#39;form&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="34">
          <span class="hits">49</span>
          
          <code class="ruby">    set_object_instance primary_model.new(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="35">
          <span class="hits">49</span>
          
          <code class="ruby">    object_instance.current_admin = current_admin        </code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="36">
          <span class="hits">49</span>
          
          <code class="ruby">    if object_instance.save    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      #redirect_to index_path, notice: &quot;#{human_name} created successfully&quot;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="38">
          <span class="hits">24</span>
          
          <code class="ruby">      @updated_with = object_instance      </code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="39">
          <span class="hits">24</span>
          
          <code class="ruby">      index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="41">
          <span class="hits">25</span>
          
          <code class="ruby">      logger.warn &quot;Error creating #{human_name}: #{object_instance.errors.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="42">
          <span class="hits">25</span>
          
          <code class="ruby">      flash.now[:warning] = &quot;Error creating #{human_name}: #{error_message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="43">
          <span class="hits">25</span>
          
          <code class="ruby">      new use_current_object: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="48">
          <span class="hits">40</span>
          
          <code class="ruby">    object_instance.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="49">
          <span class="hits">40</span>
          
          <code class="ruby">    if object_instance.update(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="50">
          <span class="hits">24</span>
          
          <code class="ruby">      flash.now[:notice] = &quot;#{human_name} updated successfully&quot;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="51">
          <span class="hits">24</span>
          
          <code class="ruby">      @updated_with = object_instance      </code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="52">
          <span class="hits">24</span>
          
          <code class="ruby">      index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="54">
          <span class="hits">16</span>
          
          <code class="ruby">      logger.warn &quot;Error updating #{human_name}: #{object_instance.errors.inspect}&quot;      </code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="55">
          <span class="hits">16</span>
          
          <code class="ruby">      flash.now[:warning] = &quot;Error updating #{human_name}: #{error_message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="56">
          <span class="hits">16</span>
          
          <code class="ruby">      edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">    def index_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">      permitted_params + [:admin_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">    def index_partial </code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="76">
          <span class="hits">48</span>
          
          <code class="ruby">      view = &#39;index&#39;</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="77">
          <span class="hits">48</span>
          
          <code class="ruby">      return view unless view_folder</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="78">
          <span class="hits">6</span>
          
          <code class="ruby">      [view_folder, view].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">    def view_path view            </code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="82">
          <span class="hits">75</span>
          
          <code class="ruby">      unless view_folder</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="83">
          <span class="hits">65</span>
          
          <code class="ruby">        return &#39;admin_handler/index&#39; if view == &#39;index&#39;</code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="84">
          <span class="hits">49</span>
          
          <code class="ruby">        return view </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="86">
          <span class="hits">10</span>
          
          <code class="ruby">        [view_folder, view].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    def view_folder</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    def response_to_index  </code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="95">
          <span class="hits">66</span>
          
          <code class="ruby">      respond_to do |format|      </code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="96">
          <span class="hits">66</span>
          
          <code class="ruby">        format.html { </code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="97">
          <span class="hits">66</span>
          
          <code class="ruby">          if @updated_with</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="98">
          <span class="hits">48</span>
          
          <code class="ruby">            render partial: index_partial</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="100">
          <span class="hits">18</span>
          
          <code class="ruby">            render view_path(&#39;index&#39;) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">          end        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="103">
          <span class="hits">66</span>
          
          <code class="ruby">        format.all { render json: objects_instance.as_json(except: [:created_at, :updated_at, :id, :admin_id, :user_id])}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">    def log_action action, sub, results, status=&quot;OK&quot;, extras={}</code>
        </li>
      
        <li class="covered" data-hits="137" data-linenumber="108">
          <span class="hits">137</span>
          
          <code class="ruby">      extras[:master_id] ||= nil</code>
        </li>
      
        <li class="covered" data-hits="137" data-linenumber="109">
          <span class="hits">137</span>
          
          <code class="ruby">      extras[:msid] ||= nil</code>
        </li>
      
        <li class="covered" data-hits="137" data-linenumber="110">
          <span class="hits">137</span>
          
          <code class="ruby">      current_admin.log_action action, sub, results, request.method_symbol, params, status, extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">    def do_log_action</code>
        </li>
      
        <li class="covered" data-hits="137" data-linenumber="115">
          <span class="hits">137</span>
          
          <code class="ruby">      len = (@master_objects ? @master_objects.length : 0)</code>
        </li>
      
        <li class="covered" data-hits="137" data-linenumber="116">
          <span class="hits">137</span>
          
          <code class="ruby">      log_action &quot;#{controller_name}##{action_name}&quot;, &quot;AUTO&quot;, len</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">    def primary_model </code>
        </li>
      
        <li class="covered" data-hits="151" data-linenumber="120">
          <span class="hits">151</span>
          
          <code class="ruby">      controller_name.classify.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_name </code>
        </li>
      
        <li class="covered" data-hits="483" data-linenumber="123">
          <span class="hits">483</span>
          
          <code class="ruby">      controller_name.singularize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">    def objects_name </code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="126">
          <span class="hits">48</span>
          
          <code class="ruby">      controller_name.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">    def human_name </code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="129">
          <span class="hits">106</span>
          
          <code class="ruby">      controller_name.singularize.humanize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">    def default_index_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">    def filter_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">    def error_message</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="144">
          <span class="hits">45</span>
          
          <code class="ruby">      res = &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="145">
          <span class="hits">45</span>
          
          <code class="ruby">      object_instance.errors.full_messages.each do |message|</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="146">
          <span class="hits">61</span>
          
          <code class="ruby">        res &lt;&lt; &quot;; &quot; unless res.blank?</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="147">
          <span class="hits">61</span>
          
          <code class="ruby">        res &lt;&lt; &quot;#{message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="149">
          <span class="hits">45</span>
          
          <code class="ruby">      res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">    def index_path opt={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">      redir = {controller: controller_name, action: :index}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">      redir.merge! @parent_param if @parent_param</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">      redir.merge! opt</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      f = filter_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">      redir[:filter] ||= f if f</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby">      url_for(redir)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_instance_from_id</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="164">
          <span class="hits">56</span>
          
          <code class="ruby">      return if params[:id] == &#39;cancel&#39;</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="165">
          <span class="hits">56</span>
          
          <code class="ruby">      set_object_instance primary_model.find(params[:id])            </code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="166">
          <span class="hits">56</span>
          
          <code class="ruby">      @id = object_instance.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_object_instance o</code>
        </li>
      
        <li class="covered" data-hits="117" data-linenumber="170">
          <span class="hits">117</span>
          
          <code class="ruby">      instance_variable_set(&quot;@#{object_name}&quot;, o)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_objects_instance o</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="174">
          <span class="hits">50</span>
          
          <code class="ruby">      instance_variable_set(&quot;@#{objects_name}&quot;, o)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    # This is not used: def object_instance=(o)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">    # ... since it requires self. prefix to make it work in controller, and is </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    # therefore more confusing than helpful</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_instance</code>
        </li>
      
        <li class="covered" data-hits="382" data-linenumber="182">
          <span class="hits">382</span>
          
          <code class="ruby">      instance_variable_get(&quot;@#{object_name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">    def objects_instance</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">      instance_variable_get(&quot;@#{objects_name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">    def filter_params</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="190">
          <span class="hits">50</span>
          
          <code class="ruby">      return nil if params[:filter].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">      params.require(:filter).permit(filters_on)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2e640a64f36fe309b76a01ce56bd0a4c096ea54e">
  <div class="header">
    <h3>app/controllers/concerns/controller_utils.rb</h3>
    <h4><span class="yellow">82.61 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ControllerUtils</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def log_action action, sub, results, status=&quot;OK&quot;, extras={}</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="6">
          <span class="hits">97</span>
          
          <code class="ruby">    extras[:master_id] ||= nil</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="7">
          <span class="hits">97</span>
          
          <code class="ruby">    extras[:msid] ||= nil</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="8">
          <span class="hits">97</span>
          
          <code class="ruby">    current_user.log_action action, sub, results, request.method_symbol, params, status, extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def params_nil_if_blank p</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="12">
          <span class="hits">26</span>
          
          <code class="ruby">    p1 = p.dup</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="13">
          <span class="hits">26</span>
          
          <code class="ruby">    p.each do |k,v|     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="15">
          <span class="hits">76</span>
          
          <code class="ruby">      if v.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="16">
          <span class="hits">12</span>
          
          <code class="ruby">        p1[k] = params_nil_if_blank v </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      elsif v.is_a? Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">        va = v.reject {|v1| v1.blank?}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">        va = nil if va.length == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">        p1[k] = va</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      elsif v.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">        p1[k] = nil        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="26">
          <span class="hits">26</span>
          
          <code class="ruby">    p1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def params_downcase p</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="30">
          <span class="hits">26</span>
          
          <code class="ruby">    p1 = p.dup</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="31">
          <span class="hits">26</span>
          
          <code class="ruby">    p.each do |k,v|           </code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="32">
          <span class="hits">76</span>
          
          <code class="ruby">      if v.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="33">
          <span class="hits">12</span>
          
          <code class="ruby">        p1[k] = params_downcase v </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      elsif v.is_a?(String) &amp;&amp; !v.blank?</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="35">
          <span class="hits">52</span>
          
          <code class="ruby">        p1[k] = v.downcase        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="39">
          <span class="hits">26</span>
          
          <code class="ruby">    p1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f346528597f0126f80e5ea649bdd0269ad38d059">
  <div class="header">
    <h3>app/controllers/concerns/master_handler.rb</h3>
    <h4><span class="green">92.13 %</span> covered</h4>
    <div>
      <b>89</b> relevant lines. 
      <span class="green"><b>82</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MasterHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  UseMasterParam = %w(new create index) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="7">
          <span class="hits">7</span>
          
          <code class="ruby">    before_action :authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">    before_action :set_me_and_master, only: [:index, :new, :edit, :create, :update, :destroy]</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="9">
          <span class="hits">7</span>
          
          <code class="ruby">    before_action :set_instance_from_id, only: [:show]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="11">
          <span class="hits">7</span>
          
          <code class="ruby">    after_action :do_log_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="13">
          <span class="hits">7</span>
          
          <code class="ruby">    helper_method :primary_model, :permitted_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def do_log_action</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="17">
          <span class="hits">91</span>
          
          <code class="ruby">    len = (@master_objects ? @master_objects.length : 0)</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="18">
          <span class="hits">91</span>
          
          <code class="ruby">    extras = {}</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="19">
          <span class="hits">91</span>
          
          <code class="ruby">    if @master</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="20">
          <span class="hits">85</span>
          
          <code class="ruby">      extras[:master_id] = @master.id </code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="21">
          <span class="hits">85</span>
          
          <code class="ruby">      extras[:msid] = @master.msid     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="23">
          <span class="hits">6</span>
          
          <code class="ruby">      extras[:master_id] = nil</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="24">
          <span class="hits">6</span>
          
          <code class="ruby">      extras[:msid] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="26">
          <span class="hits">91</span>
          
          <code class="ruby">    log_action &quot;#{controller_name}##{action_name}&quot;, &quot;AUTO&quot;, len, &quot;OK&quot;, extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def primary_model </code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="30">
          <span class="hits">36</span>
          
          <code class="ruby">    controller_name.classify.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def object_name </code>
        </li>
      
        <li class="covered" data-hits="367" data-linenumber="33">
          <span class="hits">367</span>
          
          <code class="ruby">    controller_name.singularize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def objects_name </code>
        </li>
      
        <li class="covered" data-hits="133" data-linenumber="36">
          <span class="hits">133</span>
          
          <code class="ruby">    controller_name.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def human_name </code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="39">
          <span class="hits">34</span>
          
          <code class="ruby">    controller_name.singularize.humanize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="43">
          <span class="hits">12</span>
          
          <code class="ruby">    set_objects_instance @master_objects</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="44">
          <span class="hits">12</span>
          
          <code class="ruby">    s = {objects_name =&gt; @master_objects.as_json, multiple_results: objects_name}</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="45">
          <span class="hits">12</span>
          
          <code class="ruby">    if object_instance</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">      s[:original_item] = object_instance</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">      s[objects_name] &lt;&lt;  object_instance</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="49">
          <span class="hits">12</span>
          
          <code class="ruby">    s[:master_id] = @master.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="51">
          <span class="hits">12</span>
          
          <code class="ruby">    logger.debug &quot;List: #{s} with objects_instance @#{objects_name}&quot;</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="52">
          <span class="hits">12</span>
          
          <code class="ruby">    render json: s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="56">
          <span class="hits">35</span>
          
          <code class="ruby">    p = {object_name =&gt; object_instance.as_json}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="58">
          <span class="hits">35</span>
          
          <code class="ruby">    logger.debug &quot;p: #{p} for object_instance&quot;</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="59">
          <span class="hits">35</span>
          
          <code class="ruby">    render json: p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="63">
          <span class="hits">5</span>
          
          <code class="ruby">    set_object_instance @master_objects.build</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="64">
          <span class="hits">5</span>
          
          <code class="ruby">    render partial: edit_form</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="68">
          <span class="hits">4</span>
          
          <code class="ruby">    render partial: edit_form</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="73">
          <span class="hits">38</span>
          
          <code class="ruby">    set_object_instance @master_objects.build(secure_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="75">
          <span class="hits">38</span>
          
          <code class="ruby">    if object_instance.save</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="76">
          <span class="hits">15</span>
          
          <code class="ruby">      if object_instance.has_multiple_results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">        @master_objects = object_instance.multiple_results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">        index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="80">
          <span class="hits">15</span>
          
          <code class="ruby">        show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="83">
          <span class="hits">23</span>
          
          <code class="ruby">      logger.warn &quot;Error creating #{human_name}: #{object_instance.errors.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="84">
          <span class="hits">23</span>
          
          <code class="ruby">      render json: object_instance.errors, status: :unprocessable_entity     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="89">
          <span class="hits">25</span>
          
          <code class="ruby">    if object_instance.update(secure_params)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="90">
          <span class="hits">14</span>
          
          <code class="ruby">      if object_instance.has_multiple_results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">        @master_objects = object_instance.multiple_results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">        index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="94">
          <span class="hits">14</span>
          
          <code class="ruby">        show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="98">
          <span class="hits">11</span>
          
          <code class="ruby">      logger.warn &quot;Error updating #{human_name}: #{object_instance.errors.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="99">
          <span class="hits">11</span>
          
          <code class="ruby">      render json: object_instance.errors, status: :unprocessable_entity </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">  def flags</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">    def edit_form</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">      &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_me_and_master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      # Generically retrieve the current object referenced by parameter :id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      # Store it into the @singlular_name instance variable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">      # This is the equivalent of e.g.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">      # @player_info  = PlayerInfo.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">      # This allows for us to retrieve the @master consistently, so that the master association</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">      # is not used repetitively (potentially breaking the current_user functionality and poor performance)</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="130">
          <span class="hits">85</span>
          
          <code class="ruby">      if UseMasterParam.include? action_name </code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="131">
          <span class="hits">55</span>
          
          <code class="ruby">        @master = Master.find(params[:master_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="133">
          <span class="hits">30</span>
          
          <code class="ruby">        object = primary_model.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="134">
          <span class="hits">30</span>
          
          <code class="ruby">        set_object_instance object</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="135">
          <span class="hits">30</span>
          
          <code class="ruby">        @master = object.master</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="136">
          <span class="hits">30</span>
          
          <code class="ruby">        @id = object.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      # Get the list of objects related to the master, in other words triggering the association</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">      # off of the master object</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="141">
          <span class="hits">85</span>
          
          <code class="ruby">      @master_objects = @master.send(objects_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="143">
          <span class="hits">85</span>
          
          <code class="ruby">      @master.current_user = current_user  </code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="144">
          <span class="hits">85</span>
          
          <code class="ruby">      @master.current_admin = current_admin</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="145">
          <span class="hits">85</span>
          
          <code class="ruby">      @master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_instance_from_id</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="151">
          <span class="hits">6</span>
          
          <code class="ruby">      return if params[:id] == &#39;cancel&#39;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="152">
          <span class="hits">6</span>
          
          <code class="ruby">      set_object_instance primary_model.find(params[:id])            </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="153">
          <span class="hits">6</span>
          
          <code class="ruby">      @id = object_instance.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_object_instance o</code>
        </li>
      
        <li class="covered" data-hits="79" data-linenumber="158">
          <span class="hits">79</span>
          
          <code class="ruby">      instance_variable_set(&quot;@#{object_name}&quot;, o)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_objects_instance o</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="162">
          <span class="hits">12</span>
          
          <code class="ruby">      instance_variable_set(&quot;@#{objects_name}&quot;, o)  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    # This is not used: def object_instance=(o)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    # ... since it requires self. prefix to make it work in controller, and is </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    # therefore more confusing than helpful</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">    def object_instance</code>
        </li>
      
        <li class="covered" data-hits="217" data-linenumber="170">
          <span class="hits">217</span>
          
          <code class="ruby">      instance_variable_get(&quot;@#{object_name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="660d3b1876fb736fc90c6aeef3dde478897a7f0c">
  <div class="header">
    <h3>app/controllers/concerns/master_search.rb</h3>
    <h4><span class="red">52.24 %</span> covered</h4>
    <div>
      <b>67</b> relevant lines. 
      <span class="green"><b>35</b> lines covered</span> and
      <span class="red"><b>32</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MasterSearch</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def run search_type</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="9">
          <span class="hits">6</span>
          
          <code class="ruby">    msid = nil</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">      if search_type == &#39;MSID&#39;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="13">
          <span class="hits">6</span>
          
          <code class="ruby">        if !params[:master][:msid].blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="14">
          <span class="hits">2</span>
          
          <code class="ruby">          msid = params[:master][:msid].to_s </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="15">
          <span class="hits">2</span>
          
          <code class="ruby">          msid = msid.split(/[,| ]/) if msid.index(/[,| ]/)        </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="16">
          <span class="hits">2</span>
          
          <code class="ruby">          @masters = Master.where msid: msid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">        elsif !params[:master][:pro_id].blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="18">
          <span class="hits">2</span>
          
          <code class="ruby">          proid = params[:master][:pro_id].to_s</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">          proid = proid.split(/[,| ]/) if proid.index(/[,| ]/)        </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">          @masters = Master.where pro_id: proid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        elsif !params[:master][:id].blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">          id = params[:master][:id].to_s </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">          id = id.split(/[,| ]/) if id.index(/[,| ]/)        </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">          @masters = Master.where id: id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      elsif search_type == &#39;SIMPLE&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        @masters = Master.search_on_params search_params[:master]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      elsif search_type == &#39;REPORT&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">        search_type = &quot;REPORT: #{@report.name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">        m_field = @report.field_index(&#39;master_id&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">        render text: &quot;query must return a master_id field to function as a search&quot; and return  unless m_field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        ids = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        @results.each_row {|r| ids &lt;&lt; r[m_field]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        #If the msid is an array of items then return the results in the order of the list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">        @masters = Master.where &quot;id in(?)&quot;, ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        @masters = Master.search_on_params search_params[:master]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="50">
          <span class="hits">6</span>
          
          <code class="ruby">      if @masters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        #If the msid is an array of items then return the results in the order of the list</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="53">
          <span class="hits">6</span>
          
          <code class="ruby">        if msid.is_a? Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">          i = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">          #@masters = @masters.take(ResultsLimit)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">          msid.each do |d|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">            m1 = @masters.select {|n| n.msid.to_s == d}.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">            m1.force_order = i if m1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">            i += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">          @masters = @masters.sort {|m,n| m.force_order &lt;=&gt; n.force_order}              </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="65">
          <span class="hits">6</span>
          
          <code class="ruby">        original_length = @masters.length</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="66">
          <span class="hits">6</span>
          
          <code class="ruby">        @masters = @masters[0, return_results_limit]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="68">
          <span class="hits">6</span>
          
          <code class="ruby">        m = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">          masters: @masters.as_json(include: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">            player_infos: {order: Master::PlayerInfoRankOrderClause, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">              include: {              </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">                item_flags: {include: [:item_flag_name], methods: [:method_id, :item_type_us]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">              },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">              methods: [:user_name, :accuracy_score_name, :rank_name, :source_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            pro_infos: {}, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            player_contacts: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">              order: {rank: :desc},             </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">              methods: [:user_name, :rank_name, :source_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">            addresses: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">              order: {rank: :desc},             </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">              methods: [:user_name, :rank_name, :state_name, :country_name, :source_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">#           Loading trackers dynamically provides a significant speed up, and this may become more important as the tracker usage grows</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">#           trackers: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">#              order: &quot;protocol.position #{Master::TrackerEventOrderClause}&quot;,                </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">#              methods: [:protocol_name, :protocol_position, :sub_process_name, :event_name, :tracker_history_length, :user_name, :record_type_us, :record_type, :record_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">#            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">            latest_tracker_history: {            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">              methods: [:protocol_name, :protocol_position, :sub_process_name, :event_name, :user_name, :record_type_us, :record_type, :record_id, :event_description, :event_milestone]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">#            scantrons: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">#              order: {scantron_id: :asc},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">#              methods: [:user_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">#            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">#            sage_assignments: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">#              order: {sage_id: :asc},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">#              methods: [:user_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">#            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">          }) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="105">
          <span class="hits">6</span>
          
          <code class="ruby">        m[:count] = {count: original_length,  show_count: @masters.length}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="107">
          <span class="hits">6</span>
          
          <code class="ruby">        log_action &quot;master search&quot;, search_type, @masters.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">        # Return no results      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">        m = {message: &quot;no conditions were specified&quot;, masters: [], count: {count: 0, show_count: 0} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">        log_action &quot;master search&quot;, search_type, 0, &quot;no conditions specified&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">      logger.error &quot;Error in MastersController#index: #{e.inspect}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">      m = {error: &quot;: unable to search - please check your search criteria.&quot;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">      render json: m, status: 400</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="120">
          <span class="hits">6</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="121">
          <span class="hits">6</span>
          
          <code class="ruby">      format.json {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">        # This is standard, not an export</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="123">
          <span class="hits">6</span>
          
          <code class="ruby">        render json: m        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="125">
          <span class="hits">6</span>
          
          <code class="ruby">      format.csv {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">        return not_authorized unless current_user.can? :export_csv</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">        ma = m[:masters].first </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">        #return bad_request unless ma</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">        unless ma</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">          flash[:warning] = &quot;no results to export&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">          redirect_to(&quot;/masters/&quot;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">          return </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">        res = [(ma.map {|k,v| k} + (ma[&#39;player_infos&#39;].first ||{}).map {|k,v| &quot;player.#{k}&quot;} +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">              (ma[&#39;pro_infos&#39;].first ||{}).map {|k,v| &quot;pro.#{k}&quot;}).to_csv]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">        m[:masters].each do |ma| </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">          res &lt;&lt; (ma.map {|k,v| v.is_a?(Hash) || v.is_a?(Array) ? &#39;&#39; : v }   +  (ma[&#39;player_infos&#39;].first || {}).map {|k,v| v} +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">              (ma[&#39;pro_infos&#39;].first || {}).map {|k,v| v}).to_csv </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">        send_data res.join(&quot;&quot;), filename: &quot;report.csv&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">    def return_results_limit</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="155">
          <span class="hits">6</span>
          
          <code class="ruby">      e = 0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="156">
          <span class="hits">6</span>
          
          <code class="ruby">      r = params[:res_limit]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="157">
          <span class="hits">6</span>
          
          <code class="ruby">      e = r.to_i unless r.blank?    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="158">
          <span class="hits">6</span>
          
          <code class="ruby">      e = 100 if e == 0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="159">
          <span class="hits">6</span>
          
          <code class="ruby">      @return_results_limit = e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="aaae36fdeb5a870ad47eeaec03fbc6fb2a9c9951">
  <div class="header">
    <h3>app/controllers/definitions_controller.rb</h3>
    <h4><span class="yellow">90.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class DefinitionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user_or_admin!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  Available = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    &quot;protocol_events&quot; =&gt; :selector_collection, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    &quot;protocols&quot; =&gt; :selector_collection, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    &quot;sub_processes&quot; =&gt; :selector_collection, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    &quot;colleges&quot; =&gt; :selector_array, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    &quot;accuracy_scores&quot; =&gt; :selector_collection,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    &quot;external_links&quot; =&gt; :selector_collection,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    &quot;users&quot; =&gt; :active_id_name_list,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    &quot;general_selections&quot; =&gt; :selector_collection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  }.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="17">
          <span class="hits">5</span>
          
          <code class="ruby">    def_type = params[:id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">    item_selector = available def_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # We will return a 404 if either the def_type requested by a user is nil, or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # the def_type does not appear in the Available list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # This protects against insecure requests</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="23">
          <span class="hits">5</span>
          
          <code class="ruby">    return not_found unless item_selector</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    item = @def_class.classify.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    j = item.send(item_selector, @filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    render json: j</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    # This both looks up the selector method to use, and protects against insecure </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # user-generated requests to access unexpected methods and classes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def available def_type</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="40">
          <span class="hits">5</span>
          
          <code class="ruby">      return nil unless def_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="42">
          <span class="hits">5</span>
          
          <code class="ruby">      def_type_split = def_type.split(&#39;-&#39;)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="43">
          <span class="hits">5</span>
          
          <code class="ruby">      filter = def_type_split[1]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="44">
          <span class="hits">5</span>
          
          <code class="ruby">      if filter</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">        fs = filter.split(&#39;+&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">        @filter = {fs.first =&gt; fs.last}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="48">
          <span class="hits">5</span>
          
          <code class="ruby">      @def_class = def_type_split.first</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="49">
          <span class="hits">5</span>
          
          <code class="ruby">      Available[@def_class]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9eea0d0cee816b2707a5e74ac18342d455e24e84">
  <div class="header">
    <h3>app/controllers/item_flags_controller.rb</h3>
    <h4><span class="green">97.78 %</span> covered</h4>
    <div>
      <b>45</b> relevant lines. 
      <span class="green"><b>44</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ItemFlagsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_parent_item</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_item, only: [:show]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="9">
          <span class="hits">6</span>
          
          <code class="ruby">    @item_flags = @item.item_flags</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">    s = @item_flags.as_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">    k = &quot;item_flags&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">    res = {item_flags: s, item_id: @item.id, item_type: @item_type.singularize, item_types_name: @item_type, master_id: @master.id, update_action: @update_action}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="16">
          <span class="hits">6</span>
          
          <code class="ruby">    render json: {k =&gt; res}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="20">
          <span class="hits">4</span>
          
          <code class="ruby">    index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    @item_flag = @item.item_flags.build</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="30">
          <span class="hits">12</span>
          
          <code class="ruby">    flag_list = secure_params[:item_flag_name_id].select {|f| !f.blank?}.map {|f| f.to_i}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="32">
          <span class="hits">4</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="33">
          <span class="hits">4</span>
          
          <code class="ruby">      @update_action = ItemFlag.set_flags flag_list, @item, current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    rescue ActiveRecord::RecordInvalid =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      logger.warn &quot;Bad request in create item flags: #{e.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      @item_flags = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      return bad_request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="40">
          <span class="hits">3</span>
          
          <code class="ruby">    show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_item</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      return if params[:id] == &#39;cancel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">      @item_flag = @item.item_flags.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      @id = @item_flag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_parent_item</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="52">
          <span class="hits">13</span>
          
          <code class="ruby">      @item_type = item_controller = params[:item_controller]      </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="53">
          <span class="hits">13</span>
          
          <code class="ruby">      item_class_name = item_controller.singularize.camelize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      # We will return a 404 if the requested item_class_name is not one of the valid set.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      # This prevents insecure requests from the user being used to access objects below</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="57">
          <span class="hits">13</span>
          
          <code class="ruby">      icn = ItemFlag.works_with item_class_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="59">
          <span class="hits">13</span>
          
          <code class="ruby">      return not_found unless icn</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="61">
          <span class="hits">8</span>
          
          <code class="ruby">      if defined? icn.constantize</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="62">
          <span class="hits">8</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="63">
          <span class="hits">8</span>
          
          <code class="ruby">          item_class = icn.constantize </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        rescue          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">          item_class = &quot;DynamicModel::#{icn}&quot;.constantize rescue nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="69">
          <span class="hits">8</span>
          
          <code class="ruby">      raise &quot;Failed to get #{item_class_name}&quot; unless item_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="71">
          <span class="hits">8</span>
          
          <code class="ruby">      @item = item_class.find(params[:item_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="73">
          <span class="hits">8</span>
          
          <code class="ruby">      raise &quot;Failed to get @item for #{item_class_name}&quot; unless @item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="75">
          <span class="hits">8</span>
          
          <code class="ruby">      @master = @item.master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="77">
          <span class="hits">8</span>
          
          <code class="ruby">      raise &quot;Failed to get @master for #{@item.inspect}&quot; unless @master</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="78">
          <span class="hits">8</span>
          
          <code class="ruby">      @master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="82">
          <span class="hits">4</span>
          
          <code class="ruby">      params.require(:item_flag).permit(item_flag_name_id: [])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b3aa97caf735069b9b5381a36067c9b21615eb02">
  <div class="header">
    <h3>app/controllers/masters_controller.rb</h3>
    <h4><span class="red">53.7 %</span> covered</h4>
    <div>
      <b>54</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>25</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class MastersController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authorized?, only: [:new, :create]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterSearch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  ResultsLimit = Master.results_limit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    #search_params</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="12">
          <span class="hits">7</span>
          
          <code class="ruby">    redirect_to &#39;/masters/search/&#39; and return if search_params.nil? || search_params.length == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">    search_type = params[:mode] </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="15">
          <span class="hits">6</span>
          
          <code class="ruby">    search_type = &#39;ADVANCED&#39; if search_type.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="18">
          <span class="hits">6</span>
          
          <code class="ruby">    run search_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    if params[:type] == &#39;msid&#39; &amp;&amp; params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      @master = Master.find_by_msid(params[:id]) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      return not_found unless @master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      @msid = @master.msid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    elsif params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      @master = Master.find(params[:id]) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      return not_found unless @master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      @master_id = @master.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    search</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def search</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    @msid ||= params[:nav_q]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    @master_pro_id ||= params[:nav_q_pro_id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    @master_id ||= params[:nav_q_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    @master_req_format = params[:req_format] || &#39;reg&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    @master =  Master.new </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    # Advanced search fields</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">    @master.pro_infos.build</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    @master.player_infos.build</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">    @master.addresses.build</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    @master.player_contacts.build</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    @master.trackers.build</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    @master.tracker_histories.build</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">    @master.scantrons.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    #@master.sage_assignments.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    # NOT conditions</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    @master.not_trackers.build</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">    @master.not_tracker_histories.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    # Simple search fields</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">    @master.general_infos.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    render :search</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    @master = Master.new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    # Unfortunately there is no easy way to force the create request to fail for the purposes of testing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    # Therefore we provide a way to force an apparent failure in the test environment.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    # This is necessary in order to allow testing of what appears to be a false positive for this action in Brakeman</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="77">
          <span class="hits">3</span>
          
          <code class="ruby">    @master = Master.create_master_records current_user unless Rails.env.test? &amp;&amp; params[:testfail] == &#39;testfail&#39;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">    if @master &amp;&amp; @master.id</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="79">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to @master, notice:  &quot;Created Master Record with MSID #{@master.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to new_master_url, notice: &quot;Error creating Master Record: #{Application.record_error_message @master}&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">  def search_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="89">
          <span class="hits">14</span>
          
          <code class="ruby">    p = params_nil_if_blank params</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="90">
          <span class="hits">14</span>
          
          <code class="ruby">    p = params_downcase p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">    #p = p.permit(:master_id, player_info_attributes: [:first_name, :middle_name, :last_name, :nick_name, :birth_date, :death_date, :start_year], player_contacts_attributes: [], pro_info_attributes: [], address_attributes: [], manual_investigation_attributes: [])</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="92">
          <span class="hits">14</span>
          
          <code class="ruby">    p = p.except(:utf8, :controller, :action).permit!</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="93">
          <span class="hits">14</span>
          
          <code class="ruby">    logger.debug &quot;Screened params: #{p.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="94">
          <span class="hits">14</span>
          
          <code class="ruby">    p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def authorized?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="98">
          <span class="hits">4</span>
          
          <code class="ruby">    return true if current_user.can? :create_msid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">    return not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d9a34e0c1950a7be87bdcf206916e5f9adfd2358">
  <div class="header">
    <h3>app/controllers/pages_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PagesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user_or_admin!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="4">
          <span class="hits">2</span>
          
          <code class="ruby">    if current_user &amp;&amp; ! current_admin</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to :masters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ca7505c027580ff6348a91237350aed052da100a">
  <div class="header">
    <h3>app/controllers/player_contacts_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PlayerContactsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def edit_form</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">      &#39;common_templates/edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"> </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="12">
          <span class="hits">13</span>
          
          <code class="ruby">      @permitted_params = [:master_id, :rec_type, :data, :source, :rank]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="17">
          <span class="hits">13</span>
          
          <code class="ruby">      params.require(object_name.to_sym).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4518e3cba77f87829e779a83d4033e138d48bc30">
  <div class="header">
    <h3>app/controllers/player_infos_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PlayerInfosController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def edit_form</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">      &#39;common_templates/edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="10">
          <span class="hits">12</span>
          
          <code class="ruby">      [:master_id, :first_name, :last_name, :middle_name, :nick_name, :birth_date, :death_date, :start_year, :end_year, :college, :source, :rank, :notes]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="15">
          <span class="hits">12</span>
          
          <code class="ruby">      params.require(object_name.to_sym).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="33d6e5f79ad1f82b44d7bbcd10144c5f8b306a35">
  <div class="header">
    <h3>app/controllers/pro_infos_controller.rb</h3>
    <h4><span class="red">60.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProInfosController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      params.require(:pro_info).permit(:master_id, :user_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="cd6115050568898166a7e43e5b766c188f2176e8">
  <div class="header">
    <h3>app/controllers/protocol_events_controller.rb</h3>
    <h4><span class="yellow">87.5 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>28</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProtocolEventsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_protocol, only: [:index, :new, :show, :edit]    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_protocol_for_edit, only: [:create, :update]    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="7">
          <span class="hits">8</span>
          
          <code class="ruby">    if params[:all]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      @protocol_events = ProtocolEvent.all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      @sub_process_name = &quot;All Sub Processes&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="11">
          <span class="hits">8</span>
          
          <code class="ruby">      @protocol_events = @sub_process.protocol_events</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="12">
          <span class="hits">8</span>
          
          <code class="ruby">      @sub_process_name = @sub_process.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">    response_to_index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def new options = {}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="18">
          <span class="hits">3</span>
          
          <code class="ruby">    @protocol_event = @sub_process.protocol_events.build unless options[:use_current_object]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">    render partial: &#39;form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_protocol</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="26">
          <span class="hits">4</span>
          
          <code class="ruby">      return if params[:all]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="28">
          <span class="hits">4</span>
          
          <code class="ruby">      if @protocol_event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">        @protocol = @protocol_event.protocol</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        @sub_process = @protocol_event.sub_process      </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="31">
          <span class="hits">3</span>
          
          <code class="ruby">      elsif params[:protocol_id].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">        @protocol = Protocol.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">        @sub_process = SubProcess.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="35">
          <span class="hits">3</span>
          
          <code class="ruby">        @protocol = Protocol.find(params[:protocol_id])      </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">        @sub_process = SubProcess.find(params[:sub_process_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_protocol_for_edit</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="41">
          <span class="hits">10</span>
          
          <code class="ruby">      @sub_process = SubProcess.find(secure_params[:sub_process_id])</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="42">
          <span class="hits">10</span>
          
          <code class="ruby">      @protocol = @sub_process.protocol</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="43">
          <span class="hits">10</span>
          
          <code class="ruby">      @parent_param = {protocol_id: @protocol.id, sub_process_id: @sub_process.id} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="48">
          <span class="hits">20</span>
          
          <code class="ruby">      params.require(:protocol_event).permit(:name, :sub_process_id, :disabled, :milestone, :description)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8a9725a1348ff49307971e07cddf71ff6c396411">
  <div class="header">
    <h3>app/controllers/protocols_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProtocolsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="7">
          <span class="hits">10</span>
          
          <code class="ruby">      params.require(:protocol).permit(:name, :disabled, :position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="66828b54bb61fb1b5b1539d2fdf810fc5843fcc5">
  <div class="header">
    <h3>app/controllers/reports_controller.rb</h3>
    <h4><span class="red">21.32 %</span> covered</h4>
    <div>
      <b>136</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>107</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ReportsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterSearch</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  require &#39;csv&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user_or_admin!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authorized?, only: [:index]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_editable_instance_from_id, only: [:edit, :update]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  after_action :clear_results, only: [:show, :run]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  after_action :do_log_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method :filters, :filters_on, :index_path, :permitted_params</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  ResultsLimit = Master.results_limit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # List of available reports</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def index    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    @no_create = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    pm = Report.enabled    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    pm = pm.where filter_params if filter_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    @reports = pm.order  auto: :desc, report_type: :asc, position: :asc </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    respond_to do |format|      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      format.html { render :index }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      format.all { render json: @reports.as_json(except: [:created_at, :updated_at, :id, :admin_id, :user_id])}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    id = params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    redirect_to :index if id.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    id = id.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    redirect_to :index unless id &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    search_attrs = params[:search_attrs]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    @report = Report.find(id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    options = {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    @report.current_user = current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    if params[:commit] == &#39;count&#39;    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      options[:count_only] = true </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      @count_only = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    if search_attrs &amp;&amp; search_attrs.is_a?(Hash) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      options[:filter_previous] = true if search_attrs[:_filter_previous_]==&#39;true&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      no_run = !search_attrs[:no_run].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    @editable = @report.editable_data? &amp;&amp; (current_admin || current_user.can?(:edit_report_data))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    return unless @report.searchable || authorized?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">    if search_attrs &amp;&amp; !no_run</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">      begin        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">        @results =  @report.run(search_attrs, options) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      rescue ActiveRecord::PreparedStatementInvalid =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">        logger.info &quot;Prepared statement invalid in reports_controller (#{search_attrs}) show: #{e.inspect}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        @results = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">        flash.now[:danger] = &quot;Generated SQL invalid.\n#{@report.clean_sql}\n#{e.to_s}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">        respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">          format.html {</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">            if params[:part] == &#39;results&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">              render text: &quot;Generated SQL invalid.\n#{@report.clean_sql}\n#{e.to_s}&quot;, status: 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">              render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">          format.json { </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">            return general_error &quot;invalid query for report. Please check search fields or try to run the report again.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">        end     </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">      if params[:commit] == &#39;search&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">        run &#39;REPORT&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">        format.html {</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">          if params[:part] == &#39;results&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">            render partial: &#39;results&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">            render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">        format.json {          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">          render json: {results: @results, search_attributes: @report.search_attr_values}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">        format.csv { </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">          res_a = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">          blank_value = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">          if params[:csv_blank]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">            blank_value = &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">          end          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">          res_a &lt;&lt; @results.fields.to_csv</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">          @results.each_row do |row| </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">            res_a &lt;&lt; (row.collect {|val|  val || blank_value}).to_csv</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">          send_data res_a.join(&quot;&quot;), filename: &quot;report.csv&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">    elsif params[:get_filter_previous]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">      render partial: &#39;filter_on&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">      @report.search_attr_values = search_attrs</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">        format.html { </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="122">
          
          
          <code class="ruby">          if params[:part] == &#39;form&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">            render partial: &#39;form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">            render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">        }        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">      end     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">    render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">  def update    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">    if @report_item.respond_to? :master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">      @master = @report_item.master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">      @master.current_user = current_user if @master      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    elsif @report_item.respond_to? :user_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">      @report_item.user_id = current_user.id </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">    return not_authorized unless @report.editable_data?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby">    if @report_item.update(secure_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">      #redirect_to show_path(id: @report.id), notice: &quot;#{@report_item.human_name} updated successfully&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">      #render partial: &#39;edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">      # Need to update the master_id manually, since it could have been set by a trigger</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">      res = @report_item.class.find(@report_item.id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">      @report_item.master_id = res.master_id if res.respond_to?(:master_id) &amp;&amp; res.master_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">      render json: {report_item: @report_item}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">      logger.warn &quot;Error updating #{@report_item}: #{@report_item.errors.inspect}&quot;      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      flash.now[:warning] = &quot;Error updating #{@report_item}: #{error_message}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">      edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">    def error_message</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="166">
          
          
          <code class="ruby">      res = &quot;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">      @report_item.errors.full_messages.each do |message|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">        res &lt;&lt; &quot;; &quot; unless res.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby">        res &lt;&lt; &quot;#{message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">      res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">      :item_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">    def filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby">      Report.categories.map {|g| [g,g.to_s.humanize]}.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">    def filter_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="184">
          
          
          <code class="ruby">      return nil if params[:filter].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">      params.require(:filter).permit(filters_on)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">#    def secure_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">#      params.require(:report).permit(:id,  :search_attrs)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">#    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">    def connection</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby">      @connection ||= ActiveRecord::Base.connection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">    def clear_results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">      # Needed to help control memory usage, according to PG:Result documentation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby">      @results.clear if @results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">    def authorized?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">      return true if current_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">      return true if current_user.can? :view_reports</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="206">
          
          
          <code class="ruby">      return not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">    def index_path p</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">      reports_path p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">    def do_log_action</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">      len = (@results ? @results.count : 0)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">      extras = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">      extras[:master_id] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">      extras[:msid] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">      log_action &quot;#{controller_name}##{action_name}&quot;, &quot;AUTO&quot;, len, &quot;OK&quot;, extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">    ### For editable reports</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">    def permitted_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">      @permitted_params = @report.edit_fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">    end          </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="231">
          
          
          <code class="ruby">      params.require(report_params_holder).permit(*permitted_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_editable_instance_from_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">      id = params[:report_id]      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">      id = id.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">      @report = Report.find(id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby">      return if params[:id] == &#39;cancel&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">      @report_item = report_model.find(params[:id])            </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby">      @id = @report_item.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">    def report_model</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="245">
          
          
          <code class="ruby">      @report.edit_model_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="248">
          <span class="hits">1</span>
          
          <code class="ruby">    def report_params_holder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">      &quot;report_#{@report.edit_model.classify.underscore}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="315b54d646a88f5feae70014ca16ffe13eae05e5">
  <div class="header">
    <h3>app/controllers/sage_assignments_controller.rb</h3>
    <h4><span class="red">60.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SageAssignmentsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    # By default the external id edit form is handled through a common template. To provide a customized form, copy the content of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # &quot;common_templates/external_id_edit_form.html.erb&quot; to views/sage_assignments/_edit_form.html.erb</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def edit_form</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      &#39;common_templates/external_id_edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      res = params.require(:sage_assignment).permit(:master_id, :sage_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      res[:sage_id] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a1e5db9cd62c76051b1c17de0b57f4a014d2c215">
  <div class="header">
    <h3>app/controllers/scantrons_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ScantronsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    # By default the external id edit form is handled through a common template. To provide a customized form, copy the content of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # &quot;common_templates/external_id_edit_form.html.erb&quot; to views/scantrons/_edit_form.html.erb</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def edit_form</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">      &#39;common_templates/external_id_edit_form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="15">
          <span class="hits">14</span>
          
          <code class="ruby">      params.require(:scantron).permit(:master_id, :scantron_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b41afa2318e5c430eb283c3062c320aacc0d245e">
  <div class="header">
    <h3>app/controllers/sub_processes_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SubProcessesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminControllerHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_protocol, only: [:index, :new, :show, :edit]    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_protocol_for_edit, only: [:create, :update]    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="6">
          <span class="hits">8</span>
          
          <code class="ruby">    @sub_processes = @protocol.sub_processes</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="7">
          <span class="hits">8</span>
          
          <code class="ruby">    response_to_index    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def new options = {}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">    @sub_process = @protocol.sub_processes.build unless options[:use_current_object]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="12">
          <span class="hits">3</span>
          
          <code class="ruby">    render partial: &#39;form&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_protocol</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="19">
          <span class="hits">4</span>
          
          <code class="ruby">      @protocol = Protocol.find(params[:protocol_id])      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_protocol_for_edit</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="23">
          <span class="hits">10</span>
          
          <code class="ruby">      @protocol = Protocol.find(secure_params[:protocol_id])      </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="24">
          <span class="hits">10</span>
          
          <code class="ruby">      @parent_param = {protocol_id: @protocol.id} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="28">
          <span class="hits">20</span>
          
          <code class="ruby">      params.require(:sub_process).permit(:name, :disabled, :protocol_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4061f9d046379d73edd4d40121943c4492031e7e">
  <div class="header">
    <h3>app/controllers/tracker_histories_controller.rb</h3>
    <h4><span class="red">28.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TrackerHistoriesController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :set_parent_item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    if @tracker</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      logger.info &quot;Getting tracker item tracker histories&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      @tracker_histories = @tracker.tracker_histories.order Master::TrackerHistoryEventOrderClause</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    elsif @master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      logger.info &quot;Getting master tracker histories&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      @tracker_histories = @master.tracker_histories.order Master::TrackerHistoryEventOrderClause</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      render code: 404</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    logger.info &quot;Tracker histories returned #{@tracker_histories.length} items&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    if params[:skip_last]==&#39;true&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      # Remove a current tracker item from the list.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      mid = @tracker_histories.first     </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      @tracker_histories = @tracker_histories.reject {|x| x.id == mid.id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    render json: {tracker_histories: @tracker_histories, master_id: @master.id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_parent_item</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      if params[:tracker_id].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">        @tracker = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">        @master = Master.find(params[:master_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        @tracker = Tracker.find(params[:tracker_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">        @master = @tracker.master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      params.require(:tracker).permit(:master_id,  :protocol_id, :event, :event_date, :sub_process_id, :outcome, :outcome_date, :user_id, :notes, :item_id, :item_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="558df1fb83adb6f91eb750c3554b76095270210b">
  <div class="header">
    <h3>app/controllers/trackers_controller.rb</h3>
    <h4><span class="red">76.92 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TrackersController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :merge_if_exists, only: [:create]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def merge_if_exists</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="10">
          <span class="hits">8</span>
          
          <code class="ruby">      @tracker = @master_objects.build(secure_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="12">
          <span class="hits">8</span>
          
          <code class="ruby">      res = @tracker.merge_if_exists</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      # If the tracker record exists with the requested protocol then return the updated record and show the result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      # Otherwise just follow the default record creation flow</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      if res</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">        @tracker = res</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">        show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    def secure_params</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="24">
          <span class="hits">21</span>
          
          <code class="ruby">      params.require(:tracker).permit(:master_id,  :protocol_id, :protocol_event_id, :event_date, :sub_process_id, :user_id, :notes, :item_id, :item_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0d7715e18702b940a65c0fad10c7ea9441ea3efe">
  <div class="header">
    <h3>app/helpers/addresses_helper.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AddressesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def state_hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    AddressState.id_value_pairs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"> </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3ebb82ae1f4fd221fe52d9e531eeb3c0daefb53f">
  <div class="header">
    <h3>app/helpers/admin_helper.rb</h3>
    <h4><span class="red">31.25 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AdminHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_path id, opt={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    redir = {action: :edit, id: id}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    redir.merge! opt</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    url_for(redir)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_edit_cancel</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">     link_to &#39;cancel&#39;, &quot;#&quot;, id: &quot;admin-edit-cancel&quot;, class: &quot;btn btn-danger&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_edit_btn id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">     link_to &#39;&#39;, edit_path(id, filter: params[:filter]), remote: true, class: &#39;edit-entity glyphicon glyphicon-pencil&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def show_filters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    res = &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    if respond_to?(:filters) &amp;&amp;  filters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      res = &quot;#{link_to(&quot;all&quot;, index_path(filter: &quot;&quot;), class: &quot;btn btn-default btn-sm&quot; )}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      filters.each do |k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">        res &lt;&lt; link_to(v, index_path(filter: {filters_on =&gt; k}), class: &quot;btn btn-default btn-sm&quot; )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    res.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end   </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f90bdceb10af1da98f21bd1d0b6b21e887cc0900">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4><span class="red">37.5 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>20</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ApplicationHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def object_name    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    (@object_name || controller_name.singularize)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def object_instance</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    instance_variable_get(&quot;@#{object_name}&quot;)    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def hyphenated_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    controller_name.singularize.hyphenate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_email</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    return nil unless current_user || current_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    (current_user || current_admin).email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def env_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    (ENV[&#39;FPHS_ENV_NAME&#39;] || &#39;unknown&#39;).gsub(&#39; &#39;,&#39;_&#39;).underscore.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def body_classes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    &quot; class=\&quot;#{controller_name} #{action_name} #{env_name}\&quot;&quot;.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def zip_field_props init={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    init.merge({pattern: &quot;\\d{5,5}(-\\d{4,4})?&quot;})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def inline_cancel_button class_extras=&quot;pull-right&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    logger.info &quot;Doing inline_cancel_button for #{object_instance}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    if object_instance.id </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      cancel_href = &quot;/masters/#{object_instance.master_id}/#{controller_name}/#{object_instance.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      cancel_href = &quot;/masters/#{object_instance.master_id}/#{controller_name}/cancel&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    &quot;&lt;a class=\&quot;show-entity show-#{hyphenated_name} #{class_extras} glyphicon glyphicon-remove-sign\&quot; title=\&quot;cancel\&quot; href=\&quot;#{cancel_href}\&quot; data-remote=\&quot;true\&quot; data-#{hyphenated_name}-id=\&quot;#{object_instance.id}\&quot; data-result-target=\&quot;##{hyphenated_name}-#{@master.id}-#{@id}\&quot; data-template=\&quot;#{hyphenated_name}-result-template\&quot; data-toggle=\&quot;scrollto-result\&quot; #{!@id ? &quot;data-target=\&quot;#master-#{@master.id}\&quot;&quot; : &quot;&quot;}&gt;&lt;/a&gt;&quot;.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_form_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    &quot;#{hyphenated_name}-edit-form-#{@master.id}-#{@id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_form_hash extras={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    res = extras.dup </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    res[:remote] = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">    res[:html] ||= {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    res[:html].merge!(&quot;data-result-target&quot; =&gt; &quot;##{hyphenated_name}-#{@master.id}-#{@id}&quot;, &quot;data-template&quot; =&gt; &quot;#{hyphenated_name}-result-template&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_edit_controls</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">    h = &quot;&lt;div class=\&quot;admin-edit-controls\&quot;&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      #{link_to &quot;cancel&quot;, url_for(action: :edit)} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      #{link_to &quot;admin menu&quot;, &#39;/&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      &lt;/div&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    &quot;.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="94e0cf90e781a2b4d29341db1ebccc4aef0a513a">
  <div class="header">
    <h3>app/helpers/colleges_helper.rb</h3>
    <h4><span class="red">50.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CollegesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def college_array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    res = College.selector_array.map {|c| c.titleize}.uniq!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    res.to_json.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="478d82f5d7010151450eda0e312a3fbd6313d865">
  <div class="header">
    <h3>app/helpers/general_selections_helper.rb</h3>
    <h4><span class="red">15.79 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module GeneralSelectionsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def general_selection_block_id item_type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    &quot;##{item_type}-definitions-#{@id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def general_selection type, options={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    type = type.to_sym if type.is_a? String</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    raise &quot;Item type not recognized: #{type}&quot; unless GeneralSelection.item_types.include? type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    cond = {item_type: type}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    attr = [:name, :value, :create_with, :edit_if_set, :edit_always, :lock, :description]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    res_attr = GeneralSelection.selector_attributes(attr, cond)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    if @id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      # Get results to check if the item is set to lock, and the value is set </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      res = res_attr.select {|a| !!a[5] &amp;&amp; a[1] == options[:value]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      # If the current value is not set to lock, check for edit_always or edit_if_set and the value is that set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      res  = res_attr.select {|a| !!a[4] || !!a[3] &amp;&amp; a[1] == options[:value] } if res.length == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      res  = res_attr.select {|a| !!a[2]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    unless options[:return_all]      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      res.collect! {|a| [a[0], a[1]]} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    res.map! {|a| [&quot;#{a[1]} - #{a[0]}&quot;, a[1]]} if options[:present] == :hyphenate_name_val</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    res.sort! {|a,b| a[1].to_i &lt;=&gt; b[1].to_i} if options[:order] == :value_number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    res.sort! {|a,b| b[1].to_i &lt;=&gt; a[1].to_i} if options[:order] == :value_number_desc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ef95de25ff26de68ea8735bd1b810150369b0d5e">
  <div class="header">
    <h3>app/helpers/item_flag_names_helper.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ItemFlagNamesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_types_array    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    ItemFlag.use_with_class_names.collect {|v| v.singularize.underscore}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8adec35157febfd95cf5a185c41ac586f81c861b">
  <div class="header">
    <h3>app/helpers/item_flags_helper.rb</h3>
    <h4><span class="red">35.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ItemFlagsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def flag_edit_form_id </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    &quot;item-flag-edit-form-#{@master.id}-#{@item_type}-#{@item.id}-#{@id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def flag_edit_form_hash extras={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    extras.merge({url: &quot;/masters/#{@master.id}/#{@item.item_type}/#{@item.id}/item_flags&quot;, action: :post, remote: true, html: {&quot;data-result-target&quot; =&gt; &quot;#item-flag-#{@master.id}-#{@item_type}-#{@item.id}-#{@id}&quot;, &quot;data-template&quot; =&gt; &quot;item-flags-result-template&quot;}})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_flag_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    &quot;#{url_for([@master, @item])}/item_flags/#{@id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def flag_inline_cancel_button</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    if @id </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      cancel_href = item_flag_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      cancel_href = &quot;#{item_flag_path}cancel&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    &quot;&lt;a class=\&quot;show-entity show-item-flag pull-right glyphicon glyphicon-remove-sign\&quot; title=\&quot;cancel\&quot; href=\&quot;#{cancel_href}\&quot; data-remote=\&quot;true\&quot; data-item-flag-id=\&quot;#{@id}\&quot; data-result-target=\&quot;#item-flag-#{@master.id}-#{@item.id}-#{@id}\&quot; data-template=\&quot;item-flag-result-template\&quot;&gt;&lt;/a&gt;&quot;.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_flags_array item_type=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    item_type ||= @item_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    ItemFlagName.selector_collection(item_type: item_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def flags_selected item=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    item ||= @item</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    s = item.item_flags.map {|i| i.item_flag_name_id}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    logger.info &quot;Selected #{s}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e9a3428d68e91cc36683fed42fe215114808c962">
  <div class="header">
    <h3>app/helpers/manage_users_helper.rb</h3>
    <h4><span class="red">60.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ManageUsersHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_path user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    manage_user_path(user)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def users_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    manage_users_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="da9e3638a935e04caee60a318f378149130493c4">
  <div class="header">
    <h3>app/helpers/player_infos_helper.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module PlayerInfosHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def player_info_rank_array_pair</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    AccuracyScore.selector_name_value_pair.map {|a| [&quot;#{a.last} - #{a.first}&quot;, a.last]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="86ffddca12321515f7bd15845b631dba7e189e52">
  <div class="header">
    <h3>app/helpers/protocols_helper.rb</h3>
    <h4><span class="red">24.14 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>22</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ProtocolsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    res = Protocol.selector_array_pair</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_array_without_updates</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    res = Protocol.selector_array_pair.reject {|a| a.first == Protocol::RecordUpdatesProtocolName}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def sub_processes_array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    res = SubProcess.selector_attributes [:name, :id, :protocol_name]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    res  = res.map {|a| [&quot;#{a.last} - #{a.first}&quot;, a[1]]}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def sub_processes_array_with_class</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    res = SubProcess.selector_attributes [:name, :id, :protocol_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    res = res.map {|a| [a.first, a[1], {&quot;data-filter-id&quot; =&gt; a.last}]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_events_array_with_class options={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    res = ProtocolEvent.selector_attributes [:name, :id, :sub_process_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    pes = res.collect {|a| a[2]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    if options[:add_empty]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      # look for missing items</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      missing = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      sub_processes_array.each do |a|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        missing &lt;&lt; [options[:add_empty], &#39;(null)&#39;, {&quot;data-filter-id&quot; =&gt; a[1]} ] unless pes.include? a[1]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    res = res.select {|a| a.last}.map {|a| [a.first, a[1], {&quot;data-filter-id&quot; =&gt; a.last}]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    res += missing if missing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_events_name_array_with_class</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    res = ProtocolEvent.selector_attributes [:name, :sub_process_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    res = res.map {|a| [a.first, a.first.downcase, {&quot;data-filter-id&quot; =&gt; a.last}]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e96d5f64e1f28faa5814dcdbb195192c75e8c5ee">
  <div class="header">
    <h3>app/helpers/reports_helper.rb</h3>
    <h4><span class="red">11.11 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>32</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ReportsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def report_edit_btn id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">     link_to &#39;&#39;, edit_report_path(id, report_id: @report.id, filter: params[:filter]), remote: true, class: &#39;edit-entity glyphicon glyphicon-pencil&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def report_edit_cancel</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">     link_to &#39;cancel&#39;, &quot;#&quot;, id: &quot;report-edit-cancel&quot;, class: &quot;btn btn-danger&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def report_field name, type, value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    if type.is_a? String    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      type_string = type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    elsif type.is_a? Hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      type_string = type.first.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      type_val = type.first.last      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      c = type_string.to_s.classify.constantize rescue nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    use_dropdown = nil    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    value ||= Report.calculate_default(type_val[&#39;default&#39;], type_string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    if c &amp;&amp; c.respond_to?(:all_name_value_enable_flagged) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      if type_val[&#39;item_type&#39;] == &#39;all&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        type_filter = nil     </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      elsif type_val[&#39;item_type&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">        type_filter = {item_type: type_val[&#39;item_type&#39;]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">         </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      unless @report_page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">        type_filter ||= {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">        type_filter[:disabled] = false        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      use_dropdown = options_for_select(c.all_name_value_enable_flagged(type_filter), value) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    if type_val[&#39;label&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      main_field = label_tag type_val[&#39;label&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      main_field = label_tag name </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    if type_val[&#39;multiple&#39;] == &#39;multiple&#39; || type_val[&#39;multiple&#39;] == &#39;multiple-regex&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      if use_dropdown </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">        main_field &lt;&lt; select_tag(&quot;search_attrs[#{name}]&quot;, use_dropdown , multiple: true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">        main_field &lt;&lt; text_field_tag(&quot;multiple_attrs[#{name}]&quot;, &#39;&#39;, type: type_string, class: &#39;form-control no-auto-submit&#39;  , data: {attribute: name})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">        main_field &lt;&lt; link_to( &quot;+&quot;, &quot;add_multiple_attrs[#{name}]&quot;, data: {attribute: name}, class: &#39;btn btn-default add-btn&#39;, title: &#39;add to search&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">        v = value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">        v = value.join(&quot;\n&quot;) if value.is_a? Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">        main_field &lt;&lt; text_area_tag(&quot;search_attrs[#{name}]&quot;, v, class: &#39;auto-grow&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      if use_dropdown </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        main_field &lt;&lt; select_tag(&quot;search_attrs[#{name}]&quot;, use_dropdown , include_blank: &#39;select&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        main_field &lt;&lt; text_field_tag(&quot;search_attrs[#{name}]&quot;, value, type: type_string, class: &#39;form-control&#39; )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f7efb0298613631d00fe3c9c9746a734b2c224a0">
  <div class="header">
    <h3>app/models/accuracy_score.rb</h3>
    <h4><span class="green">92.31 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AccuracyScore &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="2807" data-linenumber="5">
          <span class="hits">2807</span>
          
          <code class="ruby">  default_scope {order  :value}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_value_change,  on: :update  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :value, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def full_label</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    &quot;#{value} - #{name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_value_change </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="18">
          <span class="hits">8</span>
          
          <code class="ruby">      if value_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">        errors.add(:value, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fec2cc6e63fbaa7dd190173002a74c7b0686e3d7">
  <div class="header">
    <h3>app/models/address.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>48</b> relevant lines. 
      <span class="green"><b>48</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Address &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  PrimaryRank = 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  SecondaryRank = 5</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  InactiveRank = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :zip, zip: true, allow_blank: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :source, source: true, allow_blank: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :rank, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :handle_country</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :handle_primary_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.states</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="16">
          <span class="hits">31</span>
          
          <code class="ruby">    AddressState.id_value_pairs    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_state_name code</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="20">
          <span class="hits">50</span>
          
          <code class="ruby">    return unless code</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="21">
          <span class="hits">31</span>
          
          <code class="ruby">    states[code.upcase] </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def state_name </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="25">
          <span class="hits">8</span>
          
          <code class="ruby">    Address.get_state_name self.state</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_country_name code</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="29">
          <span class="hits">20</span>
          
          <code class="ruby">    return unless code</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="30">
          <span class="hits">6</span>
          
          <code class="ruby">    country_code = code.upcase</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="31">
          <span class="hits">6</span>
          
          <code class="ruby">    country = ISO3166::Country[country_code]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="32">
          <span class="hits">6</span>
          
          <code class="ruby">    country.translations[I18n.locale.to_s] || country.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def country_name</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="37">
          <span class="hits">8</span>
          
          <code class="ruby">    Address.get_country_name self.country</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    # Only one address for a master can be set as Primary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    # If a new item is added, or an existed item is updated with Primary rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    # update the existing record(s) with Primary status to be Secondary</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def handle_primary_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="47">
          <span class="hits">42</span>
          
          <code class="ruby">      if self.rank.to_i == PrimaryRank</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="48">
          <span class="hits">8</span>
          
          <code class="ruby">        logger.info &quot;Address rank set as primary in address #{self.id}. Setting other addresses for this master to secondary if they were primary.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="50">
          <span class="hits">8</span>
          
          <code class="ruby">        self.master.addresses.where(rank: PrimaryRank).each do |a|</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="51">
          <span class="hits">11</span>
          
          <code class="ruby">          if a.id != self.id</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="52">
          <span class="hits">3</span>
          
          <code class="ruby">            logger.info &quot;Address #{a.id} has primary rank currently. Setting it to secondary&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="53">
          <span class="hits">3</span>
          
          <code class="ruby">            a.rank = SecondaryRank</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="54">
          <span class="hits">3</span>
          
          <code class="ruby">            a.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="55">
          <span class="hits">3</span>
          
          <code class="ruby">            multiple_results &lt;&lt; a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    # Validate state and zip for US country and region / postal code for non-US    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">    def handle_country</code>
        </li>
      
        <li class="covered" data-hits="43" data-linenumber="64">
          <span class="hits">43</span>
          
          <code class="ruby">      if country</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="65">
          <span class="hits">7</span>
          
          <code class="ruby">        self.country = country.downcase        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="67">
          <span class="hits">7</span>
          
          <code class="ruby">        if country.downcase == &#39;us&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="68">
          <span class="hits">2</span>
          
          <code class="ruby">          self.region = nil</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">          self.postal_code = nil</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">          return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="72">
          <span class="hits">5</span>
          
          <code class="ruby">          if region.blank? &amp;&amp; postal_code.blank?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">            self.errors.add :country, &quot;was not USA and province/county and postal code are blank. At least one must be entered for countries other than USA.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">            return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="76">
          <span class="hits">4</span>
          
          <code class="ruby">            self.state = nil</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="77">
          <span class="hits">4</span>
          
          <code class="ruby">            self.zip = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="79">
          <span class="hits">4</span>
          
          <code class="ruby">            return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="84">
          <span class="hits">36</span>
          
          <code class="ruby">        true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7fa2768e566195827c840b66ad02c3e8caf96397">
  <div class="header">
    <h3>app/models/address_state.rb</h3>
    <h4><span class="red">80.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AddressState</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.all_name_value_enable_flagged attr=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    id_value_pairs.map {|k,v| [v,k.downcase]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.id_value_pairs</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="8">
          <span class="hits">31</span>
          
          <code class="ruby">    {&quot;AL&quot; =&gt; &quot;Alabama&quot;, &quot;AK&quot; =&gt; &quot;Alaska&quot;, &quot;AZ&quot; =&gt; &quot;Arizona&quot;, &quot;AR&quot; =&gt; &quot;Arkansas&quot;, &quot;CA&quot; =&gt; &quot;California&quot;, &quot;CO&quot; =&gt; &quot;Colorado&quot;, &quot;CT&quot; =&gt; &quot;Connecticut&quot;, &quot;DE&quot; =&gt; &quot;Delaware&quot;, &quot;DC&quot; =&gt; &quot;District of Columbia&quot;, &quot;FL&quot; =&gt; &quot;Florida&quot;, &quot;GA&quot; =&gt; &quot;Georgia&quot;, &quot;HI&quot; =&gt; &quot;Hawaii&quot;, &quot;ID&quot; =&gt; &quot;Idaho&quot;, &quot;IL&quot; =&gt; &quot;Illinois&quot;, &quot;IN&quot; =&gt; &quot;Indiana&quot;, &quot;IA&quot; =&gt; &quot;Iowa&quot;, &quot;KS&quot; =&gt; &quot;Kansas&quot;, &quot;KY&quot; =&gt; &quot;Kentucky&quot;, &quot;LA&quot; =&gt; &quot;Louisiana&quot;, &quot;ME&quot; =&gt; &quot;Maine&quot;, &quot;MD&quot; =&gt; &quot;Maryland&quot;, &quot;MA&quot; =&gt; &quot;Massachusetts&quot;, &quot;MI&quot; =&gt; &quot;Michigan&quot;, &quot;MN&quot; =&gt; &quot;Minnesota&quot;, &quot;MS&quot; =&gt; &quot;Mississippi&quot;, &quot;MO&quot; =&gt; &quot;Missouri&quot;, &quot;MT&quot; =&gt; &quot;Montana&quot;, &quot;NE&quot; =&gt; &quot;Nebraska&quot;, &quot;NV&quot; =&gt; &quot;Nevada&quot;, &quot;NH&quot; =&gt; &quot;New Hampshire&quot;, &quot;NJ&quot; =&gt; &quot;New Jersey&quot;, &quot;NM&quot; =&gt; &quot;New Mexico&quot;, &quot;NY&quot; =&gt; &quot;New York&quot;, &quot;NC&quot; =&gt; &quot;North Carolina&quot;, &quot;ND&quot; =&gt; &quot;North Dakota&quot;, &quot;OH&quot; =&gt; &quot;Ohio&quot;, &quot;OK&quot; =&gt; &quot;Oklahoma&quot;, &quot;OR&quot; =&gt; &quot;Oregon&quot;, &quot;PA&quot; =&gt; &quot;Pennsylvania&quot;, &quot;RI&quot; =&gt; &quot;Rhode Island&quot;, &quot;SC&quot; =&gt; &quot;South Carolina&quot;, &quot;SD&quot; =&gt; &quot;South Dakota&quot;, &quot;TN&quot; =&gt; &quot;Tennessee&quot;, &quot;TX&quot; =&gt; &quot;Texas&quot;, &quot;UT&quot; =&gt; &quot;Utah&quot;, &quot;VT&quot; =&gt; &quot;Vermont&quot;, &quot;VA&quot; =&gt; &quot;Virginia&quot;, &quot;WA&quot; =&gt; &quot;Washington&quot;, &quot;WV&quot; =&gt; &quot;West Virginia&quot;, &quot;WI&quot; =&gt; &quot;Wisconsin&quot;, &quot;WY&quot; =&gt; &quot;Wyoming&quot;, &quot;AS&quot; =&gt; &quot;American Samoa&quot;, &quot;GU&quot; =&gt; &quot;Guam&quot;, &quot;MP&quot; =&gt; &quot;Northern Mariana Islands&quot;, &quot;PR&quot; =&gt; &quot;Puerto Rico&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b88e322baeb8e4eee73123940390dbf31d989050">
  <div class="header">
    <h3>app/models/admin.rb</h3>
    <h4><span class="green">96.43 %</span> covered</h4>
    <div>
      <b>28</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActionLogging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include StandardAuthentication</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  devise :database_authenticatable, :trackable, :timeoutable, :lockable, :validatable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_email_change, on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_reenabling_admin, on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_not_in_setup_script, on: :create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def enabled?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    !self.disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def timeout_in</code>
        </li>
      
        <li class="covered" data-hits="139" data-linenumber="18">
          <span class="hits">139</span>
          
          <code class="ruby">    return Settings::AdminTimeout</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # Standard Devise callback to allow accounts to be disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def active_for_authentication?</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="23">
          <span class="hits">140</span>
          
          <code class="ruby">    super &amp;&amp; !self.disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # Standard Devise callback to tell user that an account has been disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def inactive_message</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    !self.disabled  ? super : :account_has_been_disabled    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  # Simple way to ensure that this is not being run from inside Passenger</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def in_setup_script</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="33">
          <span class="hits">662</span>
          
          <code class="ruby">    ENV[&#39;FPHS_ADMIN_SETUP&#39;]==&#39;yes&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_s</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="37">
          <span class="hits">9</span>
          
          <code class="ruby">    email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  protected  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_email_change </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="43">
          <span class="hits">8</span>
          
          <code class="ruby">      if email_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:email, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_reenabling_admin</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="49">
          <span class="hits">8</span>
          
          <code class="ruby">      if disabled_changed? &amp;&amp; self.persisted? &amp;&amp; self.disabled != true &amp;&amp; !in_setup_script</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">        errors.add(:disabled, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_not_in_setup_script</code>
        </li>
      
        <li class="covered" data-hits="659" data-linenumber="56">
          <span class="hits">659</span>
          
          <code class="ruby">      errors.add(:admin, &quot;can only create admins in console&quot;) unless in_setup_script</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="aeb8f3c4323ea3d6077a8c2efe863def24954900">
  <div class="header">
    <h3>app/models/application.rb</h3>
    <h4><span class="red">62.5 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Application  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.add_to_app_list list_type, item    </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="4">
          <span class="hits">2</span>
          
          <code class="ruby">    l = app_list(list_type)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    return if l.include?(item)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="6">
          <span class="hits">3</span>
          
          <code class="ruby">    res = l.select {|i| i.name == item.name}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    l &lt;&lt; item unless res.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.app_list(list_type)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">    @@app_list ||= {}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="12">
          <span class="hits">2</span>
          
          <code class="ruby">    @@app_list[list_type] ||= []    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.version    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    @@version ||= File.read(&#39;./version.txt&#39;).gsub(&quot;\n&quot;,&#39;&#39;)    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.server_cache_version</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    Rails.cache.fetch(&#39;server_cache_version&#39;){</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      Time.now.to_f.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.record_error_message record</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    res = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    return &quot;unexpected error&quot; unless record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    record.errors.each do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      res &lt;&lt; r.join(&#39; &#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    res.join &quot;; &quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.hide_messages</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    @@hide_messages ||= [I18n.translate(&#39;devise.sessions.signed_in&#39;)]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    Rails.logger.info &quot;Hide messages: #{@@hide_messages}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    @@hide_messages</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="60989f04ce10b942c75cb1782352ded5cfdb9adf">
  <div class="header">
    <h3>app/models/college.rb</h3>
    <h4><span class="yellow">89.09 %</span> covered</h4>
    <div>
      <b>55</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class College &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="7">
          <span class="hits">46</span>
          
          <code class="ruby">  default_scope -&gt; {order  &quot;colleges.updated_at DESC nulls last&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :downcase_name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_name_change,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :check_synonym</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :either_admin_or_user, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true, uniqueness: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # Override standard #all method to pull from cache if available</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.all</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="17">
          <span class="hits">162</span>
          
          <code class="ruby">    Rails.cache.fetch gen_cache_key do</code>
        </li>
      
        <li class="covered" data-hits="90" data-linenumber="18">
          <span class="hits">90</span>
          
          <code class="ruby">      super      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # Check if the college with &#39;name&#39; exists. If so, return truthy value</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.exists? name</code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="24">
          <span class="hits">49</span>
          
          <code class="ruby">    res = all.exists? name: name.downcase    </code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="25">
          <span class="hits">49</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # Create a new named college (working as the specified user) if the college does not exist already</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_if_new name, user    </code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="30">
          <span class="hits">48</span>
          
          <code class="ruby">    return if exists? name</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="31">
          <span class="hits">13</span>
          
          <code class="ruby">    logger.info &quot;Adding new college to list: #{name}&quot;</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="32">
          <span class="hits">13</span>
          
          <code class="ruby">    c = College.new </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="33">
          <span class="hits">13</span>
          
          <code class="ruby">    c.name = name.downcase</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="34">
          <span class="hits">13</span>
          
          <code class="ruby">    c.current_user = user</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="35">
          <span class="hits">12</span>
          
          <code class="ruby">    c.save!</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="36">
          <span class="hits">12</span>
          
          <code class="ruby">    c</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  # Required to get user email address for admin view of who created the college record</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    return nil unless user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    user.email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user= new_user    </code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="46">
          <span class="hits">13</span>
          
          <code class="ruby">    raise &quot;bad user set&quot; unless new_user.is_a? User</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="47">
          <span class="hits">12</span>
          
          <code class="ruby">    @user_set = true </code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="48">
          <span class="hits">12</span>
          
          <code class="ruby">    self.user = new_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_set?</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="52">
          <span class="hits">41</span>
          
          <code class="ruby">    !!@user_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  # Lookup the name of the record this is a synonym for</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def synonym_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">    return nil unless synonym_for_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    c = College.find_by_id(synonym_for_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">    return nil unless c</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">    c.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_name_change</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="68">
          <span class="hits">5</span>
          
          <code class="ruby">        errors.add(:name, &quot;change not allowed!&quot;) if name_changed? &amp;&amp; self.persisted? &amp;&amp; !admin_set?      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">    def ensure_admin_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      # Override the standard test for admin being set, since users can create (but not update) colleges</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="73">
          <span class="hits">47</span>
          
          <code class="ruby">      errors.add(:admin, &quot;has not been set&quot;) if self.persisted? &amp;&amp; !admin_set?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">    #Validate that the college this record is being set as a synonym for actually exists</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    def check_synonym</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="79">
          <span class="hits">47</span>
          
          <code class="ruby">      if synonym_for_id </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="80">
          <span class="hits">4</span>
          
          <code class="ruby">        sc = College.find_by_id(synonym_for_id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="81">
          <span class="hits">4</span>
          
          <code class="ruby">        if !sc || sc.disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">          errors.add :synonym, &quot;does not exist as a college already&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">          return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="87">
          <span class="hits">46</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    def either_admin_or_user</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="91">
          <span class="hits">41</span>
          
          <code class="ruby">      errors.add(:user, &quot;has not been set when not acting as admin&quot;) unless user_set? || admin_set?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    def downcase_name</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="95">
          <span class="hits">47</span>
          
          <code class="ruby">      return unless self.name</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="96">
          <span class="hits">44</span>
          
          <code class="ruby">      self.name = self.name.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="92f558f21d7056672aedc68a02d856317638c21a">
  <div class="header">
    <h3>app/models/concerns/action_logging.rb</h3>
    <h4><span class="green">91.67 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ActionLogging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def session_class_name</code>
        </li>
      
        <li class="covered" data-hits="468" data-linenumber="6">
          <span class="hits">468</span>
          
          <code class="ruby">    self.class.name.downcase.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def action_logger</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # We are using syslog now, so push everything out through the same logger</code>
        </li>
      
        <li class="covered" data-hits="234" data-linenumber="11">
          <span class="hits">234</span>
          
          <code class="ruby">    Rails.logger</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def log_action action, sub, results, method, params, status=&quot;OK&quot;, extras={}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="234" data-linenumber="16">
          <span class="hits">234</span>
          
          <code class="ruby">    res = {user: self.id, user_type: session_class_name, email: self.email, action: action, sub: sub, method: method, params: params, results: results, status: status, action_at: DateTime.now.iso8601}</code>
        </li>
      
        <li class="covered" data-hits="234" data-linenumber="17">
          <span class="hits">234</span>
          
          <code class="ruby">    res.merge! extras</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Note: the prefix on the front of the message is used by rsyslog to filter messages to the correct file</code>
        </li>
      
        <li class="covered" data-hits="234" data-linenumber="20">
          <span class="hits">234</span>
          
          <code class="ruby">    action_logger.info(&quot;fphs_#{session_class_name}_actions=#{res.to_json}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def after_database_authentication</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    log_action &quot;#{session_class_name} login&quot;, &quot;LOGIN&quot;, 0, :post, {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="398555292d85d0e62e5a1c92b0501c15b333db79">
  <div class="header">
    <h3>app/models/concerns/admin_handler.rb</h3>
    <h4><span class="yellow">83.87 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="5">
          <span class="hits">10</span>
          
          <code class="ruby">    belongs_to :admin</code>
        </li>
      
        <li class="covered" data-hits="305" data-linenumber="6">
          <span class="hits">305</span>
          
          <code class="ruby">    scope :active, -&gt; {where &quot;disabled is null or disabled = false&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="8">
          <span class="hits">10</span>
          
          <code class="ruby">    before_validation :ensure_admin_set</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="9">
          <span class="hits">10</span>
          
          <code class="ruby">    before_create :setup_values</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def setup_values    </code>
        </li>
      
        <li class="covered" data-hits="4593" data-linenumber="13">
          <span class="hits">4593</span>
          
          <code class="ruby">    disabled = false if disabled.nil?    </code>
        </li>
      
        <li class="covered" data-hits="4593" data-linenumber="14">
          <span class="hits">4593</span>
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def enabled?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    !disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    return unless admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    admin.email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin= new_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    raise &quot;can not change admin&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_id= new_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    raise &quot;can not change admin id&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_admin= new_admin    </code>
        </li>
      
        <li class="covered" data-hits="6512" data-linenumber="35">
          <span class="hits">6512</span>
          
          <code class="ruby">    raise &quot;Bad Admin&quot; unless new_admin.is_a?(Admin) &amp;&amp; new_admin.id &amp;&amp; !new_admin.disabled    </code>
        </li>
      
        <li class="covered" data-hits="6512" data-linenumber="36">
          <span class="hits">6512</span>
          
          <code class="ruby">    @admin_set = true</code>
        </li>
      
        <li class="covered" data-hits="6512" data-linenumber="37">
          <span class="hits">6512</span>
          
          <code class="ruby">    @current_admin = new_admin</code>
        </li>
      
        <li class="covered" data-hits="6512" data-linenumber="38">
          <span class="hits">6512</span>
          
          <code class="ruby">    write_attribute(:admin_id, new_admin.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_admin</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="42">
          <span class="hits">74</span>
          
          <code class="ruby">    return nil unless @admin_set</code>
        </li>
      
        <li class="covered" data-hits="73" data-linenumber="43">
          <span class="hits">73</span>
          
          <code class="ruby">    @current_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  # use this to check whether a current admin user has been assigned to act on this record  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def admin_set?</code>
        </li>
      
        <li class="covered" data-hits="6532" data-linenumber="48">
          <span class="hits">6532</span>
          
          <code class="ruby">    !!@admin_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def ensure_admin_set</code>
        </li>
      
        <li class="covered" data-hits="6190" data-linenumber="52">
          <span class="hits">6190</span>
          
          <code class="ruby">    errors.add(:admin, &quot;has not been set&quot;) unless admin_set?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0b0d0bac7828b2f92562f87962127a6c011ca089">
  <div class="header">
    <h3>app/models/concerns/email_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class EmailValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="3">
          <span class="hits">5</span>
          
          <code class="ruby">    record.errors.add attribute, (options[:message] || &quot;is not an email&quot;) unless</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="4">
          <span class="hits">29</span>
          
          <code class="ruby">      value =~ /\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\z/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4582da0e614b02c4fc871cf89a2141bea8ab3853">
  <div class="header">
    <h3>app/models/concerns/external_id_handler.rb</h3>
    <h4><span class="red">75.36 %</span> covered</h4>
    <div>
      <b>69</b> relevant lines. 
      <span class="green"><b>52</b> lines covered</span> and
      <span class="red"><b>17</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ExternalIdHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    attr_accessor :create_count, :just_assigned</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  class_methods do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_edit= val</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">      @prevent_edit = val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_create= val</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      @prevent_create = val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def external_id_attribute= val</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">      @external_id_attribute = val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def external_id_view_formatter= val</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      @id_formatter = val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def external_id_range= val</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      @external_id_range = val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def external_id_edit_pattern= val</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      @external_id_pattern = val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def label= val</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      @label</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_edit?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      return @prevent_edit unless @prevent_edit.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_create?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      return @prevent_create unless @prevent_create.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def external_id_attribute</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">      @external_id_attribute || :external_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    def external_id_view_formatter</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">      @id_formatter || &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">    def external_id_range</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="58">
          <span class="hits">104</span>
          
          <code class="ruby">      @external_id_range || (1..9999999999)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    def external_id_edit_pattern</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">      @external_id_pattern || &#39;\\d{0,10}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">    def plural_name</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="66">
          <span class="hits">4</span>
          
          <code class="ruby">      name.underscore.pluralize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    def hyphenated_plural_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">      name.underscore.pluralize.hyphenate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    def label</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">      @label || self.name.underscore.humanize.titleize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    # Optionally accept an association_block, allowing the association related methods such as #build to be overridden</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">    # in the master record association. Just passes this through to the add_master_assocation </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_to_app_list &amp;association_block</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="80">
          <span class="hits">2</span>
          
          <code class="ruby">      self.validates external_id_attribute, presence: true,  numericality: { only_integer: true, greater_than_or_equal_to: external_id_range.min, less_than_or_equal_to: external_id_range.max }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="82">
          <span class="hits">2</span>
          
          <code class="ruby">      Application.add_to_app_list(:external_id, self)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="83">
          <span class="hits">2</span>
          
          <code class="ruby">      add_master_association &amp;association_block</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_master_association &amp;association_block</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      # Define the association</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="89">
          <span class="hits">2</span>
          
          <code class="ruby">      Master.has_many plural_name.to_sym,  inverse_of: :master, &amp;association_block </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      # Now update the master&#39;s nested attributes this model&#39;s symbol</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="91">
          <span class="hits">2</span>
          
          <code class="ruby">      Master.add_nested_attribute plural_name.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    # For external ID models that require an auto-generated or auto-assigned (from an existing list) ID,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">    # the master association build method will use this method.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    # By default, the next available ID will be generated randomly. </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">    def master_build_with_random_id owner, att=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">      if att</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">        self.assign_random_id owner</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">        self.new master: owner</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    # We assign the random id </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">    def assign_random_id master</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">      item = self.new master: master      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">      item[external_id_attribute] = self.generate_random_id      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">      item.just_assigned = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">      item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">    # Generate a random number with no leading zeros or spaces in the defined external_id_range</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">    def generate_random_id  </code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="118">
          <span class="hits">100</span>
          
          <code class="ruby">      m = external_id_range.max</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="119">
          <span class="hits">100</span>
          
          <code class="ruby">      add = (m+1)/10</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="120">
          <span class="hits">100</span>
          
          <code class="ruby">      upper = m - add      </code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="121">
          <span class="hits">100</span>
          
          <code class="ruby">      SecureRandom.random_number(upper) + add      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    # SageAssignments for example expand on the master_build_with_random_id method</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    # in order to pluck the next available pre-generated ID from a list.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">    def master_build_with_next_id owner, att=nil</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="127">
          <span class="hits">11</span>
          
          <code class="ruby">      if att</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="128">
          <span class="hits">11</span>
          
          <code class="ruby">        self.assign_next_available_id owner</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">        self.new master: owner</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">    def assign_next_available_id master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="135">
          <span class="hits">11</span>
          
          <code class="ruby">      item = self.next_available master      </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="136">
          <span class="hits">10</span>
          
          <code class="ruby">      item.just_assigned = true</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="137">
          <span class="hits">10</span>
          
          <code class="ruby">      item.master = master</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="138">
          <span class="hits">10</span>
          
          <code class="ruby">      item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6b71b8a50eb358042d933c365f5e1ad93f6f78b2">
  <div class="header">
    <h3>app/models/concerns/master_search_handler.rb</h3>
    <h4><span class="yellow">86.36 %</span> covered</h4>
    <div>
      <b>132</b> relevant lines. 
      <span class="green"><b>114</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MasterSearchHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  # Move the main supporting functionality for the Simple and Advanced Search forms here, allowing the Master model data functionality to remain obvious</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    MasterRank  = &quot;master_rank desc nulls last, masters.id desc nulls last&quot;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    PlayerInfoRankOrderClause = &quot;case when rank is null then -1000 when rank &gt; #{PlayerInfo::BestAccuracyScore} then rank * -1 else rank end desc nulls last&quot;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    RankNotNullClause = &#39; case rank when null then -1 else rank * -1 end&#39;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    TrackerEventOrderClause = &#39;protocols.position asc, event_date DESC NULLS last, trackers.updated_at DESC NULLS last &#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    TrackerHistoryEventOrderClause = &#39;event_date DESC NULLS last, tracker_history.updated_at DESC NULLS last &#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # This association is provided to allow &#39;simple&#39; search on names in player_infos OR pro_infos </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    has_many :general_infos, class_name: &#39;ProInfo&#39; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Associations to allow advanced searches for NOT </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    has_many :not_tracker_histories, -&gt; { order(TrackerHistoryEventOrderClause)},  class_name: &#39;TrackerHistory&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    has_many :not_trackers, -&gt; { order(TrackerEventOrderClause)},  class_name: &#39;Tracker&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    SimplePlayerJoin = &quot;LEFT JOIN player_infos on masters.id = player_infos.master_id LEFT JOIN pro_infos as pro_infos on masters.id = pro_infos.master_id&quot;.freeze</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    NotTrackerJoin = :no_join #&#39;INNER JOIN trackers &quot;not_trackers&quot; on masters.id = not_trackers.master_id&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    NotTrackerHistoryJoin = :no_join #&#39;INNER JOIN tracker_history &quot;not_tracker_histories&quot; on masters.id = not_tracker_histories.master_id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    # AltConditions allows certain search fields to be handled differently from a plain equality match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # Simply define a hash for the table containing the symbolized field names to be handled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # Use a hash with :value to define a predefined matching clause:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # :starts_with is the equivalent of &quot;?%&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    # :contains is the equivalent of &quot;%?%&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    # :is  and :is_not are the equivalent of &quot;?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    # :do_nothing forces this attribute to be skipped</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    # Subsequent symbols in the array can be used to modify the string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    # :strip_spaces removes all spaces from the string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    # :upcase makes the whole string uppercase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    # The :conditioncan be specified to state the actual query condition</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    # :starts with and :contains both default to &quot;field_name LIKE ?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    # :is_not default to &quot;field_name &lt;&gt; ?&quot;  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    # note that ? characters will be replaced by the field search value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # Optionally add a value (symbol or array of symbols or string specifying full join clause) for :joins</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    # to specify specific tables to add to the inner join list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    AltConditions = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      player_infos: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">        first_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        middle_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">        nick_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        notes: {value: :contains},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">        younger_than: {value: :years, condition: &quot;player_infos.birth_date is not null  AND ((current_date - interval ? )) &lt; player_infos.birth_date&quot;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">        older_than: {value: :years, condition: &quot;player_infos.birth_date is not null  AND ((current_date - interval ?)) &gt; player_infos.birth_date&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      pro_infos: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">        first_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        middle_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">        nick_name: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">        less_than_career_years: {value: :is, condition: &quot;pro_infos.start_year is not null AND pro_infos.end_year IS NOT NULL  AND (pro_infos.end_year - pro_infos.start_year) &lt; ?&quot;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        more_than_career_years: {value: :is, condition: &quot;pro_infos.start_year is not null AND pro_infos.end_year IS NOT NULL  AND (pro_infos.end_year - pro_infos.start_year) &gt; ?&quot;}            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      addresses: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">        street: {value: :starts_with},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">        zip: {value: :starts_with}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      player_contacts: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        data: {value: [:starts_with, :strip_non_alpha_numeric], condition: &quot;regexp_replace(player_contacts.data, &#39;\\W+&#39;, &#39;&#39;, &#39;g&#39;) LIKE ?&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      not_trackers: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">        protocol_event_id: {value: :is, condition: &quot;NOT EXISTS (select NULL from trackers t_inner where t_inner.protocol_event_id EQUALS_OR_IS_NULL ? AND t_inner.sub_process_id = :not_trackers_sub_process_id  AND t_inner.master_id = masters.id)&quot;, joins: NotTrackerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        sub_process_id: {value: :is, condition: &quot;TRUE&quot;, joins: NotTrackerJoin}    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      not_tracker_histories: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">        protocol_event_id: {value: :is, condition: &quot;NOT EXISTS (select NULL from tracker_history th_inner where th_inner.protocol_event_id EQUALS_OR_IS_NULL ? AND th_inner.sub_process_id = :not_tracker_histories_sub_process_id AND th_inner.master_id = masters.id)&quot;, joins: NotTrackerHistoryJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">        sub_process_id: {value: :is, condition: &quot;TRUE&quot;, joins: NotTrackerHistoryJoin}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      general_infos: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">        first_name: {value: :starts_with, condition: &quot;(player_infos.first_name LIKE ? OR pro_infos.first_name LIKE ? OR player_infos.nick_name LIKE ? OR pro_infos.nick_name LIKE ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">        last_name: {value: :is, condition: &quot;(player_infos.last_name = ? OR pro_infos.last_name = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">        birth_date: {value: :is, condition: &quot;(player_infos.birth_date = ? OR pro_infos.birth_date = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        death_date: {value: :is, condition: &quot;(player_infos.death_date = ? OR pro_infos.death_date = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">        start_year: {value: :is, condition: &quot;(player_infos.start_year = ? OR pro_infos.start_year = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        end_year: {value: :is, condition: &quot;(player_infos.end_year = ? OR pro_infos.end_year = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">        college: {value: :is, condition: &quot;(player_infos.college = ? OR pro_infos.college = ?)&quot;, joins: SimplePlayerJoin},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">        contact_data: {value: [:starts_with, :strip_non_alpha_numeric], condition: &quot;regexp_replace(player_contacts.data, &#39;\\W+&#39;, &#39;&#39;, &#39;g&#39;) LIKE ?&quot;, joins: :player_contacts}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    # Don&#39;t automatically generate a join for specific AltConditions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    # This allows for a :joins definition in AltConditions to define a LEFT OUTER JOIN on the primary table, for example</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">    NoDefaultJoinFor = [:general_infos, :not_trackers, :not_tracker_histories ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">    MasterNestedAttribs = :general_infos, :player_infos, :pro_infos, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                                :player_contacts, :addresses, :trackers, :tracker_histories,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">                                :not_trackers, :not_tracker_histories</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    # Nested attributes for advanced search form. These items will be extended dynamically by the external_id models when they are initially configured</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    accepts_nested_attributes_for *MasterNestedAttribs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">  class_methods do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    # Allow new models to be added to the nested attributes dynamically by models as they are configured</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_nested_attribute attrib</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="103">
          <span class="hits">2</span>
          
          <code class="ruby">      @master_nested_attrib ||= MasterNestedAttribs.dup</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="104">
          <span class="hits">2</span>
          
          <code class="ruby">      @master_nested_attrib &lt;&lt; attrib</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="106">
          <span class="hits">2</span>
          
          <code class="ruby">      Master.accepts_nested_attributes_for *@master_nested_attrib</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    # Build a Master search using the Master and nested attributes passed in</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    # Any attributes that are nil will be rejected and will not appear in the query</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    # Tables will only be joined if the nested attributes for the association have one or more</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">    # attributes that are not nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">    def search_on_params params, conditions={}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="115">
          <span class="hits">26</span>
          
          <code class="ruby">      joins = [] # list of joined tables</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="116">
          <span class="hits">26</span>
          
          <code class="ruby">      wheres = {} # set of equality where clauses</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="117">
          <span class="hits">26</span>
          
          <code class="ruby">      wheresalt = [nil, {}] # list of non-equality where clauses (such as LIKE)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="118">
          <span class="hits">26</span>
          
          <code class="ruby">      selects = [&quot;masters.id&quot;, &quot;masters.pro_info_id&quot;, &quot;masters.pro_id&quot;, &quot;masters.msid&quot;, &quot;masters.rank as master_rank&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="120">
          <span class="hits">26</span>
          
          <code class="ruby">      params.each do |params_key,params_val|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="122">
          <span class="hits">26</span>
          
          <code class="ruby">        if params_val.is_a? Hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="124">
          <span class="hits">26</span>
          
          <code class="ruby">          if params_val.first.first == &quot;0&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">            # Grab the first array item from the parameters if there is one to reset the context</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="126">
          <span class="hits">26</span>
          
          <code class="ruby">            params_val = params_val.first.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">          # Handle nested attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">          # Get the key name for the table by removing the _attributes extension from the key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="132">
          <span class="hits">26</span>
          
          <code class="ruby">          if params_key.to_s.include? &#39;_attributes&#39;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="133">
          <span class="hits">26</span>
          
          <code class="ruby">            condition_key = params_key.to_s.gsub(&#39;_attributes&#39;,&#39;&#39;).to_sym</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="134">
          <span class="hits">26</span>
          
          <code class="ruby">            r = Master.reflect_on_association(condition_key)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="135">
          <span class="hits">26</span>
          
          <code class="ruby">            logger.debug &quot;condition_key: #{condition_key}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="136">
          <span class="hits">26</span>
          
          <code class="ruby">            logger.debug &quot;Reflection: #{r.klass.table_name}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="137">
          <span class="hits">26</span>
          
          <code class="ruby">            logger.debug &quot;Source Reflection: #{r.source_reflection.name &amp;&amp; r.source_reflection.name}&quot;          </code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="138">
          <span class="hits">26</span>
          
          <code class="ruby">            if r.klass #r.source_reflection # </code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="139">
          <span class="hits">26</span>
          
          <code class="ruby">              condition_table =  r.klass.table_name #r.source_reflection.name.to_s #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">              condition_table = r.plural_name.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">            # Generate a pluralized table name for associations that are has_one</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">            condition_table = params_key.to_s.pluralize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">          # Keep only non-nil attributes for the primary wheres that don&#39;t have an alternative condition string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="60" data-linenumber="151">
          <span class="hits">60</span>
          
          <code class="ruby">          basic_condition_attribs = params_val.select{|key1,v1| !v1.nil? &amp;&amp; !alt_condition(condition_key, [key1, v1])}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">          # Pull the attributes with an alternative condition string (note that this returns nil values too)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          # format: {condition: condition_clause, reference: {reference_name =&gt; value}, joins: joins_clauses} </code>
        </li>
      
        <li class="covered" data-hits="94" data-linenumber="155">
          <span class="hits">94</span>
          
          <code class="ruby">          alt_condition_attribs = params_val.select{|_,v1| !v1.nil? }.map{|v2| alt_condition(condition_key, v2) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="157">
          <span class="hits">26</span>
          
          <code class="ruby">          logger.debug &quot;Param: #{params_key} has condition_table: #{condition_table}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="158">
          <span class="hits">26</span>
          
          <code class="ruby">          logger.debug &quot;basic_condition_attribs #{basic_condition_attribs} -- alt_condition_attribs #{alt_condition_attribs}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">          # If we have a set of attributes that is not empty </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">          # add the equality conditions to the list of wheres</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="162">
          <span class="hits">26</span>
          
          <code class="ruby">          if basic_condition_attribs.length &gt; 0 || alt_condition_attribs.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">            # When this is a basic condition</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="165">
          <span class="hits">26</span>
          
          <code class="ruby">            if basic_condition_attribs.length &gt; 0            </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="166">
          
          
          <code class="ruby">              logger.debug &quot;This is a basic condition for condition_table #{condition_table}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">              # When the where for the condition_table is an array of key/values already, just add to it</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">              # otherwise store the basic condition attributes directly</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby">              if wheres[condition_table] &amp;&amp; wheres[condition_table].first.last.is_a?(Array)              </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="170">
          
          
          <code class="ruby">                wheres[condition_table][basic_condition_attribs.first.first] += basic_condition_attribs.first.last </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">              else              </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="172">
          
          
          <code class="ruby">                wheres[condition_table] = basic_condition_attribs </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">            # When there is a defined alternative condition</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="176">
          <span class="hits">26</span>
          
          <code class="ruby">            if alt_condition_attribs.length &gt; 0          </code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="177">
          <span class="hits">26</span>
          
          <code class="ruby">              logger.info &quot;Merging alternative conditions FOR #{alt_condition_attribs}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">              # For each alternative condition attribute, check if it has a defined condition, then</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">              # generate alternative where clauses</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="180">
          <span class="hits">26</span>
          
          <code class="ruby">              alt_condition_attribs.each do |alt_condition_attrib|</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="181">
          <span class="hits">34</span>
          
          <code class="ruby">                if alt_condition_attrib &amp;&amp; alt_condition_attrib[:condition]</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="182">
          <span class="hits">34</span>
          
          <code class="ruby">                  logger.info &quot;Alt Condition: #{alt_condition_attrib[:condition]}&quot;</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="183">
          <span class="hits">34</span>
          
          <code class="ruby">                  wheresalt[0] = &quot;#{wheresalt[0]}#{wheresalt[0] ? &quot; AND &quot; : &#39;&#39;}#{alt_condition_attrib[:condition]}&quot;</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="184">
          <span class="hits">34</span>
          
          <code class="ruby">                  wheresalt[1].merge! alt_condition_attrib[:reference]</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="185">
          <span class="hits">34</span>
          
          <code class="ruby">                  if alt_condition_attrib[:joins].is_a?(Symbol) &amp;&amp; alt_condition_attrib[:joins] != :no_join</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="186">
          <span class="hits">7</span>
          
          <code class="ruby">                    joins &lt;&lt; alt_condition_attrib[:joins] </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="187">
          <span class="hits">7</span>
          
          <code class="ruby">                    logger.info &quot;Adding alt join #{alt_condition_attrib[:joins]}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">                  elsif alt_condition_attrib[:joins].is_a? String</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="189">
          <span class="hits">27</span>
          
          <code class="ruby">                    joins &lt;&lt; alt_condition_attrib[:joins] </code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="190">
          <span class="hits">27</span>
          
          <code class="ruby">                    logger.info &quot;Adding alt joins #{alt_condition_attrib[:joins]}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">                  elsif alt_condition_attrib[:joins].is_a? Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby">                    joins += alt_condition_attrib[:joins] </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">                    logger.info &quot;Adding alt joins #{alt_condition_attrib[:joins]}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">                  else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">                    logger.info &quot;Not Adding alt joins&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="201">
          <span class="hits">26</span>
          
          <code class="ruby">            logger.debug &quot;Adding condition_key to joins: #{condition_key}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="202">
          <span class="hits">26</span>
          
          <code class="ruby">            joins &lt;&lt; condition_key unless NoDefaultJoinFor.include?(condition_key)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="203">
          <span class="hits">26</span>
          
          <code class="ruby">            logger.info &quot;adding standard join params_val=#{condition_table.to_sym} when basic_condition_attribs = #{basic_condition_attribs}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="204">
          <span class="hits">26</span>
          
          <code class="ruby">            conditions[condition_key] = basic_condition_attribs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">          # Always add the table to the list of joins and select (so we can get the data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">        elsif !params_val.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">          # Handle Master level attributes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">          wheres[params_key] = params_val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">      # No conditions were recognized. Exit now.</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="217">
          <span class="hits">26</span>
          
          <code class="ruby">      return nil if wheres.length == 0 &amp;&amp; !wheresalt.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="219">
          <span class="hits">26</span>
          
          <code class="ruby">      logger.debug &quot;joins: #{joins}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="220">
          <span class="hits">26</span>
          
          <code class="ruby">      logger.debug &quot;Standard wheres: #{wheres}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="221">
          <span class="hits">26</span>
          
          <code class="ruby">      logger.debug &quot;Alt wheres: #{wheresalt}&quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="222">
          <span class="hits">26</span>
          
          <code class="ruby">      res = Master.select(selects).joins(joins).uniq.where(wheres)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="223">
          <span class="hits">26</span>
          
          <code class="ruby">      res = res.where(wheresalt.first, wheresalt.last) if wheresalt.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="225">
          <span class="hits">26</span>
          
          <code class="ruby">      default_sort res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">    def alt_condition table_name, condition    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="232">
          <span class="hits">68</span>
          
          <code class="ruby">      logger.debug &quot;Getting alt_condition for #{table_name} =&gt; #{condition}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="234">
          <span class="hits">68</span>
          
          <code class="ruby">      ckey = condition.first</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="235">
          <span class="hits">68</span>
          
          <code class="ruby">      cval = condition.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="237">
          <span class="hits">68</span>
          
          <code class="ruby">      return if !table_name || !condition || ckey.nil? || cval.nil?</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="238">
          <span class="hits">68</span>
          
          <code class="ruby">      altable = AltConditions[table_name]</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="239">
          <span class="hits">68</span>
          
          <code class="ruby">      return unless altable</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="240">
          <span class="hits">68</span>
          
          <code class="ruby">      altable = altable.dup</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="241">
          <span class="hits">68</span>
          
          <code class="ruby">      altdef = altable[ckey.to_sym]</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="242">
          <span class="hits">68</span>
          
          <code class="ruby">      return unless altdef</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="243">
          <span class="hits">68</span>
          
          <code class="ruby">      altdef = altdef.dup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="246">
          <span class="hits">68</span>
          
          <code class="ruby">      cond_op = altdef[:value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="248">
          <span class="hits">68</span>
          
          <code class="ruby">      if cond_op == :do_nothing || cond_op == :is_not_null &amp;&amp; (cval.blank? || cval == &#39;(null)&#39;)      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">        return {} </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="252">
          <span class="hits">68</span>
          
          <code class="ruby">      cond_op = [cond_op] unless cond_op.is_a? Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="254">
          <span class="hits">68</span>
          
          <code class="ruby">      refname = &quot;#{table_name}_#{ckey}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="257">
          <span class="hits">68</span>
          
          <code class="ruby">      if altdef[:condition]</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="258">
          <span class="hits">68</span>
          
          <code class="ruby">        alt  = altdef[:condition]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">      elsif cond_op.include?(:starts_with) || cond_op.include?(:contains)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="260">
          
          
          <code class="ruby">        alt = &quot;#{table_name}.#{ckey} LIKE ?&quot;      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">      elsif cond_op.include?(:is_not)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="262">
          
          
          <code class="ruby">        alt = &quot;#{table_name}.#{ckey} &lt;&gt; ?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="264">
          
          
          <code class="ruby">        alt = &quot;#{table_name}.#{ckey} = ?&quot;      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="267">
          <span class="hits">68</span>
          
          <code class="ruby">      if altdef[:value].is_a? Array</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="268">
          <span class="hits">14</span>
          
          <code class="ruby">        altdef[:value].each do |d|</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="269">
          <span class="hits">28</span>
          
          <code class="ruby">          if d == :strip_spaces</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="270">
          
          
          <code class="ruby">            cval.gsub!(&#39; &#39;,&#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">          elsif d == :strip_non_alpha_numeric</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="272">
          <span class="hits">14</span>
          
          <code class="ruby">            cval.gsub!(/\W+/,&#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">          elsif d == :upcase</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="274">
          
          
          <code class="ruby">            cval.upcase!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="279">
          <span class="hits">68</span>
          
          <code class="ruby">      cval = nil if cval == &#39;(null)&#39; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="281">
          <span class="hits">68</span>
          
          <code class="ruby">      if cval.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby">        eoin = &#39;IS&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="284">
          <span class="hits">68</span>
          
          <code class="ruby">        eoin = &#39;=&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">      end    </code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="286">
          <span class="hits">68</span>
          
          <code class="ruby">      alt = alt.gsub(&#39;EQUALS_OR_IS_NULL&#39;, eoin )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="288">
          <span class="hits">68</span>
          
          <code class="ruby">      alt = alt.gsub(&#39;?&#39;, &quot;:#{refname}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="290">
          <span class="hits">68</span>
          
          <code class="ruby">      cvaltotal = &quot;#{cval}%&quot; if cond_op.include? :starts_with</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="291">
          <span class="hits">68</span>
          
          <code class="ruby">      cvaltotal = &quot;%#{cval}%&quot; if cond_op.include? :contains</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="292">
          <span class="hits">68</span>
          
          <code class="ruby">      cvaltotal = cval if cond_op.include? :is</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="293">
          <span class="hits">68</span>
          
          <code class="ruby">      cvaltotal = &quot;#{cval} years&quot; if cond_op.include? :years</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="294">
          <span class="hits">68</span>
          
          <code class="ruby">      cvaltotal = &quot;#{cval}&quot; if cond_op.include? :is_not</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="296">
          <span class="hits">68</span>
          
          <code class="ruby">      joins = altdef[:joins]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="298">
          <span class="hits">68</span>
          
          <code class="ruby">      res = {condition: alt, reference: {refname.to_sym =&gt; cvaltotal}, joins: joins}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="300">
          <span class="hits">68</span>
          
          <code class="ruby">      res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">    def default_sort res    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">      # Note that this sorts first, based on the Master rank, which is calculated through a trigger from player info accuracy</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="306">
          <span class="hits">26</span>
          
          <code class="ruby">      if results_limit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">        res = res.order(MasterRank).take(results_limit) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="309">
          <span class="hits">26</span>
          
          <code class="ruby">        res = res.order(MasterRank).all #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="311">
          <span class="hits">83</span>
          
          <code class="ruby">      logger.info &quot;sorted to #{res.map {|a| [a.id, a.master_rank]}  } &quot;</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="312">
          <span class="hits">26</span>
          
          <code class="ruby">      res        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">    def results_limit</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="316">
          <span class="hits">28</span>
          
          <code class="ruby">      r = nil</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="317">
          <span class="hits">28</span>
          
          <code class="ruby">      e = ENV[&#39;FPHS_RESULT_LIMIT&#39;]     </code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="318">
          <span class="hits">28</span>
          
          <code class="ruby">      r = e.to_i if e</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="319">
          <span class="hits">28</span>
          
          <code class="ruby">      r = nil if r == 0</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="320">
          <span class="hits">28</span>
          
          <code class="ruby">      r    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="06ff909190cbc923ea8f73680accf445042f4bd6">
  <div class="header">
    <h3>app/models/concerns/phone_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PhoneValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="3">
          <span class="hits">6</span>
          
          <code class="ruby">    record.errors.add attribute, (options[:message] || &quot;is not a valid phone number&quot;) unless</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="4">
          <span class="hits">45</span>
          
          <code class="ruby">      value =~ /\([0-9]{3}\)[0-9]{3}-[0-9]{4}.*/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d2bdcee76d062d9d49b658ff9f4ac60fbc6f1011">
  <div class="header">
    <h3>app/models/concerns/selector_cache.rb</h3>
    <h4><span class="red">56.63 %</span> covered</h4>
    <div>
      <b>83</b> relevant lines. 
      <span class="green"><b>47</b> lines covered</span> and
      <span class="red"><b>36</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">    before_save :invalidate_cache</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="9">
          <span class="hits">7</span>
          
          <code class="ruby">    before_create :invalidate_cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="644" data-linenumber="11">
          <span class="hits">644</span>
          
          <code class="ruby">    scope :enabled, -&gt; { where &quot;disabled is null OR disabled = FALSE&quot; }    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  class_methods do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_cache?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def downcase_if_string val</code>
        </li>
      
        <li class="covered" data-hits="878" data-linenumber="21">
          <span class="hits">878</span>
          
          <code class="ruby">      if val.is_a? String</code>
        </li>
      
        <li class="covered" data-hits="304" data-linenumber="22">
          <span class="hits">304</span>
          
          <code class="ruby">        val.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="574" data-linenumber="24">
          <span class="hits">574</span>
          
          <code class="ruby">        val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def gen_cache_key</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="29">
          <span class="hits">162</span>
          
          <code class="ruby">      self.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def array_cache_key </code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="33">
          <span class="hits">41</span>
          
          <code class="ruby">      logger.debug &quot;Getting #{self.to_s} array cache key&quot;</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="34">
          <span class="hits">41</span>
          
          <code class="ruby">      &quot;#{self.to_s}_array&quot;      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def array_pair_cache_key </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">      &quot;#{self.to_s}_hash&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def collection_cache_key</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      logger.debug &quot;Getting #{self.to_s} collection cache key&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      &quot;#{self.to_s}_collection&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def nv_pair_cache_key </code>
        </li>
      
        <li class="covered" data-hits="1127" data-linenumber="44">
          <span class="hits">1127</span>
          
          <code class="ruby">      &quot;#{self.to_s}_nameval&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    def nv_all_cache_key </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">      &quot;#{self.to_s}_namevalall&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def attributes_cache_key</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      &quot;#{self.to_s}_attributes&quot;      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_array conditions=nil, attribute=:name</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="54">
          <span class="hits">41</span>
          
          <code class="ruby">      ckey=&quot;#{array_cache_key}#{conditions}:#{attribute}&quot;</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="55">
          <span class="hits">41</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="56">
          <span class="hits">65</span>
          
          <code class="ruby">        enabled.where(conditions).collect {|c| c.send(attribute) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      }    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_array_pair conditions=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      ckey=&quot;#{array_pair_cache_key}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">        enabled.where(conditions).collect {|c| [c.name, c.id] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_name_value_pair conditions=nil</code>
        </li>
      
        <li class="covered" data-hits="1127" data-linenumber="69">
          <span class="hits">1127</span>
          
          <code class="ruby">      ckey=&quot;#{nv_pair_cache_key}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1127" data-linenumber="71">
          <span class="hits">1127</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="1029" data-linenumber="72">
          <span class="hits">1029</span>
          
          <code class="ruby">        enabled.where(conditions).collect {|c| [c.name, downcase_if_string(c.value)] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_name_value_pair_no_downcase conditions=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">      ckey=&quot;#{nv_pair_cache_key}-nd-#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">        enabled.where(conditions).collect {|c| [c.name, c.value] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_attributes attributes, conditions=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">      ckey=&quot;#{attributes_cache_key}#{attributes}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">        enabled.where(conditions).collect do |c|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">          a = [] </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">          attributes.each do |att|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">            a &lt;&lt; c.send(att)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">          a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">    def selector_collection conditions=nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">      ckey=&quot;#{collection_cache_key}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">        enabled.where(conditions)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">    def all_name_value_enable_flagged conditions=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">      ckey=&quot;#{nv_all_cache_key}#{conditions}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">      Rails.cache.fetch(ckey){</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">        if conditions &amp;&amp; conditions[:disabled] == false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">          res = active</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">          conditions.delete :disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">          res = all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">        res.where(conditions).collect {|c| </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">          name = &#39;&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">          if c.respond_to?(:parent_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="122">
          
          
          <code class="ruby">            v = c.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">            vlabel = &quot;(#{c.parent_name}) &quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">            name = c.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          elsif c.respond_to?(:value)             </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">            v =  c.value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">            name = c.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">            v = c.id     </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">            name = c.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">          if c.respond_to?(:full_label)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">            name =  c.full_label              </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">          [&quot;#{vlabel}#{name} #{c.disabled ? &#39;[disabled]&#39; : &#39;&#39;}&quot;, downcase_if_string(v)] </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">        }.sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">    def name_for value</code>
        </li>
      
        <li class="covered" data-hits="4125" data-linenumber="144">
          <span class="hits">4125</span>
          
          <code class="ruby">      res = selector_name_value_pair.select{|p| p.last == value}    </code>
        </li>
      
        <li class="covered" data-hits="275" data-linenumber="145">
          <span class="hits">275</span>
          
          <code class="ruby">      res.length == 1 ? res.first.first : nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">  def invalidate_cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10444" data-linenumber="153">
          <span class="hits">10444</span>
          
          <code class="ruby">    logger.info &quot;College added or updated. Invalidating cache.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    # Unfortunately we have no way to clear pattern matched keys with memcached so we just clear the whole cache</code>
        </li>
      
        <li class="covered" data-hits="10444" data-linenumber="155">
          <span class="hits">10444</span>
          
          <code class="ruby">    Rails.cache.clear    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="60e8e1378419a616fe468b81ffcfd9f24aa2903e">
  <div class="header">
    <h3>app/models/concerns/source_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SourceValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="5">
          <span class="hits">54</span>
          
          <code class="ruby">    list = GeneralSelection.item_type_name_value_pair(record)</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="6">
          <span class="hits">162</span>
          
          <code class="ruby">    matches = (list.select {|a| a.last.downcase == value})</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="7">
          <span class="hits">54</span>
          
          <code class="ruby">    unless value.blank? || matches.length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">      Rails.logger.info &quot;Bad source for #{record} in list #{list}. Matches #{matches} with value #{value}&quot;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="9">
          <span class="hits">5</span>
          
          <code class="ruby">      record.errors.add attribute, (options[:message] || &quot;is not a valid Source&quot;) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="526659279e458ddf3851998c28870bd1e647fda7">
  <div class="header">
    <h3>app/models/concerns/standard_authentication.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module StandardAuthentication</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    before_validation :generate_password, on: :create    </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">    validates_uniqueness_of :email, :case_sensitive =&gt; false, :allow_blank =&gt; false, :if =&gt; :email_changed?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    validates_format_of :email, :with  =&gt; Devise.email_regexp, :allow_blank =&gt; false, :if =&gt; :email_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def force_password_reset</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    unlock_access!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    generate_password</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def new_password</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">    @new_password</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def disable!</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="20">
          <span class="hits">3</span>
          
          <code class="ruby">    self.disabled = true</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="21">
          <span class="hits">3</span>
          
          <code class="ruby">    self.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  protected  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # Generate a random password for a new user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # Return the plain text password in the new_password attribute</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def generate_password</code>
        </li>
      
        <li class="covered" data-hits="943" data-linenumber="29">
          <span class="hits">943</span>
          
          <code class="ruby">      generated_password = Devise.friendly_token.first(12)</code>
        </li>
      
        <li class="covered" data-hits="943" data-linenumber="30">
          <span class="hits">943</span>
          
          <code class="ruby">      @new_password = generated_password    </code>
        </li>
      
        <li class="covered" data-hits="943" data-linenumber="31">
          <span class="hits">943</span>
          
          <code class="ruby">      self.password = generated_password</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="81d5c00a6407037f39288299e2fcb949fa449385">
  <div class="header">
    <h3>app/models/concerns/tracker_handler.rb</h3>
    <h4><span class="green">90.63 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module TrackerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">    belongs_to :protocol</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    belongs_to :sub_process</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">    belongs_to :protocol_event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">    belongs_to :item, polymorphic: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_name</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="15">
          <span class="hits">15</span>
          
          <code class="ruby">    return nil unless self.protocol</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="16">
          <span class="hits">15</span>
          
          <code class="ruby">    self.protocol.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_position</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="20">
          <span class="hits">7</span>
          
          <code class="ruby">    return nil unless self.protocol</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="21">
          <span class="hits">7</span>
          
          <code class="ruby">    self.protocol.position</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def sub_process_name</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="25">
          <span class="hits">15</span>
          
          <code class="ruby">    return nil unless self.sub_process</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="26">
          <span class="hits">15</span>
          
          <code class="ruby">    self.sub_process.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def event_name</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="30">
          <span class="hits">15</span>
          
          <code class="ruby">    return nil unless self.protocol_event</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="31">
          <span class="hits">15</span>
          
          <code class="ruby">    self.protocol_event.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def event_milestone</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="35">
          <span class="hits">7</span>
          
          <code class="ruby">    return nil unless self.protocol_event</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="36">
          <span class="hits">7</span>
          
          <code class="ruby">    self.protocol_event.milestone</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def event_description    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    return nil unless self.protocol_event    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    self.protocol_event.description</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def record_type    </code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="45">
          <span class="hits">22</span>
          
          <code class="ruby">    self.attributes[&#39;item_type&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def record_id</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="49">
          <span class="hits">15</span>
          
          <code class="ruby">    self.attributes[&#39;item_id&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def record_type_us</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="53">
          <span class="hits">7</span>
          
          <code class="ruby">    return unless self.record_type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">    self.record_type.underscore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1d6a745e555e21c2bf40750c843ddcdfc35308f2">
  <div class="header">
    <h3>app/models/concerns/user_handler.rb</h3>
    <h4><span class="green">98.25 %</span> covered</h4>
    <div>
      <b>114</b> relevant lines. 
      <span class="green"><b>112</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="6">
          <span class="hits">8</span>
          
          <code class="ruby">    attr_accessor :no_track</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # Standard associations</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="8">
          <span class="hits">8</span>
          
          <code class="ruby">    Rails.logger.debug &quot;Associating master as inverse of #{assoc_inverse}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="10">
          <span class="hits">8</span>
          
          <code class="ruby">    belongs_to :master, assoc_rules</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="11">
          <span class="hits">8</span>
          
          <code class="ruby">    belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="13">
          <span class="hits">8</span>
          
          <code class="ruby">    has_many :item_flags, as: :item</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">    has_many :trackers, as: :item if self != Tracker &amp;&amp; self != TrackerHistory</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Ensure the user id is saved</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">    before_validation :force_write_user    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="19">
          <span class="hits">8</span>
          
          <code class="ruby">    before_validation :downcase_attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # This validation ensures that the user ID has been set in the master object </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # It implicitly reinforces security, in that the user must be authenticated for</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # the user to have been set</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="24">
          <span class="hits">8</span>
          
          <code class="ruby">    validate :user_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="26">
          <span class="hits">8</span>
          
          <code class="ruby">    validate :source_correct</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="27">
          <span class="hits">8</span>
          
          <code class="ruby">    validate :rank_correct</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="29">
          <span class="hits">8</span>
          
          <code class="ruby">    after_save :check_status</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="30">
          <span class="hits">8</span>
          
          <code class="ruby">    after_save :track_record_update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  class_methods do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    def uses_item_flags?      </code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="36">
          <span class="hits">41</span>
          
          <code class="ruby">      ItemFlagName.enabled_for? self.name.underscore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def foreign_key_name</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="40">
          <span class="hits">16</span>
          
          <code class="ruby">      @foreign_key_name = :master_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def primary_key_name</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="44">
          <span class="hits">16</span>
          
          <code class="ruby">      @primary_key_name = :id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def assoc_rules</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="48">
          <span class="hits">8</span>
          
          <code class="ruby">      r = {inverse_of: assoc_inverse}      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="49">
          <span class="hits">8</span>
          
          <code class="ruby">      r[:foreign_key] = self.foreign_key_name if self.foreign_key_name &amp;&amp; self.foreign_key_name != :master_id</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="50">
          <span class="hits">8</span>
          
          <code class="ruby">      r[:primary_key] = self.primary_key_name if self.primary_key_name &amp;&amp; self.primary_key_name != :id</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="51">
          <span class="hits">8</span>
          
          <code class="ruby">      r</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def assoc_inverse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      # The plural model name</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="57">
          <span class="hits">16</span>
          
          <code class="ruby">      self.to_s.underscore.pluralize.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_rank_name value</code>
        </li>
      
        <li class="covered" data-hits="331" data-linenumber="61">
          <span class="hits">331</span>
          
          <code class="ruby">      GeneralSelection.name_for self, value, :rank    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_source_name value</code>
        </li>
      
        <li class="covered" data-hits="467" data-linenumber="64">
          <span class="hits">467</span>
          
          <code class="ruby">      GeneralSelection.name_for self, value, :source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_admin?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    if respond_to?(:master) &amp;&amp; master      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">      master.is_admin?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def master_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="2700" data-linenumber="78">
          <span class="hits">2700</span>
          
          <code class="ruby">    if respond_to?(:master) &amp;&amp; master      </code>
        </li>
      
        <li class="covered" data-hits="2700" data-linenumber="79">
          <span class="hits">2700</span>
          
          <code class="ruby">      current_user = master.current_user      </code>
        </li>
      
        <li class="covered" data-hits="2700" data-linenumber="80">
          <span class="hits">2700</span>
          
          <code class="ruby">      current_user </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    else      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_name</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="87">
          <span class="hits">41</span>
          
          <code class="ruby">    logger.debug &quot;Getting username for #{self.user}&quot;</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="88">
          <span class="hits">41</span>
          
          <code class="ruby">    return nil unless self.user</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="89">
          <span class="hits">41</span>
          
          <code class="ruby">    self.user.email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  # Prevent user from being set directly, to avoid accidental or malicious changes to the recorded user in records</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">  def user= u</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    raise &quot;can not set user=&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id= u</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">    raise &quot;can not set user_id=&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  def rank_name</code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="103">
          <span class="hits">135</span>
          
          <code class="ruby">    return nil unless respond_to? :rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="105">
          <span class="hits">135</span>
          
          <code class="ruby">    self.class.get_rank_name self.rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">  def source_name</code>
        </li>
      
        <li class="covered" data-hits="193" data-linenumber="109">
          <span class="hits">193</span>
          
          <code class="ruby">    return nil unless respond_to? :source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="193" data-linenumber="111">
          <span class="hits">193</span>
          
          <code class="ruby">    self.class.get_source_name self.source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_action</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="116">
          <span class="hits">41</span>
          
          <code class="ruby">    @update_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">  def multiple_results</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="120">
          <span class="hits">6</span>
          
          <code class="ruby">    @multiple_results ||= []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">  def multiple_results=mr</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="124">
          <span class="hits">10</span>
          
          <code class="ruby">    @multiple_results = mr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_multiple_results</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="128">
          <span class="hits">29</span>
          
          <code class="ruby">    @multiple_results &amp;&amp; @multiple_results.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_type</code>
        </li>
      
        <li class="covered" data-hits="233" data-linenumber="132">
          <span class="hits">233</span>
          
          <code class="ruby">    self.class.name.singularize.underscore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_status</code>
        </li>
      
        <li class="covered" data-hits="825" data-linenumber="136">
          <span class="hits">825</span>
          
          <code class="ruby">    @was_created = id_changed? ? &#39;created&#39; : false</code>
        </li>
      
        <li class="covered" data-hits="825" data-linenumber="137">
          <span class="hits">825</span>
          
          <code class="ruby">    @was_updated = updated_at_changed? ? &#39;updated&#39; : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">  def _created</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="141">
          <span class="hits">41</span>
          
          <code class="ruby">    @was_created</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">  def _updated</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="145">
          <span class="hits">41</span>
          
          <code class="ruby">    @was_updated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json extras={}</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="149">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:include] ||= {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    # Re-enable the following line if there is a need to incorporate item flags back into all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    # objects attached to a master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="153">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:include][:item_flags] = {include: [:item_flag_name], methods: [:method_id, :item_type_us]} if self.class.uses_item_flags?</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="154">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] ||= []</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="155">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :user_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">    # update_action can be used by requestor to identify whether the record was just updated (saved) or not</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="157">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :update_action</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="158">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :item_type</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="159">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :_created</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="160">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :_updated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="162">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :rank_name if respond_to? :rank        </code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="163">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :state_name if respond_to? :state</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="164">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :country_name if respond_to? :country</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="165">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :source_name if respond_to? :source</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="166">
          <span class="hits">41</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :accuracy_score_name if respond_to? :accuracy_score</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="167">
          <span class="hits">41</span>
          
          <code class="ruby">    super(extras)    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">    def creatable_without_user</code>
        </li>
      
        <li class="covered" data-hits="1778" data-linenumber="173">
          <span class="hits">1778</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">    def downcase_attributes    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1004" data-linenumber="178">
          <span class="hits">1004</span>
          
          <code class="ruby">      ignore = [&#39;item_type&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="13451" data-linenumber="180">
          <span class="hits">13451</span>
          
          <code class="ruby">      self.attributes.reject {|k,v| ignore.include? k}.each do |k, v|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11909" data-linenumber="182">
          <span class="hits">11909</span>
          
          <code class="ruby">        logger.info &quot;Downcasing attribute (#{k})&quot;</code>
        </li>
      
        <li class="covered" data-hits="11909" data-linenumber="183">
          <span class="hits">11909</span>
          
          <code class="ruby">        self.send(&quot;#{k}=&quot;.to_sym, v.downcase) if self.attributes[k].is_a? String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1004" data-linenumber="185">
          <span class="hits">1004</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">    def user_set </code>
        </li>
      
        <li class="covered" data-hits="1004" data-linenumber="189">
          <span class="hits">1004</span>
          
          <code class="ruby">      return true if creatable_without_user &amp;&amp; !persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="899" data-linenumber="191">
          <span class="hits">899</span>
          
          <code class="ruby">      unless self.user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby">        errors.add :user, &quot;must be authenticated and set&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">    def force_write_user</code>
        </li>
      
        <li class="covered" data-hits="1004" data-linenumber="196">
          <span class="hits">1004</span>
          
          <code class="ruby">      return true if creatable_without_user &amp;&amp; !persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="899" data-linenumber="198">
          <span class="hits">899</span>
          
          <code class="ruby">      raise &quot;bad user being pulled from master_user&quot; unless master_user.is_a?(User) &amp;&amp; master_user.persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="899" data-linenumber="200">
          <span class="hits">899</span>
          
          <code class="ruby">      write_attribute :user_id, master_user.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">    def track_record_update</code>
        </li>
      
        <li class="covered" data-hits="880" data-linenumber="204">
          <span class="hits">880</span>
          
          <code class="ruby">      return if no_track</code>
        </li>
      
        <li class="covered" data-hits="780" data-linenumber="205">
          <span class="hits">780</span>
          
          <code class="ruby">      @update_action = true</code>
        </li>
      
        <li class="covered" data-hits="780" data-linenumber="206">
          <span class="hits">780</span>
          
          <code class="ruby">      Tracker.track_record_update self </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">    def source_correct      </code>
        </li>
      
        <li class="covered" data-hits="1004" data-linenumber="210">
          <span class="hits">1004</span>
          
          <code class="ruby">      if respond_to?(:source) &amp;&amp; self.source       </code>
        </li>
      
        <li class="covered" data-hits="169" data-linenumber="211">
          <span class="hits">169</span>
          
          <code class="ruby">        errors.add :source, &quot;(#{self.source}) not a valid value&quot; unless source_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">      end      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">    def rank_correct      </code>
        </li>
      
        <li class="covered" data-hits="1004" data-linenumber="217">
          <span class="hits">1004</span>
          
          <code class="ruby">      if respond_to?(:rank) &amp;&amp; self.rank</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="218">
          <span class="hits">212</span>
          
          <code class="ruby">        errors.add :rank, &quot;(#{self.rank}) not a valid value&quot; unless rank_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">      end      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9e4cd2b8d11449b31e8bae86b8ded09292dcc629">
  <div class="header">
    <h3>app/models/concerns/zip_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ZipValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="3">
          <span class="hits">6</span>
          
          <code class="ruby">    record.errors.add attribute, (options[:message] || &quot;is not a valid ZIP&quot;) unless</code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="4">
          <span class="hits">49</span>
          
          <code class="ruby">      value =~ /^[0-9]{5}(-[0-9]{4})?$/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="cbfa9322b89f5428518a0b4ccc7cdd8589319832">
  <div class="header">
    <h3>app/models/dynamic_model.rb</h3>
    <h4><span class="red">25.78 %</span> covered</h4>
    <div>
      <b>128</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>95</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class DynamicModel &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="5">
          <span class="hits">4</span>
          
          <code class="ruby">  default_scope -&gt; {order disabled: :asc, category: :asc, position: :asc,  updated_at: :desc }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :editable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  after_commit :reload_model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.orientation category</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    return :horizontal if category.to_s.include?(&#39;history&#39;) </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    return :vertical</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def reload_model</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    generate_model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Now forcibly set the Master association:</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    dm = self</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    Master.has_many dm.model_association_name, inverse_of: :master , class_name: &quot;DynamicModel::#{dm.model_class_name}&quot;, foreign_key: dm.foreign_key_name, primary_key: dm.primary_key_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    self.class.routes_reload</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.categories</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    active.select(:category).distinct(:category).unscope(:order).map {|s| s.category||&#39;default&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # This is intentionally a class variable, to capture the model names for all dynamic models</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.model_names</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    @model_names ||= []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.model_names= m</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    @model_names = m</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.model_name_strings</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    model_names.map {|m| m.to_s}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.models</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    @models ||= {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_def_name </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    table_name.singularize.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_association_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    table_name.pluralize.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_path_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">    table_name.pluralize.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_data_template_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">    model_association_name.to_s.hyphenate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_class_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    table_name.singularize.camelcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def model_def</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">    self.class.models[model_def_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_models</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">    dma = DynamicModel.active</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    logger.info &quot;Generating dynamic models #{DynamicModel.active.length}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">    dma.each do |dm|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">      dm.generate_model       </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">    rescue =&gt;e      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">      Rails.logger.warn &quot; Failed to generate dynamic models. Hopefully this is during a migration. #{e.inspect}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  def generate_model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">    obj = self</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">    failed = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">    if enabled? &amp;&amp; !failed # !DynamicModel.const_defined?(model_class_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">        pkn = (self.primary_key_name).to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">        fkn = (self.foreign_key_name || &#39;master_id&#39;).to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">        tkn = (self.table_key_name || &#39;id&#39;).to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">        man = self.model_association_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">        ro = self.result_order </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">        a_new_class = Class.new(ActiveRecord::Base) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">          def self.is_dynamic_module</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">            true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">          self.table_name = obj.table_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">          def self.assoc_inverse= man</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">            @assoc_inverse = man</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">          def self.assoc_inverse</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">            @assoc_inverse </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">          def self.foreign_key_name= fkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">            @foreign_key_name = fkn</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">          end          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">          def self.foreign_key_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">            @foreign_key_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">          def self.primary_key_name= pkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">            @primary_key_name = pkn</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">          end          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">          def self.primary_key_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">            @primary_key_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">          def self.result_order= ro</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">            @result_order = ro </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">            unless ro.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">              default_scope -&gt; {order ro}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">          end          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">          def self.result_order</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">            @result_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">          self.primary_key = tkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">          self.foreign_key_name = fkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">          self.primary_key_name = pkn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">          self.assoc_inverse = man</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">          self.result_order = ro</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">          def master_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">            master.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="147">
          
          
          <code class="ruby">          def self.find id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby">            find_by(primary_key =&gt; id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">          def id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">            self.attributes[self.class.primary_key.to_s]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">        a_new_controller = Class.new(ApplicationController) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="159">
          
          
          <code class="ruby">          def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">          def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">          def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">          def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="172">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">          def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">            not_authorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby">          private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="181">
          
          
          <code class="ruby">            def secure_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">        m_name = model_class_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="187">
          
          
          <code class="ruby">        res = DynamicModel.const_set(model_class_name, a_new_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">        # Do the include after naming, to ensure the correct names are used during initialization</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="189">
          
          
          <code class="ruby">        res.include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby">        c_name = &quot;#{table_name.pluralize.camelcase}Controller&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">        res2 = DynamicModel.const_set(c_name, a_new_controller)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">        # Do the include after naming, to ensure the correct names are used during initialization</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">        res2.include MasterHandler  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="197">
          
          
          <code class="ruby">        logger.info &quot;Model Name: #{m_name} + Controller #{c_name}. Def:\n#{res}\n#{res2}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby">        tn = model_def_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">        self.class.models[tn] = res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">        unless self.class.model_names.include? tn</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">          self.class.model_names &lt;&lt; tn</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">      rescue=&gt;e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">        failed = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">        logger.info &quot;Failure creating a dynamic model definition. #{e.inspect}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">    if failed || !enabled?    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">      logger.info &quot;Removed disabled model #{tn}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="213">
          
          
          <code class="ruby">      self.class.models.delete(tn)  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">      self.class.model_names -= [tn]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.routes_load</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">    mn = model_names</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">    Rails.application.routes.draw do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">      resources :masters do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">        namespace :dynamic_model do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">          mn.each do |pg|         </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="228">
          
          
          <code class="ruby">            resources pg.to_s.pluralize.to_sym, except: [:destroy]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.routes_reload</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">    Rails.application.reload_routes!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">    Rails.application.routes_reloader.reload!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby"># Force the initialization. Do this here, rather than an initializer, since forces a reload if rails reloads classes in development mode.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">DynamicModel.define_models</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0566ccc727d6edbcf0dde8445a76c370417ae15d">
  <div class="header">
    <h3>app/models/external_link.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ExternalLink &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a6ade0086539fb2ed04cc9c33c13fba1ee8342e8">
  <div class="header">
    <h3>app/models/general_selection.rb</h3>
    <h4><span class="green">96.55 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>28</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class GeneralSelection &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # Handle general selection functionality, typically for looking up drop-down values from cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  BasicItemTypes = [:player_infos_source, :player_contacts_type, :player_contacts_source, :addresses_type, :addresses_source, :addresses_rank, :player_contacts_rank]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="4257" data-linenumber="9">
          <span class="hits">4257</span>
          
          <code class="ruby">  default_scope {order  item_type: :asc, disabled: :asc, position: :asc}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_value_change,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :value, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_types</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    BasicItemTypes + Report.item_types</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # Format the item type source string for looking up different selection types from the general_selections table  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_type_source_for record, type=:source</code>
        </li>
      
        <li class="covered" data-hits="852" data-linenumber="22">
          <span class="hits">852</span>
          
          <code class="ruby">    if record.respond_to?(:class) &amp;&amp; record.class != Class</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="23">
          <span class="hits">54</span>
          
          <code class="ruby">      klass = record.class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="798" data-linenumber="25">
          <span class="hits">798</span>
          
          <code class="ruby">      klass = record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end      </code>
        </li>
      
        <li class="covered" data-hits="852" data-linenumber="27">
          <span class="hits">852</span>
          
          <code class="ruby">    &quot;#{klass.name.pluralize.underscore}_#{type}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # Get an array of name value pairs for a particular record, and the type of attribute it corresponds to</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_type_name_value_pair record, type=:source</code>
        </li>
      
        <li class="covered" data-hits="852" data-linenumber="32">
          <span class="hits">852</span>
          
          <code class="ruby">    src = item_type_source_for record, type  </code>
        </li>
      
        <li class="covered" data-hits="852" data-linenumber="33">
          <span class="hits">852</span>
          
          <code class="ruby">    selector_name_value_pair(item_type: src)       </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # Quickly lookup the name for a general_selection record with a specific value, corresponding to a &#39;record&#39;, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # with the type of attribute it corresponds to </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.name_for record, value, type=:source</code>
        </li>
      
        <li class="covered" data-hits="798" data-linenumber="39">
          <span class="hits">798</span>
          
          <code class="ruby">    res = item_type_name_value_pair record, type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3056" data-linenumber="41">
          <span class="hits">3056</span>
          
          <code class="ruby">    resn = res.select {|l| l.last.to_s == value.to_s}</code>
        </li>
      
        <li class="covered" data-hits="798" data-linenumber="42">
          <span class="hits">798</span>
          
          <code class="ruby">    if resn.length == 1</code>
        </li>
      
        <li class="covered" data-hits="575" data-linenumber="43">
          <span class="hits">575</span>
          
          <code class="ruby">      return resn.first.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    return        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_value_change </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="51">
          <span class="hits">5</span>
          
          <code class="ruby">      if value_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:value, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="54">
          <span class="hits">5</span>
          
          <code class="ruby">      if item_type_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:item_type, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9d971e01eac2d0eda1e01a3d3ddec13d74794c7f">
  <div class="header">
    <h3>app/models/item_flag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>58</b> relevant lines. 
      <span class="green"><b>58</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ItemFlag &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :item, polymorphic: true, inverse_of: :item_flags</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :item_flag_name  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_item_change,  on: :update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # We must have a user set to save a record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Since we don&#39;t include the UserHandler module, it is necessary for users of this class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # to explicitly set the user.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # In future we can consider incorporating this into the UserHandler structure, but currently</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # all UserHandler classes belong directly to a master, and flags only belong to a master indirectly</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # through an item.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # Since an item_flag entry is only created or deleted (not updated), setting the user explicitly on </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # create is reasonable.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :user, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_flag_name_id, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_flag_name, presence: true  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :works_with_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="108" data-linenumber="24">
          <span class="hits">108</span>
          
          <code class="ruby">  default_scope -&gt; {where &quot;disabled is null or disabled = false&quot;}  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.works_with class_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # Get the value from the array and return it, so we can return a value that is not the original passed in (failing Brakeman test otherwise)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="28">
          <span class="hits">13</span>
          
          <code class="ruby">    pos = use_with_class_names.index(class_name.underscore)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="29">
          <span class="hits">13</span>
          
          <code class="ruby">    if pos      </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="30">
          <span class="hits">8</span>
          
          <code class="ruby">      use_with_class_names[pos.to_i].camelize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.use_with_class_names</code>
        </li>
      
        <li class="covered" data-hits="3584" data-linenumber="37">
          <span class="hits">3584</span>
          
          <code class="ruby">    Master.reflect_on_all_associations(:has_many).select {|v| v.options[:source] != :item_flags}.collect {|v| v.plural_name.singularize}.sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def works_with_class</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="41">
          <span class="hits">17</span>
          
          <code class="ruby">    self.class.use_with_class_names.include? item_type    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  # Create and remove flags for the underlying item.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  # Returns true if flags were added or removed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.set_flags flag_list, item, current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="50">
          <span class="hits">5</span>
          
          <code class="ruby">    current_flags = item.item_flags.map {|f| f.item_flag_name_id}.uniq</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="51">
          <span class="hits">4</span>
          
          <code class="ruby">    added_flags = flag_list - current_flags</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="52">
          <span class="hits">4</span>
          
          <code class="ruby">    removed_flags =  current_flags - flag_list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">    logger.info &quot;Current flags #{current_flags} in #{item}&quot;    </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">    logger.info &quot;Removing flags #{removed_flags} from #{item}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="56">
          <span class="hits">4</span>
          
          <code class="ruby">    logger.info &quot;Adding flags #{added_flags} to #{item}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="58">
          <span class="hits">4</span>
          
          <code class="ruby">    item.item_flags.where(item_flag_name_id: removed_flags).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">        i.disabled = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">        i.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="63">
          <span class="hits">4</span>
          
          <code class="ruby">    added_flags.each do |f|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="64">
          <span class="hits">4</span>
          
          <code class="ruby">      unless f.blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="65">
          <span class="hits">4</span>
          
          <code class="ruby">        i = item.item_flags.build item_flag_name_id: f, user: current_user</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="66">
          <span class="hits">4</span>
          
          <code class="ruby">        logger.info &quot;Added flag #{f} to #{item}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="67">
          <span class="hits">4</span>
          
          <code class="ruby">        i.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    # Reload the association to have it register the changes    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="72">
          <span class="hits">3</span>
          
          <code class="ruby">    item.item_flags.reload        </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="73">
          <span class="hits">3</span>
          
          <code class="ruby">    item.master.current_user = current_user      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="75">
          <span class="hits">6</span>
          
          <code class="ruby">    logger.info &quot;Remaining flags in #{item} for #{item.master_user}: #{item.item_flags.map {|f| f.id}}&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="76">
          <span class="hits">3</span>
          
          <code class="ruby">    if added_flags.length &gt; 0 || removed_flags.length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="77">
          <span class="hits">3</span>
          
          <code class="ruby">      ItemFlag.track_flag_updates item, added_flags, removed_flags</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">      update_action = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="81">
          <span class="hits">3</span>
          
          <code class="ruby">    return update_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">  def method_id </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="86">
          <span class="hits">6</span>
          
          <code class="ruby">    self.item.master_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_type_us</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="90">
          <span class="hits">6</span>
          
          <code class="ruby">    self.item_type.underscore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json options={}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="95">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:methods] ||= []</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="96">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:methods] += [:method_id, :item_type_us]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="97">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:include] ||=[]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="98">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:include] &lt;&lt; :item_flag_name</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="99">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:done] = true</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="100">
          <span class="hits">6</span>
          
          <code class="ruby">    super(options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.track_flag_updates item, added_flags, removed_flags</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="107">
          <span class="hits">3</span>
          
          <code class="ruby">      logger.info &quot;Track record update for added item_flags #{added_flags} and removed #{removed_flags}&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="108">
          <span class="hits">3</span>
          
          <code class="ruby">      Tracker.track_flag_update item, added_flags, removed_flags</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_item_change</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">      errors.add :item_flag_name_id, &quot;can not be changed&quot; if item_flag_name_id_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9dd373790283d270f04af16fa96f9c4f1fc4ea30">
  <div class="header">
    <h3>app/models/item_flag_name.rb</h3>
    <h4><span class="green">92.59 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ItemFlagName &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_item_type_change,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true, uniqueness: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_type, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :item_type_valid?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  after_validation  :update_tracker_events</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="861" data-linenumber="11">
          <span class="hits">861</span>
          
          <code class="ruby">  default_scope -&gt; {order  &quot;item_flag_names.updated_at DESC nulls last&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.enabled_for? item_type</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="14">
          <span class="hits">41</span>
          
          <code class="ruby">    logger.debug &quot;Checking we&#39;re enabled for #{item_type}&quot;</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="15">
          <span class="hits">41</span>
          
          <code class="ruby">    l = selector_array item_type: item_type</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="16">
          <span class="hits">41</span>
          
          <code class="ruby">    l.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.item_types</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    selector_array(nil, :item_type).uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def item_type_valid?</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="26">
          <span class="hits">77</span>
          
          <code class="ruby">      return unless item_type</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="27">
          <span class="hits">74</span>
          
          <code class="ruby">      cns = ItemFlag.use_with_class_names</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="28">
          <span class="hits">74</span>
          
          <code class="ruby">      unless  cns.include? item_type.underscore</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">          errors.add(:item_type, &quot;is attempting to use invalid item type #{item_type}. Valid items are #{cns}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_item_type_change </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="34">
          <span class="hits">7</span>
          
          <code class="ruby">      if item_type_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">        errors.add(:item_type, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def update_tracker_events</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="40">
          <span class="hits">77</span>
          
          <code class="ruby">      return unless item_type</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="41">
          <span class="hits">74</span>
          
          <code class="ruby">      Tracker.add_record_update_entries item_type, current_admin, &#39;flag&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e3919ff62130f0f677c7cdbeb435ea105c525eea">
  <div class="header">
    <h3>app/models/master.rb</h3>
    <h4><span class="yellow">81.67 %</span> covered</h4>
    <div>
      <b>60</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Master &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # inverse_of required to ensure the current_user propagates between associated models correctly</code>
        </li>
      
        <li class="covered" data-hits="126" data-linenumber="8">
          <span class="hits">126</span>
          
          <code class="ruby">  has_many :player_infos, -&gt; { order(PlayerInfoRankOrderClause)  } , inverse_of: :master  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :pro_infos , inverse_of: :master  </code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="10">
          <span class="hits">49</span>
          
          <code class="ruby">  has_many :player_contacts, -&gt; { order(RankNotNullClause)}, inverse_of: :master</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="11">
          <span class="hits">44</span>
          
          <code class="ruby">  has_many :addresses, -&gt; { order(RankNotNullClause)}  , inverse_of: :master</code>
        </li>
      
        <li class="covered" data-hits="269" data-linenumber="12">
          <span class="hits">269</span>
          
          <code class="ruby">  has_many :trackers, -&gt; { includes(:protocol).order(TrackerEventOrderClause)}, inverse_of: :master</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :tracker_histories, -&gt; { order(TrackerHistoryEventOrderClause)}, inverse_of: :master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">  has_many :latest_tracker_history, -&gt; { order(id: :desc).limit(1)},  class_name: &#39;TrackerHistory&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  # Note that additional has_many associations are added dynamically by the external_id handlers,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # such as Scantron, SageAssignment, etc. This is handled through the external_id_yyy_settings.rb call to Class.add_to_app_list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # In doing so, we enable these models to be self contained and manage the configuration of the two-way associations with masters themselves,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # without having to update the Master model directly. This is important to allow the command:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # `rails generate rails g external_id_handler test_thing` to function without having to hack this master.rb file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :set_user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_user_updates,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :user, presence: true  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  before_create :assign_msid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  DynamicModel.active.each do |dm|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    has_many dm.model_association_name, inverse_of: :master , class_name: &quot;DynamicModel::#{dm.model_class_name}&quot;, foreign_key: dm.foreign_key_name, primary_key: dm.primary_key_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    Rails.logger.debug &quot;Associated master with #{dm.model_association_name} with class_name: DynamicModel::#{dm.model_class_name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  Master.reflect_on_all_associations(:has_many).each do |assoc| </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # This association is provided to allow generic search on flagged associated object</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="39">
          <span class="hits">7</span>
          
          <code class="ruby">    has_many &quot;#{assoc.plural_name}_item_flags&quot;.to_sym, through: assoc.plural_name, source: :item_flags</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="40">
          <span class="hits">7</span>
          
          <code class="ruby">    Rails.logger.debug &quot;Associated master with #{assoc.plural_name}_item_flags through #{assoc.plural_name} with source :item_flags&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :force_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  # Move all the simple and advance search form functionality out of the way, so the data functionality of the model can be clearly seen</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  include MasterSearchHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def accuracy_rank</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    pi = player_infos.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    return -1000 unless pi</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    pi.accuracy_rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  # Current admin is not stored, but may be used in validations for administrative level changes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_admin=ca</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="60">
          <span class="hits">85</span>
          
          <code class="ruby">    @current_admin = ca.is_a?(Admin)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_admin?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">    !!@current_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user= cu</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="449" data-linenumber="69">
          <span class="hits">449</span>
          
          <code class="ruby">    if cu.is_a? User</code>
        </li>
      
        <li class="covered" data-hits="449" data-linenumber="70">
          <span class="hits">449</span>
          
          <code class="ruby">      @current_user = cu</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">    elsif cu.is_a? Integer</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">      @current_user = User.find cu</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">      raise &quot;Attempting to set current_user with non user: #{cu}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user</code>
        </li>
      
        <li class="covered" data-hits="2700" data-linenumber="79">
          <span class="hits">2700</span>
          
          <code class="ruby">    logger.info &quot;Getting current user: #{@user_id} from #{self}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    # Do not get the user association when requesting the current_user, since we </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    # do not want the value that has been persisted in the data</code>
        </li>
      
        <li class="covered" data-hits="2700" data-linenumber="82">
          <span class="hits">2700</span>
          
          <code class="ruby">    @current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  # Prevent user from being set directly, to avoid accidental or malicious changes to the recorded user in records</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def user= u</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">    raise &quot;can not set user=&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id= u</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">    raise &quot;can not set user_id=&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_master_records user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="96">
          <span class="hits">3</span>
          
          <code class="ruby">    raise &quot;no user specified&quot; unless user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="98">
          <span class="hits">3</span>
          
          <code class="ruby">    m = Master.create!(current_user: user)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="99">
          <span class="hits">3</span>
          
          <code class="ruby">    m.player_infos.create!</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="100">
          <span class="hits">3</span>
          
          <code class="ruby">    return m</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">  def assign_msid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="357" data-linenumber="108">
          <span class="hits">357</span>
          
          <code class="ruby">    max_msid = Master.maximum(:msid) || 0</code>
        </li>
      
        <li class="covered" data-hits="357" data-linenumber="109">
          <span class="hits">357</span>
          
          <code class="ruby">    self.msid = max_msid + 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">  def prevent_user_updates</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="114">
          <span class="hits">3</span>
          
          <code class="ruby">    errors.add :pro_id, &quot;can not be updated by users&quot; if pro_id_changed?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="115">
          <span class="hits">3</span>
          
          <code class="ruby">    errors.add :msid, &quot;can not be updated by users&quot; if msid_changed?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="116">
          <span class="hits">3</span>
          
          <code class="ruby">    errors.add &quot;pro info association&quot;, &quot;can not be updated by users&quot; if pro_info_id_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_user</code>
        </li>
      
        <li class="covered" data-hits="360" data-linenumber="120">
          <span class="hits">360</span>
          
          <code class="ruby">    cu = @current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">    # Set the user association when current_user is set</code>
        </li>
      
        <li class="covered" data-hits="360" data-linenumber="122">
          <span class="hits">360</span>
          
          <code class="ruby">    if cu.is_a?(User) &amp;&amp; cu.persisted?</code>
        </li>
      
        <li class="covered" data-hits="360" data-linenumber="123">
          <span class="hits">360</span>
          
          <code class="ruby">      write_attribute :user_id, cu.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">      raise &quot;Attempting to set user with non user: #{cu}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a726b169f874bbacd39b5858c31bd042a5592a67">
  <div class="header">
    <h3>app/models/player_contact.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PlayerContact &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  PrimaryRank = 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  SecondaryRank = 5</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  InactiveRank = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :data, email: true, if: :is_email?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :data, phone: true, if: :is_phone?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :source, source: true, allow_blank: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :rank, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :handle_primary_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">     </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def is_email?</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="18">
          <span class="hits">75</span>
          
          <code class="ruby">      rec_type == &#39;email&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def is_phone?</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="21">
          <span class="hits">75</span>
          
          <code class="ruby">      rec_type == &#39;phone&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    # A master record can only have one email and one phone with rank set to Primary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # If a new player contact record is created or an existing record is updated with Primary rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # then update any other records for the master of that type (email or phone) to Secondary</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def handle_primary_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="29">
          <span class="hits">61</span>
          
          <code class="ruby">      if self.rank.to_i == PrimaryRank</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="30">
          <span class="hits">24</span>
          
          <code class="ruby">        logger.info &quot;Player Contact rank set as primary in contact #{self.id} for type #{self.rec_type}. </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">                    Setting other player contacts for this master to secondary if they were primary and have the type #{self.rec_type}.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="33">
          <span class="hits">24</span>
          
          <code class="ruby">        self.master.player_contacts.where(rank: PrimaryRank, rec_type: self.rec_type).each do |a|</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="34">
          <span class="hits">27</span>
          
          <code class="ruby">          logger.info &quot;Player Contact #{a.id} has primary rank currently. Current ID is #{self.id}&quot;</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="35">
          <span class="hits">27</span>
          
          <code class="ruby">          if a.id != self.id </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">            logger.info &quot;Player Contact #{a.id} has primary rank currently. Setting it to secondary&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">            a.rank = 5</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="38">
          <span class="hits">3</span>
          
          <code class="ruby">            a.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="39">
          <span class="hits">3</span>
          
          <code class="ruby">            multiple_results &lt;&lt; a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="bbeb87e908084a50aa0523e111c2b51ac5f1bdf0">
  <div class="header">
    <h3>app/models/player_info.rb</h3>
    <h4><span class="yellow">86.49 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PlayerInfo &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  BestAccuracyScore = 12</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  FollowUpScore = 881</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  BirthDateRanks = 1..BestAccuracyScore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Allow simple search and compound searches to function</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :contact_data, :younger_than, :older_than, :age</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_user_changes, on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :dates_sensible</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :source, presence: true, if: :rank?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :check_college</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def accuracy_rank    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    if rank &amp;&amp; rank &gt; BestAccuracyScore  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      return rank * -1 </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    elsif !rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    else </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      return rank </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def accuracy_score_name </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    rank_name    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # Override the standard rank_name, to ensure correct validation, since </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  # player ranks are a special case and are defined as AccuracyScore instances</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def rank_name    </code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="36">
          <span class="hits">101</span>
          
          <code class="ruby">    PlayerInfo.get_rank_name self.rank    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_rank_name value</code>
        </li>
      
        <li class="covered" data-hits="275" data-linenumber="39">
          <span class="hits">275</span>
          
          <code class="ruby">    AccuracyScore.name_for(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def dates_sensible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="47">
          <span class="hits">122</span>
          
          <code class="ruby">      latest_year = Time.now.year+1</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="48">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;start year&#39;, &quot;is after #{latest_year}&quot;) if start_year &amp;&amp; start_year &gt; latest_year</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="49">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;end year&#39;, &quot;is after  #{latest_year}&quot;) if end_year &amp;&amp; end_year &gt; latest_year</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="50">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;start year&#39;, &#39;and end year are not sensible&#39;) if end_year &amp;&amp; start_year &amp;&amp; start_year &gt; end_year</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="51">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;birth date&#39;, &#39;and death date are not sensible&#39;) if birth_date &amp;&amp; death_date &amp;&amp; birth_date &gt; death_date</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="52">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;birth date&#39;, &#39;is after today&#39;) if birth_date &amp;&amp; birth_date &gt; DateTime.now</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="53">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;death date&#39;, &#39;is after today&#39;) if death_date &amp;&amp; death_date &gt; DateTime.now</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="54">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;start year&#39;, &quot;is more than 30 years after birth date&quot;) if start_year &amp;&amp; birth_date &amp;&amp; start_year &gt; (birth_date + 29.years).year</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="55">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;start year&#39;, &quot;is less than 19 years after birth date&quot;) if start_year &amp;&amp; birth_date &amp;&amp; start_year &lt; (birth_date + 19.years).year</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      # Make this restriction less strict... Only prevent birth date for &#39;real&#39; players.</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="58">
          <span class="hits">122</span>
          
          <code class="ruby">      errors.add(&#39;birth date&#39;, &quot;must be set if rank is set to \&quot;#{BirthDateRanks}\&quot;&quot;) if !birth_date &amp;&amp; rank &amp;&amp; BirthDateRanks.include?(rank)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    def check_college</code>
        </li>
      
        <li class="covered" data-hits="107" data-linenumber="62">
          <span class="hits">107</span>
          
          <code class="ruby">      College.create_if_new college, user unless college.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_user_changes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="67">
          <span class="hits">18</span>
          
          <code class="ruby">      errors.add :source, &quot;can not be updated by a user after a record has been created. Contact an administrator to change this field.&quot; if source_changed? &amp;&amp; !source_was.nil? &amp;&amp; !is_admin?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4b640a21d9d5e69435a3a8b97529f22b0179d942">
  <div class="header">
    <h3>app/models/pro_info.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProInfo &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_update :prevent_save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Handle special functionality and allow simple search and compound searches to function</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :enable_updates, :contact_data, :less_than_career_years, :more_than_career_years</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def prevent_save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">      return false unless @enable_updates</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # Override to not track this</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def track_record_update</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="17">
          <span class="hits">55</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d5f026daf6e02450afcf952393f88f4a2f2d2798">
  <div class="header">
    <h3>app/models/protocol.rb</h3>
    <h4><span class="green">92.86 %</span> covered</h4>
    <div>
      <b>14</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Protocol &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  RecordUpdatesProtocolName = &#39;Updates&#39;.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :sub_processes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2378" data-linenumber="10">
          <span class="hits">2378</span>
          
          <code class="ruby">  default_scope -&gt; { order position: :asc }</code>
        </li>
      
        <li class="covered" data-hits="169" data-linenumber="11">
          <span class="hits">169</span>
          
          <code class="ruby">  scope :updates, -&gt; { where &quot;name = &#39;#{RecordUpdatesProtocolName}&#39; AND (disabled IS NULL OR disabled = FALSE)&quot; }</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="12">
          <span class="hits">44</span>
          
          <code class="ruby">  scope :selectable, -&gt; { enabled.where(&quot;name &lt;&gt; ?&quot;, RecordUpdatesProtocolName)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # A simple method to cache the record that is used to indicate Tracker Updates</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # so that we can quickly and repetitively user this</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.record_updates_protocol</code>
        </li>
      
        <li class="covered" data-hits="521" data-linenumber="23">
          <span class="hits">521</span>
          
          <code class="ruby">    Rails.cache.fetch &quot;record_updates_protocol&quot; do</code>
        </li>
      
        <li class="covered" data-hits="94" data-linenumber="24">
          <span class="hits">94</span>
          
          <code class="ruby">      enabled.updates.take</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fe4b6a68b932989ba3f874b6f9ef47f67325d175">
  <div class="header">
    <h3>app/models/protocol_event.rb</h3>
    <h4><span class="red">76.47 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProtocolEvent &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :sub_process</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :sub_process, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="18489" data-linenumber="10">
          <span class="hits">18489</span>
          
          <code class="ruby">  default_scope -&gt; {order :name }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    sub_process.protocol if sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    protocol.name if protocol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def sub_process_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    sub_process.name if sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    &quot;#{protocol_name} #{sub_process_name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="be87dbd7f6a94f8e4d8660b649e40103b8063e35">
  <div class="header">
    <h3>app/models/report.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>389</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>389</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Report &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  before_validation :check_attr_def</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">  validates :report_type, presence: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  validates :name, presence: true  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  scope :counts, -&gt; {where report_type: &#39;count&#39;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">  scope :regular, -&gt; {where report_type: &#39;regular_report&#39;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">  scope :searchable, -&gt; {where(searchable: true).order(position: :asc)}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">  scope :editable_data_reports, -&gt; {where(&quot;edit_model IS NOT NULL AND edit_model &lt;&gt; &#39;&#39;&quot;) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">  ReportTypes = [:count, :regular_report, :search]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">  ReportIdAttribName = &#39;_report_id_&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">  class BadSearchCriteria &lt; FphsException</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    def message </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      &quot;Bad search criteria were entered. Please check entries and try again.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">  def self.categories</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    res = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    Report.select(&quot;distinct item_type&quot;).where(&#39;item_type is not null&#39;).all.map {|s| s.item_type}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">  def self.item_types</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    res = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    editable_data_reports.each do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      unless r.selection_fields.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        res += r.selection_fields.split(/[^a-zA-Z0-9_]/).collect {|c| &quot;report_#{r.name.id_underscore}_#{c.downcase}&quot;.to_sym}        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      end      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">  def editable_data?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    !edit_model.blank? </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">  def edit_model_class</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    return unless editable_data?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">    model_class_name = edit_model.camelize.classify</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    logger.info &quot;Getting model class name: #{model_class_name}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    if Report.const_defined?(model_class_name)    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      Report.const_get(model_class_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">      obj_table_name = edit_model.downcase</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">      a_new_class = Class.new(ActiveRecord::Base) do </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        self.table_name = obj_table_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      res = Report.const_set(model_class_name, a_new_class)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">  def edit_fields</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">    res =  edit_field_names.split(/[^a-zA-Z0-9_]/).select {|s| !s.blank?}.collect {|s| s.to_sym}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    logger.info &quot;Edit fields: #{res.inspect}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">  def report_identifier</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">    name.id_underscore</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">  def clean_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">    @clean_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">  def filtering_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">    @filtering_on</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">  def filter_previous_clause?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">    sql.include?(&#39;:filter_previous&#39;) || sql.include?(&#39;:ids_filter_previous&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">  def current_user= cu</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">    @current_user = cu</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">  def current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">    @current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">  def search_attr_values</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">    @search_attr_values || &#39;&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">  def search_attr_values= sav</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">    @search_attr_values = sav</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">  def filtering_list</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">    logger.info &quot;Reading filtering list for #{current_user}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">    return nil unless current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">    key_list = &quot;report-list: #{current_user.id}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">    Rails.cache.read(key_list)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">  def filtering_ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="109">
          
          
          <code class="ruby">    return nil unless current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">    key = &quot;report-results: #{current_user.id}&quot;      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    Rails.cache.read key  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">  def write_filtering_list list</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">    logger.info &quot;Writing filtering list for #{current_user}, #{list}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">    return nil unless current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">    key_list = &quot;report-list: #{current_user.id}&quot;        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">    Rails.cache.write(key_list, list)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">  def write_filtering_ids ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="122">
          
          
          <code class="ruby">    logger.info &quot;Writing filtering ids for #{current_user}, #{ids}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">    return nil unless current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">    key = &quot;report-results: #{current_user.id}&quot;    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">    Rails.cache.write(key, ids)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="128">
          
          
          <code class="ruby">  def search_attributes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">    @search_attrs = {} if self.search_attrs.blank?  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">      @search_attrs ||= JSON.parse self.search_attrs</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">    rescue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">      @search_attrs ||= YAML.load self.search_attrs</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">  def run  search_attr_values, options={}        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">    @search_attr_values = search_attr_values    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">    @clean_sql = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">    report_definition = self</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">    filtering_previous = false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="145">
          
          
          <code class="ruby">    using_defaults = (@search_attr_values == &#39;_use_defaults_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">    raise Report::BadSearchCriteria unless search_attrs_prep</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="147">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby">    sql = report_definition.sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="149">
          
          
          <code class="ruby">    primary_table = &#39;masters&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">    sql.strip!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">    sql = sql[0..-2] if sql.last == &#39;;&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">    ids = filtering_ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">    @search_attr_values[:ids_filter_previous] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">    if current_user &amp;&amp; options[:filter_previous] &amp;&amp; !using_defaults</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      logger.info &quot;Trying to get data from cache (#{current_user.id} :#{ids}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">      if ids &amp;&amp; sql.include?(&quot;:filter_previous&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="159">
          
          
          <code class="ruby">        inner_sql = &quot; inner join (select id master_id from masters where id in (:filter_previous_ids)) filter_previous_alias using(master_id) &quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby">        clean_inner_sql = ActiveRecord::Base.send(:sanitize_sql, [inner_sql, {filter_previous_ids: ids}], primary_table)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="161">
          
          
          <code class="ruby">        sql.gsub!(&quot;:filter_previous&quot;, clean_inner_sql) if clean_inner_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="162">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">        filtering_previous = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="165">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="166">
          
          
          <code class="ruby">      filtering_previous = true if sql.include?(&#39;:ids_filter_previous&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby">    if filtering_previous</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="170">
          
          
          <code class="ruby">      @filtering_on = ids        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">      @search_attr_values[:ids_filter_previous] = @filtering_on        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="172">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="173">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="174">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">    if sql.include?(&quot;:filter_previous&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">      sql.gsub!(&quot;:filter_previous&quot;, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="177">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="178">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby">    if options[:count_only]      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="180">
          
          
          <code class="ruby">      sql = &quot;select count(*) \&quot;result_count\&quot; from (#{sql}) t&quot;  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="181">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="182">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="183">
          
          
          <code class="ruby">    res=[]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="184">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">    logger.info &quot;Preparing with #{@search_attr_values}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="187">
          
          
          <code class="ruby">    # get arbitrary data from a table</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="188">
          
          
          <code class="ruby">    # Perform this within a transaction to avoid unexpected data or or definition updates</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="189">
          
          
          <code class="ruby">    # Note that Postgres is really a requirement for a transaction to protect against DDL. Either way, limiting grants </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="190">
          
          
          <code class="ruby">    # on DDL to the Rails user is expected.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">    self.class.connection.transaction do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">        clean_sql = ActiveRecord::Base.send(:sanitize_sql, [sql, @search_attr_values], primary_table)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby">      rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">        logger.info &quot;Unabled to sanitize sql: #{e.inspect}.\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="196">
          
          
          <code class="ruby">        raise Report::BadSearchCriteria</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="197">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="198">
          
          
          <code class="ruby">      @clean_sql = clean_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby">      res = self.class.connection.execute(clean_sql)                </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="200">
          
          
          <code class="ruby">      raise ActiveRecord::Rollback</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="202">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">    @results = res</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="205">
          
          
          <code class="ruby">    # Store the results to the cache</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="206">
          
          
          <code class="ruby">    if current_user &amp;&amp; !using_defaults</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">        m_field = field_index(&#39;master_id&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="209">
          
          
          <code class="ruby">        ids = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">        if m_field</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">          ids = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">          res.each_row {|r| ids &lt;&lt; r[m_field]}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="213">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">        write_filtering_ids ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">        if filtering_previous</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">          list = filtering_list || []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="219">
          
          
          <code class="ruby">          list = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="221">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="222">
          
          
          <code class="ruby">        l = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="223">
          
          
          <code class="ruby">        if @search_attr_values</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="224">
          
          
          <code class="ruby">          l = @search_attr_values.dup</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="225">
          
          
          <code class="ruby">          l.delete(:ids_filter_previous)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="226">
          
          
          <code class="ruby">          l.delete(:_report_id_)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">          l.delete(:_filter_previous_)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="228">
          
          
          <code class="ruby">          l.delete(:no_run)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="229">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="230">
          
          
          <code class="ruby">        list &lt;&lt; {name: name, id: id, search_params: l, results_length: @results.count}        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="231">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="232">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="233">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">        write_filtering_list list</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">      rescue =&gt;e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby">        write_filtering_ids nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">        write_filtering_list nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby">        logger.warn &quot;Failed to write cache for #{current_user.id} =&gt; #{e.inspect}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="242">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="243">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="244">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="245">
          
          
          <code class="ruby">    @results </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="247">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="248">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="250">
          
          
          <code class="ruby">  # Get the table names corresponding to each column in the results</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="251">
          
          
          <code class="ruby">  # Since PG only returns oid values for each</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="252">
          
          
          <code class="ruby">  def result_tables</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="253">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="254">
          
          
          <code class="ruby">    return unless @results #&amp;&amp; @results.count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="255">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="256">
          
          
          <code class="ruby">    return @result_tables if @result_tables</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="257">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="258">
          
          
          <code class="ruby">    @result_tables = {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="259">
          
          
          <code class="ruby">    logger.info &quot;Getting the array of result_tables&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="260">
          
          
          <code class="ruby">    i = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="261">
          
          
          <code class="ruby">    @results.fields.each do |col|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="262">
          
          
          <code class="ruby">      oid = @results.ftable(i).to_i.to_s #make sure it&#39;s clean and usable</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="263">
          
          
          <code class="ruby">      logger.info &quot;OID: #{oid}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="264">
          
          
          <code class="ruby">      unless @result_tables.has_key? oid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="265">
          
          
          <code class="ruby">        clean_sql = &quot;select relname from pg_class where oid=#{oid.to_i}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="266">
          
          
          <code class="ruby">        get_res = self.class.connection.execute(clean_sql)  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="267">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="268">
          
          
          <code class="ruby">        table_name = get_res.first.first.last if get_res &amp;&amp; get_res.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="269">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="270">
          
          
          <code class="ruby">        @result_tables[oid] = table_name </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="271">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="272">
          
          
          <code class="ruby">      i+=1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="273">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="274">
          
          
          <code class="ruby">    @result_tables</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="275">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="276">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="277">
          
          
          <code class="ruby">  def result_tables_by_index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="278">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="279">
          
          
          <code class="ruby">    return unless @results &amp;&amp; @results.count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="280">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">    return @result_tables_oid if @result_tables_oid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="283">
          
          
          <code class="ruby">    l = @results.fields.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="284">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="285">
          
          
          <code class="ruby">    logger.info &quot;Setting up oids for tables in #{l} columns&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="286">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="287">
          
          
          <code class="ruby">    @result_tables_oid = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="288">
          
          
          <code class="ruby">    (0..l-1).each do |i|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="289">
          
          
          <code class="ruby">      oid = @results.ftable(i).to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="290">
          
          
          <code class="ruby">      logger.info &quot;Getting oid: #{oid} for col #{i}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="291">
          
          
          <code class="ruby">      @result_tables_oid[i] = result_tables[oid]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="292">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="293">
          
          
          <code class="ruby">    @result_tables_oid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="294">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="295">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="296">
          
          
          <code class="ruby">  def use_defaults</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="297">
          
          
          <code class="ruby">    @search_attr_values = {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="298">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="299">
          
          
          <code class="ruby">    search_attributes.each do |k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="300">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="301">
          
          
          <code class="ruby">      @search_attr_values[k.to_sym] = self.class.calculate_default v.first.last[&#39;default&#39;], v.first.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="302">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="303">
          
          
          <code class="ruby">    logger.info &quot;Using defaults as search attributes #{@search_attr_values}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="304">
          
          
          <code class="ruby">    @search_attr_values</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="306">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">  def search_attrs_prep </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="308">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="309">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="310">
          
          
          <code class="ruby">    @search_attr_values = use_defaults if @search_attr_values == &#39;_use_defaults_&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="311">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="312">
          
          
          <code class="ruby">    all_blank = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="313">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="314">
          
          
          <code class="ruby">    search_attributes.each do |k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="315">
          
          
          <code class="ruby">      search_attr_values[k.to_sym] = nil unless search_attr_values.has_key? k.to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="316">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="317">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="318">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="319">
          
          
          <code class="ruby">    search_attr_values.each do |k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="320">
          
          
          <code class="ruby">      all_blank &amp;&amp;= (k.to_s != ReportIdAttribName &amp;&amp; (search_attributes[k.to_s].nil? || v.blank?))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="321">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="322">
          
          
          <code class="ruby">      if v.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="323">
          
          
          <code class="ruby">        search_attr_values[k] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">      elsif v.is_a? Hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="325">
          
          
          <code class="ruby">        search_attr_values[k] = v.collect{|k,v| v}      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="326">
          
          
          <code class="ruby">      elsif v.is_a?(String) &amp;&amp; v.include?(&quot;\n&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="327">
          
          
          <code class="ruby">        if search_attributes[k.to_s].first.last[&#39;multiple&#39;] == &#39;multiple-regex&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="328">
          
          
          <code class="ruby">          search_attr_values[k] = &quot;(#{v.split(&quot;\n&quot;).map{|a| a.squish}.join(&#39;|&#39;)})&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="329">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="330">
          
          
          <code class="ruby">          search_attr_values[k] = v.split(&quot;\n&quot;).map{|a| a.squish}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="331">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="332">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="333">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="334">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="335">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="336">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="337">
          
          
          <code class="ruby">    return false if all_blank &amp;&amp; search_attributes.length &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="338">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="339">
          
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="340">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="341">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="342">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="343">
          
          
          <code class="ruby">  def self.calculate_default default, type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="344">
          
          
          <code class="ruby">    default ||= &#39;&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="345">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="346">
          
          
          <code class="ruby">    res = default</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="347">
          
          
          <code class="ruby">    if default.is_a? String</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="348">
          
          
          <code class="ruby">      m = default.scan /(-\d+) (days|day|months|month|years|year)/</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="349">
          
          
          <code class="ruby">      if m.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="350">
          
          
          <code class="ruby">        t = m.first.last      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="351">
          
          
          <code class="ruby">        res = DateTime.now + m.first.first.to_i.send(t)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="352">
          
          
          <code class="ruby">      elsif default == &#39;now&#39;  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="353">
          
          
          <code class="ruby">        res = DateTime.now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="354">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="355">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="356">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="357">
          
          
          <code class="ruby">    if type == &#39;date&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="358">
          
          
          <code class="ruby">      res = res.strftime(&#39;%Y-%m-%d&#39;) rescue nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="359">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="360">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="361">
          
          
          <code class="ruby">    res </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="362">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="363">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="364">
          
          
          <code class="ruby">  def field_index name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="365">
          
          
          <code class="ruby">    m_field = nil    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="366">
          
          
          <code class="ruby">    i = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="367">
          
          
          <code class="ruby">    @results.fields.each do |f|           </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="368">
          
          
          <code class="ruby">      if f == name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="369">
          
          
          <code class="ruby">        m_field = i  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="370">
          
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="371">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="372">
          
          
          <code class="ruby">      i+=1          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="373">
          
          
          <code class="ruby">    end  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="374">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="375">
          
          
          <code class="ruby">    return m_field</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="376">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="377">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="378">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="379">
          
          
          <code class="ruby">  def check_attr_def</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="380">
          
          
          <code class="ruby">    errmsg = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="381">
          
          
          <code class="ruby">    begin    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="382">
          
          
          <code class="ruby">      s = search_attributes </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="383">
          
          
          <code class="ruby">    rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="384">
          
          
          <code class="ruby">      errmsg = e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="385">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="386">
          
          
          <code class="ruby">    errors.add :search_attributes, &quot;definition can not be parsed. Check the YAML or JSON is valid. #{errmsg.message}&quot; unless s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="387">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="388">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="389">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8bfe4b86a162622b03e48d44a2ae2405d8e66252">
  <div class="header">
    <h3>app/models/sage_assignment.rb</h3>
    <h4><span class="green">92.86 %</span> covered</h4>
    <div>
      <b>42</b> relevant lines. 
      <span class="green"><b>39</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SageAssignment &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ExternalIdHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :sage_id, presence: true,  length: {is: 10}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :sage_id_tests    </code>
        </li>
      
        <li class="covered" data-hits="160" data-linenumber="7">
          <span class="hits">160</span>
          
          <code class="ruby">  default_scope -&gt; {order id: :desc}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :assigned, -&gt; {where &quot;master_id is not null&quot;}</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="9">
          <span class="hits">13</span>
          
          <code class="ruby">  scope :unassigned, -&gt; {where &quot;master_id is null&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :return_all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"> </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  class NoUnassignedAvailable &lt; FphsException</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def message</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      &quot;No available Sage IDs for assignment&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def return_all</code>
        </li>
      
        <li class="covered" data-hits="110" data-linenumber="20">
          <span class="hits">110</span>
          
          <code class="ruby">    self.multiple_results = self.master.sage_assignments.all if self.master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # Get the next unassigned ID item from the the sage_assignments table</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.next_available owner</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="25">
          <span class="hits">11</span>
          
          <code class="ruby">    item = unassigned.unscope(:order).first</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="26">
          <span class="hits">11</span>
          
          <code class="ruby">    raise NoUnassignedAvailable  unless item</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="27">
          <span class="hits">10</span>
          
          <code class="ruby">    logger.info &quot;Got next available external id #{item.id}&quot;    </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="28">
          <span class="hits">10</span>
          
          <code class="ruby">    item.assigned_by = &quot;fphsapp&quot;      </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="29">
          <span class="hits">10</span>
          
          <code class="ruby">    item </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.generate_ids admin, count=10</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    raise &quot;Only admins can perform this function&quot; unless admin &amp;&amp; admin.enabled?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    res = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    (1..count).each do |c|      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="40">
          <span class="hits">100</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">        #s = SecureRandom.random_number(8_999_999_999) + 1_000_000_000        </code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="42">
          <span class="hits">100</span>
          
          <code class="ruby">        item = SageAssignment.new(sage_id: generate_random_id.to_s, admin_id: admin.id)</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="43">
          <span class="hits">100</span>
          
          <code class="ruby">        item.no_track = true      </code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="44">
          <span class="hits">100</span>
          
          <code class="ruby">        item.save!</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="45">
          <span class="hits">100</span>
          
          <code class="ruby">        res &lt;&lt; item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      rescue PG::UniqueViolation =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        logger.info &quot;Failed to create a Sage Assignment record due to an random duplicate&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_status</code>
        </li>
      
        <li class="covered" data-hits="110" data-linenumber="58">
          <span class="hits">110</span>
          
          <code class="ruby">    @was_created = id_changed? || just_assigned ? &#39;created&#39; : false</code>
        </li>
      
        <li class="covered" data-hits="110" data-linenumber="59">
          <span class="hits">110</span>
          
          <code class="ruby">    @was_updated = updated_at_changed? ? &#39;updated&#39; : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">    def sage_id_tests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="115" data-linenumber="67">
          <span class="hits">115</span>
          
          <code class="ruby">      if persisted? &amp;&amp; sage_id_changed? </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">        errors.add :sage_id, &quot;can not be changed&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="115" data-linenumber="71">
          <span class="hits">115</span>
          
          <code class="ruby">      if persisted? &amp;&amp; master_id_changed? &amp;&amp; !master_id_was.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">        errors.add :master, &quot;record this sage ID is associated with can not be changed&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">    def creatable_without_user</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="78">
          <span class="hits">230</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  </code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="210f5525362975fba6f66e018a2b9ae5bdb32f64">
  <div class="header">
    <h3>app/models/scantron.rb</h3>
    <h4><span class="yellow">83.33 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Scantron &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include ExternalIdHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :scantron_id_tests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  default_scope -&gt;{}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def scantron_id_tests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="14">
          <span class="hits">44</span>
          
          <code class="ruby">      if scantron_id_changed? || !persisted? </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="16">
          <span class="hits">44</span>
          
          <code class="ruby">        s = Scantron.find_by_scantron_id(self.scantron_id)</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="17">
          <span class="hits">44</span>
          
          <code class="ruby">        if s           </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">          errors.add :scantron_id, &quot;already exists in this master record&quot; if s.master_id == self.master_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">          errors.add :scantron_id, &quot;already exists in another master record (#{s.master.msid ? &quot;MSID: #{s.master.msid}&quot; : &quot;master ID: #{s.master_id}&quot;})&quot; if s.master_id != self.master_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3b1c283e3aa1c8f38d3fa7cd46b4ec497b50142a">
  <div class="header">
    <h3>app/models/sub_process.rb</h3>
    <h4><span class="red">76.92 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SubProcess &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include SelectorCache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :protocol</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :protocol_events</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :protocol, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def protocol_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    protocol ? protocol.name : &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    protocol_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="70e7bd70f44beed3e60c291d2f9c8b9caa638b06">
  <div class="header">
    <h3>app/models/tracker.rb</h3>
    <h4><span class="green">95.08 %</span> covered</h4>
    <div>
      <b>122</b> relevant lines. 
      <span class="green"><b>116</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Tracker &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include TrackerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :tracker_histories, inverse_of: :tracker</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :prevent_protocol_change,  on: :update</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :check_protocol_event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :check_sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :protocol, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # Expect an event date event if a protocol_event is not registered</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">#  validates :protocol_event_id, presence: true, if: :event_date?  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">#  validates :event_date, presence: true, if: :protocol_event_id?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :event_date, presence: true, if: :sub_process_id?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  # We can&#39;t use this, since the error attribute is not translatable, and therefore we can&#39;t get sub_process to appear to users as &#39;status&#39;  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  #  validates :sub_process, presence: true, if: :protocol_id?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # _merged attribute is used to indicate if a tracker record was merged into an existing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # record on creation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :_merged</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # Check whether a tracker record with the same protocol already exists for this master</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # If it does then we will update the existing record rather than creating a new one.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # From a user perspective this ensures that the current status of the tracker always maintains only one</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # state for a protocol.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def merge_if_exists</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="139" data-linenumber="31">
          <span class="hits">139</span>
          
          <code class="ruby">    t = self.master.trackers.where(protocol_id: self.protocol_id).take(1)</code>
        </li>
      
        <li class="covered" data-hits="139" data-linenumber="32">
          <span class="hits">139</span>
          
          <code class="ruby">    if t.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="34">
          <span class="hits">80</span>
          
          <code class="ruby">      t = t.first</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="35">
          <span class="hits">80</span>
          
          <code class="ruby">      logger.info &quot;Updating existing tracker record #{t.id} instead of creating a new one&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="37">
          <span class="hits">80</span>
          
          <code class="ruby">      t.sub_process = self.sub_process</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="38">
          <span class="hits">80</span>
          
          <code class="ruby">      t.protocol_event = self.protocol_event</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="39">
          <span class="hits">80</span>
          
          <code class="ruby">      t.event_date = self.event_date</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="40">
          <span class="hits">80</span>
          
          <code class="ruby">      t.notes = self.notes</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="41">
          <span class="hits">80</span>
          
          <code class="ruby">      t._merged = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="43">
          <span class="hits">80</span>
          
          <code class="ruby">      res = t.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="45">
          <span class="hits">80</span>
          
          <code class="ruby">      if res </code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="46">
          <span class="hits">80</span>
          
          <code class="ruby">        return t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      elsif !errors || errors.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">         errors.add :protocol, &quot;tracker could not be merged&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      else    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  # does a standard merge_if_exists, but always attempts to save the result</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  def merge_if_exists!</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="59">
          <span class="hits">129</span>
          
          <code class="ruby">    t = merge_if_exists || self</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="60">
          <span class="hits">129</span>
          
          <code class="ruby">    t.save!    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  # Called by UserHandler managed records to save the latest update to the tracker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.track_record_update record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="780" data-linenumber="66">
          <span class="hits">780</span>
          
          <code class="ruby">    return nil if record.is_a?(Tracker) || record.is_a?(TrackerHistory)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="251" data-linenumber="68">
          <span class="hits">251</span>
          
          <code class="ruby">    t = update_tracker :record, record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="251" data-linenumber="70">
          <span class="hits">251</span>
          
          <code class="ruby">    cp = &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="251" data-linenumber="71">
          <span class="hits">251</span>
          
          <code class="ruby">    ignore = %w(created_at updated_at user_id user id)</code>
        </li>
      
        <li class="covered" data-hits="251" data-linenumber="72">
          <span class="hits">251</span>
          
          <code class="ruby">    new_rec = record.id_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2664" data-linenumber="74">
          <span class="hits">2664</span>
          
          <code class="ruby">    record.changes.reject {|k,v| ignore.include? k}.each do |k,v| </code>
        </li>
      
        <li class="covered" data-hits="1522" data-linenumber="75">
          <span class="hits">1522</span>
          
          <code class="ruby">      fromv = v.first</code>
        </li>
      
        <li class="covered" data-hits="1522" data-linenumber="76">
          <span class="hits">1522</span>
          
          <code class="ruby">      tov = v.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      # Exclude where both to and from are blank (since a form update will cause a switch of nil and &quot;&quot;) which is meaningless</code>
        </li>
      
        <li class="covered" data-hits="1522" data-linenumber="79">
          <span class="hits">1522</span>
          
          <code class="ruby">      unless v.first.blank? &amp;&amp; v.last.blank?</code>
        </li>
      
        <li class="covered" data-hits="1512" data-linenumber="80">
          <span class="hits">1512</span>
          
          <code class="ruby">        kname = (&quot;#{k.to_s}_name&quot;).to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1512" data-linenumber="82">
          <span class="hits">1512</span>
          
          <code class="ruby">        if record.respond_to? kname      </code>
        </li>
      
        <li class="covered" data-hits="349" data-linenumber="83">
          <span class="hits">349</span>
          
          <code class="ruby">          n = record.class.send(&quot;get_#{k}_name&quot;.to_s, tov)</code>
        </li>
      
        <li class="covered" data-hits="349" data-linenumber="84">
          <span class="hits">349</span>
          
          <code class="ruby">          tov = &quot;(#{tov}) #{n}&quot; unless n.is_a?(String) &amp;&amp; tov.is_a?(String) &amp;&amp; tov.downcase == n.downcase</code>
        </li>
      
        <li class="covered" data-hits="349" data-linenumber="85">
          <span class="hits">349</span>
          
          <code class="ruby">          n = record.class.send(&quot;get_#{k}_name&quot;.to_s, fromv)</code>
        </li>
      
        <li class="covered" data-hits="349" data-linenumber="86">
          <span class="hits">349</span>
          
          <code class="ruby">          fromv = &quot;(#{fromv}) #{n}&quot; unless n.is_a?(String) &amp;&amp; fromv.is_a?(String) &amp;&amp; fromv.downcase == n.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1512" data-linenumber="89">
          <span class="hits">1512</span>
          
          <code class="ruby">        fromv = &#39;-&#39; if fromv.blank?</code>
        </li>
      
        <li class="covered" data-hits="1512" data-linenumber="90">
          <span class="hits">1512</span>
          
          <code class="ruby">        tov = &#39;-&#39; if tov.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1512" data-linenumber="92">
          <span class="hits">1512</span>
          
          <code class="ruby">        cp &lt;&lt; &quot;#{k.humanize} #{new_rec ? &#39;&#39; : &quot;from #{fromv}&quot;} #{new_rec ? &#39;&#39; : &#39;to &#39;}#{tov}; &quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="251" data-linenumber="97">
          <span class="hits">251</span>
          
          <code class="ruby">    t.notes = cp</code>
        </li>
      
        <li class="covered" data-hits="251" data-linenumber="98">
          <span class="hits">251</span>
          
          <code class="ruby">    t.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  # Called by item flag controller to save the aggregate set of item_flag changes to the tracker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.track_flag_update record, added_flags, removed_flags</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="105">
          <span class="hits">3</span>
          
          <code class="ruby">    return nil if record.is_a?(Tracker) || record.is_a?(TrackerHistory)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="107">
          <span class="hits">3</span>
          
          <code class="ruby">    t = update_tracker :flag, record</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="108">
          <span class="hits">3</span>
          
          <code class="ruby">    cp = &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="110">
          <span class="hits">3</span>
          
          <code class="ruby">    if added_flags.length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="111">
          <span class="hits">3</span>
          
          <code class="ruby">      cp &lt;&lt; &quot;added  flags: &quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="112">
          <span class="hits">6</span>
          
          <code class="ruby">      added_flags.each {|k| cp &lt;&lt; &quot;#{ItemFlagName.find(k).name}; &quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="115">
          <span class="hits">3</span>
          
          <code class="ruby">    if removed_flags.length &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">      cp &lt;&lt; &quot;removed flags: &quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">      removed_flags.each {|k| cp &lt;&lt; &quot;#{ItemFlagName.find(k).name}; &quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="120">
          <span class="hits">3</span>
          
          <code class="ruby">    t.notes = cp</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="121">
          <span class="hits">3</span>
          
          <code class="ruby">    res = t.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="122">
          <span class="hits">3</span>
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_tracker type, record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="127">
          <span class="hits">254</span>
          
          <code class="ruby">    t = get_or_create_record_updates_tracker record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="129">
          <span class="hits">254</span>
          
          <code class="ruby">    t.set_record_updates_sub_process type</code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="130">
          <span class="hits">254</span>
          
          <code class="ruby">    t.set_record_updates_event record  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="132">
          <span class="hits">254</span>
          
          <code class="ruby">    t.event_date = DateTime.now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="134">
          <span class="hits">254</span>
          
          <code class="ruby">    t.item_id = record.id    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="135">
          <span class="hits">254</span>
          
          <code class="ruby">    t.item_type = record.class.name</code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="136">
          <span class="hits">254</span>
          
          <code class="ruby">    raise &quot;Bad item for tracker (#{type} / #{record.class.name} / #{record.id})&quot; unless t.item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="138">
          <span class="hits">254</span>
          
          <code class="ruby">    return t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.add_record_update_entries name, admin, update_type=&#39;record&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="143">
          <span class="hits">74</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="144">
          <span class="hits">74</span>
          
          <code class="ruby">      protocol = Protocol.updates.first</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="145">
          <span class="hits">74</span>
          
          <code class="ruby">      sp = protocol.sub_processes.find_by_name(&quot;#{update_type} updates&quot;)</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="146">
          <span class="hits">74</span>
          
          <code class="ruby">      values = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="148">
          <span class="hits">74</span>
          
          <code class="ruby">      name = name.humanize.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">      logger.error &quot;Error finding protocol or sub process for tracker record update. Protocols #{Protocol.count}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">      raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="154">
          <span class="hits">74</span>
          
          <code class="ruby">    values &lt;&lt; {name: &quot;created #{name.downcase}&quot;, sub_process_id: sp.id}</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="155">
          <span class="hits">74</span>
          
          <code class="ruby">    values &lt;&lt; {name: &quot;updated #{name.downcase}&quot;, sub_process_id: sp.id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="158">
          <span class="hits">74</span>
          
          <code class="ruby">    values.each do |v|</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="159">
          <span class="hits">148</span>
          
          <code class="ruby">      res = sp.protocol_events.find_or_initialize_by(v)</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="160">
          <span class="hits">148</span>
          
          <code class="ruby">      unless res.admin</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="161">
          <span class="hits">32</span>
          
          <code class="ruby">        res.update!(current_admin: admin) </code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="162">
          <span class="hits">32</span>
          
          <code class="ruby">        logger.info &quot;Added protocol event #{v} in #{protocol.id} / #{sp.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="116" data-linenumber="164">
          <span class="hits">116</span>
          
          <code class="ruby">        logger.info &quot;Did not add protocol event #{v} in #{protocol.id} / #{sp.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_record_updates_event record</code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="171">
          <span class="hits">254</span>
          
          <code class="ruby">    new_rec = record.id_changed?    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="172">
          <span class="hits">254</span>
          
          <code class="ruby">    rec_type = &quot;#{new_rec ? &#39;created&#39; : &#39;updated&#39;} #{record.class.name.underscore.humanize.downcase}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="174">
          <span class="hits">254</span>
          
          <code class="ruby">    self.protocol_event = Rails.cache.fetch &quot;record_updates_protocol_events_#{self.sub_process.id}_#{rec_type}&quot; do</code>
        </li>
      
        <li class="covered" data-hits="120" data-linenumber="175">
          <span class="hits">120</span>
          
          <code class="ruby">      self.sub_process.protocol_events.where(name: rec_type).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="178">
          <span class="hits">254</span>
          
          <code class="ruby">    raise &quot;Bad protocol_event (#{rec_type}) for tracker #{record}&quot; unless self.protocol_event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_record_updates_sub_process type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="184">
          <span class="hits">254</span>
          
          <code class="ruby">    self.sub_process = Rails.cache.fetch &quot;record_updates_sub_process_#{type}&quot; do</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="185">
          <span class="hits">97</span>
          
          <code class="ruby">      Protocol.record_updates_protocol.sub_processes.where(name: &quot;#{type} updates&quot;).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="188">
          <span class="hits">254</span>
          
          <code class="ruby">    raise &quot;Bad sub_process for tracker (#{type})&quot; unless self.sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_or_create_record_updates_tracker record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="194">
          <span class="hits">254</span>
          
          <code class="ruby">    t = record.master.trackers.where(protocol_id: Protocol.record_updates_protocol).first    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="195">
          <span class="hits">254</span>
          
          <code class="ruby">    t ||= record.master.trackers.new protocol: Protocol.record_updates_protocol    </code>
        </li>
      
        <li class="covered" data-hits="254" data-linenumber="196">
          <span class="hits">254</span>
          
          <code class="ruby">    t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">  def tracker_history_length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="202">
          <span class="hits">7</span>
          
          <code class="ruby">    tracker_histories.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">  def prevent_protocol_change </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="250" data-linenumber="208">
          <span class="hits">250</span>
          
          <code class="ruby">    errors.add(:protocol, &quot;change not allowed!&quot;) if protocol_id_changed? &amp;&amp; self.persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_protocol_event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="538" data-linenumber="214">
          <span class="hits">538</span>
          
          <code class="ruby">    errors.add(:method, &#39; must be selected&#39;) if protocol_event_id.nil? &amp;&amp; sub_process &amp;&amp; sub_process.protocol_events.length &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_sub_process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="538" data-linenumber="219">
          <span class="hits">538</span>
          
          <code class="ruby">    errors.add(:status, &#39; must be selected&#39;) if sub_process_id.nil? &amp;&amp; protocol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json extras={}</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="223">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] ||= []</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="224">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :protocol_name</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="225">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :protocol_position</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="226">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :sub_process_name</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="227">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :event_name</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="228">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :event_milestone</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="229">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :tracker_history_length</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="230">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_type_us</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="231">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_type</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="232">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_id</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="233">
          <span class="hits">7</span>
          
          <code class="ruby">    extras[:methods] &lt;&lt; :_merged</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="235">
          <span class="hits">7</span>
          
          <code class="ruby">    super(extras)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f10186eb0e018cadb689bffe5e6d20e85a2e8011">
  <div class="header">
    <h3>app/models/tracker_history.rb</h3>
    <h4><span class="red">40.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TrackerHistory &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  self.table_name = &#39;tracker_history&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include TrackerHandler</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :tracker, inverse_of: :tracker_histories</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json extras={}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    extras[:methods] ||= []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    extras[:methods] &lt;&lt; :protocol_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    extras[:methods] &lt;&lt; :sub_process_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    extras[:methods] &lt;&lt; :event_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_type_us</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    extras[:methods] &lt;&lt; :record_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    extras[:methods] &lt;&lt; :event_milestone</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    super(extras)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2654514890fd2840274ad6d716454f0187d5ce9c">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4><span class="yellow">81.08 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class User &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActionLogging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include StandardAuthentication</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  devise :database_authenticatable, :trackable, :timeoutable, :lockable, :validatable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="2950" data-linenumber="11">
          <span class="hits">2950</span>
          
          <code class="ruby">  default_scope -&gt; {order email: :asc}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.active_id_name_list filter=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    active.map {|u| {id: u.id, value: u.id, name: u.email} }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.all_name_value_enable_flagged type_filter=nil    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    if type_filter &amp;&amp; type_filter[:disabled] == false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      res = active</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      type_filter.delete :disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      res = all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    res.map{|u| [&quot;#{u.email} #{u.disabled ? &#39;[disabled]&#39; : &#39;&#39;}&quot;, u.id]  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def timeout_in  </code>
        </li>
      
        <li class="covered" data-hits="102" data-linenumber="30">
          <span class="hits">102</span>
          
          <code class="ruby">    Settings::UserTimeout</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # Standard Devise callback to allow accounts to be disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def active_for_authentication?</code>
        </li>
      
        <li class="covered" data-hits="103" data-linenumber="35">
          <span class="hits">103</span>
          
          <code class="ruby">    super &amp;&amp; !self.disabled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # Standard Devise callback to tell user that an account has been disabled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def inactive_message</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    !self.disabled  ? super : :account_has_been_disabled    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def can? auth</code>
        </li>
      
        <li class="covered" data-hits="233" data-linenumber="44">
          <span class="hits">233</span>
          
          <code class="ruby">    UserAuthorization.user_can? self, auth</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_s</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="48">
          <span class="hits">51</span>
          
          <code class="ruby">    email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    # Override included functionality that ensures an administrator has been set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    # Limit it to check for an administrator when email or disabled flag change</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    # This is required since user tracking and password updates are allowed in </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    # standard operation, but the user can not reset a disabled flag or their email address</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">    def ensure_admin_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="296" data-linenumber="59">
          <span class="hits">296</span>
          
          <code class="ruby">      if !admin_set? &amp;&amp; !self.persisted?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:admin, &quot;account must be used to create user&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="295" data-linenumber="64">
          <span class="hits">295</span>
          
          <code class="ruby">      if email_changed? &amp;&amp; self.persisted? &amp;&amp; !admin_set?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:email, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="294" data-linenumber="69">
          <span class="hits">294</span>
          
          <code class="ruby">      if disabled_changed? &amp;&amp; self.persisted? &amp;&amp; !admin_set?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:disabled, &quot;change not allowed!&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="293" data-linenumber="74">
          <span class="hits">293</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b13362e548e2211e3a05397ce4d304ef959aa435">
  <div class="header">
    <h3>app/models/user_authorization.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class UserAuthorization &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AdminHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :correct_authorization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.authorizations</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="9">
          <span class="hits">91</span>
          
          <code class="ruby">    [:export_csv, :export_json, :create_msid, :view_reports, :view_external_links, :edit_report_data]    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.user_can? user, auth</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="274" data-linenumber="14">
          <span class="hits">274</span>
          
          <code class="ruby">    self.active.where(user_id: user.id, has_authorization: auth.to_s).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    def correct_authorization</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="20">
          <span class="hits">37</span>
          
          <code class="ruby">      if self.user.nil? || self.user.id.nil? </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="21">
          <span class="hits">5</span>
          
          <code class="ruby">        errors.add :user, &quot;must be set&quot;</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="22">
          <span class="hits">32</span>
          
          <code class="ruby">      elsif has_authorization.nil? || !self.class.authorizations.include?(self.has_authorization.to_sym)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add :has_authorization, &quot;is an invalid value&quot;        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="25">
          <span class="hits">31</span>
          
          <code class="ruby">        res = self.class.user_can? self.user, self.has_authorization</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="26">
          <span class="hits">31</span>
          
          <code class="ruby">        if res &amp;&amp; res.id != self.id # If the user has the authorization set and it is not this record</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">          errors.add :user, &quot;already has the authorization #{self.has_authorization}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  </code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ee1ba6643f4204a3cc06f15ea3d6066a07026c03">
  <div class="header">
    <h3>lib/generators/external_id_handler/external_id_handler_generator.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>36</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ExternalIdHandlerGenerator &lt; Rails::Generators::NamedBase</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  source_root File.expand_path(&#39;../templates&#39;, __FILE__)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  def copy_model_file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    template &quot;external_id_handler.rb&quot;, &quot;app/models/#{file_name}.rb&quot;    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">  def copy_controller_file    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    template &quot;external_id_handlers_controller.rb&quot;, &quot;app/controllers/#{file_name.pluralize}_controller.rb&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">  def run_migration</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    template &quot;migrate_create_external_id_handler.rb&quot;, &quot;db/migrate/#{Time.new.to_s(:number)}_create_#{file_name.pluralize}.rb&quot;    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">#  def copy_view_file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">#    template &quot;_edit_form.html.erb&quot;, &quot;app/views/#{file_name.pluralize}/_edit_form.html.erb&quot;    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">#  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">  def copy_settings_file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    template &quot;external_id_settings.rb&quot;, &quot;config/initializers/external_id_#{singular_name}_settings.rb&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">  def copy_js_file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    template &quot;_fpa_external_id.js&quot;, &quot;app/assets/javascripts/external_id_#{plural_name}.js&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">  def append_to_routes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    line = &quot;resources :scantrons, except: [:destroy]&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    gsub_file &#39;config/routes.rb&#39;, /(#{Regexp.escape(line)})/mi do |match|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      &quot;#{match}\n    resources :#{plural_name}, except: [:destroy]\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>

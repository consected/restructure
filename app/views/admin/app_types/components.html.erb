<div class="container well admin-app-type-components">
  <h1><%=@message%></h1>
  <div class="row">
    
    <div class="col-md-24">
      <h1><%= @app_type.label %> <small><%= @app_type.id %> <%= @app_type.name %></small></h1>
      <div class="text-right">
        <%= link_to 'export yaml', admin_app_type_path(@app_type, export_format: :yaml), target: '_blank', class: 'btn btn-primary' %>
      </div>
      
      <% @app_type.as_json.first.last.each do |k, v| %>
        <% if v.respond_to?(:each) %>
        <%
          title = k.humanize.gsub(/^valid |associated /i, '').titleize
          if v.first
            class_rn = v.first.class.resource_name 
            base_path = Resources::Models.find_by(resource_name: class_rn)&.dig(:base_route_name)&.pluralize
            path = send("#{base_path}_path", filter: {ids: v.map(&:id)})
        %>
        <h3>
        <%= link_to link_label_open_in_new(title), path, target: 'adminres' %>
        </h3>
        <% else %>
        <h3>
        <%= title %>
        </h3>
        <% end %>
        <ul>
        <% all_vs = v.map do |k2| %>
          <%
            rn = k2.respond_to?(:alt_resource_name) && k2.alt_resource_name
            rn ||= k2.resource_name
            path = send("#{base_path}_path", filter: {id: k2.id})
            name = k2.respond_to?(:name) ? k2.name : rn

            { rn: rn, path: path, name: name }
          %>
        <% end %>
        <% all_vs.sort {|vi, vk| vi[:name] <=> vk[:name] }.each do |vs| %>
          <li>
            
            <%= link_to link_label_open_in_new(vs[:name]), vs[:path], target: 'adminres' %>
          </li>
        <% end %>
        </ul>
        <% end %>
      <% end %>
      
    </div>
    
    <div class="col-md-24">
      <pre><%=@primary%></pre>
    </div>
  </div>
</div>

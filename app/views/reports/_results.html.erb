
<% rt = @report.result_tables_by_index || []%>
<div class="data-results" data-subscription="admin-list" >
  <div data-result="admin-list">    
    <div class="row" style="background-color: #eee;">
      <div class="col-sm-22 col-sm-offset-1 ">
      
        <h3 class="text-right hidden"><span class="result-count"><%=@results.count%></span> <%=@results.count == 1 ? 'row' : 'rows'%></h3>
        <div id="admin-edit-" data-preprocessor="admin-edit-form" data-subscription="admin-edit-form-" class="new-block new-below"></div>
      </div>
    </div>
        <table class="table tablesorter admin-list" style="margin:1em;">
          <thead>
            <tr>
              
              <% i = 0 %>
              <% @results.fields.each do |col| %>
                <th><p><%=col%></p>
                  <p class="small"><%=rt[i] %></p>
                </th>
              <%  i += 1%>
              <% end %>
            </tr>
          </thead>
          <tbody>

            <% @results.each_row do |list_item| %>


              <tr class="">
               
                <% i = 0 %>

                <% list_item.each do |col| %>
                <td data-col-type="<%=@results.fields[i] %>"  data-col-table="<%=rt[i] %>"><%= col %></td>
                <%  i += 1%>
                <% end %>

              </tr>
            <% end %>
          </tbody>
        </table>
    
      
    
  </div>
</div>

<script>
      
      window.setTimeout(function(){
      
        var tables = {trackers:
                {protocols: 'protocol_id', sub_processes: 'sub_process_id', protocol_events: 'protocol_event_id', item_type_names: 'item_type'},
            tracker_history:
                {protocols: 'protocol_id', sub_processes: 'sub_process_id', protocol_events: 'protocol_event_id', item_type_names: 'item_type'},
                masters:
                        {accuracy_scores: 'rank'}
        };

        for(var t in tables){
          if(tables.hasOwnProperty(t)){
            var table = tables[t];
            if($('td[data-col-table="'+t+'"]').length > 0 ){
              for(var i in table){

                if(tables.hasOwnProperty(t)){

                  col_types = tables[t];
                  var idname = col_types[i];

                  _fpa.set_definition(i, function(){                                                
                    var pe = _fpa.cache(i);
                    var cells = $('td[data-col-type="'+idname+'"]');
                    cells.each(function(){
                      var cell = $(this);
                      var d = cell.html();    
                      var p = _fpa.get_item_by('id', pe, d);
                      if(p) cell.append(' <em>'+p.name+'</em>');
                    });
                  });
                }
              }
            }
          }
        }


        
        
      }, 100);
    </script>
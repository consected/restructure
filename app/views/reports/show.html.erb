<div class="report-criteria">
  <h1><%=@report.name%></h1>
  <p><%= @report.description %></p>
  
  <div>
      <%= form_tag report_path(@report.id), method: :get, class: 'form' do %>
      <div class="row">
        <% @report.search_attributes.each do |name, type| %>
          <div class="col-md-4">
          <%= label_tag name %>
          <%= text_field_tag "search_attrs[#{name}]", @report.search_attr_values[name], type: type, class: 'form-control' %>
          </div>
        <%end%>
      
        <div class="col-md-4">
          <%= submit_tag :table, class: "btn btn-primary" %>
            <%= submit_tag "CSV", name: :format, value: "csv", class: "btn btn-primary" %>
            <%= submit_tag "JSON", name: :format, value: "json", class: "btn btn-primary" %>
            
        </div>
      </div>
      <%end%>
  </div>
</div>
<% if @results %>
<div class="data-results" data-subscription="admin-list" >
  <div data-result="admin-list">    
<h1>Report Results</h1>
<h3>Count: <span class="result-count"><%=@results.count%></span></h3>
<div id="admin-edit-" data-preprocessor="admin-edit-form" data-subscription="admin-edit-form-" class="new-block new-below"></div>

<table class="table tablesorter admin-list">
  <thead>
    <tr>
      <th class="no-sort"></th>
      <% @results.fields.each do |col| %>
        <th><%=col%></th>
      <% end %>
    </tr>
  </thead>

  <tbody>
    <% @results.each_row do |list_item| %>
      <tr class="">
        <td></td>
        <% i = 0 %>
        <% list_item.each do |col| %>
        <td data-col-type="<%=@results.fields[i] %>"><%= col %></td>
        <%  i += 1%>
        <% end %>
        
      </tr>
    <% end %>
  </tbody>
</table>


<script>
  var col_types = {protocols: 'protocol_id', sub_processes: 'sub_process_id', protocol_events: 'protocol_event_id', item_type_names: 'item_type', accuracy_scores: 'accuracy_score_id'};
  
  for(var i in col_types){
    if(col_types.hasOwnProperty(i)){
      var idname = col_types[i];
      _fpa.set_definition(i, function(){                                                
        var pe = _fpa.cache('protocols');
        var cells = $('td[data-col-type="'+idname+'"]');
        cells.each(function(){
          var cell = $(this);
          var d = cell.html();    
          var p = _fpa.get_item_by('id', pe, d);
          if(p) cell.append(' <em>'+p.name+'</em>');
        });
      });
    }
  }
    
</script>

  </div>
</div>
<% end %>
<%=  render partial: 'admin_handler/index_actions'  %>
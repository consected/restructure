<%
  # Get a list of folder paths for this level (root to this level) - a set of the first element in the path
  folders = downloads.map {|d| d.container_path(no_filename: true, leading_dot: true).split('/')[0..level+1]}.uniq.reject{|f| f == folder }.sort
  current_downloads = downloads.select {|d| d.container_path(no_filename: true, leading_dot: true).split('/') == folder}
%>
<%= render partial: 'nfs_store/container_list/browse_json_entry', collection: current_downloads, as: :download, locals: {} %>
<%= render partial: 'nfs_store/container_list/browse_json_folder', collection: folders, as: :folder, locals: {downloads: downloads, level: level} %>

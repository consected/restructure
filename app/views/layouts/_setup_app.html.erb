<script>

  _fpa.version = '<%=Application.version%>-<%=Application.server_cache_version%>';
  _fpa.status.session = new _fpa.session(<%= current_user ? current_user.timeout_in :  "null" %>);
  _fpa.current_locale = 'en';

  _fpa.layout = {item_blocks: <%= layout_item_block_sizes.to_json.html_safe %> };
  <% if current_user %>
  _fpa.state.app_configs = <%= Admin::AppConfiguration.all_for(current_user).to_json.html_safe %>;
  <% end %>
  _fpa.loaded.preload();

<% #
  if current_user || current_admin %>
  _fpa.handle_remotes();

  var one_time_setup = function () {
    if (_fpa.status.one_time_setup_run || !_fpa.status.loaded_templates || !_fpa.status.html_ready) return;
    _fpa.status.one_time_setup_run = true;
    _fpa.compile_templates();
    _fpa.reset_page_size();

    _fpa.loaded.default();
  }

  $.get('/pages/<%= template_version %>/template').done(function(data) {
    _fpa.status.loaded_templates = true;
    $('body').append(data);

    window.setTimeout(function() {
      one_time_setup();
    }, 1);
  });

  $('html').ready(function(){
    _fpa.status.html_ready = true;
    one_time_setup();
  });
  <% end %>
</script>

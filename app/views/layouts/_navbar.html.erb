<nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
        <a class="navbar-brand" href="/"><%= image_tag app_config_text :logo_filename, 'restructure-logo.svg' %></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <% if current_user && @app_type_switches.length > 1 %>
        <li><span class="select"><%= select_tag :use_app_type, options_for_select( @app_type_switches, selected: current_user.app_type_id), id: 'use_app_type_select', data: {app_type_id: current_user.app_type_id}, class: 'has-value attached-has-value form-control input-sm ff' %></span></li>
        <% end %>

        <%
        if current_user && current_user.app_type_id
          @primary_navs.reject{|a| a[:label].blank? }.each do |nav| %>
        <li <% if nav[:active] %>class="active"<% end %> ><%= link_to nav[:label].html_safe, nav[:url], nav[:extras] %>
          <% if nav[:sub] %>
          <ul class="dropdown-menu" role="menu">
            <% nav[:sub].each do |nav1| %>
            <li <% if nav1[:active] %>class="active"<% end %> ><%= link_to nav1[:label].html_safe, nav1[:url], nav1[:extras] %></li>
            <% end %>
          </ul>
          <% end %>
        </li>
        <%
          end
        end
        %>
      </ul>
      <% if current_user && !app_config_set(:hide_navbar_search) && current_user.app_type_id %>
        <%= form_tag msid_search_path, method: :get,  class: "navbar-form navbar-left", role: "search" do %>
          <div class="form-group">
            <%= text_field_tag :nav_q, params[:nav_q], class: "form-control", placeholder: "MSID Search" %>
            <%= text_field_tag :nav_q_pro_id, params[:nav_q_pro_id], class: "form-control", placeholder: "Pro ID Search" %>
            <%= text_field_tag :nav_q_id, params[:nav_q_id], class: "form-control", placeholder: "Master ID" %>
          </div>
          <%= button_tag '<span class="glyphicon glyphicon-search"></span>'.html_safe, class:"btn btn-default"  %>
          <%= submit_tag "CSV", name: :req_format, value: "csv", class: "btn btn-default"  if current_user.can?(:export_csv)%>
          <%= submit_tag "JSON", name: :req_format, value: "json", class: "btn btn-default target_new_window" if current_user.can?(:export_json) %>

        <% end %>
      <% end %>
      <ul class="nav navbar-nav navbar-right">
      <% @secondary_navs.each do |nav| %>
        <%
          drop = {}
          if nav[:sub]
            drop = {class: "dropdown-toggle", "data-toggle": "dropdown", role: "button", "aria-expanded": "false"}
          else
            drop = {}
          end

          drop.merge! nav[:extras]
        %>
        <li class="dropdown">
            <%= link_to nav[:label].html_safe, nav[:url], drop%>
          <% if nav[:sub] %>
          <ul class="dropdown-menu" role="menu">
            <% nav[:sub].each do |nav1| %>
            <li <% if nav1[:active] %>class="active"<% end %> ><%= link_to nav1[:label].html_safe, nav1[:url], nav1[:extras] %></li>
            <% end %>
          </ul>
          <% end %>
        </li>
        <% end %>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

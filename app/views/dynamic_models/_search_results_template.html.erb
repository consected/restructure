<% DynamicModel.active.each do |m|
  l = []
  full_name = "dynamic_model__#{m.model_def_name.to_s}"
  field_list = m.field_list
  if field_list.blank?
    field_list = m.model_def.attribute_names - ['id', 'created_at', 'updated_at', 'contactid', 'user_id', 'master_id']
    field_list  << 'tracker_history_id' if current_user.has_access_to? :edit, :table, full_name.pluralize
  else
    field_list = field_list.split(',').map {|f| f.strip}
  end

  an = field_list
  if an.length > 1
    l = an
  elsif an.first&.end_with? '_id'
    an.each do |k|
      l << [label: k.to_s.humanize, formatter: 'format_sage_id', attribute: k.to_s]
    end
  else
    l = an
  end

  if m.model_def.attribute_names.include? 'rank'
    data_sort = [:desc, "data-rank"]
  end

%>
<%= render partial: 'common_templates/search_results_template', locals: {
      caption: m.name,
      name: m.model_def_name.to_s,
      full_name: full_name,
      model_data_type: :dynamic_model,
      prevent_edit: !(current_user.has_access_to? :edit, :table, m.full_item_type_name.pluralize),
      prevent_create: !(current_user.has_access_to? :create, :table, m.full_item_type_name.pluralize),
      item_list: l,
      caption_before: m.default_options.caption_before,
      show_if: m.default_options.show_if,
      data_sort: data_sort,
      category: m.category
    } %>
<% end %>

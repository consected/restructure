<% 
@instance_list.each do |oi|
  ovd = oi.versioned_definition 
  ovd.option_configs.each do |otc|
%>
<%= render partial: 'activity_logs/common_search_results_template_item',
                 locals: {
                   def_record: ovd,
                   option_type_config: otc
                 } %>
<% 
    if @embedded_item
      evd = @embedded_item.versioned_definition
      view_type = @embedded_item.model_data_type.to_s.pluralize
      evd.option_configs.each do |etc|

%>
<%=     render partial: "#{view_type}/common_search_results_template_item",
               locals: {
                 def_record: evd,
                 option_type_config: etc
               } %>
<% 
      end 
    end
    
    done_mrs = []
    oi.model_references.each do |mr|
      mrto = mr.to_record
      next unless mrto.respond_to? :versioned_definition
      mrtovd = mrto.versioned_definition
      mrto_view_type = mrto.model_data_type.to_s.pluralize
      
      # Ensure we only do this version once for this type of template
      done_id = "#{mrto_view_type}/#{mrtovd.def_version}"
      next if done_mrs.include? done_id
      
      done_mrs << done_id

      mrtovd.option_configs.each do |mrtoetc|
%>
<%=     render partial: "#{mrto_view_type}/common_search_results_template_item",
               locals: {
                 def_record: mrtovd,
                 option_type_config: mrtoetc
               } %>  
<%
      end
    end
  end 
end 
%>
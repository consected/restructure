<% ActivityLog.active_model_configurations.each do |m|
  l = []


  an = m.implementation_class.view_attribute_list #m.attribute_names - ['id', 'created_at', 'updated_at', 'contactid', 'user_id', 'master_id']

  if an.length > 1
    l = an
  else
    an.each do |k|
      l << [label: k.to_s.humanize, formatter: 'format_sage_id', attribute: k.to_s]
    end
  end

  template_file = "_#{m.model_def_name}_search_results_template.html.erb"

  if File.exist?("#{Rails.root.join 'app', 'views', 'activity_logs', template_file}")
    template_name = "activity_logs/#{m.model_def_name}_search_results_template"
    %>
    <%= render partial: template_name, locals: {
          caption: m.name,
          name: m.item_type_name,
          prevent_edit: true,
          prevent_create: true,
          item_list: l
        } %>

    <%
  else
    template_name = 'activity_logs/common_search_results_template'
    %>
    <%= render partial: template_name, locals: {
          caption: m.name,
          name: m.item_type_name,
          prevent_edit:  !(current_user.has_access_to? :edit, :table, m.full_item_type_name.pluralize),
          prevent_create: !(current_user.has_access_to? :create, :table, m.full_item_type_name.pluralize),
          item_list: l,
          implementation_class: m.implementation_class,
          implementation_class_name: m.item_type_name,
          extra_log_type_configs: m.extra_log_type_configs,
          al_name: m.name,
          rec_type: m.rec_type,
          item_type: m.item_type,
          action_when_attribute: m.action_when_attribute,
          item_type_name: m.item_type_name,
          full_name: m.full_item_type_name,
          blank_log_full_name: "#{m.full_item_type_name}_blank_log",
          blank_log_label: (m.blank_log_name.blank? ? 'General Log' : m.blank_log_name ),
          main_log_label: (m.main_log_name.blank? ? 'Add Log' : m.main_log_name ),
          hide_item_list_panel: !!m.hide_item_list_panel

        }  if current_user.has_access_to?(:access, :table, m.full_item_type_name.pluralize) %>

    <%
  end
end
%>


CREATE OR REPLACE FUNCTION create_message_notification_job(message_notification_id INTEGER) returns INTEGER
LANGUAGE plpgsql
AS $$
DECLARE
  last_id INTEGER;
BEGIN

  INSERT INTO delayed_jobs
  (
    priority,
    attempts,
    handler,
    run_at,
    queue,
    created_at,
    updated_at
  )
  VALUES
  (
    0,
    0,
    '--- !ruby/object:ActiveJob::QueueAdapters::DelayedJobAdapter::JobWrapper
    job_data:
      job_class: HandleMessageNotificationJob
      job_id: ' || gen_random_uuid() || '
      queue_name: default
      arguments:
      - _aj_globalid: gid://fpa1/MessageNotification/' || message_notification_id::varchar || '
      locale: :en',
    now(),
    'default',
    now(),
    now()
  )
  RETURNING id
  INTO last_id
  ;

	RETURN last_id;
END;
$$;
